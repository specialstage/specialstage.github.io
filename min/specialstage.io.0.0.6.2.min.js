function Control(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var f="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",
a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;
ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(h){var g="keydown"==h.type;switch(g||(f+=h.key),3<f.length&&(f=f.slice(1,4)),h.key){case "ArrowUp":a.UP=g;break;case "ArrowDown":a.DOWN=g;break;case "ArrowLeft":a.LEFT=g;break;case "ArrowRight":a.RIGHT=g;break;case "w":a.UP=g;break;case "s":a.DOWN=g;break;case "a":a.LEFT=g;break;case "d":a.RIGHT=g;break;case "r":a.RESET=g;break;case " ":a.SPACE=g;break;case "Shift":a.SHIFT=g;break;case "1":uas.CAM=
1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "5":uas.CAM=5;break;case "6":uas.CAM=6;break;case "7":uas.CAM=7;break;case "8":uas.CAM=8;break;case "9":uas.CAM=9;break;case "0":uas.CAM=10;break;case "Enter":a.ENTER=g;break;case "Control":a.CTRL=g;break;case "Escape":case "Backspace":a.ESC=g;break;case "=":a.ZOOM_IN=g;break;case "-":a.ZOOM_OUT=g;break;case "t":a.TARGET=g;break;case "h":a.HIDE=g;break;case ">":!g&&2>PIXEL_SCALE&&(PIXEL_SCALE+=.5);resize();break;
case "<":!g&&.5<PIXEL_SCALE&&(PIXEL_SCALE-=.5),resize()}!vehicle.REPLAY||MENU||SPECTATE||"vhs"===f&&(ui.print("code detected: ghost data overwrite","2","2"),window.setTimeout(vhs["export"],1E3,state.results,!1),f="")};this.mousedown=function(h){h.preventDefault();a.touches[0]={x:h.clientX,y:h.clientY,start:!0}};this.mouseup=function(h){h.preventDefault();a.touches[0]={x:h.clientX,y:h.clientY,start:!1}};this.touchSetup=function(h){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",
a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(h)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(h){h=
h.touches;a.touches=[];for(var g=0;g<h.length;g++)a.touches[g]={x:h[g].clientX,y:h[g].clientY,start:!0}};this.touchmove=function(h){a.touches=[];h=h.touches;for(var g=0;g<h.length;g++)a.touches[g]={x:h[g].clientX,y:h[g].clientY,start:!1}};this.touchend=function(h){a.touches=[];h=h.touches;for(var g=0;g<h.length;g++)a.touches[g]={x:h[g].clientX,y:h[g].clientY,start:!1}}}
function Generate(){var a=(scope=this).SEED=0;this.length=480;var f=[],h=0;this.BIOMES=f;this.BIOME=0;f[0]={name:"pine",palette:palette[9],tree:function(r,m){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};f[0].map[0]=function(r,m){var l=palette[10],B=!1;return.92<Math.abs(r)&&(l=.92<Math.abs(r)?palette[9]:palette[2],B=!0),f[0].flags[m]=B,l};f[1]={name:"cherry blossom",palette:palette[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,
map:[],flags:[]};f[1].map[0]=function(r,m){var l=palette[1],B=!1;return.95<Math.abs(r)&&(l=.92<Math.abs(r)?palette[12]:palette[1],B=!0),f[1].flags[m]=B,l};f[2]={name:"ice",palette:palette[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};f[2].map[0]=function(r,m){var l=palette[7],B=!1;return.95<Math.abs(r)&&(l=.92<Math.abs(r)?palette[2]:palette[7],B=!0),f[2].flags[m]=B,l};var g=new THREE.Points(new THREE.Geometry);g.name="Generative Extruder";g.visible=!1;var n=new THREE.Line(new THREE.Geometry);
n.name="Generative Nodes";n.visible=!1;n.material.color=palette[6];n.material.name="Node Material";n.position.z+=2;var t=new THREE.LineSegments(new THREE.Geometry);t.name="Generative Segments";t.visible=!0;t.material.color=palette[3];t.material.name="Segments Material";var q=new THREE.Mesh(new THREE.Geometry);q.name="Generative Surface";q.visible=!1;q.material.color=palette[0];q.material.name="Surface Material";var x=new THREE.LineSegments(new THREE.Geometry);x.name="Generative Perimeter";x.material.color=
palette[1];x.material.name="Perimeter Material";var b=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));b.name="Terrain";b.material.name="Terrain Material";b.material.wireframe=!0;b.material.side=THREE.DoubleSide;b.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=
THREE.FrontSide;wireframe.visible=!0;var c=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));c.name="Trees";var k=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);k.name="Background";k.material.color=palette[0];k.material.name="Background Material";k.material.wireframe=!1;k.material.side=THREE.FrontSide;k.material.opacity=.75;k.material.blendMode=THREE.MultiplyBlending;k.material.transparent=!0;var e=new THREE.Points(new THREE.Geometry);
e.material.color=palette[1];e.material.sizeAttenuation=!1;e.material.size=1.5;e.material.fog=!1;scope.stars=e;var p=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);p.name="Collision Mesh";p.visible=!0;p.material.name="Collision Material";p.material.side=THREE.BackSide;this.checkpoints=[];var A=new THREE.Vector3(0,0,1),I=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var K=new THREE.Vector3(0,3,0),W=new THREE.Vector3(0,0,1),R=n.geometry.clone(),u=q.geometry.clone(),
z=t.geometry.clone(),C=x.geometry.clone(),F=[],J=[],Y=new THREE.Vector3;F[0]=new THREE.Vector3(5,3,0);F[1]=new THREE.Vector3(-5,3,0);J[0]=F[0].clone();J.z+=1;J[1]=F[1].clone();J.z+=1;var O=Math.PI/64,N=Math.PI/32,T=[],aa=0,Z=new THREE.Vector3;this.start=new THREE.Vector3;var ba=!1,U=!1,V=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var na=18,oa=new THREE.Raycaster;oa.far=800;g.geometry.vertices[0]=K.clone();g.geometry.vertices[1]=A.clone().add(K);g.geometry.vertices[2]=F[0].clone();g.geometry.vertices[3]=
F[1].clone();g.geometry.vertices[4]=J[0].clone();g.geometry.vertices[5]=J[1].clone();this.connect=function(){scope.SEED=SEED;this.BIOME=h=scope.randomInt(0,3);stage.SNOW=2===h;stage.SNOW&&stage.snow.init();scene.add(g);scene.add(n);scene.add(t);scene.add(x);scene.add(q);scene.add(wireframe);scene.add(k);aa=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var r in T=[],scene.remove(g),scene.remove(n),scene.remove(t),scene.remove(x),scene.remove(q),scene.remove(wireframe),
scene.remove(k),scene.remove(c),f)f[r].flag=[];for(var m in scope.checkpoints)scene.remove(scope.checkpoints[m].display),scope.checkpoints[m].display.geometry.dispose(),scope.checkpoints[m].collision.geometry.dispose()};this.complete=function(){p.geometry.mergeVertices();p.geometry.verticesNeedUpdate=!0;p.geometry.elementsNeedUpdate=!0;p.geometry.computeFaceNormals();p.geometry.computeVertexNormals();p.geometry.computeBoundingSphere();k.geometry.copy(p.geometry);--k.position.z;for(var r=[],m=0;m<
p.geometry.faces.length;m++)r[p.geometry.faces[m].a]=p.geometry.faces[m].vertexNormals[0].clone(),r[p.geometry.faces[m].b]=p.geometry.faces[m].vertexNormals[1].clone(),r[p.geometry.faces[m].c]=p.geometry.faces[m].vertexNormals[2].clone();for(m=0;m<p.geometry.vertices.length;m++)p.geometry.vertices[m].add(r[m].multiplyScalar(2));p.geometry.verticesNeedUpdate=!0;p.geometry.computeFaceNormals();p.geometry.computeVertexNormals();p.geometry.computeBoundingSphere();wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=
!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();r=new THREE.IcosahedronGeometry(1200,10);for(var l in r.vertices).3>scope.random()&&-400<r.vertices[l].z&&e.geometry.vertices.push(r.vertices[l].clone());r.dispose();e.geometry.computeBoundingSphere();stage.surface=p.clone();stage.start=scope.start.clone();aa=window.performance.now()-aa;ba=!0;scope.END=!0;FIREBASE&&firebase.analytics().logEvent("stage_generation_complete",
{time:Math.round(aa/1E3)});BATTLE?(ui.clear(),vehicle.connect(stage.start,stage.surface),vehicle.PLAY=!1,vhs.PLAY=!0):state.ready()};this.reset=function(){na=(36+scope.random()-.5)/2;a=0;n.geometry.dispose();t.geometry.dispose();q.geometry.dispose();g.geometry.dispose();x.geometry.dispose();b.geometry.dispose();wireframe.geometry.dispose();p.geometry.dispose();c.geometry.dispose();e.geometry.dispose();z.dispose();C.dispose();R.dispose();u.dispose();z.copy(new THREE.Geometry);C.copy(new THREE.Geometry);
R.copy(new THREE.Geometry);u.copy(new THREE.Geometry);n.geometry.copy(new THREE.Geometry);g.geometry.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);x.geometry.copy(new THREE.Geometry);q.geometry.copy(new THREE.Geometry);b.geometry.copy(new THREE.Geometry);p.geometry.copy(new THREE.Geometry);K.set(0,3,0);W.set(0,0,1);F[0]=new THREE.Vector3(4,3,0);F[1]=new THREE.Vector3(-4,3,0);ba&&(ba=!1,U=!1,V=!1);this.END=!1;g.position.set(0,0,0);g.geometry.vertices[0]=K.clone();g.geometry.vertices[1]=
A.clone().add(K);g.geometry.vertices[2]=F[0].clone();g.geometry.vertices[3]=F[1].clone();g.geometry.vertices[4]=J[0].clone();g.geometry.vertices[5]=J[1].clone();g.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(r,m,l,B,y,w,M,D,H,G){r=void 0===r?0:r;m=void 0===m?0:m;l=void 0===l?0:l;B=void 0===B?0:B;y=void 0===y?0:y;w=void 0===w?{start:0,end:30,angle:0,slope:0}:w;M=void 0===M?[]:M;D=void 0===D?[]:D;H=void 0===H?!1:H;G=void 0===G?999:G;var L=window.performance.now(),
P=0;for(0===B&&(B=.5<scope.random()?1:-1);32>P&&!U;){if(r===w.end+1){D=[];for(l=0;1>l;l++)if(r>=scope.length)D.push({angle:0,slope:0,end:30}),G=r+30;else if(0===m){var Q=scope.randomInt(2,4)*B;P=Math.floor(Math.abs(36/Q));B=.01>scope.random()?+B:-1*B;P=scope.randomInt(1,P);D.push({angle:Q,slope:0,end:P})}else Q=scope.randomInt(-5,-1),P=scope.random(),Q=2!==h&&.05>P?Q*=-1:Q,P=scope.randomInt(2,20),D.push({angle:0,slope:Q,end:P});P=scope.randomInt(0,D.length);m=D[P].angle;l=D[P].slope;w.start=r;w.end=
r+D[P].end;D=D.slice(P,1)}if(H||(scope.extrude(m,l),T.push({angle:m,slope:l}),R.verticesNeedUpdate=!0,r++),10<=r&&!H){P=new THREE.Vector2(R.vertices[r-1].x,R.vertices[r-1].y);for(Q=0;Q<R.vertices.length-1-10;Q++)if(18>(new THREE.Vector2(R.vertices[Q].x,R.vertices[Q].y)).distanceTo(P)){H=!0;break}H&&window.setTimeout(stage.reset(!0),0)}0;r===G&&(U=!0,n.geometry.dispose(),n.geometry=R.clone(),n.geometry.computeBoundingSphere(),n.geometry.center(),n.updateMatrixWorld(),0<n.geometry.vertices.length&&
(Z.copy(n.geometry.vertices[0]),Z.sub(R.vertices[0])),window.setTimeout(function(){state.PATH=!0;state.STATE();scope["import"]()},0));P=window.performance.now()-L}U||H||window.setTimeout(scope.path,0,r,m,l,B,y,w,M,D,H,G)};this.skijump=function(r,m,l,B,y,w,M,D,H,G,L){r=void 0===r?0:r;m=void 0===m?0:m;l=void 0===l?0:l;B=void 0===B?0:B;y=void 0===y?0:y;w=void 0===w?{start:0,end:20,angle:0,slope:0}:w;M=void 0===M?[]:M;D=void 0===D?[]:D;H=void 0===H?!1:H;G=void 0===G?300:G;L=void 0===L?0:L;var P=window.performance.now(),
Q=0;for(0===B&&(B=.5<scope.random()?1:-1);32>Q&&!U;){if(r===w.end+1){D=[];for(m=0;1>m;m++)0===l&&20===w.end?(L=-1,D.push({angle:0,slope:-4,end:30})):3===l?D.push({angle:0,slope:4,end:3}):4===l?D.push({angle:0,slope:-32,end:10}):-4===l?(L=1,D.push({angle:0,slope:l+1,end:1})):-32===l?D.push({angle:0,slope:-4,end:40}):1==L?D.push({angle:0,slope:l+1,end:1}):-1==L&&D.push({angle:0,slope:l-1,end:1});Q=scope.randomInt(0,D.length);m=D[Q].angle;l=D[Q].slope;w.start=r;w.end=r+D[Q].end;D=D.slice(Q,1)}if(H||
(scope.extrude(m,l),T.push({angle:m,slope:l}),R.verticesNeedUpdate=!0,r++),10<=r&&!H){Q=new THREE.Vector2(R.vertices[r-1].x,R.vertices[r-1].y);for(var ea=0;ea<R.vertices.length-1-10;ea++)if(0>(new THREE.Vector2(R.vertices[ea].x,R.vertices[ea].y)).distanceTo(Q)){H=!0;break}H&&window.setTimeout(stage.reset(!0),0)}0;G<=r&&(U=!0,n.geometry.dispose(),n.geometry=R.clone(),n.geometry.computeBoundingSphere(),n.geometry.center(),n.updateMatrixWorld(),0<n.geometry.vertices.length&&(Z.copy(n.geometry.vertices[0]),
Z.sub(R.vertices[0])),window.setTimeout(function(){scope["import"]()},0));Q=window.performance.now()-P}U||H||window.setTimeout(scope.skijump,0,r,m,l,B,y,w,M,D,H,G)};this["import"]=function(r){r=void 0===r?0:r;for(var m=window.performance.now(),l=0;!V&&32>l;){if(0===r&&(g.position.set(0,0,0),g.rotation.z=0,K.set(0,3,0),g.geometry.vertices[0]=K.clone(),g.geometry.vertices[1]=A.clone().add(K),g.geometry.vertices[2]=F[0].clone(),g.geometry.vertices[3]=F[1].clone(),g.geometry.vertices[4]=J[0].clone(),
g.geometry.vertices[5]=J[1].clone(),g.geometry.verticesNeedUpdate=!0,g.updateMatrixWorld()),r<T.length)a=r,angle=T[r].angle,slope=T[r].slope,scope.extrude(angle,slope),t.geometry.dispose(),t.geometry=z.clone(),t.geometry.computeBoundingSphere(),x.geometry.dispose(),x.geometry=C.clone(),x.geometry.computeBoundingSphere(),q.geometry.dispose(),q.geometry=u.clone(),q.geometry.computeBoundingSphere(),r++;else if(!V&&r===T.length){for(var B in scope.checkpoints=scope.checkpoint(),scope.checkpoints)scene.add(scope.checkpoints[B].display);
V=!0;window.setTimeout(function(){scope.terrain(!0)},0)}l=window.performance.now()-m}V||window.setTimeout(scope["import"],0,r,angle,slope)};this.extrude=function(r,m){r=void 0===r?0:r;m=void 0===m?0:m;for(var l in g.updateMatrixWorld(),g.rotateZ(r*N),g.geometry.vertices)g.geometry.vertices[l].applyAxisAngle(I,m*O);g.geometry.verticesNeedUpdate=!0;l=g.geometry.vertices[0].clone();var B=g.geometry.vertices[2].clone(),y=g.geometry.vertices[3].clone(),w=g.geometry.vertices[1].clone();if(l.applyMatrix4(g.matrix),
B.applyMatrix4(g.matrix),y.applyMatrix4(g.matrix),w.applyMatrix4(g.matrix),w.sub(l),U){if(B.add(Z),y.add(Z),0<z.vertices.length){var M=z.vertices[z.vertices.length-1].clone().sub(Y),D=z.vertices[z.vertices.length-2].clone().sub(Y);u.vertices.push(B.clone().sub(w));u.vertices.push(y.clone().sub(w));u.vertices.push(D);u.vertices.push(y.clone().sub(w));u.vertices.push(M);u.vertices.push(D);var H=B.clone();r=y.clone();M=z.vertices[z.vertices.length-1].clone();D=z.vertices[z.vertices.length-2].clone();
p.geometry.vertices.push(H);p.geometry.vertices.push(r);p.geometry.vertices.push(D);p.geometry.vertices.push(r);p.geometry.vertices.push(M);p.geometry.vertices.push(D);M=u.vertices.length;var G=new THREE.Face3(M-3,M-2,M-1);H=new THREE.Face3(M-5,M-4,M-6);u.faces.push(G);u.faces.push(H);G=G.clone();H=H.clone();G.color=new THREE.Color(16777215);H.color=new THREE.Color(16777215);p.geometry.faces.push(G);p.geometry.faces.push(H)}0<C.vertices.length?(G=2,H=1,4<C.vertices.length&&(G=4,H=2),G=C.vertices[C.vertices.length-
G].clone(),H=C.vertices[C.vertices.length-H].clone(),C.vertices.push(B.clone().add(w)),C.vertices.push(G.clone()),C.vertices.push(y.clone().add(w)),C.vertices.push(H.clone()),a==T.length-1&&(D=B.clone().add(w),M=y.clone().add(w),C.vertices.push(D),C.vertices.push(M))):(C.vertices.push(B.clone().add(w)),C.vertices.push(y.clone().add(w)));z.vertices.push(B.clone());z.vertices.push(y.clone());Y.copy(w)}else R.vertices.push(l.clone());for(var L in K.copy(l).sub(g.position),g.position.add(K),g.geometry.vertices)g.geometry.vertices[L].applyAxisAngle(I,
-1*m*O)};this.terrain=function(r,m,l,B,y,w,M){m=void 0===m?[]:m;l=void 0===l?[]:l;B=void 0===B?[]:B;y=void 0===y?0:y;w=void 0===w?0:w;M=void 0===M?0:M;if(void 0===r||r){t.updateMatrixWorld();b.geometry.dispose();b.geometry.copy(new THREE.Geometry);m=[];l=[];B=[];for(r=0;2>r;r++)B[r]=[],m[r]=[],l[r]=[];for(r=0;r<t.geometry.vertices.length;r++)l[r%2].push(t.geometry.vertices[r]);for(r=0;2>r;r++)for(var D=0;D<l[r].length;D++){var H=0===r?1:-1,G=l[r][D].clone();G.sub(l[r+H][D]);G.normalize().multiplyScalar(3);
B[r][D]=G.clone()}}D=0;var L;r=window.performance.now();if(4>y){if(b.geometry.verticesNeedUpdate=!0,b.geometry.elementsNeedUpdate=!0,b.geometry.computeBoundingSphere(),b.geometry.computeFaceNormals(),b.geometry.computeVertexNormals(),b.updateMatrixWorld(),0<y&&0===M)for(l[w]=[],H=0;H<m[w].length;H++)l[w][H]=b.geometry.vertices[m[w][H]];0===M&&(m[w]=[]);for(v=M;v<l[w].length&&32>D;){D=!1;if(void 0!==l[w][v]&&void 0!==l[w][v-1]){if(void 0===B[w][v])B[w][v]=B[s][v-1].clone();else if(b.geometry.computeBoundingSphere(),
H=l[w][v].clone().add(B[w][v]),H.z-=100,oa.set(H,A),H.z+=100,G=oa.intersectObjects([b],!0),0<G.length)for(var P in G).01<G[P].point.distanceTo(H)&&(m[w][v]=void 0,D=!0);D||(b.geometry.vertices.push(l[w][v].clone()),b.geometry.vertices.push(l[w][v].clone().add(B[w][v])),m[w][v]=b.geometry.vertices.length-1,0<v&&(b.geometry.vertices.push(l[w][v-1].clone()),L=b.geometry.vertices.length,0===w?b.geometry.faces.push(new THREE.Face3(L-2,L-1,L-3)):1===w&&b.geometry.faces.push(new THREE.Face3(L-1,L-2,L-3))))}D=
window.performance.now()-r;v++;M=v}if(M===l[w].length){M=0;for(L=1;L<m[w].length;L++)if(void 0!==m[w][L]&&void 0!==m[w][L-1]){P=b.geometry.vertices[m[w][L]];var Q;r=b.geometry.vertices[m[w][L-1]];2.8>P.distanceTo(r)?(P.copy(r),m[w][L]=m[w][L-1],B[w][L].copy(B[w][L-1])):1<L&&(b.geometry.vertices.push(l[w][L-1]),Q=0===w?m[w][L]:m[w][L-1],r=0===w?m[w][L-1]:m[w][L],b.geometry.faces.push(new THREE.Face3(Q,r,b.geometry.vertices.length-1)))}w++}1<w&&(w=0,y++)}if(4===y){b.geometry.verticesNeedUpdate=!0;b.geometry.elementsNeedUpdate=
!0;b.geometry.colorsNeedUpdate=!0;b.geometry.computeFaceNormals();b.geometry.computeVertexNormals();b.geometry.mergeVertices();b.geometry.computeBoundingSphere();scope.noise(b.geometry);for(Q=0;Q<b.geometry.faces.length;Q++)P=b.geometry.vertices[b.geometry.faces[Q].a].clone(),r=b.geometry.vertices[b.geometry.faces[Q].b].clone(),L=b.geometry.vertices[b.geometry.faces[Q].c].clone(),b.geometry.colors[b.geometry.faces[Q].a],b.geometry.colors[b.geometry.faces[Q].b],b.geometry.colors[b.geometry.faces[Q].c],
p.geometry.vertices.push(P),p.geometry.vertices.push(r),p.geometry.vertices.push(L),wireframe.geometry.vertices.push(P),wireframe.geometry.vertices.push(r),wireframe.geometry.vertices.push(L),L=p.geometry.vertices.length,P=new THREE.Face3(L-1,L-2,L-3),P.color=new THREE.Color(0),p.geometry.faces.push(P),wireframe.geometry.faces.push(new THREE.Face3(L-1,L-2,L-3));wireframe.geometry.copy(b.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,
m.slice(),l.slice(),B.slice(),y,w,M)},0)};this.biome=function(){for(var r=h,m=wireframe.geometry.faces,l=[],B=[],y=0;y<m.length;y++)for(var w=0;w<f[h].map.length;w++)m[y].vertexColors[0]=f[h].map[w](m[y].vertexNormals[0].z,m[y].a),m[y].vertexColors[1]=f[h].map[w](m[y].vertexNormals[1].z,m[y].b),m[y].vertexColors[2]=f[h].map[w](m[y].vertexNormals[2].z,m[y].c);for(m=0;m<f[h].flags.length;m++)for(y=0;y<t.geometry.vertices.length;y++).1>wireframe.geometry.vertices[m].distanceTo(t.geometry.vertices[y])&&
(f[h].flags[m]=!1);for(m=0;m<f[h].flags.length;m++)f[h].flags[m]&&l.push(m);for(m=0;m<f[h].limit&&m<l.length;){y=scope.randomInt(0,l.length);w=!0;if(0<B.length&&0<l.length)for(;w;){for(var M in B){if(wireframe.geometry.vertices[l[y]].distanceTo(wireframe.geometry.vertices[B[M]])<f[h].range){w=!0;l.slice(y,1);y=scope.randomInt(0,l.length);break}w=!1}0>=l.length&&(w=!1)}if(0<l.length){w=f[r].tree();for(var D in w.vertices)c.geometry.vertices.push(w.vertices[D].clone().add(wireframe.geometry.vertices[l[y]])),
c.geometry.colors[c.geometry.vertices.length-1]=w.colors[D];B.push(l[y]);l.slice(y,1)}m++}c.verticesNeedUpdate=!0;c.elementsNeedUpdate=!0;scene.add(c)};this.sakura=function(){var r=new THREE.Geometry,m=[],l=[],B=1,y,w=new THREE.Vector3(0,0,0),M=new THREE.Vector3(0,0,3),D=12,H=0,G=new THREE.Vector3(1,0,0),L=new THREE.Vector3(0,0,1);r.vertices.push(w);r.vertices.push(M);r.colors.push(palette[2]);r.colors.push(palette[2]);l.push({v:M.clone(),n:M.clone(),pitch:G.clone(),roll:L.clone()});for(w=[];4>H;){M=
[];for(G=0;G<l.length;G++)for(var P=L=0;3>P;P++){var Q=0===H&&2===P&&1>L?1:scope.random();if(.2<Q){Q=scope.randomInt(-2,2);var ea=l[G].n.clone(),ka=palette[2];ea.applyAxisAngle(l[G].pitch,2*Math.PI/(D+Q));ea.applyAxisAngle(l[G].roll,2*Math.PI/3*P);ea.multiplyScalar(B);Q=ea.clone().add(l[G].v);r.vertices.push(l[G].v.clone());r.vertices.push(Q);r.colors.push(ka);r.colors.push(ka);ka=l[G].pitch.clone();ka.applyAxisAngle(l[G].roll,2*Math.PI/3*P);ka.applyAxisAngle(l[G].pitch,2*Math.PI/D);var ca=l[G].roll.clone();
ca.applyAxisAngle(l[G].pitch,2*Math.PI/D);ca.applyAxisAngle(l[G].roll,2*Math.PI/3*P);0<P&&m.push({a:Q.clone(),b:l[G].v.clone(),pitch:ka,roll:ca});M.push({v:Q.clone(),n:ea.clone(),pitch:ka,roll:ca});L++}else 0===L&&2===P&&w.push({v:l[G].v.clone(),n:l[G].n.clone(),pitch:l[G].pitch.clone(),roll:l[G].roll.clone()})}l=M.slice();B*=.9;H++}for(y in D=6,m)B=m[y].a.clone(),M=m[y].b.clone(),B=B.clone().sub(M),G=B.clone().multiplyScalar(.5).add(M),H=scope.randomInt(0,3)-1,B.applyAxisAngle(m[y].pitch,2*Math.PI/
D),B.applyAxisAngle(m[y].roll,2*Math.PI/H),B.multiplyScalar(.5),M=G,G=B.clone().add(G),r.vertices.push(M),r.vertices.push(G),r.colors.push(palette[2]),r.colors.push(palette[2]),M=m[y].pitch.clone(),M.applyAxisAngle(m[y].roll,2*Math.PI/H),M.applyAxisAngle(m[y].pitch,2*Math.PI/D),L=m[y].roll.clone(),L.applyAxisAngle(m[y].pitch,2*Math.PI/D),L.applyAxisAngle(m[y].roll,2*Math.PI/H),l.push({v:G.clone(),n:B.clone(),pitch:M,roll:L});l=l.concat(w);for(m=0;m<l.length;m++)for(y=0;5>y;y++)D=l[m].n.clone(),D.normalize(),
D.applyAxisAngle(l[m].pitch,2*Math.PI/6),D.applyAxisAngle(l[m].roll,2*Math.PI/5*y),D.multiplyScalar(.5),D=D.add(l[m].v),w=l[m].v.clone(),r.vertices.push(D),r.vertices.push(w),r.colors.push(palette[12]),r.colors.push(palette[12]);return r.colorsNeedUpdate=!0,r};this.pine=function(){var r=Math.floor(8*scope.random())+6,m=2*Math.PI/6,l=new THREE.Geometry;l.vertices.push(new THREE.Vector3(0,0,0));l.vertices.push(new THREE.Vector3(0,0,+r-.5+1));l.colors.push(palette[9]);l.colors.push(palette[9]);l.colors.push(palette[9]);
for(var B=1;B<r;B++)for(var y=0;6>y;y++)off=B%2*m*.5,l.vertices.push(new THREE.Vector3(0,0,+B+1)),l.vertices.push(new THREE.Vector3(.3*(r-B),0,+B-.3+1)),l.vertices[l.vertices.length-1].applyAxisAngle(A,m*y+off),l.colors.push(palette[9]),l.colors.push(palette[9]);return l};this.checkpoint=function(){function r(y,w,M){var D=new THREE.Geometry,H=(new THREE.Vector3).copy(y).sub(w),G=(new THREE.Vector3).copy(y).add(H.clone().multiplyScalar(1.5));H=(new THREE.Vector3).copy(w).sub(H.clone().multiplyScalar(1.5));
D.vertices.push(new THREE.Vector3(G.x,G.y,G.z-12));D.vertices.push(new THREE.Vector3(G.x,G.y,G.z+12));D.vertices.push(new THREE.Vector3(H.x,H.y,H.z+12));D.vertices.push(new THREE.Vector3(H.x,H.y,H.z+12));D.vertices.push(new THREE.Vector3(H.x,H.y,H.z-12));D.vertices.push(new THREE.Vector3(G.x,G.y,G.z-12));D.faces.push(new THREE.Face3(0,1,2));D.faces.push(new THREE.Face3(3,4,5));G=new THREE.Geometry;G.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));G.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));
G.vertices.push(new THREE.Vector3(w.x,w.y,w.z+6));G.vertices.push(new THREE.Vector3(w.x,w.y,w.z+8));G.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));G.vertices.push(new THREE.Vector3(w.x,w.y,w.z+6));G.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));G.vertices.push(new THREE.Vector3(w.x,w.y,w.z+8));G.vertices.push(new THREE.Vector3(y.x,y.y,y.z+1));G.vertices.push(new THREE.Vector3(w.x,w.y,w.z+1));y=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});y.color=palette[5];D=new THREE.Mesh(D,
y);D.visible=!0;y=new THREE.LineSegments(G,y);return D.name="Objective "+M,y.name="Checkpoint"+M,{display:y,collision:D}}var m=t.geometry,l=m.vertices.length-80;l=Math.floor(l/4)-Math.floor(l/4)%2;var B=[];B[0]=r(m.vertices[40],m.vertices[41],0);B[1]=r(m.vertices[40+l],m.vertices[1+l+40],1);B[2]=r(m.vertices[2*l+40],m.vertices[2*l+41],2);B[3]=r(m.vertices[3*l+40],m.vertices[3*l+41],3);B[4]=r(m.vertices[4*l+40],m.vertices[4*l+41],4);this.DISTANCE=4*l/2*3;scope.start.copy(m.vertices[36]);scope.start.sub(m.vertices[37]);
scope.start.multiplyScalar(-.75);scope.start.add(m.vertices[36]);for(m=0;5>m;m++)null==stage.best&&(stage.best[m]=4>m?l*(m+1)/na:stage.best[m]=stage.best[m-1]);return state.STATE(),B};this.resetCheckpoints=function(){for(var r in scope.checkpoints)scope.checkpoints[r].display.material.color=palette[5]};this.random=function(){SEED=(SEED+1)%2147483647;var r=1E4*Math.sin(SEED);return r-Math.floor(r)};this.randomInt=function(r,m){return Math.floor(scope.random()*(m-r))+r};this.noise=function(r){var m=
new ImprovedNoise,l=[],B=8,y=0,w=0,M=1E3*scope.random();h;for(var D=0;D<r.vertices.length;D++)l[D]=0;for(D=0;2>D;D++){for(var H=0;H<r.vertices.length;H++)l[H]+=Math.floor(m.noise(r.vertices[H].x/B,r.vertices[H].y/B,M)*B),l[H]>y&&(y=l[H]),l[H]<w&&(w=l[H]);B*=3}for(m=0;m<l.length;m++){B=2===h?2:.5;for(y=0;y<t.geometry.vertices.length;y++)w=r.vertices[m].distanceTo(t.geometry.vertices[y]),w=w*w/100,w<B&&(B=w);r.vertices[m].z+=l[m]*B}};this.name=function(){var r="";if(CUSTOM_SEED)r=state.custom_seed;
else if(CHALLENGE||BATTLE)r=state.CHALLENGES.seed;else{var m=[" forest"," pass"," mountain"],l="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var B=Math.ceil(3*Math.random())+1,y=0;y<B;)r+=l[Math.floor(Math.random()*l.length)],y++;l=2===h?1:0;l=m[Math.floor(l+Math.random()*(m.length-l))];r+=l;(.04<Math.random()||r!==LAST_SEED)&&(r="",l=Math.floor(Math.random()*seeds.length),
r=seeds[l])}return LAST_SEED=r,this.BIOME=h,r}}
var Ghost=function(a,f,h,g,n){h=void 0===h?0:h;g=void 0===g?[]:g;var t=[];this.inputs=[];this.name=void 0===n?"":n;this.cp=g;t[0]={name:"logistics crate",geometry:function(){return MODEL.logistics_crate()}};t[1]={name:"ag-86",geometry:function(){return MODEL.ag_86()}};n=void 0===f?0:f;f=h;var q=a.slice();this.PHYSICS=q;var x=0,b=new THREE.Vector3(0,0,1);q[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;
this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var c=t[n].geometry(),k=new THREE.MeshBasicMaterial({color:PAINT[f]}),e=new THREE.LineSegments(c,k);e.visible=!0;e.name="ghost_"+ghost.length;e.position.copy(q[0].position);scene.add(e);var p=new MODEL.emitter;p.connect(PAINT[h]);0===stage.best.length||g[4]<stage.best[4]&&(g[5],stage.best[5]);uas.TARGETS.push(this);SPECTATE&&(uas.TARGET=1);this.reset=function(){TIME.reset();
p.reset();x=0};this.update=function(A){this.index(A);var I=(1E3/60-(q[x].time-A))/(1E3/60),K=q[x].U;0!==x&&0!==A||(x=1,I=0,K=!1);A=this.velocity.length();p.update(K,this.position,this.direction,A);A=this.normal.clone();A.add(this.position);e.position.copy(this.position);e.lookAt(A);e.rotateOnAxis(b,this.rotation);this.interpolate(I);this.lookAt.copy(this.position);this.velocity.copy(q[x].position);this.velocity.sub(q[x-1].position)};this.interpolate=function(A){this.position.copy(q[x-1].position);
this.position.lerp(q[x].position,A);this.normal.copy(q[x-1].normal);this.normal.lerp(q[x].normal,A);this.rotation=q[x].rotation;this.rotation-=q[x-1].rotation;this.rotation*=A;this.rotation+=q[x].rotation;this.direction.copy(q[x-1].direction);this.direction.lerp(q[x].direction,A)};this.discrete=function(){this.position.copy(q[x].position);this.rotation=q[x].rotation;this.normal.copy(q[x].normal)};this.index=function(A){if(x=0,A<=q[q.length-2].time)for(;q[x].time<=A;)x++;else x=q.length-2};this.toggleEmitter=
function(A){void 0===A||A?p.connect():p.disconnect()};this.disconnect=function(){scene.remove(e);c.dispose();k.dispose();p.disconnect()};this.debug=function(){console.log(q)};this.hide=function(){e.visible=!1};this.show=function(){e.visible=!0}},BUILD="0.0.6.2",DB_BUILD="006";window.onload=init;window.onresize=resize;window.fullscreenchange=resize;window.focus=resize;
var seeds="artology forest;coen mountain;coffee forest;coyote forest;deadmans wonderland;development mountain;do it pass;eenetsu pass;ego mountain;ghxst mountain;ghxst pass;ghxstly forest;ginko mountain;haunted forest;hoekage mountain;ifuta pass;jaywalk pass;kae mountain;lotus mountain;low tunnel pass;lyla forest;mach mountain;mew mountain;nephil pass;nminke pass;ogj route;olive forest;ovo mountain;pine forest;prey first pass;r3 mountain;r3evaluate pass;ratty mountain;rekenase mountain;rex mountain;rutsuyo pass;sheep pass;shinigami graveyard;sleeping forest;the lotus order;tofu route;tora forest;tora tora pass;totoworo forest;ultra mountain;utopia district;vr pass;wasabi mountain;zynra mountain".split(";"),palette=
[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],e$jscomp$70;for(e$jscomp$70 in palette){var Mf=new THREE.Color(palette[e$jscomp$70]);palette[e$jscomp$70]=Mf}
var PAINT=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],PAINT_NAME="snow sakura melon peach bumblebee lavender ice".split(" "),LOADSTATUS=0,PERSONAL_BEST=!1,SEED_NAME="",CUSTOM_SEED="",SEED=Math.floor(2147483647*Math.random()),LAST_SEED="",scene,camera,renderer,stage,vehicle,control,ui,vhs,state,ghost=[],TIMESTEP=1E3/60,SCORE_LIMIT=99,GHOST_LIMIT=10,GHOST_SOFT_LIMIT=9,RAID_LIMIT=20,GHOST_PRIORITY=0,GHOST_EMITTER=!0,GHOST_TIME_STAMP=0,GHOST_TIME_START=0,REPLAY_START_TIME=5E3,REPLAY_TIMER=
!1,UAS_IS_ACTIVE,UAS_ENABLED=!1,UAS_IS_TRACKING=!1,UAS_IS_FOLLOWING=!1,REGISTER=!1,UID=null,NAME="",UP,PLAY=!1,IMPORT=!1,BG=palette[0],FRAME=0,CURSOR=!1,FPS=0,COUNTER=0,TIMEOUT=0,DNF=!1,REASON="out of bounds",FULLSCREEN=!1,MODE=0,LOAD=0,LOADING=!1,MENU=!1,MOBILE=!1,CHALLENGE=!1,OBJECTIVES=[],UPDATES=[],HITBOX=!0,FIREBASE=!0,SCALE=1,RESIZE_SCALE=1,SNOW=!1,RAFID=0,GLOBAL_TS,GLOBAL_DT,GLOBAL_TS_START,GLOBAL_LAST_TS,MUSIC=!1,MUSIC_PAUSE=!1,MIXTAPE="low recordings 0.0.6 feature mix",sound,CHALLENGES=[],
BATTLE=!1,SPECTATE=!1,SPECTATE_INTRO=!1,SPECTATE_ENTRIES=!1,SPECTATE_RESULTS=!1,SPECTATE_PRESENT=!1,HIDE=!1,PIXEL_SCALE=1,TV=!0,firebaseConfig={apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"};
function init(){window.addEventListener("touchstart",activateTouch);window.addEventListener("contextmenu",function(){event.preventDefault()});scene=new THREE.Scene;scene.background=BG;UP=new THREE.Vector3(0,0,1);camera=new THREE.PerspectiveCamera;camera.up=UP;camera.position.z=2E3;camera.lookAt(0,0,0);camera.fov=70;camera.near=1E-5;camera.far=3E3;camera.name="Camera";scene.add(camera);renderer=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});renderer.setClearColor(BG);
renderer.domElement.id="renderer";renderer.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(renderer.domElement);control=new Control;control.connect();ui=new UI;stage=new Stage;vehicle=new Vehicle;vhs=new VHS;state=new State;state.login();state.checksave();state.decodeURL();uas=new UAS;uas.connect();ui.onload=function(){ui.format(1,"#50ffae");ui.format(2,"#999999");ui.format(3,"#75e8ff");ui.format(4,"#ff7272");ui.format(5,"#eeeeee");ui.format(6,"#DA4DFA");camera.position.set(0,
25,10);camera.lookAt(0,0,0);resize();main();state.intro()}}function activateTouch(){MOBILE=!0;window.removeEventListener("touchstart",activateTouch)}function resize(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,f=window.innerWidth,h=window.innerHeight;camera.aspect=f/h;camera.updateProjectionMatrix();ui.resize(f,h,a,PIXEL_SCALE);state.resize(f,h,a)}
function main(){if(window.requestAnimationFrame(main),RAFID=window.performance.now(),!PLAY||vehicle.IMPORT||SPECTATE)if(vehicle.REPLAY&&!PLAY){DT();stage.update();vehicle.update();uas.update(vehicle.TIMESTAMP);var a=0;0<ghost.length&&!vehicle.IMPORT&&SPECTATE_PRESENT&&SPECTATE?(a=1E4,SPECTATE&&vehicle.TIMESTAMP<=a-2E3&&!1===SPECTATE_ENTRIES&&(SPECTATE_ENTRIES=!0,state.stageReplay()),SPECTATE&&vehicle.TIMESTAMP>10*ghost[0].cp[4]+a+4E3&&(SPECTATE_RESULTS||(SPECTATE_RESULTS=!0,state.stageResults())),
SPECTATE&&vehicle.TIMESTAMP>10*ghost[0].cp[4]+a+2E4&&(SPECTATE_INTRO=!1,SPECTATE_ENTRIES=!1,SPECTATE_RESULTS=!1,vehicle.reset(!0))):SPECTATE&&0<ghost.length&&vehicle.TIMESTAMP>10*ghost[0].cp[4]+5E3+a&&vehicle.reset(!0);for(var f=0;f<ghost.length;f++)ghost[f].update(vehicle.TIMESTAMP-a,vehicle.FRAME)}else if(LOADING||vhs.SCAN&&!PLAY)camera.up.set(0,0,1),camera.position.applyAxisAngle(camera.up,.01),camera.lookAt(new THREE.Vector3),LOADING&&state.loading(),state.scanning();else{if(SPECTATE||vehicle.IMPORT){for(a=
"";a.length<Math.floor(RAFID/500)%4;)a+=".";ui.clear();ui.text("importing ghost data"+a,16,16);stage.update()}camera.up.set(0,0,1);camera.position.applyAxisAngle(camera.up,.01);camera.lookAt(new THREE.Vector3,0,0,0)}else{vehicle.update();for(a=0;a<ghost.length;a++)vehicle.START?ghost[a].update(vehicle.TIMESTAMP,vehicle.FRAME):ghost[a].update(0,0);uas.update(vehicle.TIMESTAMP);MENU||REGISTER||state.update();!MOBILE||MENU||DNF||ui.dpad();control.RESET&&!MENU&&(state.reset(),control.RESET=!1);stage.update()}renderer.render(scene,
camera);ui.update(control.touches)}firebase.initializeApp(firebaseConfig);firebase.analytics();
var MODEL={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,
1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,
2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=this;this.maxLife=100;for(var f=0,h=new THREE.Geometry;h.vertices.length<a.maxLife;){var g=new THREE.Vector3(0,0,0);g.life=0;g.maxLife=a.maxLife;g.acc=new THREE.Vector3(0,0,0);h.vertices.push(g);g=new THREE.Color(4294967040);h.colors.push(g)}h.verticesNeedUpdate=!0;var n=new THREE.Points(h,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));n.name="Emitter";var t=new THREE.Color;
a.connect=function(q){q=void 0===q?16777215:q;scene.add(n);a.paint(q)};a.paint=function(q){q=new THREE.Color(void 0===q?16777215:q);t=new THREE.Color;q.getHSL(t);for(q=0;q<n.geometry.vertices.length;q++)n.geometry.colors[q].setHSL(t.h,t.s,0),n.geometry.vertices[q].life=0};a.reset=function(){for(var q=0;q<n.geometry.colors.length;q++)n.geometry.colors[q].setHSL(t.h,t.s,0),n.geometry.vertices[q].life=0};a.disconnect=function(){scene.remove(n);n.geometry.dispose();n.material.dispose()};a.update=function(q,
x,b,c){if(q)for(q=0;1>q;){n.geometry.vertices[f].copy(b);n.geometry.vertices[f].multiplyScalar(-1-Math.random()*c);n.geometry.vertices[f].add(x);n.geometry.vertices[f].life=n.geometry.vertices[f].maxLife;Math.random();Math.random();Math.random();var k=.1*-Math.random();n.geometry.vertices[f].acc.copy(b);n.geometry.vertices[f].acc.multiplyScalar(k);f++;f%=n.geometry.vertices.length;q++}for(var e in n.geometry.vertices){var p;0<n.geometry.vertices[e].life&&(n.geometry.vertices[e].add(n.geometry.vertices[e].acc),
--n.geometry.vertices[e].life,p=n.geometry.vertices[e].life/100,n.geometry.colors[e].setHSL(t.h,t.s,t.l*p));0>=n.geometry.vertices[e].life&&(n.geometry.vertices[e].set(0,0,0),n.geometry.vertices[f].acc.x=0,n.geometry.vertices[f].acc.y=0,n.geometry.vertices[f].acc.z=0)}n.geometry.verticesNeedUpdate=!0;n.geometry.colorsNeedUpdate=!0;n.geometry.computeBoundingSphere()}}},ImprovedNoise=function(){function a(t){return t*t*t*(t*(6*t-15)+10)}function f(t,q,x){return q+t*(x-q)}function h(t,q,x,b){var c=15&
t;t=8>c?q:x;b=4>c?x:12==c||14==c?q:b;return(0==(1&c)?t:-t)+(0==(2&c)?b:-b)}for(var g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,
86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],n=
0;256>n;n++)g[256+n]=g[n];return{noise:function(t,q,x){var b=Math.floor(t),c=Math.floor(q),k=Math.floor(x),e=255&b,p=255&c,A=255&k,I=(t-=b)-1,K=(q-=c)-1,W=(x-=k)-1,R=a(t),u=a(q);b=a(x);c=g[e]+p;k=g[c]+A;c=g[c+1]+A;e=g[1+e]+p;p=g[e]+A;A=g[e+1]+A;return f(b,f(u,f(R,h(g[k],t,q,x),h(g[p],I,q,x)),f(R,h(g[c],t,K,x),h(g[A],I,K,x))),f(u,f(R,h(g[k+1],t,q,W),h(g[p+1],I,q,x-1)),f(R,h(g[c+1],t,K,W),h(g[A+1],I,K,W))))}}},profanity=function(a,f){for(var h="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61 736d65676d61".split(" "),
g="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),n=a.toLowerCase(),t=0;t<n.length;t++){var q=n.charCodeAt(t);if(122<q||57<q&&61>q||33>q||40==q||41==q)return"";q="";for(var f=t;f<n.length;f++){n.charAt(f);var x=n.charCodeAt(f);(48<=x&&57>=x||97<=x&&122>=x)&&(q+=x.toString(16));for(x=0;x<h.length;x++){for(var b="",c="",k=[],e=0,p=0,A=0;A<h[x].length;A+=2){var I=q.charAt(A+e)+q.charAt(A+1+e),K=h[x].charAt(A)+h[x].charAt(A+1);if((I===b||I===c)&&0!==I.length&&(p++,0<
p))for(;I===b||I===c;)e+=2,I=q.charAt(A+e)+q.charAt(A+1+e);if(I===K)k[A/2]=!0,b=I,c=K;else{k[A/2]=!1;for(var W=0;W<g.length;W++){var R=g[W].charCodeAt(1).toString(16),u=g[W].charCodeAt(0).toString(16);I===R&&(u===K?(k[A/2]=!0,b=R,c=K):u!==b&&u!==c||(p++,0<p&&(e+=2,A-=2)))}!1===k[A/2]&&(A=h[x].length)}}for(c=b=0;c<k.length;c++)if(!0===k[c]&&b++,b===k.length)return""}}}return a};
function Sound(){var a;window.addEventListener("click",function(){a=new (window.AudioContext||window.webkitAudioContext)});(function(){for(var f=[],h=0;9>h;h++)f[h]=[];f[0].A=27.5;f[0]["A#"]=29.13523509488062;f[0].B=30.867706328507754;f[1].C=32.70319566257483;f[1]["C#"]=34.64782887210901;f[1].D=36.70809598967595;f[1]["D#"]=38.890872965260115;f[1].E=41.20344461410874;f[1].F=43.653528929125486;f[1]["F#"]=46.2493028389543;f[1].G=48.99942949771866;f[1]["G#"]=51.91308719749314;f[1].A=55;f[1]["A#"]=58.27047018976124;
f[1].B=61.735412657015516})();this.trigger=function(){var f=a.createOscillator();f.connect(null);var h=wavePicker.options[wavePicker.selectedIndex].value;return"custom"==h?f.setPeriodicWave(null):f.type=h,f.frequency.value=freq,f.start(),f}}
function Stage(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new Generate;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var h=new THREE.Vector3;
h.copy(camera.position);h.x+=Math.random()*a.snow.distance-a.snow.distance/2;h.y+=Math.random()*a.snow.distance-a.snow.distance/2;h.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(h)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var h=0;h<a.snow.mesh.geometry.vertices.length;h++){var g=a.snow.mesh.geometry.vertices[h];g.z-=.5*vehicle.DT();(Math.abs(g.z-camera.position.z)>a.snow.height/2||Math.abs(g.x-
camera.position.x)>a.snow.distance/2||Math.abs(g.y-camera.position.y)>a.snow.distance/2)&&(g.copy(camera.position),g.x+=Math.random()*a.snow.distance-a.snow.distance/2,g.y+=Math.random()*a.snow.distance-a.snow.distance/2,g.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var f=0;4>f;f++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(h){h=void 0===h?!1:h;if(camera.position.set(0,
400,200),camera.far=2E3,camera.updateProjectionMatrix(),camera.lookAt(new THREE.Vector3),renderer.render(scene,camera),!h){this.name=this.generate.name();h="";for(var g in this.name)h+=this.name.charCodeAt(g).toString();SEED=h}a.generate.connect();COUNTER++};this.disconnect=function(){SNOW&&(scene.remove(a.snow.mesh),a.SNOW=!1);this.generate.disconnect();this.generate.reset()};this.reset=function(h){h=void 0===h?!1:h;SEED++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new Generate;a.connect(h)};
this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}
function State(){var a=this,f,h,g=0,n=0;this.custom_seed="";var t="#1#ffffff#334#",q=GHOST_LIMIT+"#1#",x=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(b){return b?(UID=b.uid,a.STATE(),vhs.requestName(UID,function(c){NAME=c;a.STATE()})):(UID=!1,a.STATE()),null})};this.register=function(b){ui.clear();a.STATE=function(){a.register(b)};REGISTER=!0;
a.inputName(function(){REGISTER=!1;vhs["export"]()},!0,"input name to save data")};this.resize=function(b,c){f=ui.width;h=ui.height;GHOST_SOFT_LIMIT=Math.floor((window.innerHeight/ui.scale/ui.row-34)/2)};this.wallet=function(){var b=vehicle.yen();ui.print("$ "+b.toString(),"2","1.0-4")};this.nav=function(b){b=void 0===b?function(){ui.clear()}:b;ui.style=0;ui.sprite(8,64,8,8,"1.0-4+2p","2",8,8);ui.button("","2","2+4p","1.0-4","8",function(){a.menu(b)},!1)};this.title=function(b,c){a.breadcrumb(b,c);
ui.sprite(16,64,8,8,"1.0-4+2p","2",8,8);ui.button("","1.0-7","2+4p","7","5",function(){x||ui.backdrop(!1);b();MENU=!1;a.SETTINGS=!1},!1);MUSIC;ui.style=2;ui.print(BUILD,"2","1.0-4");ui.style=0};this.breadcrumb=function(b,c){c=void 0===c?function(){x||ui.backdrop(!1);b();MENU=!1;a.SETTINGS=!1}:function(){a.menu(b);MENU=!0};ui.style=MUSIC?1:0;ui.style=0;ui.print("  menu","2","2");ui.style=0;ui.print("<","2","2");ui.button("","2","2+4p","7","8",c,!1)};this.menu=function(b){MENU=!0;ui.style=0;a.STATE=
function(){a.menu(b)};x||ui.backdrop();ui.clear();a.title(b);ui.sprite(0,0,1,1,"2","6","1.0-4",1);SPECTATE?(ui.print(" > view spectator controls","2","8"),ui.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(ui.print(" > modify vehicle","2","8"),ui.button("","2","8+4p","1.0-4","5",function(){a.vehicle(b)},!1));ui.sprite(0,0,1,1,"2","11","1.0-4",1);ui.print(" > settings","2","13");ui.button("","2","13+4p","1.0-4","5",function(){a.settings(b)},!1);ui.sprite(0,0,1,1,"2","16","1.0-4",1);var c=
8,k;SPECTATE?(k=uas.AUTOPILOT?"disable":"enable",ui.button(k+" autopilot","2","1.0-2-"+c,"1.0-4","6",function(){ui.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),c+=8,ui.button("deploy vehicle","2","1.0-2-"+c,"1.0-4","6",function(){ui.backdrop(!1);SPECTATE=!1;a.STATE=function(){};vehicle.reset(!1);a.reset();PLAY=!0;vehicle.START=!1;vehicle.disconnect();vehicle.connect(stage.start,stage.surface,!1);a.play()},!0)):(PLAY||vehicle.REPLAY)&&(ui.button("restart stage","2","1.0-2-"+c,"1.0-4",
"6",function(){ui.backdrop(!1);a.reset()},!0),c+=8,ui.button("next stage","2","1.0-2-"+c,"1.0-4","6",function(){ui.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var b;a.STATE=function(){a.intro()};x=!0;ui.clear();ui.print("specialstage.io","2","2");ui.print("-","2","4");CHALLENGE?(ui.style=4,ui.print("challenge detected!","2","12"),ui.style=0,b=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",ui.style=2,ui.print("rival:","2","15"),ui.style=0,ui.print(b,"9","15"),vhs.requestName(a.CHALLENGES.uid,
function(c){a.CHALLENGER=c;a.STATE()}),ui.style=2,ui.print("seed:","2","17"),ui.style=0,ui.print(a.CHALLENGES.seed,"9","17")):CUSTOM_SEED&&(ui.style=3,ui.print("seed detected","2","13",1),ui.style=0,ui.print("> "+a.custom_seed,"2","16",1));null!==UID&&!1===UID||""!==NAME?null!==NAME&&""!==NAME?(ui.style=5,ui.print("welcome back!","2","6"),ui.style=0,ui.print("> "+NAME,"2","9"),ui.style=2,ui.print("[edit]",NAME.length+"+5","9"),ui.style=0,ui.button("","2","9+4p",NAME.length+"+9","4",function(){a.inputName(a.intro)},
!1)):(!1===UID&&(""===NAME||null===NAME)||!1!==UID&&null===NAME)&&(ui.style=2,ui.print("user data not detected","2","6"),ui.style=0,ui.print("> [register/sign in]","2","9"),ui.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(ui.style=2,ui.print("> loading user data...","2","6"),ui.style=0);ui.style=2;ui.print(BUILD,"2","1.0-4");ui.style=0;a.nav(function(){a.intro()});ui.print("menu","1.0-9","2");ui.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},!1);a.discord();
a.startButton()};this.startButton=function(){ui.button("start","2","1.0-12+"+(2*(RESIZE_SCALE-1)).toString(),"1.0-4","8",function(){ui.clear();x=!1;ui.renderer.className="";STATE=function(){};START=!0;FIREBASE&&firebase.analytics().logEvent("game_start");stage.connect();a.load();a.discord()})};this.discord=function(){ui.style=3;ui.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);ui.print("discord","1.0-9","1.0-4");ui.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");ui.style=0};this.load=
function(){a.STATE=function(){a.target();a.setBattleName();a.discord()};a.TIMELIST=[];vhs.scan(stage.name,function(b){for(var c={t$jscomp$61:0};c.t$jscomp$61<b.length;c={t$jscomp$61:c.t$jscomp$61},c.t$jscomp$61++)a.TIMELIST[c.t$jscomp$61]={uid:b[c.t$jscomp$61].uid,utc:b[c.t$jscomp$61].utc,time:b[c.t$jscomp$61].time,name:"..."},vhs.requestName(b[c.t$jscomp$61].uid,function(p){return function(A){a.TIMELIST[p.t$jscomp$61].name=A;a.STATE()}}(c)),vhs.checkTime(UID,b[c.t$jscomp$61].uid,b[c.t$jscomp$61].time);
c=a.TIMELIST.length<GHOST_LIMIT?a.TIMELIST.length:GHOST_LIMIT;var k=[];switch(GHOST_PRIORITY){case 0:k=b.slice(0,c);break;case 1:for(b=b.slice();k.length<c;){var e=Math.floor(Math.random()*b.length);k.push(Object.assign({},b[e]));b.splice(e,1)}}a.BATTLE=k.slice();a.STATE()});LOADING=!0;a.discord();a.target();g=0};this.ready=function(){LOADING=!1;a.STATE()};this.play=function(){ui.clear();a.nav(a.play);MENU=!1;ui.style=0};this.complete=function(){MENU=!0;ui.clear();a.STATE=function(){};a.nav(a.complete);
var b="stage complete!";ui.style=0;ui.print(b,"0.5-"+2*Math.round(b.length/2),"0.3-1",2);ui.style=0;stage.COMPLETE=!0;window.setTimeout(function(){!1===UID||null===UID?(a.register(),a.STATE=function(){a.results();vehicle.replay()}):(a.STATE=function(){a.results()},vehicle.REPLAY||(a.STATE=function(){},vhs["export"](a.results)))},2E3);FIREBASE&&(b=vehicle.param().model+" ("+(vehicle.param().power+1)+"/"+(vehicle.param().drag+1)+"/"+(vehicle.param().sensitivity+1)+"/"+(vehicle.param().ease+1)+")",firebase.analytics().logEvent("stage_complete",
{operator_id:NAME,time:vehicle.AT(),penalty:vehicle.PENALTY(),score:vehicle.AT()+vehicle.PENALTY(),seed:stage.name,rating:Math.round(stage.generate.DISTANCE/(vehicle.AT()+vehicle.PENALTY())),distance:stage.generate.DISTANCE,vehicle:b}))};this.results=function(){a.STATE=function(){a.results()};ui.clear();ui.style=0;MENU=!0;var b=0,c=vehicle.CHECKPOINT[4]-1E4*vehicle.CHECKPOINT[5];if((c<PERSONAL_BEST||!1===PERSONAL_BEST)&&(PERSONAL_BEST=c),0<a.TIMELIST.length){for(var k=0;k<a.TIMELIST.length;k++)if(c<
a.TIMELIST[k].time){b=k+1;break}0==b&&(b=a.TIMELIST.length+1)}a.nav(a.results);ui.style=5;ui.print("stage complete! "+stage.name,"2","2");ui.style=0;c=ui.time(c);ui.print(c,"2","5",2);k=vehicle.overwrite(vehicle.CHECKPOINT,stage.best,!1);0!=b?ui.print("rank "+b,2*c.length+"+3".toString(),"5+4p"):k?(k=CHALLENGE?"challenge victory!":"new record!",ui.style=1,ui.print(k,2*c.length+"+3".toString(),"5+4p"),ui.style=0):CHALLENGE&&ui.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");c=9;k=vehicle.CHECKPOINT;
if(320<h){for(var e=1;e<k.length-1;e++){ui.style=5;ui.print("cp "+e,"2",c+"+"+e.toString());e;var p=k[e],A=a.split(e);ui.print(A,"0.5+1",c+"+"+e.toString());"number"==typeof k[e]?(ui.style=0,p=ui.time(k[e])):(ui.style=4,p="penalty",d="");ui.print(p,"0.5 -1-"+p.length.toString(),c+"+"+e.toString());ui.style=0;c+=1}c+=5}1===b&&(ui.style=4,ui.print("new record!","2",c.toString(),2),ui.style=0);ui.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);ui.button("modify vehicle","2","1.0-20",
"0.5-3","4",function(){ui.backdrop();a.vehicle(a.results)});ui.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});ui.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});ui.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){MENU=!1;uas.replay();a.replay()})};this.checkpoint=function(b){b=void 0===b?!1:b;ui.clear();ui.style=0;a.nav(function(){a.checkpoint(b)});var c="";b?c+="missed checkpoint X "+Math.abs(vehicle.CHECKPOINT[5]):c=this.split(vehicle.OBJECTIVE);
ui.style=4;ui.text(c,16,32);ui.style=0};this.split=function(b){var c="",k=stage.best[b]-vehicle.CHECKPOINT[b],e=2,p="";return Number.isNaN(k)?void 0===vehicle.CHECKPOINT[b]?(e=4,c+="- 100 sec"):void 0===stage.best[b]&&0>stage.best[5]?(e=1,c+="+ 100 sec"):void 0===stage.best[b]&&(e=1,c+="new time!"):(0<k?(p="+ ",e=1):0>k?(p="- ",e=4):p="+ ",k=Math.abs(k),c+="( "+p+ui.time(k)+" )"),ui.style=e,c};this.battle=function(){var b=new Ghost(vhs.save(vhs.tape),vehicle.MODEL,vehicle.PAINT);ghost.push(b);a.reset()};
this.replay=function(){if(!vehicle.IMPORT&&!PLAY&&(a.STATE=function(){a.replay()},ui.clear(),SPECTATE?a.nav(function(){a.replay()}):a.nav(a.results),!HIDE)){uas.AUTOPILOT?a.autopilot():a.drone();var b={};for(b.e$jscomp$124=ui.style=0;4>b.e$jscomp$124;b={e$jscomp$124:b.e$jscomp$124},b.e$jscomp$124++){var c="7+"+(4*b.e$jscomp$124).toString(),k=b.e$jscomp$124===uas.CAM-1?48:40;ui.button("",c+"-10p","1.0-4+4p","3","4",function(e){return function(){uas.CAM=e.e$jscomp$124+1;a.STATE()}}(b),!1);ui.sprite(k,
64,8,8,c,"1.0-4",8,8)}ui.style=0;b=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:NAME;(uas.AUTOPILOT||uas.TARGETING)&&ui.print(b,"2","1.0-7");ui.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){ui.style=0;ui.style=0<uas.POV?4:2;ui.sprite(72,64,8,8,"3","1.0-4",8,8);ui.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+
1)%3;a.STATE()},!1);SPECTATE||(ui.style=2,ui.print("<","2","2"),ui.button("","2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){ui.style=uas.TARGETING?4:2;ui.sprite(64,64,8,8,"3","1.0-4",8,8);ui.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){ui.clear();LOADING=!0;CUSTOM_SEED=BATTLE=CHALLENGE=!1;a.PATH=!1;custom_seed="";stage.name="";a.BATTLE=[];PERSONAL_BEST=!1;window.history.pushState("",
"","/");renderer.clear();vehicle.REPLAY=!1;vehicle.RESET=!0;vehicle.disconnect();for(var b=0;b<ghost.length;b++)ghost[b].disconnect();uas.reset(!0);ghost=[];stage.SNOW&&scene.remove(stage.snow.mesh);stage.reset();PLAY=MENU=!1;vhs.PLAY=!1;a.load();FIREBASE&&firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};ui.backdrop(!1);ui.clear();a.nav(a.dnf);FIREBASE&&firebase.analytics().logEvent("dnf");ui.print("dnf","0.5-3+3p","0.5-8",2);ui.button("restart stage?",
"2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(b){b=void 0===b?"reset":b;ghost.index=0;ui.clear();a.nav(a.play);PLAY=!0;MENU=!1;vehicle.reset(!1);for(var c=0;c<ghost.length;c++)ghost[c].reset();FIREBASE&&firebase.analytics().logEvent("stage_restart",{status:b})};this.hide=function(){var b=this;this.STATE=function(){b.hide()};style=1;ui.clear();a.nav(state)};this.update=function(b){b=void 0===b?!1:b;MENU||!PLAY||DNF?!1!==b&&(ui["delete"](16,16,f-64,16),ui.text(ui.time(b),
16,16)):(ui["delete"](16,16,f-64,16),ui["delete"](16,h-32,64,16),ui.text(ui.time(vehicle.AT()),16,16),ui.text(vehicle.SPEED.toString(),16,h-32))};this.loading=function(){for(var b="";b.length<Math.floor(RAFID/500)%4;)b+=".";MENU||(ui["delete"](16,16,160,8),ui.style=2,ui.text("stage generating"+b,16,16),ui.style=0);g++};this.scanning=function(){if(0===state.TIMELIST.length&&vhs.SCAN&&!MENU){ui["delete"](16,72,88,8);for(var b="";b.length<Math.floor(RAFID/500)%4;)b+=".";ui.style=5;ui.text("scanning"+
b,16,72)}};this.target=function(){ui.clear();a.discord();a.STATE=function(){a.target()};a.nav(a.target);var b,c,k=stage.name;if(LOADING||(ui.style=2,ui.print("stage generated.","2","2"),vhs.SCAN?ui.style=2:(ui.style=0,ui.button("ready","2","1.0-10","1.0-4","8",function(){ui.clear();stage.SNOW&&scene.add(stage.snow.mesh);a.STATE=function(){};stage.generate.END=!1;a.play();vehicle.SPECTATE=!1;PLAY=!0;vehicle.connect(stage.start,stage.surface,!1);a["import"]();FIREBASE&&firebase.analytics().logEvent("stage_start")}),
a.discord(),ui.style=1,0<a.BATTLE.length&&ui.button("spectate!","1.0-14","1.0-18","12","3",function(){PLAY=!1;stage.generate.END=!1;stage.SNOW&&scene.add(stage.snow.mesh);ui.style=0;vehicle.connect(stage.start,stage.surface);SPECTATE=!0;a["import"]();GHOST_TIME_START=GHOST_TIME_STAMP;ui.clear();scene.add(stage.generate.stars);FIREBASE&&firebase.analytics().logEvent("spectate_start")},!1))),ui.style=5,ui.print(k,"2","5-1p",2),ui.style=0,0!==a.TIMELIST.length||!vhs.SCAN)if(0!==a.TIMELIST.length){var e=
a.TIMELIST.slice();for(k=0;k<e.length;k++)for(var p=0;p<e.length;p++)e[k].time<=e[p].time&&e[k].utc<e[p].utc&&k>p&&(b={},Object.assign(b,e[k]),c={},Object.assign(c,e[p]),e[k]=c,e[p]=b);ui.style=2;ui.print("best time:","2","9");ui.style=0;ui.print(ui.time(e[0].time),"2","12",2);ui.style=5;b=(k=e.length<GHOST_SOFT_LIMIT)?e.length:GHOST_SOFT_LIMIT;k=k?0:e.length-GHOST_SOFT_LIMIT;for(c=0;c<b;c++)ui.print(c+1+". "+e[c].name,"2","16+"+2*c),ui.print(ui.time(e[c].time),"18","16+"+2*c);0<k&&ui.print("+ "+
k+" more entries","2",2*b+"+17")}else ui.style=2,ui.print("no entries found.","2","9"),ui.style=0};this.displayResults=function(b){b=a.TIMELIST;ui.style=2;ui.print("best time:","2","9");ui.style=0;ui.print(ui.time(b[0].time),"2","12",2);ui.style=5;var c=b.length<GHOST_SOFT_LIMIT+4,k=c?b.length:GHOST_SOFT_LIMIT+4;c=c?0:b.length-GHOST_SOFT_LIMIT+4;for(var e=0;e<k;e++)ui.print(e+1+". "+b[e].name,"2","16+"+2*e),ui.print(ui.time(b[e].time),"18","16+"+2*e);0<c&&ui.print("+ "+c+" more entries","2",2*k+"+17")};
this.setBattleName=function(){for(var b=0;b<a.BATTLE.length;b++)a.BATTLE[b].name=a.TIMELIST[b].name};this["import"]=function(){a.setBattleName();for(var b={i$jscomp$47:0};b.i$jscomp$47<a.BATTLE.length;b={i$jscomp$47:b.i$jscomp$47},b.i$jscomp$47++)vehicle.IMPORT=!0,vhs["import"](stage.name+"/"+a.BATTLE[b.i$jscomp$47].uid,function(c){return function(k){a.BATTLE[c.i$jscomp$47].IMPORT_BUFFER=[];vehicle.INPUTS=[];a.BATTLE[c.i$jscomp$47].data=[];a.BATTLE[c.i$jscomp$47].param={power:k.param.power,drag:k.param.drag,
sensitivity:k.param.sensitivity,model:k.param.model,paint:k.param.paint};a.BATTLE[c.i$jscomp$47].cp=k.cp;for(var e=0;e<k.debug.length;e++)k.debug[e].time,k.debug[e].position,k.debug[e].normal,k.debug[e].rotation,k.debug[e].U,k.debug[e].D,k.debug[e].L,k.debug[e].R,a.BATTLE[c.i$jscomp$47].data.push({U:k.debug[e].U,D:k.debug[e].D,L:k.debug[e].L,R:k.debug[e].R,time:k.debug[e].time});c.i$jscomp$47===a.BATTLE.length-1&&vehicle["import"]()}}(b))};this.uas=function(b){ui.clear();ui.style=0;a.STATE=function(){a.uas()};
ui.backdrop();ui.sprite(16,64,8,8,"1.0-4+2p","2",8,8);ui.button("","2","2","1.0","4",function(){ui.backdrop(!1);a.replay()},!1);ui.style=0;ui.print("spectator controls","2","2");ui.print("pilot mode","2","6");ui.style=2;ui.print("arrow            pitch/yaw/roll","2","10");ui.print("shift + arrow    roll/yaw modifier","2","12");ui.print("space            power +","2","14");ui.print("shift + space    power -","2","16");ui.print("ctrl:            roll/yaw toggle","2","18");ui.print("r                reset",
"2","20");ui.print("t                targeting mode toggle","2","22");ui.print("shift + arrow    change target (targeting)","2","24");ui.style=0};this.timelist=function(){ui.style=0};this.save=function(){var b=NAME+"#"+vehicle.MODEL+"#"+vehicle.PAINT+"#"+vehicle.param().power+vehicle.param().drag+ +vehicle.param().sensitivity+"#"+Date.now();b!==t&&(t=b,a.cSave("SAVE",t))};this.vehicle=function(b){a.STATE=function(){a.vehicle(b)};MENU=!0;ui.clear();a.title(function(){b();a.save()},function(){a.menu();
sv()});vehicle.REPLAY&&a.reset();var c=[],k=vehicle.param();c.push({id:"power",value:k.power,funct:function(K){vehicle.tune.power(K)}});c.push({id:"drag",value:k.drag,funct:function(K){vehicle.tune.drag(K)}});c.push({id:"sensitivity",value:k.sensitivity,funct:function(K){vehicle.tune.sensitivity(K)}});ui.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);ui.print("model","2","8+");ui.print(vehicle.models()[vehicle.MODEL].name,"2+8","8+");ui.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);ui.button(">","1.0-6","8++4p",
"4","4",function(){vehicle.MODEL+=1;1<vehicle.MODEL&&(vehicle.MODEL=0);vehicle.body();a.vehicle(b)},!1);ui.button("<","1.0-12","8++4p","4","4",function(){--vehicle.MODEL;0>vehicle.MODEL&&(vehicle.MODEL=1);vehicle.body();a.vehicle(b)},!1);ui.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);ui.print("paint","2","8+5+");ui.print(PAINT_NAME[vehicle.PAINT],"10","8+5+");ui.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);ui.button(">","1.0-6","8+5++4p","4","4",function(){vehicle.PAINT+=1;vehicle.PAINT>PAINT.length-1&&
(vehicle.PAINT=0);vehicle.paint();a.vehicle(b)},!1);ui.button("<","1.0-12","8+5++4p","4","4",function(){--vehicle.PAINT;0>vehicle.PAINT&&(vehicle.PAINT=PAINT.length-1);vehicle.paint();a.vehicle(b)},!1);for(k={t$jscomp$71:0};k.t$jscomp$71<c.length;k={t$jscomp$71:k.t$jscomp$71},k.t$jscomp$71++){var e="8+5+5+"+(5*k.t$jscomp$71).toString();ui.print(c[k.t$jscomp$71].id,"2",e);ui.sprite(0,0,1,1,"2",e+"+3","1.0-2-2",1);for(var p={e$jscomp$144:0};6>p.e$jscomp$144;p={e$jscomp$144:p.e$jscomp$144},p.e$jscomp$144++){var A=
"1.0-18+"+(3*p.e$jscomp$144).toString(),I=p.e$jscomp$144<=c[k.t$jscomp$71].value?48:40;ui.button("",A+"-10p",e+"+4p","3","4",function(K,W){return function(){c[K.t$jscomp$71].funct(W.e$jscomp$144);a.vehicle(b)}}(k,p),!1);ui.sprite(I,64,8,8,A,e,8,8)}}};this.scan=function(b,c){};this.settings=function(b){a.STATE=function(){a.settings(b)};a.SETTINGS=!0;q=GHOST_LIMIT+"#"+GHOST_PRIORITY+"#"+(HITBOX?1:0)+"#"+(UAS_ENABLED?1:0)+"#";a.cSave("SETTINGS",q);ui.clear();x||ui.backdrop();a.title(b,a.menu);ui.sprite(0,
0,1,1,"2","6","1.0-4",1);ui.print("ghost config","2","8");ui.print("[edit]","1.0-2-6","8");ui.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(b)},!1);ui.sprite(0,0,1,1,"2","11","1.0-4",1);MOBILE?(c=HITBOX?"enabled":"disabled",ui.print("display touch hitboxes","2","13"),ui.print(c,"1.0-2-"+c.length,"13"),ui.sprite(0,0,1,1,"2","21","1.0-4",1),ui.button("","2","13+4p","1.0-4","5",function(){HITBOX=!HITBOX;a.settings(b)},!1)):(ui.print("keybindings","2","13"),ui.print("arrow / wasdr","1.0-15",
"13"),ui.sprite(0,0,1,1,"2","21","1.0-4",1));ui.sprite(0,0,1,1,"2","16","1.0-4",1);ui.print("pixel scale","2","18");ui.print(""+PIXEL_SCALE,"1.0-18","18");ui.button("+","1.0-6","18+4p","4","4",function(){2>PIXEL_SCALE&&(PIXEL_SCALE+=.5);ui.style=0;a.settings(b);resize()},!1);ui.button("-","1.0-12","18+4p","4","4",function(){1<PIXEL_SCALE&&(PIXEL_SCALE-=.5);ui.style=0;a.settings(b);resize()},!1);ui.sprite(0,0,1,1,"2","26","1.0-4",1);ui.print("camera mode","2","23");var c=vehicle.FPV?"fpv":"tpv";ui.print(c,
"1.0-6","23");ui.button("","2","23+4p","1.0-4","5",function(){vehicle.FPV=!vehicle.FPV;a.settings(b)},!1);ui.print("www.procedural.ca","2","1.0-10");ui.print("www.ginko.ltd","2","1.0-8");a.discord();ui.style=0};this.ghostConfig=function(b,c){a.STATE=function(){a.ghostConfig(b)};var k=UAS_ENABLED?1:0;q=GHOST_LIMIT+"#"+GHOST_PRIORITY+"#"+(HITBOX?1:0)+"#"+k;a.cSave("SETTINGS",q);ui.clear();x||ui.backdrop();a.title(b,function(){a.settings(b)});ui.sprite(0,0,1,1,"2","6","1.0-4",1);ui.print("ghost name",
"2","8");ui.print(NAME,"1.0-13-"+NAME.length,"8");ui.print("[edit]","1.0-8","8");ui.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(b)},!1)},!1);ui.sprite(0,0,1,1,"2","11","1.0-4",1);ui.print("ghost limit","2","13");k=GHOST_LIMIT.toString();ui.print(k,"1.0-13-"+k.length,"13");ui.button(">","1.0-6","13+4p","4","4",function(){20>GHOST_LIMIT&&(GHOST_LIMIT+=1);a.ghostConfig(b)},!1);ui.button("<","1.0-12","13+4p","4","4",function(){0<GHOST_LIMIT&&--GHOST_LIMIT;a.ghostConfig(b)},
!1);ui.sprite(0,0,1,1,"2","16","1.0-4",1);ui.print("ghost priority","2","18");k=0===GHOST_PRIORITY?"best":"random";ui.print(k,"1.0-13-"+k.length,"18");ui.button(">","1.0-6","18+4p","4","4",function(){GHOST_PRIORITY+=1;1<GHOST_PRIORITY&&(GHOST_PRIORITY=0);a.STATE()},!1);ui.button("<","1.0-12","18+4p","4","4",function(){--GHOST_PRIORITY;0>GHOST_PRIORITY&&(GHOST_PRIORITY=1);a.STATE()},!1);ui.sprite(0,0,1,1,"2","21","1.0-4",1);ui.print("ghost particles","2","23");k=GHOST_EMITTER?"enabled":"disabled";
ui.print(k,"1.0-2-"+k.length,"23");ui.button("","2","23+4p","1.0-4","4",function(){GHOST_EMITTER=!GHOST_EMITTER;for(var e=0;e<ghost.length;e++)ghost[e].toggleEmitter(GHOST_EMITTER);a.ghostConfig(b)},!1);ui.sprite(0,0,1,1,"2","26","1.0-4",1)};this.controls=function(b){ui.clear();a.title(b,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){ui.clear();ui.print("specialstage.io",
"4","4",2);ui.print("-","4","8",2)};this.challenge=function(b){ui.clear();a.nav(function(){a.challenge()},a.menu);ui.print("issue challenge url","2","2");ui.print("-","2","4");ui.style=2;ui.print("issued by","2","6");ui.style=0;ui.print("> "+NAME,"2","9");ui.style=2;ui.print("[edit]",NAME.length+"+9","9");ui.button("","2","9+4p",NAME.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);ui.style=2;ui.print("seed","2","13");ui.style=5;ui.print(stage.name,"2","15");ui.style=2;ui.print("time",
"2","19");b=ui.time(vehicle.CHECKPOINT[4]-1E4*vehicle.CHECKPOINT[5]);ui.style=5;ui.print(b,"2","21");ui.style=0;ui.button("copy challenge url","1","1.0-8","1.0-2","8",function(){ui.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){ui.clear();a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(b,c,k){c=void 0===c?!1:c;k=void 0===k?"enter display name:":k;a.STATE=function(){a.inputName(b,c,k)};ui.clear();MENU=!0;
c?a.nav(function(){b()},a.menu):a.title(b);ui.print(k,"2","2");ui.textinput(NAME,"2","4","1.0-2","6","operator_id");var e=document.getElementById("operator_id");ui.button("accept","2","14","1.0-4","6",function(){ui.clear();ui.print("submitting name to db","2","2");NAME=profanity(e.value.toLowerCase());!1===UID&&1<NAME.length&&null!==NAME?firebase.auth().signInAnonymously().then(function(){UID=firebase.auth().currentUser.uid;a.submitName(UID,b,c);a.STATE=function(){}})["catch"](function(p){p.code;
p.message}):!1!==UID&&1<NAME.length&&null!==NAME?a.submitName(UID,b,c):(ui.clear(),ui.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(b,c,k)},1E3))},!0)};this.submitName=function(b,c,k){k=void 0===k?!1:k;1<NAME.length&&10>NAME.length?firebase.database().ref("uid/"+b).set({name:NAME},function(e){e?(ui.clear(),e="PERMISSION_DENIED"===e.code?"invalid name":"network error",ui.print(e,"2","2"),window.setTimeout(function(){a.inputName(c,k)},1E3)):(ui.clear(),ui.print("name change successful",
"2","2"),window.setTimeout(c,1E3))}):(ui.clear(),ui.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(c,k)},1E3))};this.encodeURL=function(){for(var b="",c=stage.name,k=0;k<c.length;k++){var e=c.charAt(k);e=" "===e?"-":e;b+=e}b=b+"/"+UID;window.history.pushState("","","/");c=window.location.href;var p="./#/"+b;navigator.clipboard.writeText("https://specialstage.io/#/"+b).then(function(){ui.print("url copied to clipboard","2","2");window.history.pushState("","",p)},function(){window.history.pushState("",
"",p);ui.print("url copied to address bar","2","2")});FIREBASE&&firebase.analytics().logEvent("challenge_issued",{url:c+"#/"+b})};this.decodeURL=function(){for(var b=window.location.href,c="",k=[],e=!1,p=0,A=0;A<b.length;A++){var I=b.charAt(A);e?"/"===I?(CHALLENGE=!0,p++):(1===p&&(I="-"===I?" ":I,c+=I),1<p&&(k+=I)):"#"===I&&(e=!0,CUSTOM_SEED=!0,p=0)}CHALLENGE&&0<k.length?(a.custom_seed=c,stage.name=c,a.CHALLENGES={seed:c,uid:k}):CUSTOM_SEED&&(a.custom_seed=c,stage.name=c,CHALLENGE=!1);FIREBASE&&CHALLENGE&&
firebase.analytics().logEvent("challenge_accepted",{url:b})};this.cSave=function(b,c){var k=new Date;k.setTime(k.getTime()+2808E7);k="expires="+k.toUTCString();document.cookie=b+"="+c+";"+k+";path=/"};this.cLoad=function(b){b+="=";for(var c=document.cookie.split(";"),k=0;k<c.length;k++){for(var e=c[k];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return""};this.checksave=function(){var b=a.cLoad("SAVE");if(0!==b.length&&null!=b){for(var c=0,k="",e="",
p="",A="",I=0,K=0;K<b.length;K++){var W=b.charAt(K);if("#"!==W)switch(I){case 1:c=parseInt(W);break;case 2:k+=W;break;case 3:e+=b.charAt(K),p+=b.charAt(K+1),A+=b.charAt(K+2),K+=2}else I++}vehicle.MODEL=parseInt(c);vehicle.PAINT=parseInt(k);vehicle.paint();vehicle.tune.power(parseInt(e));vehicle.tune.drag(parseInt(p));vehicle.tune.sensitivity(parseInt(A))}else vehicle.PAINT=0,vehicle.paint();if(b=a.cLoad("SETTINGS"),0!==b.length&&null!=b){c=0;p=e=k="";for(A=0;A<b.length;A++)if(I=b.charAt(A),"#"!==
I)switch(c){case 0:k+=I;break;case 1:GHOST_PRIORITY=parseInt(I);break;case 2:e=parseInt(I);break;case 3:p=parseInt(I)}else c++;GHOST_LIMIT=parseInt(k);HITBOX=0!==e;1===p&&(UAS_ENABLED=!0)}};this.credit=function(){ui.clear();ui.print("procedural.ca","2","1.0-6");ui.print("ginko.ltd","2","1.0-4")};this.promo=function(){ui.clear();state.nav();ui.style=0;ui.print("0.0.6.2","2","2");ui.sprite(0,88,47,8,"2","6-4p",188,32,2);ui.sprite(49,88,40,8,"2","12-4p",160,32,2);ui.sprite(1,0,255,16,"2","1.0-6",255,
16);ui.print("www.specialstage.io  ","2","1.0-8")};this.fpv=function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2");ui.print("new feature","4","0.5");ui.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2");ui.print("new feature","4","0.5");ui.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){ui.clear();
ui.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2");ui.print("update","4","0.5");ui.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){ui.clear();ui.print("play at","2","0.25-4");ui.print("www.specialstage.io","2","0.25",2);ui.print("challenges posted on discord","4","0.25+ 6");ui.print("> discord.specialstage.io",
"4","0.25 + 9");window.setTimeout(a.music,2E3)};this.music=function(b){window.setTimeout(function(){ui.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){ui.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){ui.clear();ui.print("https://specialstage.io - 0.0.4","2","2");ui.print("updates","2","6");ui.print("> added ice biome","2","10");ui.print("> added fpv camera","2","12");ui.print("> added snow particle effects","2","14");ui.print("> added terrain drag penalty",
"2","16");ui.print("> improved vehicle physics","2","18");ui.print("> increased gravity","2","20");ui.print("> decreased air resistance","2","22");ui.print("> disabled DNF timeout during button input for big jumps","2","24");ui.print("> removed framerate dependecies","2","26");ui.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){ui.clear()},1E4)};this.plug=function(b){if("n"===b.key)switch(n){case 0:ui.clear();window.setTimeout(a.promo,1E3);n++;break;case 1:window.setTimeout(a.biome,
1E3);n++;vehicle.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);n++;vehicle.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);n++;vehicle.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);n++;vehicle.CAMERA=1;break;case 5:ui.clear(),n=0}};this.url=function(){for(var b="";b.length<stage.name.length;){var c=stage.name.charAt(b.length);b+=" "===c?"-":c}return"specialstage.io/#/"+b};this.utc=function(b){b=(new Date(b)).toLocaleString("en-GB",{timeZone:"UTC"});for(var c="",k=0;k<b.length;k++)","!==
b.charAt(k)&&(c+=b.charAt(k));return c};this.stageIntro=function(){var b=this;this.STATE=function(){b.stageIntro()};ui.clear();SPECTATE_INTRO=!0;state.nav(this.STATE);var c=this.url();ui.timeouts.push(window.setTimeout(function(){ui.style=5;ui.print(c,"2","2")},250));ui.timeouts.push(window.setTimeout(function(){ui.style=2;ui.print("event seed","2","6")},250));ui.timeouts.push(window.setTimeout(function(){ui.style=0;ui.print(stage.name,"2","9",2)},500));ui.timeouts.push(window.setTimeout(function(){state.BATTLE.length;
ui.style="2";ui.print(stage.generate.BIOMES[stage.generate.BIOME].name+" biome","2","13");ui.style="0"},1E3));ui.timeouts.push(window.setTimeout(function(){ui.style="0";ui.sprite(16,72,16,16,"2","1.0-6",16,16);ui.print("heartwerk - there's a new cowboy in...","6","1.0-6")},2E3));state.stageEntries()};this.stageReplay=function(){var b=this;this.STATE=function(){b.stageReplay()};ui.clear();state.nav(this.STATE);ui.print(ghost[uas.TARGET-1].name,"2","1.0-4")};this.stageResults=function(){SPECTATE_RESULTS=
!0;this.STATE=function(){a.stageResults()};ui.clear();state.nav(this.STATE);var b=a.url();ui.timeouts.push(window.setTimeout(function(){ui.style="5";ui.print(b,"2","2")},250));ui.timeouts.push(window.setTimeout(function(){ui.style=2;ui.print("event result","2","6")},500));ui.timeouts.push(window.setTimeout(function(){ui.style=0;ui.print(state.BATTLE[0].name,"2","9",2)},750));ui.timeouts.push(window.setTimeout(function(){ui.style=1;ui.print("stage rank 1","2+"+2*state.BATTLE[0].name.length+"+1","9+4p")},
1E3));ui.timeouts.push(window.setTimeout(function(){ui.style=0;ui.sprite(0,0,1,1,"2","13","1.0-4",1)},1250));var c=a.TIMELIST;ui.style=5;var k=c.length<GHOST_SOFT_LIMIT+4,e=k?c.length:GHOST_SOFT_LIMIT+4;k||(c.length,GHOST_SOFT_LIMIT);for(k={i$jscomp$60:0};k.i$jscomp$60<e;k={i$jscomp$60:k.i$jscomp$60},k.i$jscomp$60++)ui.timeouts.push(window.setTimeout(function(p){return function(){var A="16+"+3*p.i$jscomp$60;ui.print(p.i$jscomp$60+1+". "+c[p.i$jscomp$60].name,"2",A);var I=ui.time(c[p.i$jscomp$60].time);
ui.print(I,"1.0-2-"+I.length,A)}}(k),1500+250*k.i$jscomp$60))};this.stageEntries=function(){SPECTATE_ENTRIES=!0;ui.style="5";for(var b=[],c=0;c<a.BATTLE.length;c++)b.push({name:a.BATTLE[c].name,utc:a.BATTLE[c].utc});state.BATTLE.length;ui.timeouts.push(window.setTimeout(function(){ui.sprite(0,0,1,1,"2","17","1.0-4",1)},1500));ui.style=5;b.length<GHOST_SOFT_LIMIT+6||(b.length,GHOST_SOFT_LIMIT);for(c={e$jscomp$174:0};c.e$jscomp$174<b.length;c={e$jscomp$174:c.e$jscomp$174},c.e$jscomp$174++)ui.timeouts.push(window.setTimeout(function(k){return function(){ui.style=
"5";ui["delete"]("2","19+"+k.e$jscomp$174%5*3,"1.0","1");ui.print(b[k.e$jscomp$174].name,"2","19+"+k.e$jscomp$174%5*3);ui.style="2";ui.print(state.utc(b[k.e$jscomp$174].utc),"1.0-21","19+"+k.e$jscomp$174%5*3)}}(c),2E3+500*c.e$jscomp$174)),c.e$jscomp$174===state.BATTLE.length-1&&ui.timeouts.push(window.setTimeout(function(){state.replay();HIDE=!0;STAGE_ENTRIES=STAGE_INTRO=!1},500*c.e$jscomp$174+4E3))};this.mixplug=function(){ui.clear();ui.format(6,"#555");ui.format(7,"#50ffae");ui.format(8,"#80f7d2");
ui.format(9,"#7b1df5");camera.updateProjectionMatrix();ui.style=0;ui.sprite(8,64,8,8,"1.0-4+2p","2",8,8);ui.style=7;ui.style=6;window.setTimeout(function(){ui.style=6;ui.print("mix","2","1.0-6")},2E3);for(var b={e$jscomp$176:0};15>b.e$jscomp$176;b={e$jscomp$176:b.e$jscomp$176},b.e$jscomp$176++)window.setTimeout(function(c){return function(){ui.style=0;ui.print("specialstage.io".charAt(c.e$jscomp$176),"2+"+c.e$jscomp$176,"2")}}(b),100*b.e$jscomp$176);window.setTimeout(function(){ui.sprite(0,88,88,
8,"2","4",88,8)},1800);ui.style=7;ui.style=7;window.setTimeout(function(){ui.style=7;ui.print("low recordings","2","1.0-4")},2E3);ui.style=6;window.setTimeout(function(){ui.style=6;ui.print("(lo-fi house)","1.0-15","1.0-4")},2200);ui.style=7;b=document.createElement("img");b.style.zIndex=98;b.style.position="fixed";b.style.top=0;b.style.left=0;b.src="./img/low_promo_4x.gif";b.style.setProperty("mix-blend-mode","lighten");document.body.appendChild(b)};this.tracklist=function(){ui.clear();ui.format(6,
"#555");ui.format(7,"#50ffae");ui.format(8,"#80f7d2");ui.format(9,"#DA4DFA");ui.format(10,"#101010");ui.style=0;ui.sprite(8,64,8,8,"1.0-4+2p","2",8,8);ui.style=3;ui.style=4;ui.style=1;ui.style=0;ui.print("specialstage.io","2","2");ui.style=9;ui.print("X low recordings feature mix","2","4");ui.style=5;window.setTimeout(function(){ui.style=6;ui.print("featuring music by:","2","8")},600);var b=[];ui.style=0;b.push(function(){ui.print("> evade robots","2","12")});b.push(function(){ui.print("> eli cash",
"2","14")});b.push(function(){ui.print("> shaman","2","16")});b.push(function(){ui.print("> heartwerk","2","18")});b.push(function(){ui.print("> blo","2","20")});b.push(function(){ui.print("> urbanite","2","22")});b.push(function(){ui.print("> rick wade","2","24")});b.push(function(){ui.print("> orthographic figure","2","26")});b.push(function(){ui.print("> hyas","2","28")});b.push(function(){ui.print("> albin & noris","2","30")});ui.style=7;for(var c={e$jscomp$177:0};c.e$jscomp$177<b.length;c={e$jscomp$177:c.e$jscomp$177},
c.e$jscomp$177++)window.setTimeout(function(k){return function(){ui.style=0;b[k.e$jscomp$177]()}}(c),250*c.e$jscomp$177+1E3)};this.sponsor=function(){ui.clear();a.nav(this.sponsor);ui.timeouts.push(window.setTimeout(function(){ui.renderer.className="promo_c"},1E3));ui.timeouts.push(window.setTimeout(function(){ui.style=2;ui.print("event sponsor","2","2")},1250));ui.timeouts.push(window.setTimeout(function(){ui.style=0;ui.print("www.r3evaluate.com","2","4")},1500))}}
var TIME={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){TIME.start=window.performance.now();TIME.time=0;TIME.last=0;TIME.timestep=1E3/60;TIME.dt=1}},DT=function(){return TIME.time=window.performance.now()-TIME.start,TIME.timestep=TIME.time-TIME.last,TIME.dt=TIME.timestep/(1E3/60),2<TIME.dt&&(TIME.dt=2),TIME.last=TIME.time,TIME.dt};
function UAS(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],f=0,h=!1,g=this.up.clone(),n=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,1,0),value:0},yaw:{axis:new THREE.Vector3(0,0,1),value:0},
pov:0,target:0,targeting:!1,autopilot:!0}},t=[],q=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},x=this.AUTOPILOT=!0,b=this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var c=this.CAM=1,k=this.POV=0;this.camera=[];this.camera[0]=n();this.camera[0].distance=22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=
.1;this.camera[0].position.pov=!0;this.camera[1]=n();this.camera[1].distance=24.5;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=.5708;this.camera[1].pitch.value=.485;this.camera[1].lerp=.1;this.camera[2]=n();this.camera[2].distance=34;this.camera[2].position.set(0,1,0);this.camera[2].yaw.value=3.512;this.camera[2].pitch.value=.79;this.camera[2].lerp=.1;this.camera[3]=n();this.camera[3].distance=34;this.camera[3].position.set(0,1,0);this.camera[3].yaw.value=5.7916;this.camera[3].pitch.value=
.5236;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=n();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].yaw.value=Math.PI;this.camera[4].pitch.value=1.32;this.camera[4].lerp=.075;this.camera[5]=n();this.camera[5].distance=50;this.camera[5].position.set(0,1,0);this.camera[5].yaw.value=Math.PI;this.camera[5].pitch.value=1.32;this.camera[5].lerp=.075;this.camera[6]=n();this.camera[6].distance=50;this.camera[6].position.set(0,1,0);this.camera[6].yaw.value=Math.PI;
this.camera[6].pitch.value=1.32;this.camera[6].lerp=.075;this.camera[7]=n();this.camera[7].distance=50;this.camera[7].position.set(0,1,0);this.camera[7].yaw.value=Math.PI;this.camera[7].pitch.value=1.32;this.camera[7].lerp=.075;this.camera[8]=n();this.camera[8].distance=50;this.camera[8].position.set(0,1,0);this.camera[8].yaw.value=Math.PI;this.camera[8].pitch.value=1.32;this.camera[8].lerp=.075;this.camera[9]=n();this.camera[9].distance=50;this.camera[9].position.set(0,1,0);this.camera[9].yaw.value=
Math.PI;this.camera[9].pitch.value=1.32;this.camera[9].lerp=.075;this.camera[10]=n();this.camera[10].distance=50;this.camera[10].position.set(0,1,0);this.camera[10].yaw.value=Math.PI;this.camera[10].pitch.value=1.32;this.camera[10].lerp=.075;t[0]=q();t[1]=q();t[2]=q();t[3]=q();t[4]=q();t[5]=q();t[6]=q();t[7]=q();t[8]=q();t[9]=q();t[10]=q();this.reset=function(e){if(void 0===e?0:e)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],camera.up.copy(g),e=0;e<this.camera.length;e++)this.camera[e].target=0;1<
a.length?a[f].time=0:(f=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var e=0;e<
this.camera.length;e++)this.camera[e].target=0,this.camera[e].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var e=0;e<this.camera.length;e++)this.camera[e].target=1,this.camera[e].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(e,p,A){e=void 0===e?new THREE.Vector3:e;p=void 0===p?new THREE.Vector3:p;A=void 0===A?new THREE.Vector3:A;var I=DNF||vehicle.END?1E-5:.1;this.up.set(0,0,1);p=p.clone();p.multiplyScalar(-this.camera[0].distance+
4*(ui.scale-1));p.add(e);p.z+=this.camera[0].position.z;a[f].position.lerp(p,I);a[f].lookAt.copy(A);a[f].up.set(0,0,1)};this.fpv=function(e,p,A,I){e=void 0===e?new THREE.Vector3:e;p=void 0===p?new THREE.Vector3:p;void 0===A&&new THREE.Vector3;I=void 0===I?new THREE.Vector3:I;a[f].position.copy(e);p=p.clone();p.add(e);a[f].lookAt.copy(p);I=I.clone();a[f].up.copy(I)};this.orbit=function(e,p,A){e=void 0===e?new THREE.Vector3:e;void 0===p&&new THREE.Vector3;A=void 0===A?new THREE.Vector3:A;control.SPACE;
p=control.SHIFT;var I=control.UP,K=control.DOWN,W=control.LEFT,R=control.RIGHT,u=control.ZOOM_IN,z=control.ZOOM_OUT;e=e.clone();a[f].yaw=a[f-1].yaw;var C=this.camera[c].position.clone();this.camera[c].distance+=u&&0<this.camera[c].distance?-.5:z&&100>this.camera[c].distance?.5:0;C.multiplyScalar(this.camera[c].distance);this.camera[c].yaw.value+=W?-.05:R?.05:0;this.camera[c].pitch.value+=I?.05:K?-.05:0;this.camera[c].pitch.value=0>this.camera[c].pitch.value?0:this.camera[c].pitch.value>Math.PI/2-
.1?Math.PI/2-.1:this.camera[c].pitch.value;u=this.camera[c].pitch.axis.clone();u.applyAxisAngle(g,this.camera[c].yaw.value);C.applyAxisAngle(g,this.camera[c].yaw.value);C.applyAxisAngle(u,this.camera[c].pitch.value);e.add(C);K=h?1:W||R||I||K?.1:this.camera[c].lerp;W&&p&&0<this.TARGET&&(--this.TARGET,state.replay(),control.RIGHT=!1);R&&p&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,state.replay(),control.RIGHT=!1);a[f].position.lerp(e,K);a[f].lookAt.copy(A);a[f].up.set(0,0,1)};this.physics=
function(e,p,A){if((void 0===e?0:e)>a[f].time){var I=p.position.clone(),K=p.direction.clone();e=p.lookAt.clone();p=p.normal.clone();A=((void 0!==A?A:I).clone(),{});Object.assign(A,a[f]);a=[];f=0;a.push(A);A={};Object.assign(A,a[f]);a.push(A);f++;vehicle.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(I,K,e):2===this.POV?this.fpv(I,K,e,p):this.orbit(I,K,e):this.pilot():vehicle.FPV?this.fpv(I,K,e,p):this.pov(I,K,I);a[f].time+=TIMESTEP}};this.target=function(e){this.lookAt.copy(this.TARGETS[e].position)};
this.update=function(e,p){e=void 0===e?0:e;p=void 0===p?this.TARGETS:p;this.CAM!==c?(h=!0,c=this.CAM,this.TARGET=this.camera[c].target,this.TARGETING=this.camera[c].targeting,this.AUTOPILOT=this.camera[c].autopilot,this.POV=this.camera[c].pov,x=this.AUTOPILOT,x?(a[f].position.copy(this.camera[c].position),a[f].position.add(p[this.TARGET].position),a[f].up.copy(this.camera[c].up),h=!0):(a[f].position.copy(t[c].position),a[f].lookAt.copy(t[c].lookAt),a[f].up.copy(t[c].up),a[f].velocity.copy(t[c].velocity),
a[f].pitch.axis.copy(t[c].pitch.axis),a[f].roll.axis.copy(t[c].roll.axis),a[f].yaw.axis.copy(t[c].yaw.axis),a[f].pitch.value=t[c].pitch.value,a[f].roll.value=t[c].roll.value,a[f].yaw.value=t[c].yaw.value,a[f].speed=t[c].speed),state.STATE()):(this.camera[c].target=this.TARGET,this.camera[c].pov=this.POV,this.camera[c].targeting=this.TARGETING,this.camera[c].autopilot=this.AUTOPILOT);this.AUTOPILOT!==x&&(x=this.AUTOPILOT,this.AUTOPILOT?(a[f].position.copy(this.camera[c].position),a[f].up.copy(this.camera[c].up)):
a[f].speed=0);this.POV!==k&&(state.STATE(),k=this.POV,uas.camera[uas.CAM].pov=k);this.TARGET!==b&&(b=this.TARGET,uas.camera[uas.CAM].target=b);this.physics(e,p[PLAY?0:this.camera[c].target]);TIMESTEP;a[f].time;TIMESTEP;1<a.length&&(this.position.copy(a[f].position),this.direction.copy(a[f].direction),this.up.copy(a[f].up),this.lookAt.copy(a[f].lookAt),camera.position.copy(this.position),camera.up.set(this.up.x,this.up.y,this.up.z),camera.lookAt(this.lookAt));h=!1};this.pilot=function(){var e=a[f],
p=control.SPACE,A=control.SHIFT,I=control.UP,K=control.DOWN,W=control.LEFT,R=control.RIGHT;control.TARGET&&(this.TARGETING=!this.TARGETING,control.TARGET=!1,state.replay());e.pitch.value+=I?-e.pitch.power:K?+e.pitch.power:0;A&&!this.TARGETING?e.roll.value+=W?-e.roll.power:R?e.roll.power:0:(e.yaw.value+=W?e.yaw.power:R?-e.yaw.power:0,e.yaw.value*=e.yaw.drag);e.pitch.value*=e.pitch.drag;e.roll.value*=e.roll.drag;e.yaw.value*=e.yaw.drag;e.pitch.axis.applyAxisAngle(e.roll.axis,e.roll.value);e.pitch.axis.applyAxisAngle(e.yaw.axis,
e.yaw.value);e.roll.axis.applyAxisAngle(e.pitch.axis,e.pitch.value);e.roll.axis.applyAxisAngle(e.yaw.axis,e.yaw.value);e.yaw.axis.applyAxisAngle(e.pitch.axis,e.pitch.value);e.yaw.axis.applyAxisAngle(e.roll.axis,e.roll.value);A&&p&&-1<e.speed?e.speed-=.0025:p&&1>e.speed&&(e.speed+=.0025);e.velocity.copy(e.roll.axis);e.velocity.multiplyScalar(e.speed);e.position.add(e.velocity);this.TARGETING?(W&&A&&0<this.TARGET&&(--this.TARGET,state.replay(),control.LEFT=!1),R&&A&&this.TARGET<this.TARGETS.length-
1&&(this.TARGET+=1,state.replay(),control.RIGHT=!1),this.up.set(0,0,1),h?e.lookAt.copy(this.TARGETS[this.TARGET].position):e.lookAt.lerp(this.TARGETS[this.TARGET].position,.05)):(e.up.copy(e.yaw.axis),e.lookAt.copy(e.roll.axis),e.lookAt.add(e.position));t[c].position.copy(e.position);t[c].lookAt.copy(e.lookAt);t[c].velocity.copy(e.velocity);t[c].up.copy(e.up);t[c].pitch.axis.copy(e.pitch.axis);t[c].roll.axis.copy(e.roll.axis);t[c].yaw.axis.copy(e.yaw.axis);t[c].pitch.value=e.pitch.value;t[c].roll.value=
e.roll.value;t[c].yaw.value=e.yaw.value;t[c].speed=e.speed};this.debug=function(){console.log("Vehicle Timestamp:",vehicle.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt);console.log("drones:",t)}}
function UI(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var f=this.renderer.getContext("2d");this.context=f;var h=document.createElement("img");h.src="./img/stage.font.0.0.6.png";h.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var g=document.createElement("canvas"),n=g.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var t=128,q=
180,x=128,b=80,c;var k=128;var e=q;var p=128;var A=80;var I=!(c={x:128,y:q+60,w:128,h:40}),K=[],W=[],R=[];this.timeouts=[];this.connect=function(){f.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(u,z){u=void 0===u?0:u;z=void 0===z?"#ffffff":z;void 0===g[u]&&(g[u]=document.createElement("canvas"),n[u]=g[u].getContext("2d"));n[u].drawImage(h,0,0,128,128,0,0,128,128);n[u].globalCompositeOperation="source-atop";n[u].fillStyle=z;n[u].fillRect(0,0,128,128);n[u].globalCompositeOperation=
"source-out"};this.resize=function(u,z,C,F){F=void 0===F?1:F;a.scale=C*F;var J=window.devicePixelRatio,Y=300>Math.ceil(J)/J*u?Math.floor(J):Math.ceil(J);0!=Y-J&&(C=Y/J*F);1>=J&&1<a.scale&&(C=a.scale);this.width=u/C;this.height=z/C;this.renderer.width=this.width;this.renderer.height=this.height;renderer.setSize(this.width,this.height);a.scale=C;this.renderer.style.transform="scale("+C+","+C+")";renderer.domElement.style.transform="scale("+C+","+C+")";this.renderer.style.transformOrigin="top left";
renderer.domElement.style.transformOrigin="top left";f.imageSmoothingEnabled=!1;this.redraw();t=128;q=180;x=128;b=80;k=128;e=q;p=128;A=80;c={x:128,y:q+60,w:128,h:40};this.automate(this.width,this.height)};this.igmode=function(){this.resize(1080,1080,1,2);this.renderer.style.left=window.innderWidth/2-540;this.renderer.style.position="fixed"};this.update=function(u){var z=0,C;for(C in u)for(var F in R)if(u[C].x>R[F].x*a.scale&&u[C].y>R[F].y*a.scale&&u[C].x<R[F].w*a.scale&&u[C].y<R[F].h*a.scale&&(z++,
1==u[C].start)){R[F].funct();u[C].start=!1;break}};this.print=function(u,z,C,F){F=void 0===F?1:F;for(var J=0,Y=a.compile(z,a.width,a.col),O=a.compile(C,a.height,a.row),N=a.style;J<u.length;)a.encode(u.charAt(J),Y+J*a.col*F,O,F),J++;I||K.push(function(){a.style=N;a.print(u,z,C,F)})};this.text=function(u,z,C,F,J){F=void 0===F?1:F;for(J=0;J<u.length;)a.encode(u.charAt(J),z+J*a.col*F,C,F),J++};this.button=function(u,z,C,F,J,Y,O,N){O=void 0===O?!0:O;N=void 0===N?1:N;var T=a.compile(z,a.width,a.col),aa=
a.compile(C,a.height,a.row),Z=a.compile(F,a.width,a.col),ba=a.compile(J,a.height,a.row),U=a.style;O&&(f.drawImage(g[a.style],0,0,1,1,T,aa+ba/2,Z+1,1),f.drawImage(g[a.style],0,0,1,1,T,aa-ba/2,Z+1,1),f.drawImage(g[a.style],0,0,1,1,T,aa-ba/2,1,ba),f.drawImage(g[a.style],0,0,1,1,T+Z-1,aa-ba/2,1,ba+1));for(var V=0;V<u.length;)a.encode(u.charAt(V),T+V*a.col+Z/2-Math.round(u.length*a.col)/2+2,aa-a.row/2,N),V++;R.push({x:T,y:aa-ba/2,w:T+Z,h:aa+ba/2,funct:function(){Y()}});I||K.push(function(){a.style=U;a.button(u,
z,C,F,J,Y,O,N)})};this.line=function(u,z,C,F){a.sprite(0,0,1,1,u,z,C,F)};this.sprite=function(u,z,C,F,J,Y,O,N){var T=a.compile(J,a.width,a.col),aa=a.compile(Y,a.height,a.row),Z=a.compile(O,a.width,a.col),ba=a.compile(N,a.height,a.row),U=a.style;f.drawImage(g[a.style],u,z,C,F,T,aa,Z,ba);I||K.push(function(){a.style=U;a.sprite(u,z,C,F,J,Y,O,N)})};this.backdrop=function(u,z,C,F,J){!1===(void 0===u?"#10101099":u)?(a.clear(),a.renderer.className=""):(a.clear(),a.renderer.className="backdrop")};this.getDrawList=
function(){return K};this.redraw=function(){I=!0;a.clear();for(var u=0;u<K.length;u++)K[u]();u=document.body.getElementsByTagName("input");for(var z=0;z<u.length;z++)a.text(u[z].value,u[z].style.top,u[z].style.left);I=!1};this.automate=function(u,z){u=Math.floor(u/3)-2;z=Math.floor(z/4);x>u&&(x=u,t=u,p=u,k=u,c.w=u,c.x=u);q>z&&(q=z+40,e=q,c.y=q+60)};this.pad=function(u,z,C,F,J,Y,O){var N=0;for(O();N<control.touches.length;)control.touches[N].x>z*a.scale&&control.touches[N].y>C*a.scale&&control.touches[N].x<
(z+F)*a.scale&&control.touches[N].y<(C+J)*a.scale&&Y(),N++;HITBOX&&(f.drawImage(g[a.style],0,0,1,1,z+1,C,F-1,1),f.drawImage(g[a.style],0,0,1,1,z+1,C+J,F-1,1),f.drawImage(g[a.style],0,0,1,1,z+1,C,1,J),f.drawImage(g[a.style],0,0,1,1,z+F-1,C,1,J));a.encode(u,z+F/2-a.col/2,C+J/2-a.row/2)};this.dpad=function(){f.drawImage(g[a.style],88,88,40,40,a.width-k+p/2-20,a.height-e+A/2-20,40,40);a.pad("<",t-x-1,a.height-q,x,b,function(){control.LEFT=!0},function(){control.LEFT=!1});a.pad(">",t+1,a.height-q,x,b,
function(){control.RIGHT=!0},function(){control.RIGHT=!1});a.pad("^",a.width-k,a.height-e,p,A,function(){control.UP=!0},function(){control.UP=!1});a.pad("b",a.width-c.x,a.height-c.y+c.h/2,c.w,c.h,function(){control.DOWN=!0},function(){control.DOWN=!1})};this.clear=function(){if(!I){for(var u=document.body.getElementsByTagName("input"),z=0;z<u.length;z++)document.body.removeChild(u[z]);if(!a.REDRAW){K=[];for(u=0;u<W.length;u++)document.body.removeChild(W[u]);W=[]}K=[];for(u=0;u<this.timeouts.length;u++)window.clearTimeout(this.timeouts[u])}R=
[];f.clearRect(0,0,a.width,a.height)};this["delete"]=function(u,z,C,F){z=void 0===z?0:z;C=void 0===C?renderer.width:C;F=void 0===F?renderer.height:F;u=a.compile(void 0===u?0:u,a.width,a.col);z=a.compile(z,a.height,a.row);C=a.compile(C,a.width,a.col);F=a.compile(F,a.height,a.row);f.clearRect(u,z,C,F)};this.encode=function(u,z,C,F){F=void 0===F?1:F;var J=u.charCodeAt(0);u=8*J%128;J=8*Math.floor(J/16);f.clearRect(z,C,8,8);f.drawImage(g[a.style],u,J,8,8,z,C,8*F,8*F)};this["float"]=function(u,z){var C=
Math.floor(Math.abs(100*u));C=C.toString();var F=C.slice(0,C.length-2),J=C.slice(C.length-2,C.length);return 0==u?"0.00":(0==F.length&&(F="0"),2>J.length&&(J+="0"),z&&0<u?F="+"+F:0>u&&(F="-"+F),C=F+"."+J,C)};this.compile=function(u,z,C){var F=0;switch(z=Math.floor(z),typeof u){case "number":F=u;break;case "function":F=u();break;case "string":for(var J=!1,Y=1,O=0,N="";O<u.length;){var T=u.charAt(O);"."===T?(N+=T,J=!0):"+"===T?(N=J?Number(N)*z:Number(N)*C,N*=Y,Y=1,F+=N,J=!1,N=""):"-"===T?(N=J?Number(N)*
z:Number(N)*C,N*=Y,Y=-1,F+=N,J=!1,N=""):"p"===T?(N=Number(N),N*=Y,F+=N,N=""):O===u.length-1?(N+=T,N=J?Number(N)*z:Number(N)*C,N*=Y,F+=N,N=""):N+=T;O++}}return F};this.textinput=function(u,z,C,F,J,Y,O){var N=a.compile(z,a.width,a.col),T=a.compile(C,a.height,a.row),aa=a.compile(F,a.width,a.col),Z=a.compile(J,a.height,a.row),ba=a.style;if(I)a.text("> "+O.value,N,T+Z/2);else{(O=document.createElement("input")).type="text";O.id=Y;O.name=Y;O.value=u;O.style.position="fixed";O.style.top=T+"px";O.style.left=
N+"px";O.style.width=aa+"px";O.style.height=Z+"px";O.style.paddingLeft="12px";O.style.fontSize="14px";O.style.zIndex=9999;O.style.opacity=0;O.maxlength=10;a.text("> "+O.value,N,T+Z/2);document.body.appendChild(O);window.setTimeout(function(){O.focus();O.select()},200);O.oninput=function(){U()};O.onfocusout=function(){U()};O.onfocusin=function(){U()};O.onclick=function(){U()};var U=function(V){a["delete"](N,T,aa,Z);a.text("> "+O.value,N,T+Z/2);a.text("_",O.selectionStart*a.col+2*a.col+N,T+Z/2)};K.push(function(){a.style=
ba;a.textinput(O.value,z,C,F,J,Y,O)})}};this.link=function(u,z,C,F,J,Y,O,N){var T=a.compile(z,a.width,a.col)*a.scale,aa=a.compile(C,a.height,a.row)*a.scale,Z=a.compile(F,a.width,a.col)*a.scale,ba=a.compile(J,a.height,a.row)*a.scale,U=a.style;I||K.push(function(){return new function(){a.style=U;V.style.left=T+"px";V.style.top=aa+"px";V.style.width=Z+"px";V.style.height=ba+"px";a.print(u,T,aa)}});var V=document.createElement("a");V.href=Y;V.style.left=T+"px";V.style.top=aa+"px";V.style.width=Z+"px";
V.style.height=ba+"px";V.style.display="block";V.style.zIndex=999;V.style.position="fixed";V.target="_blank";V.id=Y;document.body.appendChild(V);W.push(V);I=!0;a.print(u,T,aa);I=!1};this.time=function(u){return(u/100).toFixed(2)};this.typewrite=function(u){a.clear();for(var z={e$jscomp$214:0};z.e$jscomp$214<u.length;z={e$jscomp$214:z.e$jscomp$214},z.e$jscomp$214++){var C=(z.e$jscomp$214,0);C=Math.floor(z.e$jscomp$214%32);var F=Math.floor(z.e$jscomp$214/32);C=32+C%32*8;F=32+16*F;window.setTimeout(function(J){return function(){ui.text(u.charAt(J.e$jscomp$214),
C,F)}}(z),50*z.e$jscomp$214)}}}
function Vehicle(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return A};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=
[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var f=[],h=0;this.TIMESTEP=TIMESTEP;var g=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var n=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),t=!1,q=!1,x=!1,b=!1,c=!0,k=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var e=0,p=0,A=0,I=0,K=!1,W=!1,R=0,u=0;this.DT=function(){return 1};
var z={power:2,drag:0,mass:1,brake:2,sensitivity:2,ease:0},C=0,F=0,J=0;C=.004;F=.985-.98;J=.08-.06;var Y,O,N,T=6,aa,Z=0,ba=0,U=0,V=new THREE.Vector3(0,1,0),na=new THREE.Vector3(0,0,0),oa=new THREE.Vector3,r=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var m=new THREE.Vector3(0,0,1),l=new THREE.Vector3(0,0,1),B=new THREE.Vector3(0,0,1),y=new THREE.Vector3(0,0,1),w=new THREE.Vector3(0,0,-.008),M=new THREE.Vector3,D=new THREE.Vector3,H=new THREE.Vector3,G=new THREE.Vector3;this.position=M.clone();
this.direction=V.clone();this.lookAt=M.clone();this.normal=l.clone();this.rotation=0;var L=[],P=new THREE.Vector3(0,0,1),Q=new THREE.Raycaster(G,P,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,
x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var ea=[{name:"logistics crate",geometry:function(){return MODEL.logistics_crate()}},{name:"ag-86",geometry:function(){return MODEL.ag_86()}}];this.models=function(){return ea};this.PAINT=0;var ka=new THREE.MeshBasicMaterial({color:PAINT[a.PAINT]}),ca=(new THREE.LineSegments(ea[a.MODEL].geometry(),ka)).clone();ca.name="Vehicle";var pa=new MODEL.emitter;this.connect=function(E,S){ca.copy(new THREE.LineSegments(ea[a.MODEL].geometry(),ka));ca.name=
"Vehicle";ca.geometry.computeBoundingSphere();H.copy(E);H.z+=2;ca.position.copy(H);scene.add(ca);pa.connect(PAINT[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();scene.fog=new THREE.FogExp2(palette[0],.005);camera.fov=90;camera.updateProjectionMatrix();scene.add(stage.generate.stars);a.START_POSITION.copy(H);a.START_NORMAL.copy(l);a.START_DIRECTION.copy(V);a.START_VELOCITY.copy(oa);uas.TARGETS.length<ghost.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;
this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);scene.remove(ca);pa.disconnect();scene.fog=new THREE.FogExp2(palette[0],0);scene.remove(stage.generate.stars);this.DISCONNECT=!1};this.ready=function(E){E=void 0===E?window.performance.now():E;var S;!t&&!this.REPLAY||this.RESET||(stage.generate.checkpoints[0].display.material.color=palette[4],uas.reset(),u=1,K=!1,W=!1,c=!0,TIME.reset(),I=E,e=0,h=0,this.FRAME=0,f[h].time=0,f=[],f.length=0,h=0,f.push({time:0,
position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],S={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),lookAt:y.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(S),a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=
0,S={},Object.assign(S,f[h]),a.PHYSICSBUFFER.push(S),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(E){E=void 0===E?!1:E;a.REPLAY=E;a.RESET=!0;PLAY=!E;ca.visible=!0;SPECTATE&&(ca.visible=!1);this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;k=DNF=this.END=this.START=!1;control.UP=!1;control.DOWN=!1;control.LEFT=!1;b=x=q=t=control.RIGHT=!1;u=A=R=0;M.copy(a.START_POSITION);D.copy(M);V.copy(a.START_DIRECTION);oa.copy(a.START_VELOCITY);l.copy(a.START_NORMAL);G.copy(M);this.position=M.clone();this.direction=
V.clone();this.lookAt=M.clone();this.normal=l.clone();aa=U=Z=ba=this.rotation=0;a.SPEED=0;P.copy(a.START_NORMAL);P.normalize();Q.far=P.length();Q.set(a.START_POSITION,P);B.copy(a.START_NORMAL);y.copy(a.START_NORMAL);y.add(a.START_POSITION);camera.updateProjectionMatrix();k=!0;pa.reset();TIME.reset();uas.reset();f=[];I=h=0;this.IMPORT||(I=window.performance.now());for(E=0;E<stage.generate.checkpoints.length;E++)stage.generate.checkpoints[E].display.material.color=palette[5];if(f[0]={time:0,position:this.START_POSITION.clone(),
normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY)for(this.DEBUG_BUFFER=[],e=0,this.IMPORT||(a.best=a.overwrite(a.CHECKPOINT,a.best)),stage.best=a.overwrite(a.CHECKPOINT,stage.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,a.inputs=[],a.inputs.push({key:0,time:0}),a.PHYSICSBUFFER=[],E={},Object.assign(E,f[h]),a.PHYSICSBUFFER.push(E),E=0;E<ghost.length;E++)ghost[E].reset();this.VALIDATE_CHECKPOINT=
[];this.VALIDATE_CHECKPOINT.length=6;n.position.copy(a.START_POSITION);n.lookAt(y);ca.lookAt(y);n.rotateOnAxis(m,0);W=K=!1;c=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(E){E=void 0===E?window.performance.now():E;DNF||a.END||!k||a.REPLAY||a.RESET?(t=!1,q=!1,x=!1,b=!1):(t=control.UP,q=control.DOWN,x=control.LEFT,b=control.RIGHT,x&&b&&(x=!1,b=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?E+99999-I:E-I;E=0;if(this.TIMESTAMP>f[h].time){var S={};Object.assign(S,f[h]);var X=S.time;
f=[];h=0;for(f.push({time:X,position:S.position.clone(),normal:S.normal.clone(),direction:S.direction.clone(),velocity:S.velocity.clone(),rotation:S.rotation,step:S.step,U:S.U,D:S.D,L:S.L,R:S.R});X<this.TIMESTAMP;){var da;X+=TIMESTEP;this.REPLAY&&this.START&&(E=this.tapeReplay(X));f.push({time:X,position:f[h].position.clone(),normal:f[h].normal.clone(),direction:f[h].direction.clone(),velocity:f[h].velocity.clone(),rotation:f[h].rotation,step:f[h].step,U:t,D:q,L:x,R:b});h=f.length-1;a.START&&(la=
ha=void 0,la=x&&b?0:x?1:b?-1:0,U=f[h].step,0!=la&&Math.abs(U)<T?U+=la:Math.abs(U)>T?(ha=U/Math.abs(U),U=T*ha):0<Math.abs(U)&&(ha=U/Math.abs(U),U-=U/Math.abs(U),U/Math.abs(U)!=ha&&(U=0)),Z=U/T*N,f[h].rotation+=Z,f[h].step=U,aa=f[h].velocity.length(),ha=void 0,t&&c&&(na.copy(f[h].direction),na.multiplyScalar(Y),f[h].velocity.add(na)),q&&c&&f[h].velocity.multiplyScalar(.95),c?(W=!1,ha=K?O-.01:O,f[h].velocity.multiplyScalar(ha)):c||(W?f[h].velocity.add(w):W=!0,f[h].velocity.multiplyScalar(.998)),f[h].position.add(f[h].velocity),
n.position.copy(f[h].position),function(){L=[];G.copy(f[h].position);G.z-=50;P.set(0,0,1);Q.far=100;Q.set(G,P);stage.surface.raycast(Q,L);0<L.length?(G.copy(L[0].point),K=f[h].position.z<G.z&&5>Math.abs(f[h].position.z-G.z)?(p=0,c=!0,l.copy(L[0].face.normal),f[h].position.copy(G),1!==L[0].face.color.r):c=!1):0===L.length&&(c=!1,K=!1,t||q||x||b||a.REPLAY||(p+=TIMESTEP),1E3<p&&!a.END&&!DNF&&(DNF=!0,state.dnf()));var fa=W?.001:.25;B.copy(f[h].normal);B.lerp(l,fa);fa=B.clone();fa.add(f[h].position);f[h].normal=
B.clone();n.lookAt(fa);n.rotateOnAxis(m,f[h].rotation);V.copy(n.localToWorld(r.clone()));V.sub(f[h].position);V.normalize();f[h].direction.copy(V)}(),function(){L=[];P.copy(f[h].position);P.sub(f[h-1].position);P.normalize();Q.far=P.length();Q.set(f[h].position,P);for(var fa=0,ia=!1,ja=u;5>ja;ja++)if(stage.generate.checkpoints[ja].collision.raycast(Q,L),0<L.length){fa=ja;ia=!0;break}if(ia){ja=f[h].position;ia=L[0].point;var ma=f[h-1].position.distanceTo(ia);ia=ja.distanceTo(ia);ia=f[h-1].time+ma/
(ma+ia)*a.TIMESTEP;stage.generate.checkpoints[fa].display.material.color=palette[4];a.CHECKPOINT[fa]=Math.floor(ia/10);ia=u!==fa;a.CHECKPOINT[5]=0;for(ja=1;ja<fa;ja++)void 0===a.CHECKPOINT[ja]&&--a.CHECKPOINT[5];u=fa+1;4<=fa&&!a.REPLAY?(a.END=!0,a.REPLAY||state.complete()):a.REPLAY||a.IMPORT||state.checkpoint(ia)}a.SPEED=Math.round(60*aa/1E3*3600);a.START&&!a.END&&(e=Math.floor(f[h].time/10));a.OBJECTIVE=u;D.copy(M)}());this.FRAME++;this.START&&!this.REPLAY?(da={},Object.assign(da,f[h]),this.PHYSICSBUFFER.push(da)):
this.REPLAY&&E<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(da={time:f[h].time,position:f[h].position.clone(),direction:f[h].direction.clone(),normal:f[h].normal.clone(),velocity:f[h].velocity.clone(),rotation:f[h].rotation,U:f[h].U,D:f[h].D,L:f[h].L,R:f[h].R,step:f[h].step,lookAt:y.clone()},a.DEBUG_BUFFER.push(da));!this.IMPORT&&5E3<this.TIMESTAMP-X&&vehicle.reset(this.REPLAY)}}var ha,la;if(g=(TIMESTEP-(f[h].time-this.TIMESTAMP))/TIMESTEP,1<f.length)this.position.copy(f[h-1].position),
this.position.lerp(f[h].position,g),this.direction.copy(f[h-1].direction),this.direction.lerp(f[h].direction,g),this.rotation=f[h].rotation,this.rotation-=f[h-1].rotation,this.rotation*=g,this.rotation+=f[h].rotation,this.lookAt.copy(this.position),this.normal.copy(f[h-1].normal),this.normal.lerp(f[h].normal,g),this.lookAt.copy(f[h].position),this.normal.copy(f[h].normal),da=this.normal.clone(),da.add(this.position),ca.position.copy(this.position),ca.lookAt(da),ca.rotateOnAxis(m,this.rotation),pa.update(t,
this.position,this.direction,aa);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:R,yen:0}};this.AT=function(){return e};this.convert=function(E){for(var S=[],X=0;X<E.length;X++){var da=E[X].U,ha=E[X].D,la=E[X].L,fa=E[X].R,ia=da&&ha&&la,ja=da&&ha&&fa,ma=0;ia||ja?ia?ma="a":ja&&(ma="b"):(ma+=da?3:ha?6:0,ma+=la?1:fa?2:0);S.push(ma.toString())}return S};this.replay=function(E){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),
PLAY=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(E,S){void 0===E||E?(a.SAVE_PARAM.power=S.power,a.SAVE_PARAM.drag=S.drag,a.SAVE_PARAM.sensitivity=S.sensitivity,a.SAVE_PARAM.model=S.model,a.SAVE_PARAM.paint=S.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var E=ghost.length+" / "+state.BATTLE.length;
0===ghost.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);ghost.length<state.BATTLE.length?(state.scan(E,!1),this.reset(),a.PAINT=state.BATTLE[ghost.length].param.paint,a.MODEL=state.BATTLE[ghost.length].param.model,a.paint(),a.body(),a.tune.power(state.BATTLE[ghost.length].param.power),a.tune.drag(state.BATTLE[ghost.length].param.drag),a.tune.sensitivity(state.BATTLE[ghost.length].param.sensitivity),
a.INPUTS=state.BATTLE[ghost.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(f[h].time=0,this.IMPORT=!1,SPECTATE?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),state.replay("import"),this.INPUTS=[]):(this.reset(!1),state.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(E){E=
void 0===E?z.power:E;z.power=0>E?0:5<E?5:E;Y=.016+z.power/5*C},drag:function(E){E=void 0===E?z.drag:E;z.drag=0>E?0:5<E?5:E;O=.985-z.drag/5*F},sensitivity:function(E){E=void 0===E?z.sensitivity:E;z.sensitivity=0>E?0:5<E?5:E;N=.06+z.sensitivity/5*J},ease:function(E){E=void 0===E?z.ease:E;z.ease=0>E?0:5<E?5:E;T=6+z.ease}};this.param=function(){return array=Object.assign(z,[]),array.model=a.MODEL,array.paint=a.PAINT,array};this.paint=function(E){E=void 0===E?a.PAINT:E;a.PAINT=E;pa.paint(PAINT[E]);ka.color.set(PAINT[E]);
ka.needsUpdate=!0};this.body=function(){ca.geometry.dispose();ca.geometry=ea[a.MODEL].geometry().clone();ca.geometry.verticesNeedUpdate=!0};this.yen=function(){return state.cSave("YEN",0),0};this.debug=function(){console.log("position:",M);console.log("direction:",V);console.log("rotation:",ba);console.log("dt:",1);console.log("TIME:",RAFID);console.log("INTERPOLATION:",g);console.log("PHYSICS MESH:",n.rotation);console.log("EASE",T);console.log(f);console.log(p);console.log("TIMESTAMPS",this.TIMESTAMP);
console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",f[h]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(E){var S=0;if(0==a.INPUTS.length)S=0;else if(E<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[S].time<E;)S++;t=this.INPUTS[S].U;q=this.INPUTS[S].D;x=this.INPUTS[S].L;b=this.INPUTS[S].R}else if(this.IMPORT){E=!0;for(var X="",da=1;da<this.CHECKPOINT.length;da++)this.CHECKPOINT[da]!==state.BATTLE[ghost.length].cp[da]&&(""===X&&(X+="checkpoint_discrepancy"),
E=!1);if(a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==state.BATTLE[ghost.length].time&&(E=!1,X+="final_time_discrepancy"),E){E=[];for(X=0;X<this.DEBUG_BUFFER.length;X++)E.push({time:this.DEBUG_BUFFER[X].time,position:this.DEBUG_BUFFER[X].position.clone(),direction:this.DEBUG_BUFFER[X].direction.clone(),rotation:this.DEBUG_BUFFER[X].rotation,normal:this.DEBUG_BUFFER[X].normal.clone(),lookAt:this.DEBUG_BUFFER[X].lookAt.clone(),U:this.DEBUG_BUFFER[X].U});ghost.push(new Ghost(E,this.MODEL,this.PAINT,this.CHECKPOINT.slice(),
state.BATTLE[ghost.length].name))}else FIREBASE&&firebase.analytics().logEvent("invalid_data",{seed:stage.name,uid:state.BATTLE[ghost.length].uid,name:state.BATTLE[ghost.length].name,report:stage.name+"/"+state.BATTLE[ghost.length].uid+"("+state.BATTLE[ghost.length].name+")"+X+" : "+UID+"/("+NAME+")",error:X}),state.BATTLE.splice(ghost.length,1);this["import"]()}else a.replay(!1),this.START=this.IMPORT=!1;return S};this.overwrite=function(E,S,X){X=void 0===X?!0:X;var da=E[4]<S[4],ha=E[5]>=S[5],la=
E[5]>S[5];return void 0===S[4]||da&&ha||la?!X||E:!!X&&S};this.decode=function(E){var S=[function(){control.UP=!1;control.DOWN=!1;control.LEFT=!1;control.RIGHT=!1},function(){control.UP=!1;control.DOWN=!1;control.LEFT=!0;control.RIGHT=!1},function(){control.UP=!1;control.DOWN=!1;control.LEFT=!1;control.RIGHT=!0},function(){control.UP=!0;control.DOWN=!1;control.LEFT=!1;control.RIGHT=!1},function(){control.UP=!0;control.DOWN=!1;control.LEFT=!0;control.RIGHT=!1},function(){control.UP=!0;control.DOWN=
!1;control.LEFT=!1;control.RIGHT=!0},function(){control.UP=!1;control.DOWN=!0;control.LEFT=!1;control.RIGHT=!1},function(){control.UP=!1;control.DOWN=!0;control.LEFT=!0;control.RIGHT=!1},function(){control.UP=!1;control.DOWN=!0;control.LEFT=!1;control.RIGHT=!0},function(){control.UP=!0;control.DOWN=!0;control.LEFT=!1;control.RIGHT=!1}];S.a=function(){control.UP=!0;control.DOWN=!0;control.LEFT=!0;control.RIGHT=!1};S.b=function(){control.UP=!0;control.DOWN=!0;control.LEFT=!1;control.RIGHT=!0};S[E]()};
this.audit=function(){}}
function VHS(a){var f=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return f.tape[h].timer};this.DT=DT();var h=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(g){this.keybuffer.push({key:(control.UP?3:control.DOWN?6:0)+(control.LEFT?1:control.RIGHT?2:0),time:g})};this.simulate=function(){};this.capture=function(g){return{position:(new THREE.Vector3).copy(g.position),normal:(new THREE.Vector3).copy(g.normal),lookTarget:g.lookTarget.clone(),rotation:g.rotation,
timer:g.getTime(),objective:g.getObjective(),check:g.check,UP:g.UP}};this.record=function(g){f.tape[h]=g.record();h=24E4<f.tape[h].TS?0:h+1};this.play=function(g){if(this.RECORD){this.RECORD=!1;for(var n=f.frame=0;n<ghost.length;n++)ghost[n].reset();TIME.reset();TIMEOUT=0}if(f.frame>f.tape.length-10){f.frame=0;TIME.reset();for(n=0;n<ghost.length;n++)ghost[n].reset();stage.generate.resetCheckpoints()}if(g.replay(),this.tape[f.frame].check)stage.generate.checkpoints[0===this.tape[f.frame].objective?
4:this.tape[f.frame].objective-1].display.material.color=palette[4]};this.reset=function(){stage.generate.resetCheckpoints();h=0;f.frame=0;TIME.reset();f.PLAY=!1;f.RECORD=!0;f.tape=[]};this["export"]=function(g,n){g=void 0===g?function(){state.results()}:g;var t=vehicle.CHECKPOINT[4]-1E4*vehicle.CHECKPOINT[5];if((t<PERSONAL_BEST||!1===PERSONAL_BEST)&&""!==NAME&&null!==NAME&&!1!==UID&&void 0!==UID&&!f.SCAN||void 0!==n&&!n){state.STATE=function(){ui.clear();ui.print("uploading vhs to db","2","2")};
state.STATE();UID;var q=stage.name,x=vehicle.CHECKPOINT.slice(),b=vehicle.CHECKPOINT[0];n=vehicle.param();for(var c=[];c.length<vehicle.PHYSICSBUFFER.length;){var k=c.length;k={time:vehicle.PHYSICSBUFFER[k].time,U:vehicle.PHYSICSBUFFER[k].U,D:vehicle.PHYSICSBUFFER[k].D,L:vehicle.PHYSICSBUFFER[k].L,R:vehicle.PHYSICSBUFFER[k].R};c.push(k)}n={version:DB_BUILD,id:UID,seed:q,time:t,cp:x,utc:b,debug:c,param:n};firebase.database().ref("vhs/"+DB_BUILD+"/"+n.seed+"/"+UID).set(n,function(e){e?(ui.clear(),ui.print("network error",
"2","2")):(ui.clear(),ui.print("vhs succesfully submitted","2","2"));window.setTimeout(g,1E3);uas.replay();vehicle.replay()})}else void 0===UID||!1===UID||null===NAME||""===NAME||void 0===NAME?state.register():(state.results(),uas.replay(),vehicle.replay())};this.burn=function(g){return Math.round(1E9*g).toString(16)};this.read=function(g){return parseInt(g,16)/1E9};this.scan=function(g,n){f.SCAN=!0;var t=[];firebase.database().ref("vhs/"+DB_BUILD+"/"+g).orderByChild("time").limitToFirst(SCORE_LIMIT).once("value").then(function(q){q.forEach(function(x){var b=
x.child("id").val(),c=x.child("time").val();x=x.child("utc").val();t.push({uid:b,time:c,utc:x})});f.SCAN=!1;n(t)})};this.checkTime=function(g,n,t){g===n&&(PERSONAL_BEST=t)};this.requestName=function(g,n){firebase.database().ref("uid/"+g).once("value").then(function(t){t=t.child("name").val();return n(t),t})};this["import"]=function(g,n){n=void 0===n?function(){}:n;firebase.database().ref("vhs/"+DB_BUILD+"/"+g).once("value").then(function(t){var q=t.val(),x=q.id,b=q.seed,c=q.cp.slice();t=q.utc;q.model;
q.paint;q.param;n({uid:x,seed:b,cp:c,utc:t,debug:q.debug.slice(),param:q.param})})};this.save=function(g,n){n=void 0===n?1E3/30:n;for(var t=0,q=[],x=g[g.length-1].TS,b=0;b<x;)b+=n,b<x&&q.push({TS:b});for(x=0;x<q.length;x++)t=f.convert(g,q[x],t);return q};this.convert=function(g,n,t){for(var q=g[t].time,x=g[t+1].TS,b=x-q;n.time>x&&t<g.length-2;)q=g[++t].time,x=g[t+1].time,b=x-q;q=t;var c=t+1;x=(b-(x-n.time))/b;return n.position=new THREE.Vector3,n.position.copy(g[q].position),n.position.lerp(g[c].position,
x),n.lookTarget=new THREE.Vector3,n.lookTarget.copy(g[q].normal),n.lookTarget.lerp(g[c].normal,x),n.rotation=(g[c].rotation-g[q].rotation)*x,n.rotation+=g[q].rotation,n.rotation=(g[c].rotation-g[q].rotation)*x,n.rotation+=g[q].rotation,n.AT=(g[c].AT-g[q].AT)*x,n.AT+=g[q].AT,n.UP=g[q].UP,n.check=g[q].check,n.objective=g[q].objective,t}}
TIME.convert=function(a){a=void 0===a?[]:a;for(var f="[\n",h=0;h<a.length;h++){f+="'";for(var g=0;g<a[h].length;g++)f+=a[h].charCodeAt(g).toString(16);f+="',\n"}return f+="]",console.log(f),f};