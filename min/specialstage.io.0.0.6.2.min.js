(function(){function ob(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var f="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",
a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;
ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(l){var k="keydown"==l.type;switch(k||(f+=l.key),3<f.length&&(f=f.slice(1,4)),l.key){case "ArrowUp":a.UP=k;break;case "ArrowDown":a.DOWN=k;break;case "ArrowLeft":a.LEFT=k;break;case "ArrowRight":a.RIGHT=k;break;case "w":a.UP=k;break;case "s":a.DOWN=k;break;case "a":a.LEFT=k;break;case "d":a.RIGHT=k;break;case "r":a.RESET=k;break;case " ":a.SPACE=k;break;case "Shift":a.SHIFT=k;break;case "1":uas.CAM=
1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "Enter":a.ENTER=k;break;case "Control":a.CTRL=k;break;case "Escape":case "Backspace":a.ESC=k;break;case "=":a.ZOOM_IN=k;break;case "-":a.ZOOM_OUT=k;break;case "t":a.TARGET=k;break;case "h":a.HIDE=k;break;case ">":!k&&2>Fa&&(Fa+=.5);Ia();break;case "<":!k&&.5<Fa&&(Fa-=.5),Ia()}!w.REPLAY||qa||ya||"vhs"===f&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(sa["export"],1E3,R.results,!1),f=
"")};this.mousedown=function(l){l.preventDefault();a.touches[0]={x:l.clientX,y:l.clientY,start:!0}};this.mouseup=function(l){l.preventDefault();a.touches[0]={x:l.clientX,y:l.clientY,start:!1}};this.touchSetup=function(l){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",
a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(l)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(l){l=l.touches;a.touches=[];for(var k=0;k<l.length;k++)a.touches[k]={x:l[k].clientX,y:l[k].clientY,start:!0}};this.touchmove=function(l){a.touches=[];l=l.touches;for(var k=0;k<l.length;k++)a.touches[k]=
{x:l[k].clientX,y:l[k].clientY,start:!1}};this.touchend=function(l){a.touches=[];l=l.touches;for(var k=0;k<l.length;k++)a.touches[k]={x:l[k].clientX,y:l[k].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var f=[],l=0;this.BIOMES=f;this.BIOME=0;f[0]={name:"pine",palette:ba[9],tree:function(p,n){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};f[0].map[0]=function(p,n){var m=ba[10],E=!1;return.92<Math.abs(p)&&(m=.92<Math.abs(p)?ba[9]:ba[2],E=
!0),f[0].flags[n]=E,m};f[1]={name:"cherry blossom",palette:ba[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};f[1].map[0]=function(p,n){var m=ba[1],E=!1;return.95<Math.abs(p)&&(m=.92<Math.abs(p)?ba[12]:ba[1],E=!0),f[1].flags[n]=E,m};f[2]={name:"ice",palette:ba[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};f[2].map[0]=function(p,n){var m=ba[7],E=!1;return.95<Math.abs(p)&&(m=.92<Math.abs(p)?ba[2]:ba[7],E=!0),f[2].flags[n]=
E,m};var k=new THREE.Points(new THREE.Geometry);k.name="Generative Extruder";k.visible=!1;var q=new THREE.Line(new THREE.Geometry);q.name="Generative Nodes";q.visible=!1;q.material.color=ba[6];q.material.name="Node Material";q.position.z+=2;var u=new THREE.LineSegments(new THREE.Geometry);u.name="Generative Segments";u.visible=!0;u.material.color=ba[3];u.material.name="Segments Material";var r=new THREE.Mesh(new THREE.Geometry);r.name="Generative Surface";r.visible=!1;r.material.color=ba[0];r.material.name=
"Surface Material";var B=new THREE.LineSegments(new THREE.Geometry);B.name="Generative Perimeter";B.material.color=ba[1];B.material.name="Perimeter Material";var z=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));z.name="Terrain";z.material.name="Terrain Material";z.material.wireframe=!0;z.material.side=THREE.DoubleSide;z.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name=
"Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var c=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));c.name="Trees";var g=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);g.name="Background";g.material.color=ba[0];g.material.name="Background Material";g.material.wireframe=!1;g.material.side=THREE.FrontSide;g.material.opacity=
.75;g.material.blendMode=THREE.MultiplyBlending;g.material.transparent=!0;var e=new THREE.Points(new THREE.Geometry);e.material.color=ba[1];e.material.sizeAttenuation=!1;e.material.size=1.5;e.material.fog=!1;scope.stars=e;var h=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);h.name="Collision Mesh";h.visible=!0;h.material.name="Collision Material";h.material.side=THREE.BackSide;this.checkpoints=[];var x=new THREE.Vector3(0,0,1),D=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,
0,1);var M=new THREE.Vector3(0,3,0),Z=new THREE.Vector3(0,0,1),T=q.geometry.clone(),t=r.geometry.clone(),A=u.geometry.clone(),I=B.geometry.clone(),J=[],O=[],ia=new THREE.Vector3;J[0]=new THREE.Vector3(5,3,0);J[1]=new THREE.Vector3(-5,3,0);O[0]=J[0].clone();O.z+=1;O[1]=J[1].clone();O.z+=1;var U=Math.PI/64,S=Math.PI/32,aa=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var oa=!1,da=!1,ea=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Pa=18,Qa=new THREE.Raycaster;Qa.far=800;k.geometry.vertices[0]=
M.clone();k.geometry.vertices[1]=x.clone().add(M);k.geometry.vertices[2]=J[0].clone();k.geometry.vertices[3]=J[1].clone();k.geometry.vertices[4]=O[0].clone();k.geometry.vertices[5]=O[1].clone();this.connect=function(){scope.SEED=Ra;this.BIOME=l=scope.randomInt(0,3);N.SNOW=2===l;N.SNOW&&N.snow.init();fa.add(k);fa.add(q);fa.add(u);fa.add(B);fa.add(r);fa.add(wireframe);fa.add(g);la=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var p in aa=[],fa.remove(k),
fa.remove(q),fa.remove(u),fa.remove(B),fa.remove(r),fa.remove(wireframe),fa.remove(g),fa.remove(c),f)f[p].flag=[];for(var n in scope.checkpoints)fa.remove(scope.checkpoints[n].display),scope.checkpoints[n].display.geometry.dispose(),scope.checkpoints[n].collision.geometry.dispose()};this.complete=function(){h.geometry.mergeVertices();h.geometry.verticesNeedUpdate=!0;h.geometry.elementsNeedUpdate=!0;h.geometry.computeFaceNormals();h.geometry.computeVertexNormals();h.geometry.computeBoundingSphere();
g.geometry.copy(h.geometry);--g.position.z;for(var p=[],n=0;n<h.geometry.faces.length;n++)p[h.geometry.faces[n].a]=h.geometry.faces[n].vertexNormals[0].clone(),p[h.geometry.faces[n].b]=h.geometry.faces[n].vertexNormals[1].clone(),p[h.geometry.faces[n].c]=h.geometry.faces[n].vertexNormals[2].clone();for(n=0;n<h.geometry.vertices.length;n++)h.geometry.vertices[n].add(p[n].multiplyScalar(2));h.geometry.verticesNeedUpdate=!0;h.geometry.computeFaceNormals();h.geometry.computeVertexNormals();h.geometry.computeBoundingSphere();
wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();p=new THREE.IcosahedronGeometry(1200,10);for(var m in p.vertices).3>scope.random()&&-400<p.vertices[m].z&&e.geometry.vertices.push(p.vertices[m].clone());p.dispose();e.geometry.computeBoundingSphere();N.surface=h.clone();N.start=scope.start.clone();la=window.performance.now()-la;oa=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",
{time:Math.round(la/1E3)});Za?(b.clear(),w.connect(N.start,N.surface),w.PLAY=!1,sa.PLAY=!0):R.ready()};this.reset=function(){Pa=(36+scope.random()-.5)/2;a=0;q.geometry.dispose();u.geometry.dispose();r.geometry.dispose();k.geometry.dispose();B.geometry.dispose();z.geometry.dispose();wireframe.geometry.dispose();h.geometry.dispose();c.geometry.dispose();e.geometry.dispose();A.dispose();I.dispose();T.dispose();t.dispose();A.copy(new THREE.Geometry);I.copy(new THREE.Geometry);T.copy(new THREE.Geometry);
t.copy(new THREE.Geometry);q.geometry.copy(new THREE.Geometry);k.geometry.copy(new THREE.Geometry);u.geometry.copy(new THREE.Geometry);B.geometry.copy(new THREE.Geometry);r.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);M.set(0,3,0);Z.set(0,0,1);J[0]=new THREE.Vector3(4,3,0);J[1]=new THREE.Vector3(-4,3,0);oa&&(oa=!1,da=!1,ea=!1);this.END=!1;k.position.set(0,0,0);k.geometry.vertices[0]=M.clone();k.geometry.vertices[1]=x.clone().add(M);k.geometry.vertices[2]=
J[0].clone();k.geometry.vertices[3]=J[1].clone();k.geometry.vertices[4]=O[0].clone();k.geometry.vertices[5]=O[1].clone();k.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(p,n,m,E,C,y,Q,F,L,K){p=void 0===p?0:p;n=void 0===n?0:n;m=void 0===m?0:m;E=void 0===E?0:E;C=void 0===C?0:C;y=void 0===y?{start:0,end:30,angle:0,slope:0}:y;Q=void 0===Q?[]:Q;F=void 0===F?[]:F;L=void 0===L?!1:L;K=void 0===K?999:K;var P=window.performance.now(),V=0;for(0===E&&(E=.5<scope.random()?
1:-1);32>V&&!da;){if(p===y.end+1){F=[];for(m=0;1>m;m++)if(p>=scope.length)F.push({angle:0,slope:0,end:30}),K=p+30;else if(0===n){var W=scope.randomInt(2,4)*E;V=Math.floor(Math.abs(36/W));E=.01>scope.random()?+E:-1*E;V=scope.randomInt(1,V);F.push({angle:W,slope:0,end:V})}else W=scope.randomInt(-5,-1),V=scope.random(),W=2!==l&&.05>V?W*=-1:W,V=scope.randomInt(2,20),F.push({angle:0,slope:W,end:V});V=scope.randomInt(0,F.length);n=F[V].angle;m=F[V].slope;y.start=p;y.end=p+F[V].end;F=F.slice(V,1)}if(L||
(scope.extrude(n,m),aa.push({angle:n,slope:m}),T.verticesNeedUpdate=!0,p++),10<=p&&!L){V=new THREE.Vector2(T.vertices[p-1].x,T.vertices[p-1].y);for(W=0;W<T.vertices.length-1-10;W++)if(18>(new THREE.Vector2(T.vertices[W].x,T.vertices[W].y)).distanceTo(V)){L=!0;break}L&&window.setTimeout(N.reset(!0),0)}0;p===K&&(da=!0,q.geometry.dispose(),q.geometry=T.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ka.copy(q.geometry.vertices[0]),ka.sub(T.vertices[0])),
window.setTimeout(function(){R.PATH=!0;R.STATE();scope["import"]()},0));V=window.performance.now()-P}da||L||window.setTimeout(scope.path,0,p,n,m,E,C,y,Q,F,L,K)};this.skijump=function(p,n,m,E,C,y,Q,F,L,K,P){p=void 0===p?0:p;n=void 0===n?0:n;m=void 0===m?0:m;E=void 0===E?0:E;C=void 0===C?0:C;y=void 0===y?{start:0,end:20,angle:0,slope:0}:y;Q=void 0===Q?[]:Q;F=void 0===F?[]:F;L=void 0===L?!1:L;K=void 0===K?300:K;P=void 0===P?0:P;var V=window.performance.now(),W=0;for(0===E&&(E=.5<scope.random()?1:-1);32>
W&&!da;){if(p===y.end+1){F=[];for(n=0;1>n;n++)0===m&&20===y.end?(P=-1,F.push({angle:0,slope:-4,end:30})):3===m?F.push({angle:0,slope:4,end:3}):4===m?F.push({angle:0,slope:-32,end:10}):-4===m?(P=1,F.push({angle:0,slope:m+1,end:1})):-32===m?F.push({angle:0,slope:-4,end:40}):1==P?F.push({angle:0,slope:m+1,end:1}):-1==P&&F.push({angle:0,slope:m-1,end:1});W=scope.randomInt(0,F.length);n=F[W].angle;m=F[W].slope;y.start=p;y.end=p+F[W].end;F=F.slice(W,1)}if(L||(scope.extrude(n,m),aa.push({angle:n,slope:m}),
T.verticesNeedUpdate=!0,p++),10<=p&&!L){W=new THREE.Vector2(T.vertices[p-1].x,T.vertices[p-1].y);for(var ta=0;ta<T.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(T.vertices[ta].x,T.vertices[ta].y)).distanceTo(W)){L=!0;break}L&&window.setTimeout(N.reset(!0),0)}0;K<=p&&(da=!0,q.geometry.dispose(),q.geometry=T.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ka.copy(q.geometry.vertices[0]),ka.sub(T.vertices[0])),window.setTimeout(function(){scope["import"]()},
0));W=window.performance.now()-V}da||L||window.setTimeout(scope.skijump,0,p,n,m,E,C,y,Q,F,L,K)};this["import"]=function(p){p=void 0===p?0:p;for(var n=window.performance.now(),m=0;!ea&&32>m;){if(0===p&&(k.position.set(0,0,0),k.rotation.z=0,M.set(0,3,0),k.geometry.vertices[0]=M.clone(),k.geometry.vertices[1]=x.clone().add(M),k.geometry.vertices[2]=J[0].clone(),k.geometry.vertices[3]=J[1].clone(),k.geometry.vertices[4]=O[0].clone(),k.geometry.vertices[5]=O[1].clone(),k.geometry.verticesNeedUpdate=!0,
k.updateMatrixWorld()),p<aa.length)a=p,angle=aa[p].angle,slope=aa[p].slope,scope.extrude(angle,slope),u.geometry.dispose(),u.geometry=A.clone(),u.geometry.computeBoundingSphere(),B.geometry.dispose(),B.geometry=I.clone(),B.geometry.computeBoundingSphere(),r.geometry.dispose(),r.geometry=t.clone(),r.geometry.computeBoundingSphere(),p++;else if(!ea&&p===aa.length){for(var E in scope.checkpoints=scope.checkpoint(),scope.checkpoints)fa.add(scope.checkpoints[E].display);ea=!0;window.setTimeout(function(){scope.terrain(!0)},
0)}m=window.performance.now()-n}ea||window.setTimeout(scope["import"],0,p,angle,slope)};this.extrude=function(p,n){p=void 0===p?0:p;n=void 0===n?0:n;for(var m in k.updateMatrixWorld(),k.rotateZ(p*S),k.geometry.vertices)k.geometry.vertices[m].applyAxisAngle(D,n*U);k.geometry.verticesNeedUpdate=!0;m=k.geometry.vertices[0].clone();var E=k.geometry.vertices[2].clone(),C=k.geometry.vertices[3].clone(),y=k.geometry.vertices[1].clone();if(m.applyMatrix4(k.matrix),E.applyMatrix4(k.matrix),C.applyMatrix4(k.matrix),
y.applyMatrix4(k.matrix),y.sub(m),da){if(E.add(ka),C.add(ka),0<A.vertices.length){var Q=A.vertices[A.vertices.length-1].clone().sub(ia),F=A.vertices[A.vertices.length-2].clone().sub(ia);t.vertices.push(E.clone().sub(y));t.vertices.push(C.clone().sub(y));t.vertices.push(F);t.vertices.push(C.clone().sub(y));t.vertices.push(Q);t.vertices.push(F);var L=E.clone();p=C.clone();Q=A.vertices[A.vertices.length-1].clone();F=A.vertices[A.vertices.length-2].clone();h.geometry.vertices.push(L);h.geometry.vertices.push(p);
h.geometry.vertices.push(F);h.geometry.vertices.push(p);h.geometry.vertices.push(Q);h.geometry.vertices.push(F);Q=t.vertices.length;var K=new THREE.Face3(Q-3,Q-2,Q-1);L=new THREE.Face3(Q-5,Q-4,Q-6);t.faces.push(K);t.faces.push(L);K=K.clone();L=L.clone();K.color=new THREE.Color(16777215);L.color=new THREE.Color(16777215);h.geometry.faces.push(K);h.geometry.faces.push(L)}0<I.vertices.length?(K=2,L=1,4<I.vertices.length&&(K=4,L=2),K=I.vertices[I.vertices.length-K].clone(),L=I.vertices[I.vertices.length-
L].clone(),I.vertices.push(E.clone().add(y)),I.vertices.push(K.clone()),I.vertices.push(C.clone().add(y)),I.vertices.push(L.clone()),a==aa.length-1&&(F=E.clone().add(y),Q=C.clone().add(y),I.vertices.push(F),I.vertices.push(Q))):(I.vertices.push(E.clone().add(y)),I.vertices.push(C.clone().add(y)));A.vertices.push(E.clone());A.vertices.push(C.clone());ia.copy(y)}else T.vertices.push(m.clone());for(var P in M.copy(m).sub(k.position),k.position.add(M),k.geometry.vertices)k.geometry.vertices[P].applyAxisAngle(D,
-1*n*U)};this.terrain=function(p,n,m,E,C,y,Q){n=void 0===n?[]:n;m=void 0===m?[]:m;E=void 0===E?[]:E;C=void 0===C?0:C;y=void 0===y?0:y;Q=void 0===Q?0:Q;if(void 0===p||p){u.updateMatrixWorld();z.geometry.dispose();z.geometry.copy(new THREE.Geometry);n=[];m=[];E=[];for(p=0;2>p;p++)E[p]=[],n[p]=[],m[p]=[];for(p=0;p<u.geometry.vertices.length;p++)m[p%2].push(u.geometry.vertices[p]);for(p=0;2>p;p++)for(var F=0;F<m[p].length;F++){var L=0===p?1:-1,K=m[p][F].clone();K.sub(m[p+L][F]);K.normalize().multiplyScalar(3);
E[p][F]=K.clone()}}F=0;var P;p=window.performance.now();if(4>C){if(z.geometry.verticesNeedUpdate=!0,z.geometry.elementsNeedUpdate=!0,z.geometry.computeBoundingSphere(),z.geometry.computeFaceNormals(),z.geometry.computeVertexNormals(),z.updateMatrixWorld(),0<C&&0===Q)for(m[y]=[],L=0;L<n[y].length;L++)m[y][L]=z.geometry.vertices[n[y][L]];0===Q&&(n[y]=[]);for(v=Q;v<m[y].length&&32>F;){F=!1;if(void 0!==m[y][v]&&void 0!==m[y][v-1]){if(void 0===E[y][v])E[y][v]=E[s][v-1].clone();else if(z.geometry.computeBoundingSphere(),
L=m[y][v].clone().add(E[y][v]),L.z-=100,Qa.set(L,x),L.z+=100,K=Qa.intersectObjects([z],!0),0<K.length)for(var V in K).01<K[V].point.distanceTo(L)&&(n[y][v]=void 0,F=!0);F||(z.geometry.vertices.push(m[y][v].clone()),z.geometry.vertices.push(m[y][v].clone().add(E[y][v])),n[y][v]=z.geometry.vertices.length-1,0<v&&(z.geometry.vertices.push(m[y][v-1].clone()),P=z.geometry.vertices.length,0===y?z.geometry.faces.push(new THREE.Face3(P-2,P-1,P-3)):1===y&&z.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3))))}F=
window.performance.now()-p;v++;Q=v}if(Q===m[y].length){Q=0;for(P=1;P<n[y].length;P++)if(void 0!==n[y][P]&&void 0!==n[y][P-1]){V=z.geometry.vertices[n[y][P]];var W;p=z.geometry.vertices[n[y][P-1]];2.8>V.distanceTo(p)?(V.copy(p),n[y][P]=n[y][P-1],E[y][P].copy(E[y][P-1])):1<P&&(z.geometry.vertices.push(m[y][P-1]),W=0===y?n[y][P]:n[y][P-1],p=0===y?n[y][P-1]:n[y][P],z.geometry.faces.push(new THREE.Face3(W,p,z.geometry.vertices.length-1)))}y++}1<y&&(y=0,C++)}if(4===C){z.geometry.verticesNeedUpdate=!0;z.geometry.elementsNeedUpdate=
!0;z.geometry.colorsNeedUpdate=!0;z.geometry.computeFaceNormals();z.geometry.computeVertexNormals();z.geometry.mergeVertices();z.geometry.computeBoundingSphere();scope.noise(z.geometry);for(W=0;W<z.geometry.faces.length;W++)V=z.geometry.vertices[z.geometry.faces[W].a].clone(),p=z.geometry.vertices[z.geometry.faces[W].b].clone(),P=z.geometry.vertices[z.geometry.faces[W].c].clone(),z.geometry.colors[z.geometry.faces[W].a],z.geometry.colors[z.geometry.faces[W].b],z.geometry.colors[z.geometry.faces[W].c],
h.geometry.vertices.push(V),h.geometry.vertices.push(p),h.geometry.vertices.push(P),wireframe.geometry.vertices.push(V),wireframe.geometry.vertices.push(p),wireframe.geometry.vertices.push(P),P=h.geometry.vertices.length,V=new THREE.Face3(P-1,P-2,P-3),V.color=new THREE.Color(0),h.geometry.faces.push(V),wireframe.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3));wireframe.geometry.copy(z.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,
n.slice(),m.slice(),E.slice(),C,y,Q)},0)};this.biome=function(){for(var p=l,n=wireframe.geometry.faces,m=[],E=[],C=0;C<n.length;C++)for(var y=0;y<f[l].map.length;y++)n[C].vertexColors[0]=f[l].map[y](n[C].vertexNormals[0].z,n[C].a),n[C].vertexColors[1]=f[l].map[y](n[C].vertexNormals[1].z,n[C].b),n[C].vertexColors[2]=f[l].map[y](n[C].vertexNormals[2].z,n[C].c);for(n=0;n<f[l].flags.length;n++)for(C=0;C<u.geometry.vertices.length;C++).1>wireframe.geometry.vertices[n].distanceTo(u.geometry.vertices[C])&&
(f[l].flags[n]=!1);for(n=0;n<f[l].flags.length;n++)f[l].flags[n]&&m.push(n);for(n=0;n<f[l].limit&&n<m.length;){C=scope.randomInt(0,m.length);y=!0;if(0<E.length&&0<m.length)for(;y;){for(var Q in E){if(wireframe.geometry.vertices[m[C]].distanceTo(wireframe.geometry.vertices[E[Q]])<f[l].range){y=!0;m.slice(C,1);C=scope.randomInt(0,m.length);break}y=!1}0>=m.length&&(y=!1)}if(0<m.length){y=f[p].tree();for(var F in y.vertices)c.geometry.vertices.push(y.vertices[F].clone().add(wireframe.geometry.vertices[m[C]])),
c.geometry.colors[c.geometry.vertices.length-1]=y.colors[F];E.push(m[C]);m.slice(C,1)}n++}c.verticesNeedUpdate=!0;c.elementsNeedUpdate=!0;fa.add(c)};this.sakura=function(){var p=new THREE.Geometry,n=[],m=[],E=1,C,y=new THREE.Vector3(0,0,0),Q=new THREE.Vector3(0,0,3),F=12,L=0,K=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,0,1);p.vertices.push(y);p.vertices.push(Q);p.colors.push(ba[2]);p.colors.push(ba[2]);m.push({v:Q.clone(),n:Q.clone(),pitch:K.clone(),roll:P.clone()});for(y=[];4>L;){Q=[];for(K=
0;K<m.length;K++)for(var V=P=0;3>V;V++){var W=0===L&&2===V&&1>P?1:scope.random();if(.2<W){W=scope.randomInt(-2,2);var ta=m[K].n.clone(),Ca=ba[2];ta.applyAxisAngle(m[K].pitch,2*Math.PI/(F+W));ta.applyAxisAngle(m[K].roll,2*Math.PI/3*V);ta.multiplyScalar(E);W=ta.clone().add(m[K].v);p.vertices.push(m[K].v.clone());p.vertices.push(W);p.colors.push(Ca);p.colors.push(Ca);Ca=m[K].pitch.clone();Ca.applyAxisAngle(m[K].roll,2*Math.PI/3*V);Ca.applyAxisAngle(m[K].pitch,2*Math.PI/F);var pa=m[K].roll.clone();pa.applyAxisAngle(m[K].pitch,
2*Math.PI/F);pa.applyAxisAngle(m[K].roll,2*Math.PI/3*V);0<V&&n.push({a:W.clone(),b:m[K].v.clone(),pitch:Ca,roll:pa});Q.push({v:W.clone(),n:ta.clone(),pitch:Ca,roll:pa});P++}else 0===P&&2===V&&y.push({v:m[K].v.clone(),n:m[K].n.clone(),pitch:m[K].pitch.clone(),roll:m[K].roll.clone()})}m=Q.slice();E*=.9;L++}for(C in F=6,n)E=n[C].a.clone(),Q=n[C].b.clone(),E=E.clone().sub(Q),K=E.clone().multiplyScalar(.5).add(Q),L=scope.randomInt(0,3)-1,E.applyAxisAngle(n[C].pitch,2*Math.PI/F),E.applyAxisAngle(n[C].roll,
2*Math.PI/L),E.multiplyScalar(.5),Q=K,K=E.clone().add(K),p.vertices.push(Q),p.vertices.push(K),p.colors.push(ba[2]),p.colors.push(ba[2]),Q=n[C].pitch.clone(),Q.applyAxisAngle(n[C].roll,2*Math.PI/L),Q.applyAxisAngle(n[C].pitch,2*Math.PI/F),P=n[C].roll.clone(),P.applyAxisAngle(n[C].pitch,2*Math.PI/F),P.applyAxisAngle(n[C].roll,2*Math.PI/L),m.push({v:K.clone(),n:E.clone(),pitch:Q,roll:P});m=m.concat(y);for(n=0;n<m.length;n++)for(C=0;5>C;C++)F=m[n].n.clone(),F.normalize(),F.applyAxisAngle(m[n].pitch,
2*Math.PI/6),F.applyAxisAngle(m[n].roll,2*Math.PI/5*C),F.multiplyScalar(.5),F=F.add(m[n].v),y=m[n].v.clone(),p.vertices.push(F),p.vertices.push(y),p.colors.push(ba[12]),p.colors.push(ba[12]);return p.colorsNeedUpdate=!0,p};this.pine=function(){var p=Math.floor(8*scope.random())+6,n=2*Math.PI/6,m=new THREE.Geometry;m.vertices.push(new THREE.Vector3(0,0,0));m.vertices.push(new THREE.Vector3(0,0,+p-.5+1));m.colors.push(ba[9]);m.colors.push(ba[9]);m.colors.push(ba[9]);for(var E=1;E<p;E++)for(var C=0;6>
C;C++)off=E%2*n*.5,m.vertices.push(new THREE.Vector3(0,0,+E+1)),m.vertices.push(new THREE.Vector3(.3*(p-E),0,+E-.3+1)),m.vertices[m.vertices.length-1].applyAxisAngle(x,n*C+off),m.colors.push(ba[9]),m.colors.push(ba[9]);return m};this.checkpoint=function(){function p(C,y,Q){var F=new THREE.Geometry,L=(new THREE.Vector3).copy(C).sub(y),K=(new THREE.Vector3).copy(C).add(L.clone().multiplyScalar(1.5));L=(new THREE.Vector3).copy(y).sub(L.clone().multiplyScalar(1.5));F.vertices.push(new THREE.Vector3(K.x,
K.y,K.z-12));F.vertices.push(new THREE.Vector3(K.x,K.y,K.z+12));F.vertices.push(new THREE.Vector3(L.x,L.y,L.z+12));F.vertices.push(new THREE.Vector3(L.x,L.y,L.z+12));F.vertices.push(new THREE.Vector3(L.x,L.y,L.z-12));F.vertices.push(new THREE.Vector3(K.x,K.y,K.z-12));F.faces.push(new THREE.Face3(0,1,2));F.faces.push(new THREE.Face3(3,4,5));K=new THREE.Geometry;K.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));K.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));K.vertices.push(new THREE.Vector3(y.x,
y.y,y.z+6));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));K.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));K.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));K.vertices.push(new THREE.Vector3(C.x,C.y,C.z+1));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+1));C=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});C.color=ba[5];F=new THREE.Mesh(F,C);F.visible=!0;C=new THREE.LineSegments(K,
C);return F.name="Objective "+Q,C.name="Checkpoint"+Q,{display:C,collision:F}}var n=u.geometry,m=n.vertices.length-80;m=Math.floor(m/4)-Math.floor(m/4)%2;var E=[];E[0]=p(n.vertices[40],n.vertices[41],0);E[1]=p(n.vertices[40+m],n.vertices[1+m+40],1);E[2]=p(n.vertices[2*m+40],n.vertices[2*m+41],2);E[3]=p(n.vertices[3*m+40],n.vertices[3*m+41],3);E[4]=p(n.vertices[4*m+40],n.vertices[4*m+41],4);this.DISTANCE=4*m/2*3;scope.start.copy(n.vertices[36]);scope.start.sub(n.vertices[37]);scope.start.multiplyScalar(-.75);
scope.start.add(n.vertices[36]);for(n=0;5>n;n++)null==N.best&&(N.best[n]=4>n?m*(n+1)/Pa:N.best[n]=N.best[n-1]);return R.STATE(),E};this.resetCheckpoints=function(){for(var p in scope.checkpoints)scope.checkpoints[p].display.material.color=ba[5]};this.random=function(){Ra=(Ra+1)%2147483647;var p=1E4*Math.sin(Ra);return p-Math.floor(p)};this.randomInt=function(p,n){return Math.floor(scope.random()*(n-p))+p};this.noise=function(p){var n=new pb,m=[],E=8,C=0,y=0,Q=1E3*scope.random();l;for(var F=0;F<p.vertices.length;F++)m[F]=
0;for(F=0;2>F;F++){for(var L=0;L<p.vertices.length;L++)m[L]+=Math.floor(n.noise(p.vertices[L].x/E,p.vertices[L].y/E,Q)*E),m[L]>C&&(C=m[L]),m[L]<y&&(y=m[L]);E*=3}for(n=0;n<m.length;n++){E=2===l?2:.5;for(C=0;C<u.geometry.vertices.length;C++)y=p.vertices[n].distanceTo(u.geometry.vertices[C]),y=y*y/100,y<E&&(E=y);p.vertices[n].z+=m[n]*E}};this.name=function(){var p="";if(Ua)p=R.custom_seed;else if(Ga||Za)p=R.CHALLENGES.seed;else{var n=[" forest"," pass"," mountain"],m="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");
TOGGLE=!1;for(var E=Math.ceil(3*Math.random())+1,C=0;C<E;)p+=m[Math.floor(Math.random()*m.length)],C++;m=2===l?1:0;m=n[Math.floor(m+Math.random()*(n.length-m))];p+=m;(.04<Math.random()||p!==eb)&&(p="",m=Math.floor(Math.random()*fb.length),p=fb[m])}return eb=p,this.BIOME=l,p}}function gb(){$a=!0;window.removeEventListener("touchstart",gb)}function Ia(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,f=window.innerWidth,l=window.innerHeight;ca.aspect=f/l;ca.updateProjectionMatrix();
b.resize(f,l,a,Fa);R.resize(f,l,a)}function hb(){if(window.requestAnimationFrame(hb),Va=window.performance.now(),!va||w.IMPORT||ya)if(w.REPLAY&&!va){ib();N.update();w.update();uas.update(w.TIMESTAMP);ya&&0<X.length&&w.TIMESTAMP>10*X[0].cp[4]+5E3&&w.reset(!0);qa||jb||kb||qb||(w.TIMESTAMP,0);for(var a=0;a<X.length;a++)X[a].update(w.TIMESTAMP-0,w.FRAME)}else if(Sa||sa.SCAN&&!va)ca.up.set(0,0,1),ca.position.applyAxisAngle(ca.up,.01),ca.lookAt(new THREE.Vector3),Sa&&R.loading(),R.scanning();else{if(ya||
w.IMPORT){for(a="";a.length<Math.floor(Va/500)%4;)a+=".";b.clear();b.text("importing ghost data"+a,16,16);N.update()}ca.up.set(0,0,1);ca.position.applyAxisAngle(ca.up,.01);ca.lookAt(new THREE.Vector3,0,0,0)}else{w.update();for(a=0;a<X.length;a++)w.START?X[a].update(w.TIMESTAMP,w.FRAME):X[a].update(0,0);uas.update(w.TIMESTAMP);qa||ab||R.update();!$a||qa||Ma||b.dpad();G.RESET&&!qa&&(R.reset(),G.RESET=!1);N.update()}za.render(fa,ca);b.update(G.touches)}function rb(){var a=this;this.SNOW=this.COMPLETE=
!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var l=new THREE.Vector3;l.copy(ca.position);l.x+=Math.random()*a.snow.distance-a.snow.distance/
2;l.y+=Math.random()*a.snow.distance-a.snow.distance/2;l.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(l)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var l=0;l<a.snow.mesh.geometry.vertices.length;l++){var k=a.snow.mesh.geometry.vertices[l];k.z-=.5*w.DT();(Math.abs(k.z-ca.position.z)>a.snow.height/2||Math.abs(k.x-ca.position.x)>a.snow.distance/2||Math.abs(k.y-ca.position.y)>a.snow.distance/2)&&(k.copy(ca.position),
k.x+=Math.random()*a.snow.distance-a.snow.distance/2,k.y+=Math.random()*a.snow.distance-a.snow.distance/2,k.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var f=0;4>f;f++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(l){l=void 0===l?!1:l;if(ca.position.set(0,400,200),ca.far=2E3,ca.updateProjectionMatrix(),ca.lookAt(new THREE.Vector3),za.render(fa,ca),!l){this.name=
this.generate.name();l="";for(var k in this.name)l+=this.name.charCodeAt(k).toString();Ra=l}a.generate.connect();sb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(l){l=void 0===l?!1:l;Ra++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;a.connect(l)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function tb(){var a=this,f,l,k=0,q=0,u=[];u.push(function(){b.link("","0","1.0-24","1.0-4",
"6","https://ginko.ltd");b.renderer.style.backgroundImage="url('./img/ginko_promo.gif')";b.renderer.style.backgroundSize="auto";b.renderer.style.backgroundRepeat="no-repeat";b.renderer.style.backgroundPosition="center 25%";b.print("support development by","2","1.0-23");b.style=6;b.print("acquiring items from ginko.ltd!","2","1.0-21");b.style=0});u.push(function(){b.renderer.style.backgroundImage="url('./img/low_promo.gif')";b.renderer.style.backgroundSize="auto";b.renderer.style.backgroundRepeat=
"no-repeat";b.renderer.style.backgroundPosition="center 25%";b.print("new mixtape by","2","1.0-23");b.style=1;b.print("low recordings! listen now!","2","1.0-21");b.button("","2","1.0-22","40","7",function(){var c=document.getElementById("mp3_player");c.currentTime=Math.random()*c.duration;c.play();a.STATE();Wa=!0;a.menu(a.intro)},!1);b.style=0});this.custom_seed="";var r="#1#ffffff#334#",B=Da+"#1#",z=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=
[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(c){return c?(ma=c.uid,a.STATE(),sa.requestName(ma,function(g){ja=g;a.STATE()})):(ma=!1,a.STATE()),null})};this.register=function(c){b.clear();a.STATE=function(){a.register(c)};ab=!0;a.inputName(function(){ab=!1;sa["export"]()},!0,"input name to save data")};this.resize=function(c,g){f=b.width;l=b.height;Aa=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var c=w.yen();b.print("$ "+
c.toString(),"2","1.0-4")};this.nav=function(c){c=void 0===c?function(){b.clear()}:c;b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2+4p","1.0-4","8",function(){a.menu(c)},!1)};this.title=function(c,g){a.breadcrumb(c,g);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){z||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1},!1);Wa?(b.style=1,b.sprite(40,72,8,10,"1.0-14","2",8,10),b.sprite(48,72,16,16,"1.0-19","2",16,16),b.sprite(16,72,16,16,"1.0-10","2",16,
16),b.style=0,b.button("","1.0-23","2+4p","7","5",function(){var e=document.getElementById("mp3_player");e.currentTime=Math.random()*e.duration;e.play();a.STATE()},!1),b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").pause();Wa=!1;a.STATE()},!1)):(b.style=4,b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();Wa=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=
function(c,g){g=void 0===g?function(){z||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1}:function(){a.menu(c);qa=!0};b.style=Wa?1:0;b.style=0;b.print("  menu","2","2");b.style=0;b.print("<","2","2");b.button("","2","2+4p","7","8",g,!1)};this.menu=function(c){qa=!0;b.style=0;a.STATE=function(){a.menu(c)};z||b.backdrop();b.clear();a.title(c);b.sprite(0,0,1,1,"2","6","1.0-4",1);ya?(b.print(" > view spectator controls","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle",
"2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(c)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");b.button("","2","13+4p","1.0-4","5",function(){a.settings(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var g=8,e;ya?(e=uas.AUTOPILOT?"disable":"enable",b.button(e+" autopilot","2","1.0-2-"+g,"1.0-4","6",function(){b.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),g+=8,b.button("deploy vehicle","2","1.0-2-"+g,"1.0-4","6",function(){b.backdrop(!1);
ya=!1;a.STATE=function(){};w.reset(!1);a.reset();va=!0;w.START=!1;w.disconnect();w.connect(N.start,N.surface,!1);a.play()},!0)):(va||w.REPLAY)&&(b.button("restart stage","2","1.0-2-"+g,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),g+=8,b.button("next stage","2","1.0-2-"+g,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var c;a.STATE=function(){a.intro()};z=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");u[0]();Ga?(b.style=4,b.print("challenge detected!",
"2","12"),b.style=0,c=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),b.style=0,b.print(c,"9","15"),sa.requestName(a.CHALLENGES.uid,function(g){a.CHALLENGER=g;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ua&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===ma||""!==ja?null!==ja&&""!==ja?(b.style=5,b.print("welcome back!","2","6"),b.style=
0,b.print("> "+ja,"2","9"),b.style=2,b.print("[edit]",ja.length+"+5","9"),b.style=0,b.button("","2","9+4p",ja.length+"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===ja||null===ja)||!1!==ma&&null===ja)&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.6.2","2","1.0-4");b.style=
0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();z=!1;b.renderer.style.background="none";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");N.connect();a.load();a.discord()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12",
"1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=0};this.load=function(){a.STATE=function(){a.target();a.setBattleName();a.discord()};a.TIMELIST=[];sa.scan(N.name,function(c){for(var g={$jscomp$loop$prop$t$88$170:0};g.$jscomp$loop$prop$t$88$170<c.length;g={$jscomp$loop$prop$t$88$170:g.$jscomp$loop$prop$t$88$170},g.$jscomp$loop$prop$t$88$170++)a.TIMELIST[g.$jscomp$loop$prop$t$88$170]={uid:c[g.$jscomp$loop$prop$t$88$170].uid,
utc:c[g.$jscomp$loop$prop$t$88$170].utc,time:c[g.$jscomp$loop$prop$t$88$170].time,name:"..."},sa.requestName(c[g.$jscomp$loop$prop$t$88$170].uid,function(x){return function(D){a.TIMELIST[x.$jscomp$loop$prop$t$88$170].name=D;a.STATE()}}(g)),sa.checkTime(ma,c[g.$jscomp$loop$prop$t$88$170].uid,c[g.$jscomp$loop$prop$t$88$170].time);g=a.TIMELIST.length<Da?a.TIMELIST.length:Da;var e=[];switch(Ea){case 0:e=c.slice(0,g);break;case 1:for(c=c.slice();e.length<g;){var h=Math.floor(Math.random()*c.length);e.push(Object.assign({},
c[h]));c.splice(h,1)}}a.BATTLE=e.slice();a.STATE()});Sa=!0;a.discord();a.target();k=0};this.ready=function(){Sa=!1;a.STATE()};this.play=function(){b.clear();a.nav(a.play);qa=!1;b.style=0};this.complete=function(){qa=!0;b.clear();a.STATE=function(){};a.nav(a.complete);var c="stage complete!";b.style=0;b.print(c,"0.5-"+2*Math.round(c.length/2),"0.3-1",2);b.style=0;N.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=function(){a.results();w.replay()}):(a.STATE=function(){a.results()},
w.REPLAY||(a.STATE=function(){},sa["export"](a.results)))},2E3);c=w.param().model+" ("+(w.param().power+1)+"/"+(w.param().drag+1)+"/"+(w.param().sensitivity+1)+"/"+(w.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:ja,time:w.AT(),penalty:w.PENALTY(),score:w.AT()+w.PENALTY(),seed:N.name,rating:Math.round(N.generate.DISTANCE/(w.AT()+w.PENALTY())),distance:N.generate.DISTANCE,vehicle:c})};this.results=function(){a.STATE=function(){a.results()};b.clear();b.style=0;qa=!0;
var c=0,g=w.CHECKPOINT[4]-1E4*w.CHECKPOINT[5];if((g<Na||!1===Na)&&(Na=g),0<a.TIMELIST.length){for(var e=0;e<a.TIMELIST.length;e++)if(g<a.TIMELIST[e].time){c=e+1;break}0==c&&(c=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+N.name,"2","2");b.style=0;g=b.time(g);b.print(g,"2","5",2);e=w.overwrite(w.CHECKPOINT,N.best,!1);0!=c?b.print("rank "+c,2*g.length+"+3".toString(),"5+4p"):e?(e=Ga?"challenge victory!":"new record!",b.style=1,b.print(e,2*g.length+"+3".toString(),"5+4p"),
b.style=0):Ga&&b.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");g=9;e=w.CHECKPOINT;if(320<l){for(var h=1;h<e.length-1;h++){b.style=5;b.print("cp "+h,"2",g+"+"+h.toString());h;var x=e[h],D=a.split(h);b.print(D,"0.5+1",g+"+"+h.toString());"number"==typeof e[h]?(b.style=0,x=b.time(e[h])):(b.style=4,x="penalty",d="");b.print(x,"0.5 -1-"+x.length.toString(),g+"+"+h.toString());b.style=0;g+=1}g+=5}1===c&&(b.style=4,b.print("new record!","2",g.toString(),2),b.style=0);b.button("issue challenge",
"0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){qa=!1;uas.replay();a.replay()})};this.checkpoint=function(c){c=void 0===c?!1:c;b.clear();b.style=0;a.nav(function(){a.checkpoint(c)});var g="";c?g+=
"missed checkpoint X "+Math.abs(w.CHECKPOINT[5]):g=this.split(w.OBJECTIVE);b.text(g,16,32);b.style=0};this.split=function(c){var g="",e=N.best[c]-w.CHECKPOINT[c],h=2,x="";return Number.isNaN(e)?void 0===w.CHECKPOINT[c]?(h=4,g+="- 100 sec"):void 0===N.best[c]&&0>N.best[5]?(h=1,g+="+ 100 sec"):void 0===N.best[c]&&(h=1,g+="new time!"):(0<e?(x="+ ",h=1):0>e?(x="- ",h=4):x="+ ",e=Math.abs(e),g+="( "+x+b.time(e)+" )"),b.style=h,g};this.battle=function(){var c=new lb(sa.save(sa.tape),w.MODEL,w.PAINT);X.push(c);
a.reset()};this.replay=function(){if(!w.IMPORT&&!va&&(a.STATE=function(){a.replay()},b.clear(),ya?a.nav(function(){a.replay()}):a.nav(a.results),!0)){uas.AUTOPILOT?a.autopilot():a.drone();var c={};for(c.$jscomp$loop$prop$e$93$172=b.style=0;4>c.$jscomp$loop$prop$e$93$172;c={$jscomp$loop$prop$e$93$172:c.$jscomp$loop$prop$e$93$172},c.$jscomp$loop$prop$e$93$172++){var g="7+"+(4*c.$jscomp$loop$prop$e$93$172).toString(),e=c.$jscomp$loop$prop$e$93$172===uas.CAM-1?48:40;b.button("",g+"-10p","1.0-4+4p","3",
"4",function(h){return function(){uas.CAM=h.$jscomp$loop$prop$e$93$172+1;a.STATE()}}(c),!1);b.sprite(e,64,8,8,g,"1.0-4",8,8)}b.style=0;c=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:ja;(uas.AUTOPILOT||uas.TARGETING)&&b.print(c,"2","1.0-7");b.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){b.style=0;b.style=0<uas.POV?4:2;b.sprite(72,
64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);ya||(b.style=2,b.print("<","2","2"),b.button("","2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){b.style=uas.TARGETING?4:2;b.sprite(64,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){b.clear();Sa=!0;Ua=Za=Ga=!1;a.PATH=!1;custom_seed="";N.name="";a.BATTLE=
[];Na=!1;window.history.pushState("","","/");za.clear();w.REPLAY=!1;w.RESET=!0;w.disconnect();for(var c=0;c<X.length;c++)X[c].disconnect();uas.reset(!0);X=[];N.SNOW&&fa.remove(N.snow.mesh);N.reset();va=qa=!1;sa.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},
!1)};this.reset=function(c){c=void 0===c?"reset":c;X.index=0;b.clear();a.nav(a.play);va=!0;qa=!1;w.reset(!1);for(var g=0;g<X.length;g++)X[g].reset();firebase.analytics().logEvent("stage_restart",{status:c})};this.hide=function(){var c=this;this.STATE=function(){c.hide()};style=1;b.clear();a.nav(R)};this.update=function(c){c=void 0===c?!1:c;qa||!va||Ma?!1!==c&&(b["delete"](16,16,f-64,16),b.text(b.time(c),16,16)):(b["delete"](16,16,f-64,16),b["delete"](16,l-32,64,16),b.text(b.time(w.AT()),16,16),b.text(w.SPEED.toString(),
16,l-32))};this.loading=function(){for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";qa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+c,16,16),b.style=0);k++};this.scanning=function(){if(0===R.TIMELIST.length&&sa.SCAN&&!qa){b["delete"](16,72,88,8);for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";b.style=5;b.text("scanning"+c,16,72)}};this.target=function(){b.clear();a.discord();a.STATE=function(){a.target()};a.nav(a.target);var c,g,e=N.name;if(Sa||(b.style=2,b.print("stage generated.",
"2","2"),sa.SCAN?b.style=2:(b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){b.clear();N.SNOW&&fa.add(N.snow.mesh);a.STATE=function(){};N.generate.END=!1;a.play();w.SPECTATE=!1;va=!0;w.connect(N.start,N.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")}),a.discord(),b.style=1,0<a.BATTLE.length&&b.button("spectate!","1.0-14","1.0-18","12","3",function(){va=!1;N.generate.END=!1;N.SNOW&&fa.add(N.snow.mesh);b.style=0;w.connect(N.start,N.surface);ya=!0;a["import"]();
b.clear();fa.add(N.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),b.style=5,b.print(e,"2","5-1p",2),b.style=0,0!==a.TIMELIST.length||!sa.SCAN)if(0!==a.TIMELIST.length){var h=a.TIMELIST.slice();for(e=0;e<h.length;e++)for(var x=0;x<h.length;x++)h[e].time<=h[x].time&&h[e].utc<h[x].utc&&e>x&&(c={},Object.assign(c,h[e]),g={},Object.assign(g,h[x]),h[e]=g,h[x]=c);b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(h[0].time),"2","12",2);b.style=5;c=(e=h.length<Aa)?h.length:
Aa;e=e?0:h.length-Aa;for(g=0;g<c;g++)b.print(g+1+". "+h[g].name,"2","16+"+2*g),b.print(b.time(h[g].time),"18","16+"+2*g);0<e&&b.print("+ "+e+" more entries","2",2*c+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.displayResults=function(c){c=a.TIMELIST;b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(c[0].time),"2","12",2);b.style=5;var g=c.length<Aa+4,e=g?c.length:Aa+4;g=g?0:c.length-Aa+4;for(var h=0;h<e;h++)b.print(h+1+". "+c[h].name,"2","16+"+2*h),b.print(b.time(c[h].time),
"18","16+"+2*h);0<g&&b.print("+ "+g+" more entries","2",2*e+"+17")};this.setBattleName=function(){for(var c=0;c<a.BATTLE.length;c++)a.BATTLE[c].name=a.TIMELIST[c].name};this["import"]=function(){a.setBattleName();for(var c={$jscomp$loop$prop$i$103$174:0};c.$jscomp$loop$prop$i$103$174<a.BATTLE.length;c={$jscomp$loop$prop$i$103$174:c.$jscomp$loop$prop$i$103$174},c.$jscomp$loop$prop$i$103$174++)w.IMPORT=!0,sa["import"](N.name+"/"+a.BATTLE[c.$jscomp$loop$prop$i$103$174].uid,function(g){return function(e){a.BATTLE[g.$jscomp$loop$prop$i$103$174].IMPORT_BUFFER=
[];w.INPUTS=[];a.BATTLE[g.$jscomp$loop$prop$i$103$174].data=[];a.BATTLE[g.$jscomp$loop$prop$i$103$174].param={power:e.param.power,drag:e.param.drag,sensitivity:e.param.sensitivity,model:e.param.model,paint:e.param.paint};a.BATTLE[g.$jscomp$loop$prop$i$103$174].cp=e.cp;for(var h=0;h<e.debug.length;h++)e.debug[h].time,e.debug[h].position,e.debug[h].normal,e.debug[h].rotation,e.debug[h].U,e.debug[h].D,e.debug[h].L,e.debug[h].R,a.BATTLE[g.$jscomp$loop$prop$i$103$174].data.push({U:e.debug[h].U,D:e.debug[h].D,
L:e.debug[h].L,R:e.debug[h].R,time:e.debug[h].time});g.$jscomp$loop$prop$i$103$174===a.BATTLE.length-1&&w["import"]()}}(c))};this.uas=function(c){b.clear();b.style=0;a.STATE=function(){a.uas()};b.backdrop();b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2","1.0","4",function(){b.backdrop(!1);a.replay()},!1);b.style=0;b.print("spectator controls","2","2");b.print("pilot mode","2","6");b.style=2;b.print("arrow            pitch/yaw/roll","2","10");b.print("shift + arrow    roll/yaw modifier",
"2","12");b.print("space            power +","2","14");b.print("shift + space    power -","2","16");b.print("ctrl:            roll/yaw toggle","2","18");b.print("r                reset","2","20");b.print("t                targeting mode toggle","2","22");b.print("shift + arrow    change target (targeting)","2","24");b.style=0};this.timelist=function(){b.style=0};this.save=function(){var c=ja+"#"+w.MODEL+"#"+w.PAINT+"#"+w.param().power+w.param().drag+ +w.param().sensitivity+"#"+Date.now();c!==r&&(r=
c,a.cSave("SAVE",r))};this.vehicle=function(c){a.STATE=function(){a.vehicle(c)};qa=!0;b.clear();a.title(function(){c();a.save()},function(){a.menu();sv()});w.REPLAY&&a.reset();var g=[],e=w.param();g.push({id:"power",value:e.power,funct:function(Z){w.tune.power(Z)}});g.push({id:"drag",value:e.drag,funct:function(Z){w.tune.drag(Z)}});g.push({id:"sensitivity",value:e.sensitivity,funct:function(Z){w.tune.sensitivity(Z)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(w.models()[w.MODEL].name,
"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){w.MODEL+=1;1<w.MODEL&&(w.MODEL=0);w.body();a.vehicle(c)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--w.MODEL;0>w.MODEL&&(w.MODEL=1);w.body();a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(ub[w.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){w.PAINT+=1;w.PAINT>Ja.length-1&&
(w.PAINT=0);w.paint();a.vehicle(c)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--w.PAINT;0>w.PAINT&&(w.PAINT=Ja.length-1);w.paint();a.vehicle(c)},!1);for(e={$jscomp$loop$prop$t$105$176:0};e.$jscomp$loop$prop$t$105$176<g.length;e={$jscomp$loop$prop$t$105$176:e.$jscomp$loop$prop$t$105$176},e.$jscomp$loop$prop$t$105$176++){var h="8+5+5+"+(5*e.$jscomp$loop$prop$t$105$176).toString();b.print(g[e.$jscomp$loop$prop$t$105$176].id,"2",h);b.sprite(0,0,1,1,"2",h+"+3","1.0-2-2",1);for(var x={$jscomp$loop$prop$e$106$178:0};6>
x.$jscomp$loop$prop$e$106$178;x={$jscomp$loop$prop$e$106$178:x.$jscomp$loop$prop$e$106$178},x.$jscomp$loop$prop$e$106$178++){var D="1.0-18+"+(3*x.$jscomp$loop$prop$e$106$178).toString(),M=x.$jscomp$loop$prop$e$106$178<=g[e.$jscomp$loop$prop$t$105$176].value?48:40;b.button("",D+"-10p",h+"+4p","3","4",function(Z,T){return function(){g[Z.$jscomp$loop$prop$t$105$176].funct(T.$jscomp$loop$prop$e$106$178);a.vehicle(c)}}(e,x),!1);b.sprite(M,64,8,8,D,h,8,8)}}};this.scan=function(c,g){};this.settings=function(c){a.STATE=
function(){a.settings(c)};a.SETTINGS=!0;B=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+(bb?1:0)+"#";a.cSave("SETTINGS",B);b.clear();z||b.backdrop();a.title(c,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(g=Oa?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(g,"1.0-2-"+g.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("",
"2","13+4p","1.0-4","5",function(){Oa=!Oa;a.settings(c)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+Fa,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",function(){2>Fa&&(Fa+=.5);b.style=0;a.settings(c);Ia()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<Fa&&(Fa-=.5);b.style=0;a.settings(c);Ia()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);
b.print("camera mode","2","23");var g=w.FPV?"fpv":"tpv";b.print(g,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){w.FPV=!w.FPV;a.settings(c)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(c,g){a.STATE=function(){a.ghostConfig(c)};var e=bb?1:0;B=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+e;a.cSave("SETTINGS",B);b.clear();z||b.backdrop();a.title(c,function(){a.settings(c)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name",
"2","8");b.print(ja,"1.0-13-"+ja.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(c)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");e=Da.toString();b.print(e,"1.0-13-"+e.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Da&&(Da+=1);a.ghostConfig(c)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Da&&--Da;a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority",
"2","18");e=0===Ea?"best":"random";b.print(e,"1.0-13-"+e.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Ea+=1;1<Ea&&(Ea=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Ea;0>Ea&&(Ea=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2","23");e=Ya?"enabled":"disabled";b.print(e,"1.0-2-"+e.length,"23");b.button("","2","23+4p","1.0-4","4",function(){Ya=!Ya;for(var h=0;h<X.length;h++)X[h].toggleEmitter(Ya);a.ghostConfig(c)},!1);b.sprite(0,
0,1,1,"2","26","1.0-4",1)};this.controls=function(c){b.clear();a.title(c,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(c){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");
b.style=0;b.print("> "+ja,"2","9");b.style=2;b.print("[edit]",ja.length+"+9","9");b.button("","2","9+4p",ja.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(N.name,"2","15");b.style=2;b.print("time","2","19");c=b.time(w.CHECKPOINT[4]-1E4*w.CHECKPOINT[5]);b.style=5;b.print(c,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();
a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(c,g,e){g=void 0===g?!1:g;e=void 0===e?"enter display name:":e;a.STATE=function(){a.inputName(c,g,e)};b.clear();qa=!0;g?a.nav(function(){c()},a.menu):a.title(c);b.print(e,"2","2");b.textinput(ja,"2","4","1.0-2","6","operator_id");var h=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ja=vb(h.value.toLowerCase());
!1===ma&&1<ja.length&&null!==ja?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,c,g);a.STATE=function(){}})["catch"](function(x){x.code;x.message}):!1!==ma&&1<ja.length&&null!==ja?a.submitName(ma,c,g):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(c,g,e)},1E3))},!0)};this.submitName=function(c,g,e){e=void 0===e?!1:e;1<ja.length&&10>ja.length?firebase.database().ref("uid/"+c).set({name:ja},function(h){h?(b.clear(),
h="PERMISSION_DENIED"===h.code?"invalid name":"network error",b.print(h,"2","2"),window.setTimeout(function(){a.inputName(g,e)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(g,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(g,e)},1E3))};this.encodeURL=function(){for(var c="",g=N.name,e=0;e<g.length;e++){var h=g.charAt(e);h=" "===h?"-":h;c+=h}c=c+"/"+ma;window.history.pushState("","","/");g=window.location.href;var x="./#/"+
c;navigator.clipboard.writeText("https://specialstage.io/#/"+c).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",x)},function(){window.history.pushState("","",x);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:g+"#/"+c})};this.decodeURL=function(){for(var c=window.location.href,g="",e=[],h=!1,x=0,D=0;D<c.length;D++){var M=c.charAt(D);h?"/"===M?(Ga=!0,x++):(1===x&&(M="-"===M?" ":M,g+=M),1<x&&(e+=M)):"#"===
M&&(h=!0,Ua=!0,x=0)}Ga&&0<e.length?(a.custom_seed=g,N.name=g,a.CHALLENGES={seed:g,uid:e}):Ua&&(a.custom_seed=g,N.name=g,Ga=!1);Ga&&firebase.analytics().logEvent("challenge_accepted",{url:c})};this.cSave=function(c,g){var e=new Date;e.setTime(e.getTime()+2808E7);e="expires="+e.toUTCString();document.cookie=c+"="+g+";"+e+";path=/"};this.cLoad=function(c){c+="=";for(var g=document.cookie.split(";"),e=0;e<g.length;e++){for(var h=g[e];" "==h.charAt(0);)h=h.substring(1);if(0==h.indexOf(c))return h.substring(c.length,
h.length)}return""};this.checksave=function(){var c=a.cLoad("SAVE");if(0!==c.length&&null!=c){for(var g=0,e="",h="",x="",D="",M=0,Z=0;Z<c.length;Z++){var T=c.charAt(Z);if("#"!==T)switch(M){case 1:g=parseInt(T);break;case 2:e+=T;break;case 3:h+=c.charAt(Z),x+=c.charAt(Z+1),D+=c.charAt(Z+2),Z+=2}else M++}w.MODEL=parseInt(g);w.PAINT=parseInt(e);w.paint();w.tune.power(parseInt(h));w.tune.drag(parseInt(x));w.tune.sensitivity(parseInt(D))}else w.PAINT=0,w.paint();if(c=a.cLoad("SETTINGS"),0!==c.length&&
null!=c){g=0;x=h=e="";for(D=0;D<c.length;D++)if(M=c.charAt(D),"#"!==M)switch(g){case 0:e+=M;break;case 1:Ea=parseInt(M);break;case 2:h=parseInt(M);break;case 3:x=parseInt(M)}else g++;Da=parseInt(e);Oa=0!==h;1===x&&(bb=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();R.nav();b.style=0;b.print("0.0.6.2","2","2");b.sprite(0,88,47,8,"2","6-4p",188,32,2);b.sprite(49,88,40,8,"2","12-4p",160,32,2);b.sprite(1,0,255,
16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();
b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("www.specialstage.io","2","0.25",2);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.specialstage.io",
"4","0.25 + 9");window.setTimeout(a.music,2E3)};this.music=function(c){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty",
"2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(c){if("n"===c.key)switch(q){case 0:b.clear();window.setTimeout(a.promo,1E3);q++;break;case 1:window.setTimeout(a.biome,
1E3);q++;w.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);q++;w.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);q++;w.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);q++;w.CAMERA=1;break;case 5:b.clear(),q=0}};this.url=function(){for(var c="";c.length<N.name.length;){var g=N.name.charAt(c.length);c+=" "===g?"-":g}return"specialstage.io/#/"+c};this.utc=function(c){c=(new Date(c)).toLocaleString("en-GB",{timeZone:"UTC"});for(var g="",e=0;e<c.length;e++)","!==c.charAt(e)&&(g+=c.charAt(e));
return g};this.stageIntro=function(){var c=this;this.STATE=function(){c.stageIntro()};b.clear();R.nav(this.STATE);var g=this.url();b.timeouts.push(window.setTimeout(function(){b.style=5;b.print(g,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event seed","2","7")},250));b.timeouts.push(window.setTimeout(function(){b.style=0;b.print(N.name,"2","10",2)},500));b.timeouts.push(window.setTimeout(function(){R.BATTLE.length;b.style="2";b.print(N.generate.BIOMES[N.generate.BIOME].name+
" biome","2","14");b.style="0"},1E3))};this.stageReplay=function(){var c=this;this.STATE=function(){c.stageReplay()};b.clear();R.nav(this.STATE);b.print(X[uas.TARGET-1].name,"2","1.0-4")};this.stageResults=function(){jb=!0;this.STATE=function(){a.stageResults()};b.clear();R.nav(this.STATE);var c=a.url();b.timeouts.push(window.setTimeout(function(){b.style="5";b.print(c,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event result","2","6")},500));b.timeouts.push(window.setTimeout(function(){b.style=
0;b.print(R.BATTLE[0].name,"2","9",2)},750));b.timeouts.push(window.setTimeout(function(){b.style=1;b.print("stage rank 1","2+"+2*R.BATTLE[0].name.length+"+1","9+4p")},1E3));b.timeouts.push(window.setTimeout(function(){b.style=0;b.sprite(0,0,1,1,"2","13","1.0-4",1)},1250));var g=a.TIMELIST;b.style=5;var e=g.length<Aa+4,h=e?g.length:Aa+4;e||(g.length,Aa);for(e={$jscomp$loop$prop$i$128$180:0};e.$jscomp$loop$prop$i$128$180<h;e={$jscomp$loop$prop$i$128$180:e.$jscomp$loop$prop$i$128$180},e.$jscomp$loop$prop$i$128$180++)b.timeouts.push(window.setTimeout(function(x){return function(){var D=
"16+"+3*x.$jscomp$loop$prop$i$128$180;b.print(x.$jscomp$loop$prop$i$128$180+1+". "+g[x.$jscomp$loop$prop$i$128$180].name,"2",D);var M=b.time(g[x.$jscomp$loop$prop$i$128$180].time);b.print(M,"1.0-2-"+M.length,D)}}(e),1500+250*e.$jscomp$loop$prop$i$128$180))};this.stageEntries=function(){var c=this;kb=!0;this.STATE=function(){a.stageEntries()};b.clear();a.nav(this.STATE);b.style="5";b.print(this.url(),"2","2");b.style="5";for(var g=[],e=0;e<X.length;e++)X[e].hide();for(e=0;e<a.BATTLE.length;e++){var h;
!(0<g.length)||a.BATTLE[e].utc>g[e-1].utc?g.push({name:a.BATTLE[e].name,utc:a.BATTLE[e].utc}):(h={name:g[e-1].name,utc:g[e-1].utc},g[e-1]={name:a.BATTLE[e].name,utc:a.BATTLE[e].utc},g.push(h))}var x=1<R.BATTLE.length?" entries":" entry";x=R.BATTLE.length+x;b.timeouts.push(window.setTimeout(function(){b.style="0";b.print(N.name,"2","6");b.print(x,"1.0-2-"+x.length,"6")},1E3));b.timeouts.push(window.setTimeout(function(){b.sprite(0,0,1,1,"2","10","1.0-4",1)},1500));b.style=5;h=g.length<Aa+4;h?g.length:
Aa;h||(g.length,Aa);w.reset(!0);for(h={$jscomp$loop$prop$e$131$183:0};h.$jscomp$loop$prop$e$131$183<g.length;h={$jscomp$loop$prop$e$131$183:h.$jscomp$loop$prop$e$131$183},h.$jscomp$loop$prop$e$131$183++)b.timeouts.push(window.setTimeout(function(D){return function(){b.style="5";b.print(g[D.$jscomp$loop$prop$e$131$183].name,"2","12+"+3*D.$jscomp$loop$prop$e$131$183);X[D.$jscomp$loop$prop$e$131$183].show();0<D.$jscomp$loop$prop$e$131$183&&X[D.$jscomp$loop$prop$e$131$183-1].hide();b.style="2";b.print(R.utc(g[D.$jscomp$loop$prop$e$131$183].utc),
"1.0-21","12+"+3*D.$jscomp$loop$prop$e$131$183)}}(h),2E3+500*h.$jscomp$loop$prop$e$131$183)),h.$jscomp$loop$prop$e$131$183===R.BATTLE.length-1&&(b.timeouts.push(window.setTimeout(function(D){return function(){X[D.$jscomp$loop$prop$e$131$183].hide()}}(h),500*h.$jscomp$loop$prop$e$131$183+2500)),b.timeouts.push(window.setTimeout(function(){for(var D=0;D<X.length;D++)X[D].show();c.stageReplay();uas.CAM=1},500*h.$jscomp$loop$prop$e$131$183+3E3)))};this.mixplug=function(){b.clear();b.format(6,"#555");
b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#7b1df5");ca.updateProjectionMatrix();b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.style=7;b.style=6;window.setTimeout(function(){b.style=6;b.print("mix","2","1.0-6")},2E3);for(var c={$jscomp$loop$prop$e$133$185:0};15>c.$jscomp$loop$prop$e$133$185;c={$jscomp$loop$prop$e$133$185:c.$jscomp$loop$prop$e$133$185},c.$jscomp$loop$prop$e$133$185++)window.setTimeout(function(g){return function(){b.style=0;b.print("specialstage.io".charAt(g.$jscomp$loop$prop$e$133$185),
"2+"+g.$jscomp$loop$prop$e$133$185,"2")}}(c),100*c.$jscomp$loop$prop$e$133$185);window.setTimeout(function(){b.sprite(0,88,88,8,"2","4",88,8)},1800);b.style=7;b.style=7;window.setTimeout(function(){b.style=7;b.print("low recordings","2","1.0-4")},2E3);b.style=6;window.setTimeout(function(){b.style=6;b.print("(lo-fi house)","1.0-15","1.0-4")},2200);b.style=7;c=document.createElement("img");c.style.zIndex=98;c.style.position="fixed";c.style.top=0;c.style.left=0;c.src="./img/low_promo_4x.gif";c.style.setProperty("mix-blend-mode",
"lighten");document.body.appendChild(c)};this.tracklist=function(){b.clear();b.format(6,"#555");b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#DA4DFA");b.format(10,"#101010");b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.style=3;b.style=4;b.style=1;b.style=0;b.print("specialstage.io","2","2");b.style=9;b.print("X low recordings feature mix","2","4");b.style=5;window.setTimeout(function(){b.style=6;b.print("featuring music by:","2","8")},600);var c=[];b.style=0;c.push(function(){b.print("> evade robots",
"2","12")});c.push(function(){b.print("> eli cash","2","14")});c.push(function(){b.print("> shaman","2","16")});c.push(function(){b.print("> heartwerk","2","18")});c.push(function(){b.print("> blo","2","20")});c.push(function(){b.print("> urbanite","2","22")});c.push(function(){b.print("> rick wade","2","24")});c.push(function(){b.print("> orthographic figure","2","26")});c.push(function(){b.print("> hyas","2","28")});c.push(function(){b.print("> albin & noris","2","30")});b.style=7;for(var g={$jscomp$loop$prop$e$134$187:0};g.$jscomp$loop$prop$e$134$187<
c.length;g={$jscomp$loop$prop$e$134$187:g.$jscomp$loop$prop$e$134$187},g.$jscomp$loop$prop$e$134$187++)window.setTimeout(function(e){return function(){b.style=0;c[e.$jscomp$loop$prop$e$134$187]()}}(g),250*g.$jscomp$loop$prop$e$134$187+1E3)}}function wb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],f=0,l=!1,k=this.up.clone(),q=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,
direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,1,0),value:0},yaw:{axis:new THREE.Vector3(0,0,1),value:0},pov:0,target:0,targeting:!1,autopilot:!0}},u=[],r=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},
speed:0}},B=this.AUTOPILOT=!0,z=this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var c=this.CAM=1,g=this.POV=0;this.camera=[];this.camera[0]=q();this.camera[0].distance=22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=q();this.camera[1].distance=24.5;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=.5708;this.camera[1].pitch.value=.485;this.camera[1].lerp=.1;this.camera[2]=q();this.camera[2].distance=34;this.camera[2].position.set(0,
1,0);this.camera[2].yaw.value=3.512;this.camera[2].pitch.value=.79;this.camera[2].lerp=.1;this.camera[3]=q();this.camera[3].distance=34;this.camera[3].position.set(0,1,0);this.camera[3].yaw.value=5.7916;this.camera[3].pitch.value=.5236;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=q();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].yaw.value=Math.PI;this.camera[4].pitch.value=1.32;this.camera[4].lerp=.075;u[0]=r();u[1]=r();u[2]=r();u[3]=r();u[4]=r();this.reset=
function(e){if(void 0===e?0:e)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],ca.up.copy(k),e=0;e<this.camera.length;e++)this.camera[e].target=0;1<a.length?a[f].time=0:(f=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:7E-4,drag:.98,
limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var e=0;e<this.camera.length;e++)this.camera[e].target=0,this.camera[e].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var e=0;e<this.camera.length;e++)this.camera[e].target=1,this.camera[e].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(e,h,x){e=void 0===e?new THREE.Vector3:
e;h=void 0===h?new THREE.Vector3:h;x=void 0===x?new THREE.Vector3:x;var D=Ma||w.END?1E-5:.1;this.up.set(0,0,1);h=h.clone();h.multiplyScalar(-this.camera[0].distance+4*(b.scale-1));h.add(e);h.z+=this.camera[0].position.z;a[f].position.lerp(h,D);a[f].lookAt.copy(x);a[f].up.set(0,0,1)};this.fpv=function(e,h,x,D){e=void 0===e?new THREE.Vector3:e;h=void 0===h?new THREE.Vector3:h;void 0===x&&new THREE.Vector3;D=void 0===D?new THREE.Vector3:D;a[f].position.copy(e);h=h.clone();h.add(e);a[f].lookAt.copy(h);
D=D.clone();a[f].up.copy(D)};this.orbit=function(e,h,x){e=void 0===e?new THREE.Vector3:e;void 0===h&&new THREE.Vector3;x=void 0===x?new THREE.Vector3:x;G.SPACE;G.SHIFT;h=G.UP;var D=G.DOWN,M=G.LEFT,Z=G.RIGHT,T=G.ZOOM_IN,t=G.ZOOM_OUT;e=e.clone();a[f].yaw=a[f-1].yaw;var A=this.camera[c].position.clone();this.camera[c].distance+=T&&0<this.camera[c].distance?-.5:t&&100>this.camera[c].distance?.5:0;A.multiplyScalar(this.camera[c].distance);this.camera[c].yaw.value+=M?-.05:Z?.05:0;this.camera[c].pitch.value+=
h?.05:D?-.05:0;this.camera[c].pitch.value=0>this.camera[c].pitch.value?0:this.camera[c].pitch.value>Math.PI/2-.1?Math.PI/2-.1:this.camera[c].pitch.value;T=this.camera[c].pitch.axis.clone();T.applyAxisAngle(k,this.camera[c].yaw.value);A.applyAxisAngle(k,this.camera[c].yaw.value);A.applyAxisAngle(T,this.camera[c].pitch.value);e.add(A);D=l?1:M||Z||h||D?.1:this.camera[c].lerp;a[f].position.lerp(e,D);a[f].lookAt.copy(x);a[f].up.set(0,0,1)};this.physics=function(e,h,x){if((void 0===e?0:e)>a[f].time){var D=
h.position.clone(),M=h.direction.clone();e=h.lookAt.clone();h=h.normal.clone();x=((void 0!==x?x:D).clone(),{});Object.assign(x,a[f]);a=[];f=0;a.push(x);x={};Object.assign(x,a[f]);a.push(x);f++;w.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(D,M,e):2===this.POV?this.fpv(D,M,e,h):this.orbit(D,M,e):this.pilot():w.FPV?this.fpv(D,M,e,h):this.pov(D,M,D);a[f].time+=Ka}};this.target=function(e){this.lookAt.copy(this.TARGETS[e].position)};this.update=function(e,h){e=void 0===e?0:e;h=void 0===h?this.TARGETS:
h;this.CAM!==c?(l=!0,c=this.CAM,this.TARGET=this.camera[c].target,this.TARGETING=this.camera[c].targeting,this.AUTOPILOT=this.camera[c].autopilot,this.POV=this.camera[c].pov,B=this.AUTOPILOT,B?(a[f].position.copy(this.camera[c].position),a[f].position.add(h[this.TARGET].position),a[f].up.copy(this.camera[c].up),l=!0):(a[f].position.copy(u[c].position),a[f].lookAt.copy(u[c].lookAt),a[f].up.copy(u[c].up),a[f].velocity.copy(u[c].velocity),a[f].pitch.axis.copy(u[c].pitch.axis),a[f].roll.axis.copy(u[c].roll.axis),
a[f].yaw.axis.copy(u[c].yaw.axis),a[f].pitch.value=u[c].pitch.value,a[f].roll.value=u[c].roll.value,a[f].yaw.value=u[c].yaw.value,a[f].speed=u[c].speed),R.STATE()):(this.camera[c].target=this.TARGET,this.camera[c].pov=this.POV,this.camera[c].targeting=this.TARGETING,this.camera[c].autopilot=this.AUTOPILOT);this.AUTOPILOT!==B&&(B=this.AUTOPILOT,this.AUTOPILOT?(a[f].position.copy(this.camera[c].position),a[f].up.copy(this.camera[c].up)):a[f].speed=0);this.POV!==g&&(R.STATE(),g=this.POV,uas.camera[uas.CAM].pov=
g);this.TARGET!==z&&(z=this.TARGET,uas.camera[uas.CAM].target=z);this.physics(e,h[va?0:this.camera[c].target]);Ka;a[f].time;Ka;1<a.length&&(this.position.copy(a[f].position),this.direction.copy(a[f].direction),this.up.copy(a[f].up),this.lookAt.copy(a[f].lookAt),ca.position.copy(this.position),ca.up.set(this.up.x,this.up.y,this.up.z),ca.lookAt(this.lookAt));l=!1};this.pilot=function(){var e=a[f],h=G.SPACE,x=G.SHIFT,D=G.UP,M=G.DOWN,Z=G.LEFT,T=G.RIGHT;G.TARGET&&(this.TARGETING=!this.TARGETING,G.TARGET=
!1,R.replay());e.pitch.value+=D?-e.pitch.power:M?+e.pitch.power:0;x&&!this.TARGETING?e.roll.value+=Z?-e.roll.power:T?e.roll.power:0:(e.yaw.value+=Z?e.yaw.power:T?-e.yaw.power:0,e.yaw.value*=e.yaw.drag);e.pitch.value*=e.pitch.drag;e.roll.value*=e.roll.drag;e.yaw.value*=e.yaw.drag;e.pitch.axis.applyAxisAngle(e.roll.axis,e.roll.value);e.pitch.axis.applyAxisAngle(e.yaw.axis,e.yaw.value);e.roll.axis.applyAxisAngle(e.pitch.axis,e.pitch.value);e.roll.axis.applyAxisAngle(e.yaw.axis,e.yaw.value);e.yaw.axis.applyAxisAngle(e.pitch.axis,
e.pitch.value);e.yaw.axis.applyAxisAngle(e.roll.axis,e.roll.value);x&&h&&-1<e.speed?e.speed-=.0025:h&&1>e.speed&&(e.speed+=.0025);e.velocity.copy(e.roll.axis);e.velocity.multiplyScalar(e.speed);e.position.add(e.velocity);this.TARGETING?(Z&&x&&0<this.TARGET&&(--this.TARGET,R.replay(),G.LEFT=!1),T&&x&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,R.replay(),G.RIGHT=!1),this.up.set(0,0,1),l?e.lookAt.copy(this.TARGETS[this.TARGET].position):e.lookAt.lerp(this.TARGETS[this.TARGET].position,.05)):
(e.up.copy(e.yaw.axis),e.lookAt.copy(e.roll.axis),e.lookAt.add(e.position));u[c].position.copy(e.position);u[c].lookAt.copy(e.lookAt);u[c].velocity.copy(e.velocity);u[c].up.copy(e.up);u[c].pitch.axis.copy(e.pitch.axis);u[c].roll.axis.copy(e.roll.axis);u[c].yaw.axis.copy(e.yaw.axis);u[c].pitch.value=e.pitch.value;u[c].roll.value=e.roll.value;u[c].yaw.value=e.yaw.value;u[c].speed=e.speed};this.autocam=function(){};this.debug=function(){console.log("Vehicle Timestamp:",w.TIMESTAMP);console.log("Physics:",
a);console.log("lookAt:",this.lookAt)}}function xb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var f=this.renderer.getContext("2d");this.context=f;var l=document.createElement("img");l.src="./img/stage.font.0.0.6.png";l.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var k=document.createElement("canvas"),q=k.getContext("2d");this.scale=1;this.row=this.col=8;this.width;
this.height;this.style=0;var u=128,r=180,B=128,z=80,c;var g=128;var e=r;var h=128;var x=80;var D=!(c={x:128,y:r+60,w:128,h:40}),M=[],Z=[],T=[];this.timeouts=[];this.connect=function(){f.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(t,A){t=void 0===t?0:t;A=void 0===A?"#ffffff":A;void 0===k[t]&&(k[t]=document.createElement("canvas"),q[t]=k[t].getContext("2d"));q[t].drawImage(l,0,0,128,128,0,0,128,128);q[t].globalCompositeOperation="source-atop";q[t].fillStyle=A;q[t].fillRect(0,
0,128,128);q[t].globalCompositeOperation="source-out"};this.resize=function(t,A,I,J){J=void 0===J?1:J;a.scale=I*J;var O=window.devicePixelRatio,ia=300>Math.ceil(O)/O*t?Math.floor(O):Math.ceil(O);0!=ia-O&&(I=ia/O*J);1>=O&&1<a.scale&&(I=a.scale);this.width=t/I;this.height=A/I;this.renderer.width=this.width;this.renderer.height=this.height;za.setSize(this.width,this.height);a.scale=I;this.renderer.style.transform="scale("+I+","+I+")";za.domElement.style.transform="scale("+I+","+I+")";this.renderer.style.transformOrigin=
"top left";za.domElement.style.transformOrigin="top left";f.imageSmoothingEnabled=!1;this.redraw();u=128;r=180;B=128;z=80;g=128;e=r;h=128;x=80;c={x:128,y:r+60,w:128,h:40};this.automate(this.width,this.height)};this.update=function(t){var A=0,I;for(I in t)for(var J in T)if(t[I].x>T[J].x*a.scale&&t[I].y>T[J].y*a.scale&&t[I].x<T[J].w*a.scale&&t[I].y<T[J].h*a.scale&&(A++,1==t[I].start)){T[J].funct();t[I].start=!1;break}};this.print=function(t,A,I,J){J=void 0===J?1:J;for(var O=0,ia=a.compile(A,a.width,
a.col),U=a.compile(I,a.height,a.row),S=a.style;O<t.length;)a.encode(t.charAt(O),ia+O*a.col*J,U,J),O++;D||M.push(function(){a.style=S;a.print(t,A,I,J)})};this.text=function(t,A,I,J,O){J=void 0===J?1:J;for(O=0;O<t.length;)a.encode(t.charAt(O),A+O*a.col*J,I,J),O++};this.button=function(t,A,I,J,O,ia,U,S){U=void 0===U?!0:U;S=void 0===S?1:S;var aa=a.compile(A,a.width,a.col),la=a.compile(I,a.height,a.row),ka=a.compile(J,a.width,a.col),oa=a.compile(O,a.height,a.row),da=a.style;U&&(f.drawImage(k[a.style],
0,0,1,1,aa,la+oa/2,ka+1,1),f.drawImage(k[a.style],0,0,1,1,aa,la-oa/2,ka+1,1),f.drawImage(k[a.style],0,0,1,1,aa,la-oa/2,1,oa),f.drawImage(k[a.style],0,0,1,1,aa+ka-1,la-oa/2,1,oa+1));for(var ea=0;ea<t.length;)a.encode(t.charAt(ea),aa+ea*a.col+ka/2-Math.round(t.length*a.col)/2+2,la-a.row/2,S),ea++;T.push({x:aa,y:la-oa/2,w:aa+ka,h:la+oa/2,funct:function(){ia()}});D||M.push(function(){a.style=da;a.button(t,A,I,J,O,ia,U,S)})};this.line=function(t,A,I,J){a.sprite(0,0,1,1,t,A,I,J)};this.sprite=function(t,
A,I,J,O,ia,U,S){var aa=a.compile(O,a.width,a.col),la=a.compile(ia,a.height,a.row),ka=a.compile(U,a.width,a.col),oa=a.compile(S,a.height,a.row),da=a.style;f.drawImage(k[a.style],t,A,I,J,aa,la,ka,oa);D||M.push(function(){a.style=da;a.sprite(t,A,I,J,O,ia,U,S)})};this.backdrop=function(t,A,I,J,O){t=void 0===t?"#10101099":t;!1===t?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=t)};this.getDrawList=function(){return M};this.redraw=function(){D=!0;a.clear();
for(var t=0;t<M.length;t++)M[t]();t=document.body.getElementsByTagName("input");for(var A=0;A<t.length;A++)a.text(t[A].value,t[A].style.top,t[A].style.left);D=!1};this.automate=function(t,A){t=Math.floor(t/3)-2;A=Math.floor(A/4);B>t&&(B=t,u=t,h=t,g=t,c.w=t,c.x=t);r>A&&(r=A+40,e=r,c.y=r+60)};this.pad=function(t,A,I,J,O,ia,U){var S=0;for(U();S<G.touches.length;)G.touches[S].x>A*a.scale&&G.touches[S].y>I*a.scale&&G.touches[S].x<(A+J)*a.scale&&G.touches[S].y<(I+O)*a.scale&&ia(),S++;Oa&&(f.drawImage(k[a.style],
0,0,1,1,A+1,I,J-1,1),f.drawImage(k[a.style],0,0,1,1,A+1,I+O,J-1,1),f.drawImage(k[a.style],0,0,1,1,A+1,I,1,O),f.drawImage(k[a.style],0,0,1,1,A+J-1,I,1,O));a.encode(t,A+J/2-a.col/2,I+O/2-a.row/2)};this.dpad=function(){f.drawImage(k[a.style],88,88,40,40,a.width-g+h/2-20,a.height-e+x/2-20,40,40);a.pad("<",u-B-1,a.height-r,B,z,function(){G.LEFT=!0},function(){G.LEFT=!1});a.pad(">",u+1,a.height-r,B,z,function(){G.RIGHT=!0},function(){G.RIGHT=!1});a.pad("^",a.width-g,a.height-e,h,x,function(){G.UP=!0},function(){G.UP=
!1});a.pad("b",a.width-c.x,a.height-c.y+c.h/2,c.w,c.h,function(){G.DOWN=!0},function(){G.DOWN=!1})};this.clear=function(){if(!D){for(var t=document.body.getElementsByTagName("input"),A=0;A<t.length;A++)document.body.removeChild(t[A]);if(!a.REDRAW){M=[];for(t=0;t<Z.length;t++)document.body.removeChild(Z[t]);Z=[]}M=[];for(t=0;t<this.timeouts.length;t++)window.clearTimeout(this.timeouts[t])}T=[];f.clearRect(0,0,a.width,a.height)};this["delete"]=function(t,A,I,J){A=void 0===A?0:A;I=void 0===I?za.width:
I;J=void 0===J?za.height:J;t=a.compile(void 0===t?0:t,a.width,a.col);A=a.compile(A,a.height,a.row);I=a.compile(I,a.width,a.col);J=a.compile(J,a.height,a.row);f.clearRect(t,A,I,J)};this.encode=function(t,A,I,J){J=void 0===J?1:J;var O=t.charCodeAt(0);t=8*O%128;O=8*Math.floor(O/16);f.clearRect(A,I,8,8);f.drawImage(k[a.style],t,O,8,8,A,I,8*J,8*J)};this["float"]=function(t,A){var I=Math.floor(Math.abs(100*t));I=I.toString();var J=I.slice(0,I.length-2),O=I.slice(I.length-2,I.length);return 0==t?"0.00":
(0==J.length&&(J="0"),2>O.length&&(O+="0"),A&&0<t?J="+"+J:0>t&&(J="-"+J),I=J+"."+O,I)};this.compile=function(t,A,I){var J=0;switch(A=Math.floor(A),typeof t){case "number":J=t;break;case "function":J=t();break;case "string":for(var O=!1,ia=1,U=0,S="";U<t.length;){var aa=t.charAt(U);"."===aa?(S+=aa,O=!0):"+"===aa?(S=O?Number(S)*A:Number(S)*I,S*=ia,ia=1,J+=S,O=!1,S=""):"-"===aa?(S=O?Number(S)*A:Number(S)*I,S*=ia,ia=-1,J+=S,O=!1,S=""):"p"===aa?(S=Number(S),S*=ia,J+=S,S=""):U===t.length-1?(S+=aa,S=O?Number(S)*
A:Number(S)*I,S*=ia,J+=S,S=""):S+=aa;U++}}return J};this.textinput=function(t,A,I,J,O,ia,U){var S=a.compile(A,a.width,a.col),aa=a.compile(I,a.height,a.row),la=a.compile(J,a.width,a.col),ka=a.compile(O,a.height,a.row),oa=a.style;if(D)a.text("> "+U.value,S,aa+ka/2);else{(U=document.createElement("input")).type="text";U.id=ia;U.name=ia;U.value=t;U.style.position="fixed";U.style.top=aa+"px";U.style.left=S+"px";U.style.width=la+"px";U.style.height=ka+"px";U.style.paddingLeft="12px";U.style.fontSize="14px";
U.style.zIndex=9999;U.style.opacity=0;U.maxlength=10;a.text("> "+U.value,S,aa+ka/2);document.body.appendChild(U);window.setTimeout(function(){U.focus();U.select()},200);U.oninput=function(){da()};U.onfocusout=function(){da()};U.onfocusin=function(){da()};U.onclick=function(){da()};var da=function(ea){a["delete"](S,aa,la,ka);a.text("> "+U.value,S,aa+ka/2);a.text("_",U.selectionStart*a.col+2*a.col+S,aa+ka/2)};M.push(function(){a.style=oa;a.textinput(U.value,A,I,J,O,ia,U)})}};this.link=function(t,A,
I,J,O,ia,U,S){var aa=a.compile(A,a.width,a.col)*a.scale,la=a.compile(I,a.height,a.row)*a.scale,ka=a.compile(J,a.width,a.col)*a.scale,oa=a.compile(O,a.height,a.row)*a.scale,da=a.style;D||M.push(function(){return new function(){a.style=da;ea.style.left=aa+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";a.print(t,aa,la)}});var ea=document.createElement("a");ea.href=ia;ea.style.left=aa+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";ea.style.display="block";
ea.style.zIndex=999;ea.style.position="fixed";ea.target="_blank";ea.id=ia;document.body.appendChild(ea);Z.push(ea);D=!0;a.print(t,aa,la);D=!1};this.time=function(t){return(t/100).toFixed(2)};this.typewrite=function(t){a.clear();for(var A={$jscomp$loop$prop$e$147$189:0};A.$jscomp$loop$prop$e$147$189<t.length;A={$jscomp$loop$prop$e$147$189:A.$jscomp$loop$prop$e$147$189},A.$jscomp$loop$prop$e$147$189++){var I=(A.$jscomp$loop$prop$e$147$189,0);I=Math.floor(A.$jscomp$loop$prop$e$147$189%32);var J=Math.floor(A.$jscomp$loop$prop$e$147$189/
32);I=32+I%32*8;J=32+16*J;window.setTimeout(function(O){return function(){b.text(t.charAt(O.$jscomp$loop$prop$e$147$189),I,J)}}(A),50*A.$jscomp$loop$prop$e$147$189)}}}function yb(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return x};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=
new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var f=[],l=0;this.TIMESTEP=Ka;var k=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var q=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),
u=!1,r=!1,B=!1,z=!1,c=!0,g=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var e=0,h=0,x=0,D=0,M=!1,Z=!1,T=0,t=0;this.DT=function(){return 1};var A={power:2,drag:0,mass:1,brake:2,sensitivity:2,ease:0},I=0,J=0,O=0;I=.004;J=.985-.98;O=.08-.06;var ia,U,S,aa=6,la,ka=0,oa=0,da=0,ea=new THREE.Vector3(0,1,0),Pa=new THREE.Vector3(0,0,0),Qa=new THREE.Vector3,p=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var n=new THREE.Vector3(0,0,1),m=new THREE.Vector3(0,0,1),E=new THREE.Vector3(0,0,
1),C=new THREE.Vector3(0,0,1),y=new THREE.Vector3(0,0,-.008),Q=new THREE.Vector3,F=new THREE.Vector3,L=new THREE.Vector3,K=new THREE.Vector3;this.position=Q.clone();this.direction=ea.clone();this.lookAt=Q.clone();this.normal=m.clone();this.rotation=0;var P=[],V=new THREE.Vector3(0,0,1),W=new THREE.Raycaster(K,V,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]=
{distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var ta=[{name:"logistics crate",geometry:function(){return Ta.logistics_crate()}},{name:"ag-86",geometry:function(){return Ta.ag_86()}}];this.models=function(){return ta};this.PAINT=0;var Ca=new THREE.MeshBasicMaterial({color:Ja[a.PAINT]}),pa=(new THREE.LineSegments(ta[a.MODEL].geometry(),
Ca)).clone();pa.name="Vehicle";var Xa=new Ta.emitter;this.connect=function(H,Y){pa.copy(new THREE.LineSegments(ta[a.MODEL].geometry(),Ca));pa.name="Vehicle";pa.geometry.computeBoundingSphere();L.copy(H);L.z+=2;pa.position.copy(L);fa.add(pa);Xa.connect(Ja[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();fa.fog=new THREE.FogExp2(ba[0],.005);ca.fov=90;ca.updateProjectionMatrix();fa.add(N.generate.stars);a.START_POSITION.copy(L);a.START_NORMAL.copy(m);a.START_DIRECTION.copy(ea);
a.START_VELOCITY.copy(Qa);uas.TARGETS.length<X.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);fa.remove(pa);Xa.disconnect();fa.fog=new THREE.FogExp2(ba[0],0);fa.remove(N.generate.stars);this.DISCONNECT=!1};this.ready=function(H){H=void 0===H?window.performance.now():H;var Y;!u&&!this.REPLAY||this.RESET||(N.generate.checkpoints[0].display.material.color=ba[4],uas.reset(),t=1,M=!1,Z=
!1,c=!0,na.reset(),D=H,e=0,l=0,this.FRAME=0,f[l].time=0,f=[],f.length=0,l=0,f.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],Y={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),lookAt:C.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(Y),
a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,Y={},Object.assign(Y,f[l]),a.PHYSICSBUFFER.push(Y),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(H){H=void 0===H?!1:H;a.REPLAY=H;a.RESET=!0;va=!H;pa.visible=!0;ya&&(pa.visible=!1);this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;g=Ma=this.END=this.START=!1;G.UP=!1;G.DOWN=!1;G.LEFT=!1;z=B=r=u=G.RIGHT=!1;t=x=T=0;Q.copy(a.START_POSITION);F.copy(Q);ea.copy(a.START_DIRECTION);Qa.copy(a.START_VELOCITY);m.copy(a.START_NORMAL);
K.copy(Q);this.position=Q.clone();this.direction=ea.clone();this.lookAt=Q.clone();this.normal=m.clone();la=da=ka=oa=this.rotation=0;a.SPEED=0;V.copy(a.START_NORMAL);V.normalize();W.far=V.length();W.set(a.START_POSITION,V);E.copy(a.START_NORMAL);C.copy(a.START_NORMAL);C.add(a.START_POSITION);ca.updateProjectionMatrix();g=!0;Xa.reset();na.reset();uas.reset();f=[];D=l=0;this.IMPORT||(D=window.performance.now());for(H=0;H<N.generate.checkpoints.length;H++)N.generate.checkpoints[H].display.material.color=
ba[5];if(f[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY)for(this.DEBUG_BUFFER=[],e=0,this.IMPORT||(a.best=a.overwrite(a.CHECKPOINT,a.best)),N.best=a.overwrite(a.CHECKPOINT,N.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,a.inputs=[],a.inputs.push({key:0,time:0}),a.PHYSICSBUFFER=[],H={},Object.assign(H,f[l]),a.PHYSICSBUFFER.push(H),H=0;H<
X.length;H++)X[H].reset();this.VALIDATE_CHECKPOINT=[];this.VALIDATE_CHECKPOINT.length=6;q.position.copy(a.START_POSITION);q.lookAt(C);pa.lookAt(C);q.rotateOnAxis(n,0);Z=M=!1;c=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(H){H=void 0===H?window.performance.now():H;Ma||a.END||!g||a.REPLAY||a.RESET?(u=!1,r=!1,B=!1,z=!1):(u=G.UP,r=G.DOWN,B=G.LEFT,z=G.RIGHT,B&&z&&(B=!1,z=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?H+99999-D:H-D;H=0;if(this.TIMESTAMP>f[l].time){var Y={};Object.assign(Y,
f[l]);var ha=Y.time;f=[];l=0;for(f.push({time:ha,position:Y.position.clone(),normal:Y.normal.clone(),direction:Y.direction.clone(),velocity:Y.velocity.clone(),rotation:Y.rotation,step:Y.step,U:Y.U,D:Y.D,L:Y.L,R:Y.R});ha<this.TIMESTAMP;){var ra;ha+=Ka;this.REPLAY&&this.START&&(H=this.tapeReplay(ha));f.push({time:ha,position:f[l].position.clone(),normal:f[l].normal.clone(),direction:f[l].direction.clone(),velocity:f[l].velocity.clone(),rotation:f[l].rotation,step:f[l].step,U:u,D:r,L:B,R:z});l=f.length-
1;a.START&&(Ha=wa=void 0,Ha=B&&z?0:B?1:z?-1:0,da=f[l].step,0!=Ha&&Math.abs(da)<aa?da+=Ha:Math.abs(da)>aa?(wa=da/Math.abs(da),da=aa*wa):0<Math.abs(da)&&(wa=da/Math.abs(da),da-=da/Math.abs(da),da/Math.abs(da)!=wa&&(da=0)),ka=da/aa*S,f[l].rotation+=ka,f[l].step=da,la=f[l].velocity.length(),wa=void 0,u&&c&&(Pa.copy(f[l].direction),Pa.multiplyScalar(ia),f[l].velocity.add(Pa)),r&&c&&f[l].velocity.multiplyScalar(.95),c?(Z=!1,wa=M?U-.01:U,f[l].velocity.multiplyScalar(wa)):c||(Z?f[l].velocity.add(y):Z=!0,
f[l].velocity.multiplyScalar(.998)),f[l].position.add(f[l].velocity),q.position.copy(f[l].position),function(){P=[];K.copy(f[l].position);K.z-=50;V.set(0,0,1);W.far=100;W.set(K,V);N.surface.raycast(W,P);0<P.length?(K.copy(P[0].point),M=f[l].position.z<K.z&&5>Math.abs(f[l].position.z-K.z)?(h=0,c=!0,m.copy(P[0].face.normal),f[l].position.copy(K),1!==P[0].face.color.r):c=!1):0===P.length&&(c=!1,M=!1,u||r||B||z||a.REPLAY||(h+=Ka),1E3<h&&!a.END&&!Ma&&(Ma=!0,R.dnf()));var ua=Z?.001:.25;E.copy(f[l].normal);
E.lerp(m,ua);ua=E.clone();ua.add(f[l].position);f[l].normal=E.clone();q.lookAt(ua);q.rotateOnAxis(n,f[l].rotation);ea.copy(q.localToWorld(p.clone()));ea.sub(f[l].position);ea.normalize();f[l].direction.copy(ea)}(),function(){P=[];V.copy(f[l].position);V.sub(f[l-1].position);V.normalize();W.far=V.length();W.set(f[l].position,V);for(var ua=0,xa=!1,Ba=t;5>Ba;Ba++)if(N.generate.checkpoints[Ba].collision.raycast(W,P),0<P.length){ua=Ba;xa=!0;break}if(xa){Ba=f[l].position;xa=P[0].point;var La=f[l-1].position.distanceTo(xa);
xa=Ba.distanceTo(xa);xa=f[l-1].time+La/(La+xa)*a.TIMESTEP;N.generate.checkpoints[ua].display.material.color=ba[4];a.CHECKPOINT[ua]=Math.floor(xa/10);xa=t!==ua;a.CHECKPOINT[5]=0;for(Ba=1;Ba<ua;Ba++)void 0===a.CHECKPOINT[Ba]&&--a.CHECKPOINT[5];t=ua+1;4<=ua&&!a.REPLAY?(a.END=!0,a.REPLAY||R.complete()):a.REPLAY||a.IMPORT||R.checkpoint(xa)}a.SPEED=Math.round(60*la/1E3*3600);a.START&&!a.END&&(e=Math.floor(f[l].time/10));a.OBJECTIVE=t;F.copy(Q)}());this.FRAME++;this.START&&!this.REPLAY?(ra={},Object.assign(ra,
f[l]),this.PHYSICSBUFFER.push(ra)):this.REPLAY&&H<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(ra={time:f[l].time,position:f[l].position.clone(),direction:f[l].direction.clone(),normal:f[l].normal.clone(),velocity:f[l].velocity.clone(),rotation:f[l].rotation,U:f[l].U,D:f[l].D,L:f[l].L,R:f[l].R,step:f[l].step,lookAt:C.clone()},a.DEBUG_BUFFER.push(ra));!this.IMPORT&&5E3<this.TIMESTAMP-ha&&w.reset(this.REPLAY)}}var wa,Ha;if(k=(Ka-(f[l].time-this.TIMESTAMP))/Ka,1<f.length)this.position.copy(f[l-
1].position),this.position.lerp(f[l].position,k),this.direction.copy(f[l-1].direction),this.direction.lerp(f[l].direction,k),this.rotation=f[l].rotation,this.rotation-=f[l-1].rotation,this.rotation*=k,this.rotation+=f[l].rotation,this.lookAt.copy(this.position),this.normal.copy(f[l-1].normal),this.normal.lerp(f[l].normal,k),this.lookAt.copy(f[l].position),this.normal.copy(f[l].normal),ra=this.normal.clone(),ra.add(this.position),pa.position.copy(this.position),pa.lookAt(ra),pa.rotateOnAxis(n,this.rotation),
Xa.update(u,this.position,this.direction,la);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:T,yen:0}};this.AT=function(){return e};this.convert=function(H){for(var Y=[],ha=0;ha<H.length;ha++){var ra=H[ha].U,wa=H[ha].D,Ha=H[ha].L,ua=H[ha].R,xa=ra&&wa&&Ha,Ba=ra&&wa&&ua,La=0;xa||Ba?xa?La="a":Ba&&(La="b"):(La+=ra?3:wa?6:0,La+=Ha?1:ua?2:0);Y.push(La.toString())}return Y};this.replay=function(H){a.REPLAY_START?(0===a.INPUTS.length&&
(a.INPUTS=a.PHYSICSBUFFER.slice()),va=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(H,Y){void 0===H||H?(a.SAVE_PARAM.power=Y.power,a.SAVE_PARAM.drag=Y.drag,a.SAVE_PARAM.sensitivity=Y.sensitivity,a.SAVE_PARAM.model=Y.model,a.SAVE_PARAM.paint=Y.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var H=
X.length+" / "+R.BATTLE.length;0===X.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);X.length<R.BATTLE.length?(R.scan(H,!1),this.reset(),a.PAINT=R.BATTLE[X.length].param.paint,a.MODEL=R.BATTLE[X.length].param.model,a.paint(),a.body(),a.tune.power(R.BATTLE[X.length].param.power),a.tune.drag(R.BATTLE[X.length].param.drag),a.tune.sensitivity(R.BATTLE[X.length].param.sensitivity),
a.INPUTS=R.BATTLE[X.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(f[l].time=0,this.IMPORT=!1,ya?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),R.replay("import"),this.INPUTS=[]):(this.reset(!1),R.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(H){H=void 0===H?
A.power:H;A.power=0>H?0:5<H?5:H;ia=.016+A.power/5*I},drag:function(H){H=void 0===H?A.drag:H;A.drag=0>H?0:5<H?5:H;U=.985-A.drag/5*J},sensitivity:function(H){H=void 0===H?A.sensitivity:H;A.sensitivity=0>H?0:5<H?5:H;S=.06+A.sensitivity/5*O},ease:function(H){H=void 0===H?A.ease:H;A.ease=0>H?0:5<H?5:H;aa=6+A.ease}};this.param=function(){return array=Object.assign(A,[]),array.model=a.MODEL,array.paint=a.PAINT,array};this.paint=function(H){H=void 0===H?a.PAINT:H;a.PAINT=H;Xa.paint(Ja[H]);Ca.color.set(Ja[H]);
Ca.needsUpdate=!0};this.body=function(){pa.geometry.dispose();pa.geometry=ta[a.MODEL].geometry().clone();pa.geometry.verticesNeedUpdate=!0};this.yen=function(){return R.cSave("YEN",0),0};this.debug=function(){console.log("position:",Q);console.log("direction:",ea);console.log("rotation:",oa);console.log("dt:",1);console.log("TIME:",Va);console.log("INTERPOLATION:",k);console.log("PHYSICS MESH:",q.rotation);console.log("EASE",aa);console.log(f);console.log(h);console.log("TIMESTAMPS",this.TIMESTAMP);
console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",f[l]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(H){var Y=0;if(0==a.INPUTS.length)Y=0;else if(H<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[Y].time<H;)Y++;u=this.INPUTS[Y].U;r=this.INPUTS[Y].D;B=this.INPUTS[Y].L;z=this.INPUTS[Y].R}else if(this.IMPORT){H=!0;for(var ha="",ra=1;ra<this.CHECKPOINT.length;ra++)this.CHECKPOINT[ra]!==R.BATTLE[X.length].cp[ra]&&(""===ha&&(ha+="checkpoint_discrepancy"),
H=!1);if(a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==R.BATTLE[X.length].time&&(H=!1,ha+="final_time_discrepancy"),H){H=[];for(ha=0;ha<this.DEBUG_BUFFER.length;ha++)H.push({time:this.DEBUG_BUFFER[ha].time,position:this.DEBUG_BUFFER[ha].position.clone(),direction:this.DEBUG_BUFFER[ha].direction.clone(),rotation:this.DEBUG_BUFFER[ha].rotation,normal:this.DEBUG_BUFFER[ha].normal.clone(),lookAt:this.DEBUG_BUFFER[ha].lookAt.clone(),U:this.DEBUG_BUFFER[ha].U});X.push(new lb(H,this.MODEL,this.PAINT,this.CHECKPOINT.slice(),
R.BATTLE[X.length].name))}else firebase.analytics().logEvent("invalid_data",{seed:N.name,uid:R.BATTLE[X.length].uid,name:R.BATTLE[X.length].name,report:N.name+"/"+R.BATTLE[X.length].uid+"("+R.BATTLE[X.length].name+")"+ha+" : "+ma+"/("+ja+")",error:ha}),R.BATTLE.splice(X.length,1);this["import"]()}else a.replay(!1),this.START=this.IMPORT=!1;return Y};this.overwrite=function(H,Y,ha){ha=void 0===ha?!0:ha;var ra=H[4]<Y[4],wa=H[5]>=Y[5],Ha=H[5]>Y[5];return void 0===Y[4]||ra&&wa||Ha?!ha||H:!!ha&&Y};this.decode=
function(H){var Y=[function(){G.UP=!1;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!1;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!0},function(){G.UP=!0;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!0;G.DOWN=!1;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!0;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!0},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!0},function(){G.UP=!0;G.DOWN=
!0;G.LEFT=!1;G.RIGHT=!1}];Y.a=function(){G.UP=!0;G.DOWN=!0;G.LEFT=!0;G.RIGHT=!1};Y.b=function(){G.UP=!0;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!0};Y[H]()};this.audit=function(){}}function zb(a){var f=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return f.tape[l].timer};this.DT=ib();var l=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(k){this.keybuffer.push({key:(G.UP?3:G.DOWN?6:0)+(G.LEFT?1:G.RIGHT?2:0),time:k})};this.simulate=function(){};this.capture=
function(k){return{position:(new THREE.Vector3).copy(k.position),normal:(new THREE.Vector3).copy(k.normal),lookTarget:k.lookTarget.clone(),rotation:k.rotation,timer:k.getTime(),objective:k.getObjective(),check:k.check,UP:k.UP}};this.record=function(k){f.tape[l]=k.record();l=24E4<f.tape[l].TS?0:l+1};this.play=function(k){if(this.RECORD){this.RECORD=!1;for(var q=f.frame=0;q<X.length;q++)X[q].reset();na.reset()}if(f.frame>f.tape.length-10){f.frame=0;na.reset();for(q=0;q<X.length;q++)X[q].reset();N.generate.resetCheckpoints()}if(k.replay(),
this.tape[f.frame].check)N.generate.checkpoints[0===this.tape[f.frame].objective?4:this.tape[f.frame].objective-1].display.material.color=ba[4]};this.reset=function(){N.generate.resetCheckpoints();l=0;f.frame=0;na.reset();f.PLAY=!1;f.RECORD=!0;f.tape=[]};this["export"]=function(k,q){k=void 0===k?function(){R.results()}:k;var u=w.CHECKPOINT[4]-1E4*w.CHECKPOINT[5];if((u<Na||!1===Na)&&""!==ja&&null!==ja&&!1!==ma&&void 0!==ma&&!f.SCAN||void 0!==q&&!q){R.STATE=function(){b.clear();b.print("uploading vhs to db",
"2","2")};R.STATE();ma;var r=N.name,B=w.CHECKPOINT.slice(),z=w.CHECKPOINT[0];q=w.param();for(var c=[];c.length<w.PHYSICSBUFFER.length;){var g=c.length;g={time:w.PHYSICSBUFFER[g].time,U:w.PHYSICSBUFFER[g].U,D:w.PHYSICSBUFFER[g].D,L:w.PHYSICSBUFFER[g].L,R:w.PHYSICSBUFFER[g].R};c.push(g)}q={version:"006",id:ma,seed:r,time:u,cp:B,utc:z,debug:c,param:q};firebase.database().ref("vhs/006/"+q.seed+"/"+ma).set(q,function(e){e?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted",
"2","2"));window.setTimeout(k,1E3);uas.replay();w.replay()})}else void 0===ma||!1===ma||null===ja||""===ja||void 0===ja?R.register():(R.results(),uas.replay(),w.replay())};this.burn=function(k){return Math.round(1E9*k).toString(16)};this.read=function(k){return parseInt(k,16)/1E9};this.scan=function(k,q){f.SCAN=!0;var u=[];firebase.database().ref("vhs/006/"+k).orderByChild("time").limitToFirst(99).once("value").then(function(r){r.forEach(function(B){var z=B.child("id").val(),c=B.child("time").val();
B=B.child("utc").val();u.push({uid:z,time:c,utc:B})});f.SCAN=!1;q(u)})};this.checkTime=function(k,q,u){k===q&&(Na=u)};this.requestName=function(k,q){firebase.database().ref("uid/"+k).once("value").then(function(u){u=u.child("name").val();return q(u),u})};this["import"]=function(k,q){q=void 0===q?function(){}:q;firebase.database().ref("vhs/006/"+k).once("value").then(function(u){var r=u.val(),B=r.id,z=r.seed,c=r.cp.slice();u=r.utc;r.model;r.paint;r.param;q({uid:B,seed:z,cp:c,utc:u,debug:r.debug.slice(),
param:r.param})})};this.save=function(k,q){q=void 0===q?1E3/30:q;for(var u=0,r=[],B=k[k.length-1].TS,z=0;z<B;)z+=q,z<B&&r.push({TS:z});for(B=0;B<r.length;B++)u=f.convert(k,r[B],u);return r};this.convert=function(k,q,u){for(var r=k[u].time,B=k[u+1].TS,z=B-r;q.time>B&&u<k.length-2;)r=k[++u].time,B=k[u+1].time,z=B-r;r=u;var c=u+1;B=(z-(B-q.time))/z;return q.position=new THREE.Vector3,q.position.copy(k[r].position),q.position.lerp(k[c].position,B),q.lookTarget=new THREE.Vector3,q.lookTarget.copy(k[r].normal),
q.lookTarget.lerp(k[c].normal,B),q.rotation=(k[c].rotation-k[r].rotation)*B,q.rotation+=k[r].rotation,q.rotation=(k[c].rotation-k[r].rotation)*B,q.rotation+=k[r].rotation,q.AT=(k[c].AT-k[r].AT)*B,q.AT+=k[r].AT,q.UP=k[r].UP,q.check=k[r].check,q.objective=k[r].objective,u}}var lb=function(a,f,l,k,q){l=void 0===l?0:l;k=void 0===k?[]:k;var u=[];this.inputs=[];this.name=void 0===q?"":q;this.cp=k;u[0]={name:"logistics crate",geometry:function(){return Ta.logistics_crate()}};u[1]={name:"ag-86",geometry:function(){return Ta.ag_86()}};
q=void 0===f?0:f;f=l;var r=a.slice();this.PHYSICS=r;var B=0,z=new THREE.Vector3(0,0,1);r[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var c=u[q].geometry(),g=new THREE.MeshBasicMaterial({color:Ja[f]}),e=new THREE.LineSegments(c,g);e.visible=!0;e.name="ghost_"+X.length;
e.position.copy(r[0].position);fa.add(e);var h=new Ta.emitter;h.connect(Ja[l]);0===N.best.length||k[4]<N.best[4]&&(k[5],N.best[5]);uas.TARGETS.push(this);ya&&(uas.TARGET=1);this.reset=function(){na.reset();h.reset();B=0};this.update=function(x){this.index(x);var D=(1E3/60-(r[B].time-x))/(1E3/60),M=r[B].U;0!==B&&0!==x||(B=1,D=0,M=!1);x=this.velocity.length();h.update(M,this.position,this.direction,x);x=this.normal.clone();x.add(this.position);e.position.copy(this.position);e.lookAt(x);e.rotateOnAxis(z,
this.rotation);this.interpolate(D);this.lookAt.copy(this.position);this.velocity.copy(r[B].position);this.velocity.sub(r[B-1].position)};this.interpolate=function(x){this.position.copy(r[B-1].position);this.position.lerp(r[B].position,x);this.normal.copy(r[B-1].normal);this.normal.lerp(r[B].normal,x);this.rotation=r[B].rotation;this.rotation-=r[B-1].rotation;this.rotation*=x;this.rotation+=r[B].rotation;this.direction.copy(r[B-1].direction);this.direction.lerp(r[B].direction,x)};this.discrete=function(){this.position.copy(r[B].position);
this.rotation=r[B].rotation;this.normal.copy(r[B].normal)};this.index=function(x){if(B=0,x<=r[r.length-2].time)for(;r[B].time<=x;)B++;else B=r.length-2};this.toggleEmitter=function(x){void 0===x||x?h.connect():h.disconnect()};this.disconnect=function(){fa.remove(e);c.dispose();g.dispose();h.disconnect()};this.debug=function(){console.log(r)};this.hide=function(){e.visible=!1};this.show=function(){e.visible=!0}};window.onload=function(){window.addEventListener("touchstart",gb);window.addEventListener("contextmenu",
function(){event.preventDefault()});fa=new THREE.Scene;fa.background=mb;nb=new THREE.Vector3(0,0,1);ca=new THREE.PerspectiveCamera;ca.up=nb;ca.position.z=2E3;ca.lookAt(0,0,0);ca.fov=70;ca.near=1E-5;ca.far=3E3;ca.name="Camera";fa.add(ca);za=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});za.setClearColor(mb);za.domElement.id="renderer";za.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(za.domElement);G=new ob;G.connect();b=new xb;N=new rb;
w=new yb;sa=new zb;R=new tb;R.login();R.checksave();R.decodeURL();uas=new wb;uas.connect();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,"#eeeeee");b.format(6,"#DA4DFA");ca.position.set(0,25,10);ca.lookAt(0,0,0);Ia();hb();R.intro()}};window.onresize=Ia;window.fullscreenchange=Ia;window.focus=Ia;var fb="artology forest;coen mountain;coffee forest;coyote forest;deadmans wonderland;development mountain;do it pass;eenetsu pass;ego mountain;ghxst mountain;ghxst pass;ghxstly forest;ginko mountain;haunted forest;hoekage mountain;ifuta pass;jaywalk pass;kae mountain;lotus mountain;low tunnel pass;lyla forest;mach mountain;mew mountain;nephil pass;nminke pass;ogj route;olive forest;ovo mountain;pine forest;prey first pass;r3 mountain;r3evaluate pass;ratty mountain;rekenase mountain;rex mountain;rutsuyo pass;sheep pass;shinigami graveyard;sleeping forest;the lotus order;tofu route;tora forest;tora tora pass;totoworo forest;ultra mountain;utopia district;vancouver island survey;vr pass;wasabi mountain;zynra mountain".split(";"),
ba=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],cb;for(cb in ba){var Ab=new THREE.Color(ba[cb]);ba[cb]=Ab}var Ja=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],ub="snow sakura melon peach bumblebee lavender ice".split(" "),Na=!1,Ua="",Ra=Math.floor(2147483647*Math.random()),eb="",fa,ca,za,N,w,G,b,sa,R,X=[],Ka=1E3/60,Da=20,Aa=9,Ea=0,Ya=!0,bb=!1,ab=!1,ma=null,ja="",nb,va=!1,mb=ba[0],sb=0,Ma=!1,Sa=!1,qa=!1,$a=!1,Ga=!1,
Oa=!0,Va=0,Wa=!1,Za=!1,ya=!1,qb=!1,kb=!1,jb=!1,Fa=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Ta={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,
-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=
this;this.maxLife=100;for(var f=0,l=new THREE.Geometry;l.vertices.length<a.maxLife;){var k=new THREE.Vector3(0,0,0);k.life=0;k.maxLife=a.maxLife;k.acc=new THREE.Vector3(0,0,0);l.vertices.push(k);k=new THREE.Color(4294967040);l.colors.push(k)}l.verticesNeedUpdate=!0;var q=new THREE.Points(l,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));q.name="Emitter";var u=new THREE.Color;a.connect=function(r){r=void 0===r?16777215:r;fa.add(q);
a.paint(r)};a.paint=function(r){r=new THREE.Color(void 0===r?16777215:r);u=new THREE.Color;r.getHSL(u);for(r=0;r<q.geometry.vertices.length;r++)q.geometry.colors[r].setHSL(u.h,u.s,0),q.geometry.vertices[r].life=0};a.reset=function(){for(var r=0;r<q.geometry.colors.length;r++)q.geometry.colors[r].setHSL(u.h,u.s,0),q.geometry.vertices[r].life=0};a.disconnect=function(){fa.remove(q);q.geometry.dispose();q.material.dispose()};a.update=function(r,B,z,c){if(r)for(r=0;1>r;){q.geometry.vertices[f].copy(z);
q.geometry.vertices[f].multiplyScalar(-1-Math.random()*c);q.geometry.vertices[f].add(B);q.geometry.vertices[f].life=q.geometry.vertices[f].maxLife;Math.random();Math.random();Math.random();var g=.1*-Math.random();q.geometry.vertices[f].acc.copy(z);q.geometry.vertices[f].acc.multiplyScalar(g);f++;f%=q.geometry.vertices.length;r++}for(var e in q.geometry.vertices){var h;0<q.geometry.vertices[e].life&&(q.geometry.vertices[e].add(q.geometry.vertices[e].acc),--q.geometry.vertices[e].life,h=q.geometry.vertices[e].life/
100,q.geometry.colors[e].setHSL(u.h,u.s,u.l*h));0>=q.geometry.vertices[e].life&&(q.geometry.vertices[e].set(0,0,0),q.geometry.vertices[f].acc.x=0,q.geometry.vertices[f].acc.y=0,q.geometry.vertices[f].acc.z=0)}q.geometry.verticesNeedUpdate=!0;q.geometry.colorsNeedUpdate=!0;q.geometry.computeBoundingSphere()}}},pb=function(){function a(u){return u*u*u*(u*(6*u-15)+10)}function f(u,r,B){return r+u*(B-r)}function l(u,r,B,z){var c=15&u;u=8>c?r:B;z=4>c?B:12==c||14==c?r:z;return(0==(1&c)?u:-u)+(0==(2&c)?
z:-z)}for(var k=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,
118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],q=0;256>q;q++)k[256+q]=k[q];return{noise:function(u,r,B){var z=Math.floor(u),
c=Math.floor(r),g=Math.floor(B),e=255&z,h=255&c,x=255&g,D=(u-=z)-1,M=(r-=c)-1,Z=(B-=g)-1,T=a(u),t=a(r);z=a(B);c=k[e]+h;g=k[c]+x;c=k[c+1]+x;e=k[1+e]+h;h=k[e]+x;x=k[e+1]+x;return f(z,f(t,f(T,l(k[g],u,r,B),l(k[h],D,r,B)),f(T,l(k[c],u,M,B),l(k[x],D,M,B))),f(t,f(T,l(k[g+1],u,r,Z),l(k[h+1],D,r,B-1)),f(T,l(k[c+1],u,M,Z),l(k[x+1],D,M,Z))))}}},vb=function(a,f){for(var l="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61 736d65676d61".split(" "),
k="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),q=a.toLowerCase(),u=0;u<q.length;u++){var r=q.charCodeAt(u);if(122<r||57<r&&61>r||33>r||40==r||41==r)return"";r="";for(var B=u;B<q.length;B++){q.charAt(B);var z=q.charCodeAt(B);(48<=z&&57>=z||97<=z&&122>=z)&&(r+=z.toString(16));for(z=0;z<l.length;z++){for(var c="",g="",e=[],h=0,x=0,D=0;D<l[z].length;D+=2){var M=r.charAt(D+h)+r.charAt(D+1+h),Z=l[z].charAt(D)+l[z].charAt(D+1);if((M===c||M===g)&&0!==M.length&&(x++,0<
x))for(;M===c||M===g;)h+=2,M=r.charAt(D+h)+r.charAt(D+1+h);if(M===Z)e[D/2]=!0,c=M,g=Z;else{e[D/2]=!1;for(var T=0;T<k.length;T++){var t=k[T].charCodeAt(1).toString(16),A=k[T].charCodeAt(0).toString(16);M===t&&(A===Z?(e[D/2]=!0,c=t,g=Z):A!==c&&A!==g||(x++,0<x&&(h+=2,D-=2)))}!1===e[D/2]&&(D=l[z].length)}}for(g=c=0;g<e.length;g++)if(!0===e[g]&&c++,c===e.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();na.time=
0;na.last=0;na.timestep=1E3/60;na.dt=1}},ib=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var f="[\n",l=0;l<a.length;l++){f+="'";for(var k=0;k<a[l].length;k++)f+=a[l].charCodeAt(k).toString(16);f+="',\n"}return f+="]",console.log(f),f}})();