(function(){function ob(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var g="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",
a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;
ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(k){var h="keydown"==k.type;switch(h||(g+=k.key),3<g.length&&(g=g.slice(1,4)),k.key){case "ArrowUp":a.UP=h;break;case "ArrowDown":a.DOWN=h;break;case "ArrowLeft":a.LEFT=h;break;case "ArrowRight":a.RIGHT=h;break;case "w":a.UP=h;break;case "s":a.DOWN=h;break;case "a":a.LEFT=h;break;case "d":a.RIGHT=h;break;case "r":a.RESET=h;break;case " ":a.SPACE=h;break;case "Shift":a.SHIFT=h;break;case "1":uas.CAM=
1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "Enter":a.ENTER=h;break;case "Control":a.CTRL=h;break;case "Escape":case "Backspace":a.ESC=h;break;case "=":a.ZOOM_IN=h;break;case "-":a.ZOOM_OUT=h;break;case "t":a.TARGET=h;break;case "h":a.HIDE=h;break;case ">":!h&&2>Fa&&(Fa+=.5);Ia();break;case "<":!h&&.5<Fa&&(Fa-=.5),Ia()}!x.REPLAY||qa||ya||"vhs"===g&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(sa["export"],1E3,S.results,!1),g=
"")};this.mousedown=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!0}};this.mouseup=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!1}};this.touchSetup=function(k){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",
a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(k)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(k){k=k.touches;a.touches=[];for(var h=0;h<k.length;h++)a.touches[h]={x:k[h].clientX,y:k[h].clientY,start:!0}};this.touchmove=function(k){a.touches=[];k=k.touches;for(var h=0;h<k.length;h++)a.touches[h]=
{x:k[h].clientX,y:k[h].clientY,start:!1}};this.touchend=function(k){a.touches=[];k=k.touches;for(var h=0;h<k.length;h++)a.touches[h]={x:k[h].clientX,y:k[h].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var g=[],k=0;this.BIOMES=g;this.BIOME=0;g[0]={name:"pine",palette:ba[9],tree:function(p,n){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};g[0].map[0]=function(p,n){var m=ba[10],E=!1;return.92<Math.abs(p)&&(m=.92<Math.abs(p)?ba[9]:ba[2],E=
!0),g[0].flags[n]=E,m};g[1]={name:"cherry blossom",palette:ba[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};g[1].map[0]=function(p,n){var m=ba[1],E=!1;return.95<Math.abs(p)&&(m=.92<Math.abs(p)?ba[12]:ba[1],E=!0),g[1].flags[n]=E,m};g[2]={name:"ice",palette:ba[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};g[2].map[0]=function(p,n){var m=ba[7],E=!1;return.95<Math.abs(p)&&(m=.92<Math.abs(p)?ba[2]:ba[7],E=!0),g[2].flags[n]=
E,m};var h=new THREE.Points(new THREE.Geometry);h.name="Generative Extruder";h.visible=!1;var q=new THREE.Line(new THREE.Geometry);q.name="Generative Nodes";q.visible=!1;q.material.color=ba[6];q.material.name="Node Material";q.position.z+=2;var w=new THREE.LineSegments(new THREE.Geometry);w.name="Generative Segments";w.visible=!0;w.material.color=ba[3];w.material.name="Segments Material";var r=new THREE.Mesh(new THREE.Geometry);r.name="Generative Surface";r.visible=!1;r.material.color=ba[0];r.material.name=
"Surface Material";var D=new THREE.LineSegments(new THREE.Geometry);D.name="Generative Perimeter";D.material.color=ba[1];D.material.name="Perimeter Material";var A=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));A.name="Terrain";A.material.name="Terrain Material";A.material.wireframe=!0;A.material.side=THREE.DoubleSide;A.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name=
"Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var u=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));u.name="Trees";var e=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);e.name="Background";e.material.color=ba[0];e.material.name="Background Material";e.material.wireframe=!1;e.material.side=THREE.FrontSide;e.material.opacity=
.75;e.material.blendMode=THREE.MultiplyBlending;e.material.transparent=!0;var c=new THREE.Points(new THREE.Geometry);c.material.color=ba[1];c.material.sizeAttenuation=!1;c.material.size=1.5;c.material.fog=!1;scope.stars=c;var f=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);f.name="Collision Mesh";f.visible=!0;f.material.name="Collision Material";f.material.side=THREE.BackSide;this.checkpoints=[];var l=new THREE.Vector3(0,0,1),z=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,
0,1);var K=new THREE.Vector3(0,3,0),W=new THREE.Vector3(0,0,1),Q=q.geometry.clone(),t=r.geometry.clone(),B=w.geometry.clone(),I=D.geometry.clone(),J=[],O=[],ia=new THREE.Vector3;J[0]=new THREE.Vector3(5,3,0);J[1]=new THREE.Vector3(-5,3,0);O[0]=J[0].clone();O.z+=1;O[1]=J[1].clone();O.z+=1;var U=Math.PI/64,T=Math.PI/32,aa=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var oa=!1,da=!1,ea=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Pa=18,Qa=new THREE.Raycaster;Qa.far=800;h.geometry.vertices[0]=
K.clone();h.geometry.vertices[1]=l.clone().add(K);h.geometry.vertices[2]=J[0].clone();h.geometry.vertices[3]=J[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();this.connect=function(){scope.SEED=Ra;this.BIOME=k=scope.randomInt(0,3);N.SNOW=2===k;N.SNOW&&N.snow.init();fa.add(h);fa.add(q);fa.add(w);fa.add(D);fa.add(r);fa.add(wireframe);fa.add(e);la=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var p in aa=[],fa.remove(h),
fa.remove(q),fa.remove(w),fa.remove(D),fa.remove(r),fa.remove(wireframe),fa.remove(e),fa.remove(u),g)g[p].flag=[];for(var n in scope.checkpoints)fa.remove(scope.checkpoints[n].display),scope.checkpoints[n].display.geometry.dispose(),scope.checkpoints[n].collision.geometry.dispose()};this.complete=function(){f.geometry.mergeVertices();f.geometry.verticesNeedUpdate=!0;f.geometry.elementsNeedUpdate=!0;f.geometry.computeFaceNormals();f.geometry.computeVertexNormals();f.geometry.computeBoundingSphere();
e.geometry.copy(f.geometry);--e.position.z;for(var p=[],n=0;n<f.geometry.faces.length;n++)p[f.geometry.faces[n].a]=f.geometry.faces[n].vertexNormals[0].clone(),p[f.geometry.faces[n].b]=f.geometry.faces[n].vertexNormals[1].clone(),p[f.geometry.faces[n].c]=f.geometry.faces[n].vertexNormals[2].clone();for(n=0;n<f.geometry.vertices.length;n++)f.geometry.vertices[n].add(p[n].multiplyScalar(2));f.geometry.verticesNeedUpdate=!0;f.geometry.computeFaceNormals();f.geometry.computeVertexNormals();f.geometry.computeBoundingSphere();
wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();p=new THREE.IcosahedronGeometry(1200,10);for(var m in p.vertices).3>scope.random()&&-400<p.vertices[m].z&&c.geometry.vertices.push(p.vertices[m].clone());p.dispose();c.geometry.computeBoundingSphere();N.surface=f.clone();N.start=scope.start.clone();la=window.performance.now()-la;oa=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",
{time:Math.round(la/1E3)});Za?(b.clear(),x.connect(N.start,N.surface),x.PLAY=!1,sa.PLAY=!0):S.ready()};this.reset=function(){Pa=(36+scope.random()-.5)/2;a=0;q.geometry.dispose();w.geometry.dispose();r.geometry.dispose();h.geometry.dispose();D.geometry.dispose();A.geometry.dispose();wireframe.geometry.dispose();f.geometry.dispose();u.geometry.dispose();c.geometry.dispose();B.dispose();I.dispose();Q.dispose();t.dispose();B.copy(new THREE.Geometry);I.copy(new THREE.Geometry);Q.copy(new THREE.Geometry);
t.copy(new THREE.Geometry);q.geometry.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);D.geometry.copy(new THREE.Geometry);r.geometry.copy(new THREE.Geometry);A.geometry.copy(new THREE.Geometry);f.geometry.copy(new THREE.Geometry);K.set(0,3,0);W.set(0,0,1);J[0]=new THREE.Vector3(4,3,0);J[1]=new THREE.Vector3(-4,3,0);oa&&(oa=!1,da=!1,ea=!1);this.END=!1;h.position.set(0,0,0);h.geometry.vertices[0]=K.clone();h.geometry.vertices[1]=l.clone().add(K);h.geometry.vertices[2]=
J[0].clone();h.geometry.vertices[3]=J[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();h.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(p,n,m,E,C,y,R,F,M,L){p=void 0===p?0:p;n=void 0===n?0:n;m=void 0===m?0:m;E=void 0===E?0:E;C=void 0===C?0:C;y=void 0===y?{start:0,end:30,angle:0,slope:0}:y;R=void 0===R?[]:R;F=void 0===F?[]:F;M=void 0===M?!1:M;L=void 0===L?999:L;var P=window.performance.now(),V=0;for(0===E&&(E=.5<scope.random()?
1:-1);32>V&&!da;){if(p===y.end+1){F=[];for(m=0;1>m;m++)if(p>=scope.length)F.push({angle:0,slope:0,end:30}),L=p+30;else if(0===n){var X=scope.randomInt(2,4)*E;V=Math.floor(Math.abs(36/X));E=.01>scope.random()?+E:-1*E;V=scope.randomInt(1,V);F.push({angle:X,slope:0,end:V})}else X=scope.randomInt(-5,-1),V=scope.random(),X=2!==k&&.05>V?X*=-1:X,V=scope.randomInt(2,20),F.push({angle:0,slope:X,end:V});V=scope.randomInt(0,F.length);n=F[V].angle;m=F[V].slope;y.start=p;y.end=p+F[V].end;F=F.slice(V,1)}if(M||
(scope.extrude(n,m),aa.push({angle:n,slope:m}),Q.verticesNeedUpdate=!0,p++),10<=p&&!M){V=new THREE.Vector2(Q.vertices[p-1].x,Q.vertices[p-1].y);for(X=0;X<Q.vertices.length-1-10;X++)if(18>(new THREE.Vector2(Q.vertices[X].x,Q.vertices[X].y)).distanceTo(V)){M=!0;break}M&&window.setTimeout(N.reset(!0),0)}0;p===L&&(da=!0,q.geometry.dispose(),q.geometry=Q.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ka.copy(q.geometry.vertices[0]),ka.sub(Q.vertices[0])),
window.setTimeout(function(){S.PATH=!0;S.STATE();scope["import"]()},0));V=window.performance.now()-P}da||M||window.setTimeout(scope.path,0,p,n,m,E,C,y,R,F,M,L)};this.skijump=function(p,n,m,E,C,y,R,F,M,L,P){p=void 0===p?0:p;n=void 0===n?0:n;m=void 0===m?0:m;E=void 0===E?0:E;C=void 0===C?0:C;y=void 0===y?{start:0,end:20,angle:0,slope:0}:y;R=void 0===R?[]:R;F=void 0===F?[]:F;M=void 0===M?!1:M;L=void 0===L?300:L;P=void 0===P?0:P;var V=window.performance.now(),X=0;for(0===E&&(E=.5<scope.random()?1:-1);32>
X&&!da;){if(p===y.end+1){F=[];for(n=0;1>n;n++)0===m&&20===y.end?(P=-1,F.push({angle:0,slope:-4,end:30})):3===m?F.push({angle:0,slope:4,end:3}):4===m?F.push({angle:0,slope:-32,end:10}):-4===m?(P=1,F.push({angle:0,slope:m+1,end:1})):-32===m?F.push({angle:0,slope:-4,end:40}):1==P?F.push({angle:0,slope:m+1,end:1}):-1==P&&F.push({angle:0,slope:m-1,end:1});X=scope.randomInt(0,F.length);n=F[X].angle;m=F[X].slope;y.start=p;y.end=p+F[X].end;F=F.slice(X,1)}if(M||(scope.extrude(n,m),aa.push({angle:n,slope:m}),
Q.verticesNeedUpdate=!0,p++),10<=p&&!M){X=new THREE.Vector2(Q.vertices[p-1].x,Q.vertices[p-1].y);for(var ta=0;ta<Q.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(Q.vertices[ta].x,Q.vertices[ta].y)).distanceTo(X)){M=!0;break}M&&window.setTimeout(N.reset(!0),0)}0;L<=p&&(da=!0,q.geometry.dispose(),q.geometry=Q.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ka.copy(q.geometry.vertices[0]),ka.sub(Q.vertices[0])),window.setTimeout(function(){scope["import"]()},
0));X=window.performance.now()-V}da||M||window.setTimeout(scope.skijump,0,p,n,m,E,C,y,R,F,M,L)};this["import"]=function(p){p=void 0===p?0:p;for(var n=window.performance.now(),m=0;!ea&&32>m;){if(0===p&&(h.position.set(0,0,0),h.rotation.z=0,K.set(0,3,0),h.geometry.vertices[0]=K.clone(),h.geometry.vertices[1]=l.clone().add(K),h.geometry.vertices[2]=J[0].clone(),h.geometry.vertices[3]=J[1].clone(),h.geometry.vertices[4]=O[0].clone(),h.geometry.vertices[5]=O[1].clone(),h.geometry.verticesNeedUpdate=!0,
h.updateMatrixWorld()),p<aa.length)a=p,angle=aa[p].angle,slope=aa[p].slope,scope.extrude(angle,slope),w.geometry.dispose(),w.geometry=B.clone(),w.geometry.computeBoundingSphere(),D.geometry.dispose(),D.geometry=I.clone(),D.geometry.computeBoundingSphere(),r.geometry.dispose(),r.geometry=t.clone(),r.geometry.computeBoundingSphere(),p++;else if(!ea&&p===aa.length){for(var E in scope.checkpoints=scope.checkpoint(),scope.checkpoints)fa.add(scope.checkpoints[E].display);ea=!0;window.setTimeout(function(){scope.terrain(!0)},
0)}m=window.performance.now()-n}ea||window.setTimeout(scope["import"],0,p,angle,slope)};this.extrude=function(p,n){p=void 0===p?0:p;n=void 0===n?0:n;for(var m in h.updateMatrixWorld(),h.rotateZ(p*T),h.geometry.vertices)h.geometry.vertices[m].applyAxisAngle(z,n*U);h.geometry.verticesNeedUpdate=!0;m=h.geometry.vertices[0].clone();var E=h.geometry.vertices[2].clone(),C=h.geometry.vertices[3].clone(),y=h.geometry.vertices[1].clone();if(m.applyMatrix4(h.matrix),E.applyMatrix4(h.matrix),C.applyMatrix4(h.matrix),
y.applyMatrix4(h.matrix),y.sub(m),da){if(E.add(ka),C.add(ka),0<B.vertices.length){var R=B.vertices[B.vertices.length-1].clone().sub(ia),F=B.vertices[B.vertices.length-2].clone().sub(ia);t.vertices.push(E.clone().sub(y));t.vertices.push(C.clone().sub(y));t.vertices.push(F);t.vertices.push(C.clone().sub(y));t.vertices.push(R);t.vertices.push(F);var M=E.clone();p=C.clone();R=B.vertices[B.vertices.length-1].clone();F=B.vertices[B.vertices.length-2].clone();f.geometry.vertices.push(M);f.geometry.vertices.push(p);
f.geometry.vertices.push(F);f.geometry.vertices.push(p);f.geometry.vertices.push(R);f.geometry.vertices.push(F);R=t.vertices.length;var L=new THREE.Face3(R-3,R-2,R-1);M=new THREE.Face3(R-5,R-4,R-6);t.faces.push(L);t.faces.push(M);L=L.clone();M=M.clone();L.color=new THREE.Color(16777215);M.color=new THREE.Color(16777215);f.geometry.faces.push(L);f.geometry.faces.push(M)}0<I.vertices.length?(L=2,M=1,4<I.vertices.length&&(L=4,M=2),L=I.vertices[I.vertices.length-L].clone(),M=I.vertices[I.vertices.length-
M].clone(),I.vertices.push(E.clone().add(y)),I.vertices.push(L.clone()),I.vertices.push(C.clone().add(y)),I.vertices.push(M.clone()),a==aa.length-1&&(F=E.clone().add(y),R=C.clone().add(y),I.vertices.push(F),I.vertices.push(R))):(I.vertices.push(E.clone().add(y)),I.vertices.push(C.clone().add(y)));B.vertices.push(E.clone());B.vertices.push(C.clone());ia.copy(y)}else Q.vertices.push(m.clone());for(var P in K.copy(m).sub(h.position),h.position.add(K),h.geometry.vertices)h.geometry.vertices[P].applyAxisAngle(z,
-1*n*U)};this.terrain=function(p,n,m,E,C,y,R){n=void 0===n?[]:n;m=void 0===m?[]:m;E=void 0===E?[]:E;C=void 0===C?0:C;y=void 0===y?0:y;R=void 0===R?0:R;if(void 0===p||p){w.updateMatrixWorld();A.geometry.dispose();A.geometry.copy(new THREE.Geometry);n=[];m=[];E=[];for(p=0;2>p;p++)E[p]=[],n[p]=[],m[p]=[];for(p=0;p<w.geometry.vertices.length;p++)m[p%2].push(w.geometry.vertices[p]);for(p=0;2>p;p++)for(var F=0;F<m[p].length;F++){var M=0===p?1:-1,L=m[p][F].clone();L.sub(m[p+M][F]);L.normalize().multiplyScalar(3);
E[p][F]=L.clone()}}F=0;var P;p=window.performance.now();if(4>C){if(A.geometry.verticesNeedUpdate=!0,A.geometry.elementsNeedUpdate=!0,A.geometry.computeBoundingSphere(),A.geometry.computeFaceNormals(),A.geometry.computeVertexNormals(),A.updateMatrixWorld(),0<C&&0===R)for(m[y]=[],M=0;M<n[y].length;M++)m[y][M]=A.geometry.vertices[n[y][M]];0===R&&(n[y]=[]);for(v=R;v<m[y].length&&32>F;){F=!1;if(void 0!==m[y][v]&&void 0!==m[y][v-1]){if(void 0===E[y][v])E[y][v]=E[s][v-1].clone();else if(A.geometry.computeBoundingSphere(),
M=m[y][v].clone().add(E[y][v]),M.z-=100,Qa.set(M,l),M.z+=100,L=Qa.intersectObjects([A],!0),0<L.length)for(var V in L).01<L[V].point.distanceTo(M)&&(n[y][v]=void 0,F=!0);F||(A.geometry.vertices.push(m[y][v].clone()),A.geometry.vertices.push(m[y][v].clone().add(E[y][v])),n[y][v]=A.geometry.vertices.length-1,0<v&&(A.geometry.vertices.push(m[y][v-1].clone()),P=A.geometry.vertices.length,0===y?A.geometry.faces.push(new THREE.Face3(P-2,P-1,P-3)):1===y&&A.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3))))}F=
window.performance.now()-p;v++;R=v}if(R===m[y].length){R=0;for(P=1;P<n[y].length;P++)if(void 0!==n[y][P]&&void 0!==n[y][P-1]){V=A.geometry.vertices[n[y][P]];var X;p=A.geometry.vertices[n[y][P-1]];2.8>V.distanceTo(p)?(V.copy(p),n[y][P]=n[y][P-1],E[y][P].copy(E[y][P-1])):1<P&&(A.geometry.vertices.push(m[y][P-1]),X=0===y?n[y][P]:n[y][P-1],p=0===y?n[y][P-1]:n[y][P],A.geometry.faces.push(new THREE.Face3(X,p,A.geometry.vertices.length-1)))}y++}1<y&&(y=0,C++)}if(4===C){A.geometry.verticesNeedUpdate=!0;A.geometry.elementsNeedUpdate=
!0;A.geometry.colorsNeedUpdate=!0;A.geometry.computeFaceNormals();A.geometry.computeVertexNormals();A.geometry.mergeVertices();A.geometry.computeBoundingSphere();scope.noise(A.geometry);for(X=0;X<A.geometry.faces.length;X++)V=A.geometry.vertices[A.geometry.faces[X].a].clone(),p=A.geometry.vertices[A.geometry.faces[X].b].clone(),P=A.geometry.vertices[A.geometry.faces[X].c].clone(),A.geometry.colors[A.geometry.faces[X].a],A.geometry.colors[A.geometry.faces[X].b],A.geometry.colors[A.geometry.faces[X].c],
f.geometry.vertices.push(V),f.geometry.vertices.push(p),f.geometry.vertices.push(P),wireframe.geometry.vertices.push(V),wireframe.geometry.vertices.push(p),wireframe.geometry.vertices.push(P),P=f.geometry.vertices.length,V=new THREE.Face3(P-1,P-2,P-3),V.color=new THREE.Color(0),f.geometry.faces.push(V),wireframe.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3));wireframe.geometry.copy(A.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,
n.slice(),m.slice(),E.slice(),C,y,R)},0)};this.biome=function(){for(var p=k,n=wireframe.geometry.faces,m=[],E=[],C=0;C<n.length;C++)for(var y=0;y<g[k].map.length;y++)n[C].vertexColors[0]=g[k].map[y](n[C].vertexNormals[0].z,n[C].a),n[C].vertexColors[1]=g[k].map[y](n[C].vertexNormals[1].z,n[C].b),n[C].vertexColors[2]=g[k].map[y](n[C].vertexNormals[2].z,n[C].c);for(n=0;n<g[k].flags.length;n++)for(C=0;C<w.geometry.vertices.length;C++).1>wireframe.geometry.vertices[n].distanceTo(w.geometry.vertices[C])&&
(g[k].flags[n]=!1);for(n=0;n<g[k].flags.length;n++)g[k].flags[n]&&m.push(n);for(n=0;n<g[k].limit&&n<m.length;){C=scope.randomInt(0,m.length);y=!0;if(0<E.length&&0<m.length)for(;y;){for(var R in E){if(wireframe.geometry.vertices[m[C]].distanceTo(wireframe.geometry.vertices[E[R]])<g[k].range){y=!0;m.slice(C,1);C=scope.randomInt(0,m.length);break}y=!1}0>=m.length&&(y=!1)}if(0<m.length){y=g[p].tree();for(var F in y.vertices)u.geometry.vertices.push(y.vertices[F].clone().add(wireframe.geometry.vertices[m[C]])),
u.geometry.colors[u.geometry.vertices.length-1]=y.colors[F];E.push(m[C]);m.slice(C,1)}n++}u.verticesNeedUpdate=!0;u.elementsNeedUpdate=!0;fa.add(u)};this.sakura=function(){var p=new THREE.Geometry,n=[],m=[],E=1,C,y=new THREE.Vector3(0,0,0),R=new THREE.Vector3(0,0,3),F=12,M=0,L=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,0,1);p.vertices.push(y);p.vertices.push(R);p.colors.push(ba[2]);p.colors.push(ba[2]);m.push({v:R.clone(),n:R.clone(),pitch:L.clone(),roll:P.clone()});for(y=[];4>M;){R=[];for(L=
0;L<m.length;L++)for(var V=P=0;3>V;V++){var X=0===M&&2===V&&1>P?1:scope.random();if(.2<X){X=scope.randomInt(-2,2);var ta=m[L].n.clone(),Ca=ba[2];ta.applyAxisAngle(m[L].pitch,2*Math.PI/(F+X));ta.applyAxisAngle(m[L].roll,2*Math.PI/3*V);ta.multiplyScalar(E);X=ta.clone().add(m[L].v);p.vertices.push(m[L].v.clone());p.vertices.push(X);p.colors.push(Ca);p.colors.push(Ca);Ca=m[L].pitch.clone();Ca.applyAxisAngle(m[L].roll,2*Math.PI/3*V);Ca.applyAxisAngle(m[L].pitch,2*Math.PI/F);var pa=m[L].roll.clone();pa.applyAxisAngle(m[L].pitch,
2*Math.PI/F);pa.applyAxisAngle(m[L].roll,2*Math.PI/3*V);0<V&&n.push({a:X.clone(),b:m[L].v.clone(),pitch:Ca,roll:pa});R.push({v:X.clone(),n:ta.clone(),pitch:Ca,roll:pa});P++}else 0===P&&2===V&&y.push({v:m[L].v.clone(),n:m[L].n.clone(),pitch:m[L].pitch.clone(),roll:m[L].roll.clone()})}m=R.slice();E*=.9;M++}for(C in F=6,n)E=n[C].a.clone(),R=n[C].b.clone(),E=E.clone().sub(R),L=E.clone().multiplyScalar(.5).add(R),M=scope.randomInt(0,3)-1,E.applyAxisAngle(n[C].pitch,2*Math.PI/F),E.applyAxisAngle(n[C].roll,
2*Math.PI/M),E.multiplyScalar(.5),R=L,L=E.clone().add(L),p.vertices.push(R),p.vertices.push(L),p.colors.push(ba[2]),p.colors.push(ba[2]),R=n[C].pitch.clone(),R.applyAxisAngle(n[C].roll,2*Math.PI/M),R.applyAxisAngle(n[C].pitch,2*Math.PI/F),P=n[C].roll.clone(),P.applyAxisAngle(n[C].pitch,2*Math.PI/F),P.applyAxisAngle(n[C].roll,2*Math.PI/M),m.push({v:L.clone(),n:E.clone(),pitch:R,roll:P});m=m.concat(y);for(n=0;n<m.length;n++)for(C=0;5>C;C++)F=m[n].n.clone(),F.normalize(),F.applyAxisAngle(m[n].pitch,
2*Math.PI/6),F.applyAxisAngle(m[n].roll,2*Math.PI/5*C),F.multiplyScalar(.5),F=F.add(m[n].v),y=m[n].v.clone(),p.vertices.push(F),p.vertices.push(y),p.colors.push(ba[12]),p.colors.push(ba[12]);return p.colorsNeedUpdate=!0,p};this.pine=function(){var p=Math.floor(8*scope.random())+6,n=2*Math.PI/6,m=new THREE.Geometry;m.vertices.push(new THREE.Vector3(0,0,0));m.vertices.push(new THREE.Vector3(0,0,+p-.5+1));m.colors.push(ba[9]);m.colors.push(ba[9]);m.colors.push(ba[9]);for(var E=1;E<p;E++)for(var C=0;6>
C;C++)off=E%2*n*.5,m.vertices.push(new THREE.Vector3(0,0,+E+1)),m.vertices.push(new THREE.Vector3(.3*(p-E),0,+E-.3+1)),m.vertices[m.vertices.length-1].applyAxisAngle(l,n*C+off),m.colors.push(ba[9]),m.colors.push(ba[9]);return m};this.checkpoint=function(){function p(C,y,R){var F=new THREE.Geometry,M=(new THREE.Vector3).copy(C).sub(y),L=(new THREE.Vector3).copy(C).add(M.clone().multiplyScalar(1.5));M=(new THREE.Vector3).copy(y).sub(M.clone().multiplyScalar(1.5));F.vertices.push(new THREE.Vector3(L.x,
L.y,L.z-12));F.vertices.push(new THREE.Vector3(L.x,L.y,L.z+12));F.vertices.push(new THREE.Vector3(M.x,M.y,M.z+12));F.vertices.push(new THREE.Vector3(M.x,M.y,M.z+12));F.vertices.push(new THREE.Vector3(M.x,M.y,M.z-12));F.vertices.push(new THREE.Vector3(L.x,L.y,L.z-12));F.faces.push(new THREE.Face3(0,1,2));F.faces.push(new THREE.Face3(3,4,5));L=new THREE.Geometry;L.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));L.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));L.vertices.push(new THREE.Vector3(y.x,
y.y,y.z+6));L.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));L.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));L.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));L.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));L.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));L.vertices.push(new THREE.Vector3(C.x,C.y,C.z+1));L.vertices.push(new THREE.Vector3(y.x,y.y,y.z+1));C=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});C.color=ba[5];F=new THREE.Mesh(F,C);F.visible=!0;C=new THREE.LineSegments(L,
C);return F.name="Objective "+R,C.name="Checkpoint"+R,{display:C,collision:F}}var n=w.geometry,m=n.vertices.length-80;m=Math.floor(m/4)-Math.floor(m/4)%2;var E=[];E[0]=p(n.vertices[40],n.vertices[41],0);E[1]=p(n.vertices[40+m],n.vertices[1+m+40],1);E[2]=p(n.vertices[2*m+40],n.vertices[2*m+41],2);E[3]=p(n.vertices[3*m+40],n.vertices[3*m+41],3);E[4]=p(n.vertices[4*m+40],n.vertices[4*m+41],4);this.DISTANCE=4*m/2*3;scope.start.copy(n.vertices[36]);scope.start.sub(n.vertices[37]);scope.start.multiplyScalar(-.75);
scope.start.add(n.vertices[36]);for(n=0;5>n;n++)null==N.best&&(N.best[n]=4>n?m*(n+1)/Pa:N.best[n]=N.best[n-1]);return S.STATE(),E};this.resetCheckpoints=function(){for(var p in scope.checkpoints)scope.checkpoints[p].display.material.color=ba[5]};this.random=function(){Ra=(Ra+1)%2147483647;var p=1E4*Math.sin(Ra);return p-Math.floor(p)};this.randomInt=function(p,n){return Math.floor(scope.random()*(n-p))+p};this.noise=function(p){var n=new pb,m=[],E=8,C=0,y=0,R=1E3*scope.random();k;for(var F=0;F<p.vertices.length;F++)m[F]=
0;for(F=0;2>F;F++){for(var M=0;M<p.vertices.length;M++)m[M]+=Math.floor(n.noise(p.vertices[M].x/E,p.vertices[M].y/E,R)*E),m[M]>C&&(C=m[M]),m[M]<y&&(y=m[M]);E*=3}for(n=0;n<m.length;n++){E=2===k?2:.5;for(C=0;C<w.geometry.vertices.length;C++)y=p.vertices[n].distanceTo(w.geometry.vertices[C]),y=y*y/100,y<E&&(E=y);p.vertices[n].z+=m[n]*E}};this.name=function(){var p="";if(Ua)p=S.custom_seed;else if(Ga||Za)p=S.CHALLENGES.seed;else{var n=[" forest"," pass"," mountain"],m="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");
TOGGLE=!1;for(var E=Math.ceil(3*Math.random())+1,C=0;C<E;)p+=m[Math.floor(Math.random()*m.length)],C++;m=2===k?1:0;m=n[Math.floor(m+Math.random()*(n.length-m))];p+=m;(.04<Math.random()||p!==eb)&&(p="",m=Math.floor(Math.random()*fb.length),p=fb[m])}return eb=p,this.BIOME=k,p}}function gb(){$a=!0;window.removeEventListener("touchstart",gb)}function Ia(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,g=window.innerWidth,k=window.innerHeight;ca.aspect=g/k;ca.updateProjectionMatrix();
b.resize(g,k,a,Fa);S.resize(g,k,a)}function hb(){if(window.requestAnimationFrame(hb),Va=window.performance.now(),!va||x.IMPORT||ya)if(x.REPLAY&&!va){ib();N.update();x.update();uas.update(x.TIMESTAMP);ya&&0<Y.length&&x.TIMESTAMP>10*Y[0].cp[4]+5E3&&x.reset(!0);qa||jb||kb||qb||(x.TIMESTAMP,0);for(var a=0;a<Y.length;a++)Y[a].update(x.TIMESTAMP-0,x.FRAME)}else if(Sa||sa.SCAN&&!va)ca.up.set(0,0,1),ca.position.applyAxisAngle(ca.up,.01),ca.lookAt(new THREE.Vector3),Sa&&S.loading(),S.scanning();else{if(ya||
x.IMPORT){for(a="";a.length<Math.floor(Va/500)%4;)a+=".";b.clear();b.text("importing ghost data"+a,16,16);N.update()}ca.up.set(0,0,1);ca.position.applyAxisAngle(ca.up,.01);ca.lookAt(new THREE.Vector3,0,0,0)}else{x.update();for(a=0;a<Y.length;a++)x.START?Y[a].update(x.TIMESTAMP,x.FRAME):Y[a].update(0,0);uas.update(x.TIMESTAMP);qa||ab||S.update();!$a||qa||Ma||b.dpad();G.RESET&&!qa&&(S.reset(),G.RESET=!1);N.update()}za.render(fa,ca);b.update(G.touches)}function rb(){var a=this;this.SNOW=this.COMPLETE=
!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var k=new THREE.Vector3;k.copy(ca.position);k.x+=Math.random()*a.snow.distance-a.snow.distance/
2;k.y+=Math.random()*a.snow.distance-a.snow.distance/2;k.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(k)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var k=0;k<a.snow.mesh.geometry.vertices.length;k++){var h=a.snow.mesh.geometry.vertices[k];h.z-=.5*x.DT();(Math.abs(h.z-ca.position.z)>a.snow.height/2||Math.abs(h.x-ca.position.x)>a.snow.distance/2||Math.abs(h.y-ca.position.y)>a.snow.distance/2)&&(h.copy(ca.position),
h.x+=Math.random()*a.snow.distance-a.snow.distance/2,h.y+=Math.random()*a.snow.distance-a.snow.distance/2,h.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var g=0;4>g;g++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(k){k=void 0===k?!1:k;if(ca.position.set(0,400,200),ca.far=2E3,ca.updateProjectionMatrix(),ca.lookAt(new THREE.Vector3),za.render(fa,ca),!k){this.name=
this.generate.name();k="";for(var h in this.name)k+=this.name.charCodeAt(h).toString();Ra=k}a.generate.connect();sb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(k){k=void 0===k?!1:k;Ra++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;a.connect(k)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function tb(){var a=this,g,k,h=0,q=0,w=[],r=0;w.push(function(){b.link("","0","1.0-24",
"1.0-4","6","https://ginko.ltd");b.renderer.style.backgroundImage="url('./img/ginko_promo.gif')";b.renderer.style.backgroundSize="auto";b.renderer.style.backgroundRepeat="no-repeat";b.renderer.style.backgroundPosition="center 25%";b.print("support development by","2","1.0-23");b.style=6;b.print("aquiring items from ginko.ltd!","2","1.0-21");b.style=0});w.push(function(){b.renderer.style.backgroundImage="url('./img/low_promo.gif')";b.renderer.style.backgroundSize="auto";b.renderer.style.backgroundRepeat=
"no-repeat";b.renderer.style.backgroundPosition="center 25%";b.print("new mixtape by","2","1.0-23");b.style=1;b.print("low recordings! listen now!","2","1.0-21");b.button("","2","1.0-22","40","7",function(){var e=document.getElementById("mp3_player");e.currentTime=Math.random()*e.duration;e.play();a.STATE();Wa=!0;a.menu(a.intro)},!1);b.style=0});this.custom_seed="";var D="#1#ffffff#334#",A=Da+"#1#",u=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=
[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(e){return e?(ma=e.uid,a.STATE(),sa.requestName(ma,function(c){ja=c;a.STATE()})):(ma=!1,a.STATE()),null})};this.register=function(e){b.clear();a.STATE=function(){a.register(e)};ab=!0;a.inputName(function(){ab=!1;sa["export"]()},!0,"input name to save data")};this.resize=function(e,c){g=b.width;k=b.height;Aa=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var e=x.yen();b.print("$ "+
e.toString(),"2","1.0-4")};this.nav=function(e){e=void 0===e?function(){b.clear()}:e;b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2+4p","1.0-4","8",function(){a.menu(e)},!1)};this.title=function(e,c){a.breadcrumb(e,c);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){u||b.backdrop(!1);e();qa=!1;a.SETTINGS=!1},!1);Wa?(b.style=1,b.sprite(40,72,8,10,"1.0-14","2",8,10),b.sprite(48,72,16,16,"1.0-19","2",16,16),b.sprite(16,72,16,16,"1.0-10","2",16,
16),b.style=0,b.button("","1.0-23","2+4p","7","5",function(){var f=document.getElementById("mp3_player");f.currentTime=Math.random()*f.duration;f.play();a.STATE()},!1),b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").pause();Wa=!1;a.STATE()},!1)):(b.style=4,b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();Wa=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=
function(e,c){c=void 0===c?function(){u||b.backdrop(!1);e();qa=!1;a.SETTINGS=!1}:function(){a.menu(e);qa=!0};b.style=Wa?1:0;b.style=0;b.print("  menu","2","2");b.style=0;b.print("<","2","2");b.button("","2","2+4p","7","8",c,!1)};this.menu=function(e){qa=!0;b.style=0;a.STATE=function(){a.menu(e)};u||b.backdrop();b.clear();a.title(e);b.sprite(0,0,1,1,"2","6","1.0-4",1);ya?(b.print(" > view spectator controls","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle",
"2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(e)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");b.button("","2","13+4p","1.0-4","5",function(){a.settings(e)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var c=8,f;ya?(f=uas.AUTOPILOT?"disable":"enable",b.button(f+" autopilot","2","1.0-2-"+c,"1.0-4","6",function(){b.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),c+=8,b.button("deploy vehicle","2","1.0-2-"+c,"1.0-4","6",function(){b.backdrop(!1);
ya=!1;a.STATE=function(){};x.reset(!1);a.reset();va=!0;x.START=!1;x.disconnect();x.connect(N.start,N.surface,!1);a.play()},!0)):(va||x.REPLAY)&&(b.button("restart stage","2","1.0-2-"+c,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),c+=8,b.button("next stage","2","1.0-2-"+c,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var e;a.STATE=function(){a.intro()};u=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");b.timeouts.push(window.setTimeout(function(){r+=
1;r%=w.length;a.intro()},6E3));w[r]();Ga?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,e=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),b.style=0,b.print(e,"9","15"),sa.requestName(a.CHALLENGES.uid,function(c){a.CHALLENGER=c;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ua&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===
ma||""!==ja?null!==ja&&""!==ja?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+ja,"2","9"),b.style=2,b.print("[edit]",ja.length+"+5","9"),b.style=0,b.button("","2","9+4p",ja.length+"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===ja||null===ja)||!1!==ma&&null===ja)&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...",
"2","6"),b.style=0);b.style=2;b.print("0.0.6.2","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();u=!1;b.renderer.style.background="none";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");N.connect();a.load();a.discord()})};
this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=0};this.load=function(){a.STATE=function(){a.target();a.setBattleName();a.discord()};a.TIMELIST=[];sa.scan(N.name,function(e){for(var c={$jscomp$loop$prop$t$88$170:0};c.$jscomp$loop$prop$t$88$170<e.length;c={$jscomp$loop$prop$t$88$170:c.$jscomp$loop$prop$t$88$170},c.$jscomp$loop$prop$t$88$170++)a.TIMELIST[c.$jscomp$loop$prop$t$88$170]=
{uid:e[c.$jscomp$loop$prop$t$88$170].uid,utc:e[c.$jscomp$loop$prop$t$88$170].utc,time:e[c.$jscomp$loop$prop$t$88$170].time,name:"..."},sa.requestName(e[c.$jscomp$loop$prop$t$88$170].uid,function(z){return function(K){a.TIMELIST[z.$jscomp$loop$prop$t$88$170].name=K;a.STATE()}}(c)),sa.checkTime(ma,e[c.$jscomp$loop$prop$t$88$170].uid,e[c.$jscomp$loop$prop$t$88$170].time);c=a.TIMELIST.length<Da?a.TIMELIST.length:Da;var f=[];switch(Ea){case 0:f=e.slice(0,c);break;case 1:for(e=e.slice();f.length<c;){var l=
Math.floor(Math.random()*e.length);f.push(Object.assign({},e[l]));e.splice(l,1)}}a.BATTLE=f.slice();a.STATE()});Sa=!0;a.discord();a.target();h=0};this.ready=function(){Sa=!1;a.STATE()};this.play=function(){b.clear();a.nav(a.play);qa=!1;b.style=0};this.complete=function(){qa=!0;b.clear();a.STATE=function(){};a.nav(a.complete);var e="stage complete!";b.style=0;b.print(e,"0.5-"+2*Math.round(e.length/2),"0.3-1",2);b.style=0;N.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=
function(){a.results();x.replay()}):(a.STATE=function(){a.results()},x.REPLAY||(a.STATE=function(){},sa["export"](a.results)))},2E3);e=x.param().model+" ("+(x.param().power+1)+"/"+(x.param().drag+1)+"/"+(x.param().sensitivity+1)+"/"+(x.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:ja,time:x.AT(),penalty:x.PENALTY(),score:x.AT()+x.PENALTY(),seed:N.name,rating:Math.round(N.generate.DISTANCE/(x.AT()+x.PENALTY())),distance:N.generate.DISTANCE,vehicle:e})};this.results=
function(){a.STATE=function(){a.results()};b.clear();b.style=0;qa=!0;var e=0,c=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((c<Na||!1===Na)&&(Na=c),0<a.TIMELIST.length){for(var f=0;f<a.TIMELIST.length;f++)if(c<a.TIMELIST[f].time){e=f+1;break}0==e&&(e=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+N.name,"2","2");b.style=0;c=b.time(c);b.print(c,"2","5",2);f=x.overwrite(x.CHECKPOINT,N.best,!1);0!=e?b.print("rank "+e,2*c.length+"+3".toString(),"5+4p"):f?(f=Ga?"challenge victory!":
"new record!",b.style=1,b.print(f,2*c.length+"+3".toString(),"5+4p"),b.style=0):Ga&&b.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");c=9;f=x.CHECKPOINT;if(320<k){for(var l=1;l<f.length-1;l++){b.style=5;b.print("cp "+l,"2",c+"+"+l.toString());l;var z=f[l],K=a.split(l);b.print(K,"0.5+1",c+"+"+l.toString());"number"==typeof f[l]?(b.style=0,z=b.time(f[l])):(b.style=4,z="penalty",d="");b.print(z,"0.5 -1-"+z.length.toString(),c+"+"+l.toString());b.style=0;c+=1}c+=5}1===e&&(b.style=4,b.print("new record!",
"2",c.toString(),2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){qa=!1;uas.replay();a.replay()})};this.checkpoint=function(e){e=void 0===e?!1:e;b.clear();b.style=
0;a.nav(function(){a.checkpoint(e)});var c="";e?c+="missed checkpoint X "+Math.abs(x.CHECKPOINT[5]):c=this.split(x.OBJECTIVE);b.text(c,16,32);b.style=0};this.split=function(e){var c="",f=N.best[e]-x.CHECKPOINT[e],l=2,z="";return Number.isNaN(f)?void 0===x.CHECKPOINT[e]?(l=4,c+="- 100 sec"):void 0===N.best[e]&&0>N.best[5]?(l=1,c+="+ 100 sec"):void 0===N.best[e]&&(l=1,c+="new time!"):(0<f?(z="+ ",l=1):0>f?(z="- ",l=4):z="+ ",f=Math.abs(f),c+="( "+z+b.time(f)+" )"),b.style=l,c};this.battle=function(){var e=
new lb(sa.save(sa.tape),x.MODEL,x.PAINT);Y.push(e);a.reset()};this.replay=function(){if(!x.IMPORT&&!va&&(a.STATE=function(){a.replay()},b.clear(),ya?a.nav(function(){a.replay()}):a.nav(a.results),!0)){uas.AUTOPILOT?a.autopilot():a.drone();var e={};for(e.$jscomp$loop$prop$e$93$172=b.style=0;4>e.$jscomp$loop$prop$e$93$172;e={$jscomp$loop$prop$e$93$172:e.$jscomp$loop$prop$e$93$172},e.$jscomp$loop$prop$e$93$172++){var c="7+"+(4*e.$jscomp$loop$prop$e$93$172).toString(),f=e.$jscomp$loop$prop$e$93$172===
uas.CAM-1?48:40;b.button("",c+"-10p","1.0-4+4p","3","4",function(l){return function(){uas.CAM=l.$jscomp$loop$prop$e$93$172+1;a.STATE()}}(e),!1);b.sprite(f,64,8,8,c,"1.0-4",8,8)}b.style=0;e=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:ja;(uas.AUTOPILOT||uas.TARGETING)&&b.print(e,"2","1.0-7");b.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=
function(){b.style=0;b.style=0<uas.POV?4:2;b.sprite(72,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);ya||(b.style=2,b.print("<","2","2"),b.button("","2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){b.style=uas.TARGETING?4:2;b.sprite(64,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){b.clear();Sa=!0;
Ua=Za=Ga=!1;a.PATH=!1;custom_seed="";N.name="";a.BATTLE=[];Na=!1;window.history.pushState("","","/");za.clear();x.REPLAY=!1;x.RESET=!0;x.disconnect();for(var e=0;e<Y.length;e++)Y[e].disconnect();uas.reset(!0);Y=[];N.SNOW&&fa.remove(N.snow.mesh);N.reset();va=qa=!1;sa.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?",
"2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(e){e=void 0===e?"reset":e;Y.index=0;b.clear();a.nav(a.play);va=!0;qa=!1;x.reset(!1);for(var c=0;c<Y.length;c++)Y[c].reset();firebase.analytics().logEvent("stage_restart",{status:e})};this.hide=function(){var e=this;this.STATE=function(){e.hide()};style=1;b.clear();a.nav(S)};this.update=function(e){e=void 0===e?!1:e;qa||!va||Ma?!1!==e&&(b["delete"](16,16,g-64,16),b.text(b.time(e),16,16)):(b["delete"](16,16,g-64,16),b["delete"](16,
k-32,64,16),b.text(b.time(x.AT()),16,16),b.text(x.SPEED.toString(),16,k-32))};this.loading=function(){for(var e="";e.length<Math.floor(Va/500)%4;)e+=".";qa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+e,16,16),b.style=0);h++};this.scanning=function(){if(0===S.TIMELIST.length&&sa.SCAN&&!qa){b["delete"](16,72,88,8);for(var e="";e.length<Math.floor(Va/500)%4;)e+=".";b.style=5;b.text("scanning"+e,16,72)}};this.target=function(){b.clear();a.discord();a.STATE=function(){a.target()};a.nav(a.target);
var e,c,f=N.name;if(Sa||(b.style=2,b.print("stage generated.","2","2"),sa.SCAN?b.style=2:(b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){b.clear();N.SNOW&&fa.add(N.snow.mesh);a.STATE=function(){};N.generate.END=!1;a.play();x.SPECTATE=!1;va=!0;x.connect(N.start,N.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")}),a.discord(),b.style=1,0<a.BATTLE.length&&b.button("spectate!","1.0-14","1.0-18","12","3",function(){va=!1;N.generate.END=!1;N.SNOW&&fa.add(N.snow.mesh);
b.style=0;x.connect(N.start,N.surface);ya=!0;a["import"]();b.clear();fa.add(N.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),b.style=5,b.print(f,"2","5-1p",2),b.style=0,0!==a.TIMELIST.length||!sa.SCAN)if(0!==a.TIMELIST.length){var l=a.TIMELIST.slice();for(f=0;f<l.length;f++)for(var z=0;z<l.length;z++)l[f].time<=l[z].time&&l[f].utc<l[z].utc&&f>z&&(e={},Object.assign(e,l[f]),c={},Object.assign(c,l[z]),l[f]=c,l[z]=e);b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(l[0].time),
"2","12",2);b.style=5;e=(f=l.length<Aa)?l.length:Aa;f=f?0:l.length-Aa;for(c=0;c<e;c++)b.print(c+1+". "+l[c].name,"2","16+"+2*c),b.print(b.time(l[c].time),"18","16+"+2*c);0<f&&b.print("+ "+f+" more entries","2",2*e+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.displayResults=function(e){e=a.TIMELIST;b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(e[0].time),"2","12",2);b.style=5;var c=e.length<Aa+4,f=c?e.length:Aa+4;c=c?0:e.length-Aa+4;for(var l=0;l<f;l++)b.print(l+
1+". "+e[l].name,"2","16+"+2*l),b.print(b.time(e[l].time),"18","16+"+2*l);0<c&&b.print("+ "+c+" more entries","2",2*f+"+17")};this.setBattleName=function(){for(var e=0;e<a.BATTLE.length;e++)a.BATTLE[e].name=a.TIMELIST[e].name};this["import"]=function(){a.setBattleName();for(var e={$jscomp$loop$prop$i$103$174:0};e.$jscomp$loop$prop$i$103$174<a.BATTLE.length;e={$jscomp$loop$prop$i$103$174:e.$jscomp$loop$prop$i$103$174},e.$jscomp$loop$prop$i$103$174++)x.IMPORT=!0,sa["import"](N.name+"/"+a.BATTLE[e.$jscomp$loop$prop$i$103$174].uid,
function(c){return function(f){a.BATTLE[c.$jscomp$loop$prop$i$103$174].IMPORT_BUFFER=[];x.INPUTS=[];a.BATTLE[c.$jscomp$loop$prop$i$103$174].data=[];a.BATTLE[c.$jscomp$loop$prop$i$103$174].param={power:f.param.power,drag:f.param.drag,sensitivity:f.param.sensitivity,model:f.param.model,paint:f.param.paint};a.BATTLE[c.$jscomp$loop$prop$i$103$174].cp=f.cp;for(var l=0;l<f.debug.length;l++)f.debug[l].time,f.debug[l].position,f.debug[l].normal,f.debug[l].rotation,f.debug[l].U,f.debug[l].D,f.debug[l].L,f.debug[l].R,
a.BATTLE[c.$jscomp$loop$prop$i$103$174].data.push({U:f.debug[l].U,D:f.debug[l].D,L:f.debug[l].L,R:f.debug[l].R,time:f.debug[l].time});c.$jscomp$loop$prop$i$103$174===a.BATTLE.length-1&&x["import"]()}}(e))};this.uas=function(e){b.clear();b.style=0;a.STATE=function(){a.uas()};b.backdrop();b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2","1.0","4",function(){b.backdrop(!1);a.replay()},!1);b.style=0;b.print("spectator controls","2","2");b.print("pilot mode","2","6");b.style=2;b.print("arrow            pitch/yaw/roll",
"2","10");b.print("shift + arrow    roll/yaw modifier","2","12");b.print("space            power +","2","14");b.print("shift + space    power -","2","16");b.print("ctrl:            roll/yaw toggle","2","18");b.print("r                reset","2","20");b.print("t                targeting mode toggle","2","22");b.print("shift + arrow    change target (targeting)","2","24");b.style=0};this.timelist=function(){b.style=0};this.save=function(){var e=ja+"#"+x.MODEL+"#"+x.PAINT+"#"+x.param().power+x.param().drag+
+x.param().sensitivity+"#"+Date.now();e!==D&&(D=e,a.cSave("SAVE",D))};this.vehicle=function(e){a.STATE=function(){a.vehicle(e)};qa=!0;b.clear();a.title(function(){e();a.save()},function(){a.menu();sv()});x.REPLAY&&a.reset();var c=[],f=x.param();c.push({id:"power",value:f.power,funct:function(Q){x.tune.power(Q)}});c.push({id:"drag",value:f.drag,funct:function(Q){x.tune.drag(Q)}});c.push({id:"sensitivity",value:f.sensitivity,funct:function(Q){x.tune.sensitivity(Q)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",
1);b.print("model","2","8+");b.print(x.models()[x.MODEL].name,"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){x.MODEL+=1;1<x.MODEL&&(x.MODEL=0);x.body();a.vehicle(e)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--x.MODEL;0>x.MODEL&&(x.MODEL=1);x.body();a.vehicle(e)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(ub[x.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6",
"8+5++4p","4","4",function(){x.PAINT+=1;x.PAINT>Ja.length-1&&(x.PAINT=0);x.paint();a.vehicle(e)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--x.PAINT;0>x.PAINT&&(x.PAINT=Ja.length-1);x.paint();a.vehicle(e)},!1);for(f={$jscomp$loop$prop$t$105$176:0};f.$jscomp$loop$prop$t$105$176<c.length;f={$jscomp$loop$prop$t$105$176:f.$jscomp$loop$prop$t$105$176},f.$jscomp$loop$prop$t$105$176++){var l="8+5+5+"+(5*f.$jscomp$loop$prop$t$105$176).toString();b.print(c[f.$jscomp$loop$prop$t$105$176].id,"2",
l);b.sprite(0,0,1,1,"2",l+"+3","1.0-2-2",1);for(var z={$jscomp$loop$prop$e$106$178:0};6>z.$jscomp$loop$prop$e$106$178;z={$jscomp$loop$prop$e$106$178:z.$jscomp$loop$prop$e$106$178},z.$jscomp$loop$prop$e$106$178++){var K="1.0-18+"+(3*z.$jscomp$loop$prop$e$106$178).toString(),W=z.$jscomp$loop$prop$e$106$178<=c[f.$jscomp$loop$prop$t$105$176].value?48:40;b.button("",K+"-10p",l+"+4p","3","4",function(Q,t){return function(){c[Q.$jscomp$loop$prop$t$105$176].funct(t.$jscomp$loop$prop$e$106$178);a.vehicle(e)}}(f,
z),!1);b.sprite(W,64,8,8,K,l,8,8)}}};this.scan=function(e,c){};this.settings=function(e){a.STATE=function(){a.settings(e)};a.SETTINGS=!0;A=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+(bb?1:0)+"#";a.cSave("SETTINGS",A);b.clear();u||b.backdrop();a.title(e,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(e)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(c=Oa?"enabled":"disabled",b.print("display touch hitboxes",
"2","13"),b.print(c,"1.0-2-"+c.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("","2","13+4p","1.0-4","5",function(){Oa=!Oa;a.settings(e)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+Fa,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",function(){2>Fa&&(Fa+=.5);b.style=0;a.settings(e);Ia()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<
Fa&&(Fa-=.5);b.style=0;a.settings(e);Ia()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);b.print("camera mode","2","23");var c=x.FPV?"fpv":"tpv";b.print(c,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){x.FPV=!x.FPV;a.settings(e)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(e,c){a.STATE=function(){a.ghostConfig(e)};var f=bb?1:0;A=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+f;a.cSave("SETTINGS",A);b.clear();u||b.backdrop();
a.title(e,function(){a.settings(e)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name","2","8");b.print(ja,"1.0-13-"+ja.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(e)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");f=Da.toString();b.print(f,"1.0-13-"+f.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Da&&(Da+=1);a.ghostConfig(e)},!1);b.button("<","1.0-12","13+4p","4",
"4",function(){0<Da&&--Da;a.ghostConfig(e)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority","2","18");f=0===Ea?"best":"random";b.print(f,"1.0-13-"+f.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Ea+=1;1<Ea&&(Ea=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Ea;0>Ea&&(Ea=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2","23");f=Ya?"enabled":"disabled";b.print(f,"1.0-2-"+f.length,"23");b.button("","2","23+4p",
"1.0-4","4",function(){Ya=!Ya;for(var l=0;l<Y.length;l++)Y[l].toggleEmitter(Ya);a.ghostConfig(e)},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1)};this.controls=function(e){b.clear();a.title(e,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(e){b.clear();a.nav(function(){a.challenge()},
a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");b.style=0;b.print("> "+ja,"2","9");b.style=2;b.print("[edit]",ja.length+"+9","9");b.button("","2","9+4p",ja.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(N.name,"2","15");b.style=2;b.print("time","2","19");e=b.time(x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5]);b.style=5;b.print(e,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8",
"1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(e,c,f){c=void 0===c?!1:c;f=void 0===f?"enter display name:":f;a.STATE=function(){a.inputName(e,c,f)};b.clear();qa=!0;c?a.nav(function(){e()},a.menu):a.title(e);b.print(f,"2","2");b.textinput(ja,"2","4","1.0-2","6","operator_id");var l=document.getElementById("operator_id");b.button("accept",
"2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ja=vb(l.value.toLowerCase());!1===ma&&1<ja.length&&null!==ja?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,e,c);a.STATE=function(){}})["catch"](function(z){z.code;z.message}):!1!==ma&&1<ja.length&&null!==ja?a.submitName(ma,e,c):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(e,c,f)},1E3))},!0)};this.submitName=function(e,c,
f){f=void 0===f?!1:f;1<ja.length&&10>ja.length?firebase.database().ref("uid/"+e).set({name:ja},function(l){l?(b.clear(),l="PERMISSION_DENIED"===l.code?"invalid name":"network error",b.print(l,"2","2"),window.setTimeout(function(){a.inputName(c,f)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(c,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(c,f)},1E3))};this.encodeURL=function(){for(var e="",c=N.name,f=0;f<c.length;f++){var l=
c.charAt(f);l=" "===l?"-":l;e+=l}e=e+"/"+ma;window.history.pushState("","","/");c=window.location.href;var z="./#/"+e;navigator.clipboard.writeText("https://specialstage.io/#/"+e).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",z)},function(){window.history.pushState("","",z);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:c+"#/"+e})};this.decodeURL=function(){for(var e=window.location.href,c="",f=[],l=
!1,z=0,K=0;K<e.length;K++){var W=e.charAt(K);l?"/"===W?(Ga=!0,z++):(1===z&&(W="-"===W?" ":W,c+=W),1<z&&(f+=W)):"#"===W&&(l=!0,Ua=!0,z=0)}Ga&&0<f.length?(a.custom_seed=c,N.name=c,a.CHALLENGES={seed:c,uid:f}):Ua&&(a.custom_seed=c,N.name=c,Ga=!1);Ga&&firebase.analytics().logEvent("challenge_accepted",{url:e})};this.cSave=function(e,c){var f=new Date;f.setTime(f.getTime()+2808E7);f="expires="+f.toUTCString();document.cookie=e+"="+c+";"+f+";path=/"};this.cLoad=function(e){e+="=";for(var c=document.cookie.split(";"),
f=0;f<c.length;f++){for(var l=c[f];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(e))return l.substring(e.length,l.length)}return""};this.checksave=function(){var e=a.cLoad("SAVE");if(0!==e.length&&null!=e){for(var c=0,f="",l="",z="",K="",W=0,Q=0;Q<e.length;Q++){var t=e.charAt(Q);if("#"!==t)switch(W){case 1:c=parseInt(t);break;case 2:f+=t;break;case 3:l+=e.charAt(Q),z+=e.charAt(Q+1),K+=e.charAt(Q+2),Q+=2}else W++}x.MODEL=parseInt(c);x.PAINT=parseInt(f);x.paint();x.tune.power(parseInt(l));x.tune.drag(parseInt(z));
x.tune.sensitivity(parseInt(K))}else x.PAINT=0,x.paint();if(e=a.cLoad("SETTINGS"),0!==e.length&&null!=e){c=0;z=l=f="";for(K=0;K<e.length;K++)if(W=e.charAt(K),"#"!==W)switch(c){case 0:f+=W;break;case 1:Ea=parseInt(W);break;case 2:l=parseInt(W);break;case 3:z=parseInt(W)}else c++;Da=parseInt(f);Oa=0!==l;1===z&&(bb=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();S.nav();b.style=0;b.print("0.0.6.2","2","2");
b.sprite(0,88,47,8,"2","6-4p",188,32,2);b.sprite(49,88,40,8,"2","12-4p",160,32,2);b.sprite(1,0,255,16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4",
"2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");
b.print("www.specialstage.io","2","0.25",2);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.specialstage.io","4","0.25 + 9");window.setTimeout(a.music,2E3)};this.music=function(e){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome",
"2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty","2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};
this.plug=function(e){if("n"===e.key)switch(q){case 0:b.clear();window.setTimeout(a.promo,1E3);q++;break;case 1:window.setTimeout(a.biome,1E3);q++;x.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);q++;x.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);q++;x.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);q++;x.CAMERA=1;break;case 5:b.clear(),q=0}};this.url=function(){for(var e="";e.length<N.name.length;){var c=N.name.charAt(e.length);e+=" "===c?"-":c}return"specialstage.io/#/"+e};this.utc=
function(e){e=(new Date(e)).toLocaleString("en-GB",{timeZone:"UTC"});for(var c="",f=0;f<e.length;f++)","!==e.charAt(f)&&(c+=e.charAt(f));return c};this.stageIntro=function(){var e=this;this.STATE=function(){e.stageIntro()};b.clear();S.nav(this.STATE);var c=this.url();b.timeouts.push(window.setTimeout(function(){b.style=5;b.print(c,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event seed","2","7")},250));b.timeouts.push(window.setTimeout(function(){b.style=0;b.print(N.name,
"2","10",2)},500));b.timeouts.push(window.setTimeout(function(){S.BATTLE.length;b.style="2";b.print(N.generate.BIOMES[N.generate.BIOME].name+" biome","2","14");b.style="0"},1E3))};this.stageReplay=function(){var e=this;this.STATE=function(){e.stageReplay()};b.clear();S.nav(this.STATE);b.print(Y[uas.TARGET-1].name,"2","1.0-4")};this.stageResults=function(){jb=!0;this.STATE=function(){a.stageResults()};b.clear();S.nav(this.STATE);var e=a.url();b.timeouts.push(window.setTimeout(function(){b.style="5";
b.print(e,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event result","2","6")},500));b.timeouts.push(window.setTimeout(function(){b.style=0;b.print(S.BATTLE[0].name,"2","9",2)},750));b.timeouts.push(window.setTimeout(function(){b.style=1;b.print("stage rank 1","2+"+2*S.BATTLE[0].name.length+"+1","9+4p")},1E3));b.timeouts.push(window.setTimeout(function(){b.style=0;b.sprite(0,0,1,1,"2","13","1.0-4",1)},1250));var c=a.TIMELIST;b.style=5;var f=c.length<Aa+4,l=f?c.length:
Aa+4;f||(c.length,Aa);for(f={$jscomp$loop$prop$i$128$180:0};f.$jscomp$loop$prop$i$128$180<l;f={$jscomp$loop$prop$i$128$180:f.$jscomp$loop$prop$i$128$180},f.$jscomp$loop$prop$i$128$180++)b.timeouts.push(window.setTimeout(function(z){return function(){var K="16+"+3*z.$jscomp$loop$prop$i$128$180;b.print(z.$jscomp$loop$prop$i$128$180+1+". "+c[z.$jscomp$loop$prop$i$128$180].name,"2",K);var W=b.time(c[z.$jscomp$loop$prop$i$128$180].time);b.print(W,"1.0-2-"+W.length,K)}}(f),1500+250*f.$jscomp$loop$prop$i$128$180))};
this.stageEntries=function(){var e=this;kb=!0;this.STATE=function(){a.stageEntries()};b.clear();a.nav(this.STATE);b.style="5";b.print(this.url(),"2","2");b.style="5";for(var c=[],f=0;f<Y.length;f++)Y[f].hide();for(f=0;f<a.BATTLE.length;f++){var l;!(0<c.length)||a.BATTLE[f].utc>c[f-1].utc?c.push({name:a.BATTLE[f].name,utc:a.BATTLE[f].utc}):(l={name:c[f-1].name,utc:c[f-1].utc},c[f-1]={name:a.BATTLE[f].name,utc:a.BATTLE[f].utc},c.push(l))}var z=1<S.BATTLE.length?" entries":" entry";z=S.BATTLE.length+
z;b.timeouts.push(window.setTimeout(function(){b.style="0";b.print(N.name,"2","6");b.print(z,"1.0-2-"+z.length,"6")},1E3));b.timeouts.push(window.setTimeout(function(){b.sprite(0,0,1,1,"2","10","1.0-4",1)},1500));b.style=5;l=c.length<Aa+4;l?c.length:Aa;l||(c.length,Aa);x.reset(!0);for(l={$jscomp$loop$prop$e$131$183:0};l.$jscomp$loop$prop$e$131$183<c.length;l={$jscomp$loop$prop$e$131$183:l.$jscomp$loop$prop$e$131$183},l.$jscomp$loop$prop$e$131$183++)b.timeouts.push(window.setTimeout(function(K){return function(){b.style=
"5";b.print(c[K.$jscomp$loop$prop$e$131$183].name,"2","12+"+3*K.$jscomp$loop$prop$e$131$183);Y[K.$jscomp$loop$prop$e$131$183].show();0<K.$jscomp$loop$prop$e$131$183&&Y[K.$jscomp$loop$prop$e$131$183-1].hide();b.style="2";b.print(S.utc(c[K.$jscomp$loop$prop$e$131$183].utc),"1.0-21","12+"+3*K.$jscomp$loop$prop$e$131$183)}}(l),2E3+500*l.$jscomp$loop$prop$e$131$183)),l.$jscomp$loop$prop$e$131$183===S.BATTLE.length-1&&(b.timeouts.push(window.setTimeout(function(K){return function(){Y[K.$jscomp$loop$prop$e$131$183].hide()}}(l),
500*l.$jscomp$loop$prop$e$131$183+2500)),b.timeouts.push(window.setTimeout(function(){for(var K=0;K<Y.length;K++)Y[K].show();e.stageReplay();uas.CAM=1},500*l.$jscomp$loop$prop$e$131$183+3E3)))};this.mixplug=function(){b.clear();b.format(6,"#555");b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#7b1df5");ca.updateProjectionMatrix();b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.style=7;b.style=6;window.setTimeout(function(){b.style=6;b.print("mix","2","1.0-6")},2E3);for(var e={$jscomp$loop$prop$e$133$185:0};15>
e.$jscomp$loop$prop$e$133$185;e={$jscomp$loop$prop$e$133$185:e.$jscomp$loop$prop$e$133$185},e.$jscomp$loop$prop$e$133$185++)window.setTimeout(function(c){return function(){b.style=0;b.print("specialstage.io".charAt(c.$jscomp$loop$prop$e$133$185),"2+"+c.$jscomp$loop$prop$e$133$185,"2")}}(e),100*e.$jscomp$loop$prop$e$133$185);window.setTimeout(function(){b.sprite(0,88,88,8,"2","4",88,8)},1800);b.style=7;b.style=7;window.setTimeout(function(){b.style=7;b.print("low recordings","2","1.0-4")},2E3);b.style=
6;window.setTimeout(function(){b.style=6;b.print("(lo-fi house)","1.0-15","1.0-4")},2200);b.style=7;e=document.createElement("img");e.style.zIndex=98;e.style.position="fixed";e.style.top=0;e.style.left=0;e.src="./img/low_promo_4x.gif";e.style.setProperty("mix-blend-mode","lighten");document.body.appendChild(e)};this.tracklist=function(){b.clear();b.format(6,"#555");b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#DA4DFA");b.format(10,"#101010");b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,
8);b.style=3;b.style=4;b.style=1;b.style=0;b.print("specialstage.io","2","2");b.style=9;b.print("X low recordings feature mix","2","4");b.style=5;window.setTimeout(function(){b.style=6;b.print("featuring music by:","2","8")},600);var e=[];b.style=0;e.push(function(){b.print("> evade robots","2","12")});e.push(function(){b.print("> eli cash","2","14")});e.push(function(){b.print("> shaman","2","16")});e.push(function(){b.print("> heartwerk","2","18")});e.push(function(){b.print("> blo","2","20")});
e.push(function(){b.print("> urbanite","2","22")});e.push(function(){b.print("> rick wade","2","24")});e.push(function(){b.print("> orthographic figure","2","26")});e.push(function(){b.print("> hyas","2","28")});e.push(function(){b.print("> albin & noris","2","30")});b.style=7;for(var c={$jscomp$loop$prop$e$134$187:0};c.$jscomp$loop$prop$e$134$187<e.length;c={$jscomp$loop$prop$e$134$187:c.$jscomp$loop$prop$e$134$187},c.$jscomp$loop$prop$e$134$187++)window.setTimeout(function(f){return function(){b.style=
0;e[f.$jscomp$loop$prop$e$134$187]()}}(c),250*c.$jscomp$loop$prop$e$134$187+1E3)}}function wb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],g=0,k=!1,h=this.up.clone(),q=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,
1,0),value:0},yaw:{axis:new THREE.Vector3(0,0,1),value:0},pov:0,target:0,targeting:!1,autopilot:!0}},w=[],r=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},D=this.AUTOPILOT=!0,A=this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var u=this.CAM=1,e=this.POV=0;this.camera=[];this.camera[0]=q();this.camera[0].distance=
22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=q();this.camera[1].distance=24.5;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=.5708;this.camera[1].pitch.value=.485;this.camera[1].lerp=.1;this.camera[2]=q();this.camera[2].distance=34;this.camera[2].position.set(0,1,0);this.camera[2].yaw.value=3.512;this.camera[2].pitch.value=.79;this.camera[2].lerp=.1;this.camera[3]=q();this.camera[3].distance=34;this.camera[3].position.set(0,
1,0);this.camera[3].yaw.value=5.7916;this.camera[3].pitch.value=.5236;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=q();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].yaw.value=Math.PI;this.camera[4].pitch.value=1.32;this.camera[4].lerp=.075;w[0]=r();w[1]=r();w[2]=r();w[3]=r();w[4]=r();this.reset=function(c){if(void 0===c?0:c)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],ca.up.copy(h),c=0;c<this.camera.length;c++)this.camera[c].target=0;1<a.length?a[g].time=
0:(g=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var c=0;c<this.camera.length;c++)this.camera[c].target=
0,this.camera[c].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var c=0;c<this.camera.length;c++)this.camera[c].target=1,this.camera[c].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(c,f,l){c=void 0===c?new THREE.Vector3:c;f=void 0===f?new THREE.Vector3:f;l=void 0===l?new THREE.Vector3:l;var z=Ma||x.END?1E-5:.1;this.up.set(0,0,1);f=f.clone();f.multiplyScalar(-this.camera[0].distance+4*(b.scale-1));f.add(c);
f.z+=this.camera[0].position.z;a[g].position.lerp(f,z);a[g].lookAt.copy(l);a[g].up.set(0,0,1)};this.fpv=function(c,f,l,z){c=void 0===c?new THREE.Vector3:c;f=void 0===f?new THREE.Vector3:f;void 0===l&&new THREE.Vector3;z=void 0===z?new THREE.Vector3:z;a[g].position.copy(c);f=f.clone();f.add(c);a[g].lookAt.copy(f);z=z.clone();a[g].up.copy(z)};this.orbit=function(c,f,l){c=void 0===c?new THREE.Vector3:c;void 0===f&&new THREE.Vector3;l=void 0===l?new THREE.Vector3:l;G.SPACE;G.SHIFT;f=G.UP;var z=G.DOWN,
K=G.LEFT,W=G.RIGHT,Q=G.ZOOM_IN,t=G.ZOOM_OUT;c=c.clone();a[g].yaw=a[g-1].yaw;var B=this.camera[u].position.clone();this.camera[u].distance+=Q&&0<this.camera[u].distance?-.5:t&&100>this.camera[u].distance?.5:0;B.multiplyScalar(this.camera[u].distance);this.camera[u].yaw.value+=K?-.05:W?.05:0;this.camera[u].pitch.value+=f?.05:z?-.05:0;this.camera[u].pitch.value=0>this.camera[u].pitch.value?0:this.camera[u].pitch.value>Math.PI/2-.1?Math.PI/2-.1:this.camera[u].pitch.value;Q=this.camera[u].pitch.axis.clone();
Q.applyAxisAngle(h,this.camera[u].yaw.value);B.applyAxisAngle(h,this.camera[u].yaw.value);B.applyAxisAngle(Q,this.camera[u].pitch.value);c.add(B);z=k?1:K||W||f||z?.1:this.camera[u].lerp;a[g].position.lerp(c,z);a[g].lookAt.copy(l);a[g].up.set(0,0,1)};this.physics=function(c,f,l){if((void 0===c?0:c)>a[g].time){var z=f.position.clone(),K=f.direction.clone();c=f.lookAt.clone();f=f.normal.clone();l=((void 0!==l?l:z).clone(),{});Object.assign(l,a[g]);a=[];g=0;a.push(l);l={};Object.assign(l,a[g]);a.push(l);
g++;x.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(z,K,c):2===this.POV?this.fpv(z,K,c,f):this.orbit(z,K,c):this.pilot():x.FPV?this.fpv(z,K,c,f):this.pov(z,K,z);a[g].time+=Ka}};this.target=function(c){this.lookAt.copy(this.TARGETS[c].position)};this.update=function(c,f){c=void 0===c?0:c;f=void 0===f?this.TARGETS:f;this.CAM!==u?(k=!0,u=this.CAM,this.TARGET=this.camera[u].target,this.TARGETING=this.camera[u].targeting,this.AUTOPILOT=this.camera[u].autopilot,this.POV=this.camera[u].pov,D=this.AUTOPILOT,
D?(a[g].position.copy(this.camera[u].position),a[g].position.add(f[this.TARGET].position),a[g].up.copy(this.camera[u].up),k=!0):(a[g].position.copy(w[u].position),a[g].lookAt.copy(w[u].lookAt),a[g].up.copy(w[u].up),a[g].velocity.copy(w[u].velocity),a[g].pitch.axis.copy(w[u].pitch.axis),a[g].roll.axis.copy(w[u].roll.axis),a[g].yaw.axis.copy(w[u].yaw.axis),a[g].pitch.value=w[u].pitch.value,a[g].roll.value=w[u].roll.value,a[g].yaw.value=w[u].yaw.value,a[g].speed=w[u].speed),S.STATE()):(this.camera[u].target=
this.TARGET,this.camera[u].pov=this.POV,this.camera[u].targeting=this.TARGETING,this.camera[u].autopilot=this.AUTOPILOT);this.AUTOPILOT!==D&&(D=this.AUTOPILOT,this.AUTOPILOT?(a[g].position.copy(this.camera[u].position),a[g].up.copy(this.camera[u].up)):a[g].speed=0);this.POV!==e&&(S.STATE(),e=this.POV,uas.camera[uas.CAM].pov=e);this.TARGET!==A&&(A=this.TARGET,uas.camera[uas.CAM].target=A);this.physics(c,f[va?0:this.camera[u].target]);Ka;a[g].time;Ka;1<a.length&&(this.position.copy(a[g].position),this.direction.copy(a[g].direction),
this.up.copy(a[g].up),this.lookAt.copy(a[g].lookAt),ca.position.copy(this.position),ca.up.set(this.up.x,this.up.y,this.up.z),ca.lookAt(this.lookAt));k=!1};this.pilot=function(){var c=a[g],f=G.SPACE,l=G.SHIFT,z=G.UP,K=G.DOWN,W=G.LEFT,Q=G.RIGHT;G.TARGET&&(this.TARGETING=!this.TARGETING,G.TARGET=!1,S.replay());c.pitch.value+=z?-c.pitch.power:K?+c.pitch.power:0;l&&!this.TARGETING?c.roll.value+=W?-c.roll.power:Q?c.roll.power:0:(c.yaw.value+=W?c.yaw.power:Q?-c.yaw.power:0,c.yaw.value*=c.yaw.drag);c.pitch.value*=
c.pitch.drag;c.roll.value*=c.roll.drag;c.yaw.value*=c.yaw.drag;c.pitch.axis.applyAxisAngle(c.roll.axis,c.roll.value);c.pitch.axis.applyAxisAngle(c.yaw.axis,c.yaw.value);c.roll.axis.applyAxisAngle(c.pitch.axis,c.pitch.value);c.roll.axis.applyAxisAngle(c.yaw.axis,c.yaw.value);c.yaw.axis.applyAxisAngle(c.pitch.axis,c.pitch.value);c.yaw.axis.applyAxisAngle(c.roll.axis,c.roll.value);l&&f&&-1<c.speed?c.speed-=.0025:f&&1>c.speed&&(c.speed+=.0025);c.velocity.copy(c.roll.axis);c.velocity.multiplyScalar(c.speed);
c.position.add(c.velocity);this.TARGETING?(W&&l&&0<this.TARGET&&(--this.TARGET,S.replay(),G.LEFT=!1),Q&&l&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,S.replay(),G.RIGHT=!1),this.up.set(0,0,1),k?c.lookAt.copy(this.TARGETS[this.TARGET].position):c.lookAt.lerp(this.TARGETS[this.TARGET].position,.05)):(c.up.copy(c.yaw.axis),c.lookAt.copy(c.roll.axis),c.lookAt.add(c.position));w[u].position.copy(c.position);w[u].lookAt.copy(c.lookAt);w[u].velocity.copy(c.velocity);w[u].up.copy(c.up);w[u].pitch.axis.copy(c.pitch.axis);
w[u].roll.axis.copy(c.roll.axis);w[u].yaw.axis.copy(c.yaw.axis);w[u].pitch.value=c.pitch.value;w[u].roll.value=c.roll.value;w[u].yaw.value=c.yaw.value;w[u].speed=c.speed};this.autocam=function(){};this.debug=function(){console.log("Vehicle Timestamp:",x.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt)}}function xb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var g=this.renderer.getContext("2d");this.context=
g;var k=document.createElement("img");k.src="./img/stage.font.0.0.6.png";k.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var h=document.createElement("canvas"),q=h.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var w=128,r=180,D=128,A=80,u;var e=128;var c=r;var f=128;var l=80;var z=!(u={x:128,y:r+60,w:128,h:40}),K=[],W=[],Q=[];this.timeouts=[];this.connect=function(){g.imageSmoothingEnabled=!1;a.format(0,
"#ffffff")};this.format=function(t,B){t=void 0===t?0:t;B=void 0===B?"#ffffff":B;void 0===h[t]&&(h[t]=document.createElement("canvas"),q[t]=h[t].getContext("2d"));q[t].drawImage(k,0,0,128,128,0,0,128,128);q[t].globalCompositeOperation="source-atop";q[t].fillStyle=B;q[t].fillRect(0,0,128,128);q[t].globalCompositeOperation="source-out"};this.resize=function(t,B,I,J){J=void 0===J?1:J;a.scale=I*J;var O=window.devicePixelRatio,ia=300>Math.ceil(O)/O*t?Math.floor(O):Math.ceil(O);0!=ia-O&&(I=ia/O*J);1>=O&&
1<a.scale&&(I=a.scale);this.width=t/I;this.height=B/I;this.renderer.width=this.width;this.renderer.height=this.height;za.setSize(this.width,this.height);a.scale=I;this.renderer.style.transform="scale("+I+","+I+")";za.domElement.style.transform="scale("+I+","+I+")";this.renderer.style.transformOrigin="top left";za.domElement.style.transformOrigin="top left";g.imageSmoothingEnabled=!1;this.redraw();w=128;r=180;D=128;A=80;e=128;c=r;f=128;l=80;u={x:128,y:r+60,w:128,h:40};this.automate(this.width,this.height)};
this.update=function(t){var B=0,I;for(I in t)for(var J in Q)if(t[I].x>Q[J].x*a.scale&&t[I].y>Q[J].y*a.scale&&t[I].x<Q[J].w*a.scale&&t[I].y<Q[J].h*a.scale&&(B++,1==t[I].start)){Q[J].funct();t[I].start=!1;break}};this.print=function(t,B,I,J){J=void 0===J?1:J;for(var O=0,ia=a.compile(B,a.width,a.col),U=a.compile(I,a.height,a.row),T=a.style;O<t.length;)a.encode(t.charAt(O),ia+O*a.col*J,U,J),O++;z||K.push(function(){a.style=T;a.print(t,B,I,J)})};this.text=function(t,B,I,J,O){J=void 0===J?1:J;for(O=0;O<
t.length;)a.encode(t.charAt(O),B+O*a.col*J,I,J),O++};this.button=function(t,B,I,J,O,ia,U,T){U=void 0===U?!0:U;T=void 0===T?1:T;var aa=a.compile(B,a.width,a.col),la=a.compile(I,a.height,a.row),ka=a.compile(J,a.width,a.col),oa=a.compile(O,a.height,a.row),da=a.style;U&&(g.drawImage(h[a.style],0,0,1,1,aa,la+oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,aa,la-oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,aa,la-oa/2,1,oa),g.drawImage(h[a.style],0,0,1,1,aa+ka-1,la-oa/2,1,oa+1));for(var ea=0;ea<t.length;)a.encode(t.charAt(ea),
aa+ea*a.col+ka/2-Math.round(t.length*a.col)/2+2,la-a.row/2,T),ea++;Q.push({x:aa,y:la-oa/2,w:aa+ka,h:la+oa/2,funct:function(){ia()}});z||K.push(function(){a.style=da;a.button(t,B,I,J,O,ia,U,T)})};this.line=function(t,B,I,J){a.sprite(0,0,1,1,t,B,I,J)};this.sprite=function(t,B,I,J,O,ia,U,T){var aa=a.compile(O,a.width,a.col),la=a.compile(ia,a.height,a.row),ka=a.compile(U,a.width,a.col),oa=a.compile(T,a.height,a.row),da=a.style;g.drawImage(h[a.style],t,B,I,J,aa,la,ka,oa);z||K.push(function(){a.style=da;
a.sprite(t,B,I,J,O,ia,U,T)})};this.backdrop=function(t,B,I,J,O){t=void 0===t?"#10101099":t;!1===t?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=t)};this.getDrawList=function(){return K};this.redraw=function(){z=!0;a.clear();for(var t=0;t<K.length;t++)K[t]();t=document.body.getElementsByTagName("input");for(var B=0;B<t.length;B++)a.text(t[B].value,t[B].style.top,t[B].style.left);z=!1};this.automate=function(t,B){t=Math.floor(t/3)-2;B=Math.floor(B/4);D>
t&&(D=t,w=t,f=t,e=t,u.w=t,u.x=t);r>B&&(r=B+40,c=r,u.y=r+60)};this.pad=function(t,B,I,J,O,ia,U){var T=0;for(U();T<G.touches.length;)G.touches[T].x>B*a.scale&&G.touches[T].y>I*a.scale&&G.touches[T].x<(B+J)*a.scale&&G.touches[T].y<(I+O)*a.scale&&ia(),T++;Oa&&(g.drawImage(h[a.style],0,0,1,1,B+1,I,J-1,1),g.drawImage(h[a.style],0,0,1,1,B+1,I+O,J-1,1),g.drawImage(h[a.style],0,0,1,1,B+1,I,1,O),g.drawImage(h[a.style],0,0,1,1,B+J-1,I,1,O));a.encode(t,B+J/2-a.col/2,I+O/2-a.row/2)};this.dpad=function(){g.drawImage(h[a.style],
88,88,40,40,a.width-e+f/2-20,a.height-c+l/2-20,40,40);a.pad("<",w-D-1,a.height-r,D,A,function(){G.LEFT=!0},function(){G.LEFT=!1});a.pad(">",w+1,a.height-r,D,A,function(){G.RIGHT=!0},function(){G.RIGHT=!1});a.pad("^",a.width-e,a.height-c,f,l,function(){G.UP=!0},function(){G.UP=!1});a.pad("b",a.width-u.x,a.height-u.y+u.h/2,u.w,u.h,function(){G.DOWN=!0},function(){G.DOWN=!1})};this.clear=function(){if(!z){for(var t=document.body.getElementsByTagName("input"),B=0;B<t.length;B++)document.body.removeChild(t[B]);
if(!a.REDRAW){K=[];for(t=0;t<W.length;t++)document.body.removeChild(W[t]);W=[]}K=[];for(t=0;t<this.timeouts.length;t++)window.clearTimeout(this.timeouts[t])}Q=[];g.clearRect(0,0,a.width,a.height)};this["delete"]=function(t,B,I,J){B=void 0===B?0:B;I=void 0===I?za.width:I;J=void 0===J?za.height:J;t=a.compile(void 0===t?0:t,a.width,a.col);B=a.compile(B,a.height,a.row);I=a.compile(I,a.width,a.col);J=a.compile(J,a.height,a.row);g.clearRect(t,B,I,J)};this.encode=function(t,B,I,J){J=void 0===J?1:J;var O=
t.charCodeAt(0);t=8*O%128;O=8*Math.floor(O/16);g.clearRect(B,I,8,8);g.drawImage(h[a.style],t,O,8,8,B,I,8*J,8*J)};this["float"]=function(t,B){var I=Math.floor(Math.abs(100*t));I=I.toString();var J=I.slice(0,I.length-2),O=I.slice(I.length-2,I.length);return 0==t?"0.00":(0==J.length&&(J="0"),2>O.length&&(O+="0"),B&&0<t?J="+"+J:0>t&&(J="-"+J),I=J+"."+O,I)};this.compile=function(t,B,I){var J=0;switch(B=Math.floor(B),typeof t){case "number":J=t;break;case "function":J=t();break;case "string":for(var O=
!1,ia=1,U=0,T="";U<t.length;){var aa=t.charAt(U);"."===aa?(T+=aa,O=!0):"+"===aa?(T=O?Number(T)*B:Number(T)*I,T*=ia,ia=1,J+=T,O=!1,T=""):"-"===aa?(T=O?Number(T)*B:Number(T)*I,T*=ia,ia=-1,J+=T,O=!1,T=""):"p"===aa?(T=Number(T),T*=ia,J+=T,T=""):U===t.length-1?(T+=aa,T=O?Number(T)*B:Number(T)*I,T*=ia,J+=T,T=""):T+=aa;U++}}return J};this.textinput=function(t,B,I,J,O,ia,U){var T=a.compile(B,a.width,a.col),aa=a.compile(I,a.height,a.row),la=a.compile(J,a.width,a.col),ka=a.compile(O,a.height,a.row),oa=a.style;
if(z)a.text("> "+U.value,T,aa+ka/2);else{(U=document.createElement("input")).type="text";U.id=ia;U.name=ia;U.value=t;U.style.position="fixed";U.style.top=aa+"px";U.style.left=T+"px";U.style.width=la+"px";U.style.height=ka+"px";U.style.paddingLeft="12px";U.style.fontSize="14px";U.style.zIndex=9999;U.style.opacity=0;U.maxlength=10;a.text("> "+U.value,T,aa+ka/2);document.body.appendChild(U);window.setTimeout(function(){U.focus();U.select()},200);U.oninput=function(){da()};U.onfocusout=function(){da()};
U.onfocusin=function(){da()};U.onclick=function(){da()};var da=function(ea){a["delete"](T,aa,la,ka);a.text("> "+U.value,T,aa+ka/2);a.text("_",U.selectionStart*a.col+2*a.col+T,aa+ka/2)};K.push(function(){a.style=oa;a.textinput(U.value,B,I,J,O,ia,U)})}};this.link=function(t,B,I,J,O,ia,U,T){var aa=a.compile(B,a.width,a.col)*a.scale,la=a.compile(I,a.height,a.row)*a.scale,ka=a.compile(J,a.width,a.col)*a.scale,oa=a.compile(O,a.height,a.row)*a.scale,da=a.style;z||K.push(function(){return new function(){a.style=
da;ea.style.left=aa+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";a.print(t,aa,la)}});var ea=document.createElement("a");ea.href=ia;ea.style.left=aa+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";ea.style.display="block";ea.style.zIndex=999;ea.style.position="fixed";ea.target="_blank";ea.id=ia;document.body.appendChild(ea);W.push(ea);z=!0;a.print(t,aa,la);z=!1};this.time=function(t){return(t/100).toFixed(2)};this.typewrite=function(t){a.clear();
for(var B={$jscomp$loop$prop$e$147$189:0};B.$jscomp$loop$prop$e$147$189<t.length;B={$jscomp$loop$prop$e$147$189:B.$jscomp$loop$prop$e$147$189},B.$jscomp$loop$prop$e$147$189++){var I=(B.$jscomp$loop$prop$e$147$189,0);I=Math.floor(B.$jscomp$loop$prop$e$147$189%32);var J=Math.floor(B.$jscomp$loop$prop$e$147$189/32);I=32+I%32*8;J=32+16*J;window.setTimeout(function(O){return function(){b.text(t.charAt(O.$jscomp$loop$prop$e$147$189),I,J)}}(B),50*B.$jscomp$loop$prop$e$147$189)}}}function yb(){var a=this;
this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return l};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=
!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var g=[],k=0;this.TIMESTEP=Ka;var h=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var q=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),w=!1,r=!1,D=!1,A=!1,u=!0,e=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var c=0,f=0,l=0,z=0,K=!1,W=!1,Q=0,t=0;this.DT=function(){return 1};var B={power:2,drag:0,
mass:1,brake:2,sensitivity:2,ease:0},I=0,J=0,O=0;I=.004;J=.985-.98;O=.08-.06;var ia,U,T,aa=6,la,ka=0,oa=0,da=0,ea=new THREE.Vector3(0,1,0),Pa=new THREE.Vector3(0,0,0),Qa=new THREE.Vector3,p=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var n=new THREE.Vector3(0,0,1),m=new THREE.Vector3(0,0,1),E=new THREE.Vector3(0,0,1),C=new THREE.Vector3(0,0,1),y=new THREE.Vector3(0,0,-.008),R=new THREE.Vector3,F=new THREE.Vector3,M=new THREE.Vector3,L=new THREE.Vector3;this.position=R.clone();this.direction=
ea.clone();this.lookAt=R.clone();this.normal=m.clone();this.rotation=0;var P=[],V=new THREE.Vector3(0,0,1),X=new THREE.Raycaster(L,V,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,
z:60,lerp:.0075,lookAt:new THREE.Vector3};var ta=[{name:"logistics crate",geometry:function(){return Ta.logistics_crate()}},{name:"ag-86",geometry:function(){return Ta.ag_86()}}];this.models=function(){return ta};this.PAINT=0;var Ca=new THREE.MeshBasicMaterial({color:Ja[a.PAINT]}),pa=(new THREE.LineSegments(ta[a.MODEL].geometry(),Ca)).clone();pa.name="Vehicle";var Xa=new Ta.emitter;this.connect=function(H,Z){pa.copy(new THREE.LineSegments(ta[a.MODEL].geometry(),Ca));pa.name="Vehicle";pa.geometry.computeBoundingSphere();
M.copy(H);M.z+=2;pa.position.copy(M);fa.add(pa);Xa.connect(Ja[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();fa.fog=new THREE.FogExp2(ba[0],.005);ca.fov=90;ca.updateProjectionMatrix();fa.add(N.generate.stars);a.START_POSITION.copy(M);a.START_NORMAL.copy(m);a.START_DIRECTION.copy(ea);a.START_VELOCITY.copy(Qa);uas.TARGETS.length<Y.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=
!1;a.reset(!1);fa.remove(pa);Xa.disconnect();fa.fog=new THREE.FogExp2(ba[0],0);fa.remove(N.generate.stars);this.DISCONNECT=!1};this.ready=function(H){H=void 0===H?window.performance.now():H;var Z;!w&&!this.REPLAY||this.RESET||(N.generate.checkpoints[0].display.material.color=ba[4],uas.reset(),t=1,K=!1,W=!1,u=!0,na.reset(),z=H,c=0,k=0,this.FRAME=0,g[k].time=0,g=[],g.length=0,k=0,g.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),
rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],Z={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),lookAt:C.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(Z),a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,Z={},Object.assign(Z,g[k]),a.PHYSICSBUFFER.push(Z),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(H){H=void 0===H?!1:H;
a.REPLAY=H;a.RESET=!0;va=!H;pa.visible=!0;ya&&(pa.visible=!1);this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;e=Ma=this.END=this.START=!1;G.UP=!1;G.DOWN=!1;G.LEFT=!1;A=D=r=w=G.RIGHT=!1;t=l=Q=0;R.copy(a.START_POSITION);F.copy(R);ea.copy(a.START_DIRECTION);Qa.copy(a.START_VELOCITY);m.copy(a.START_NORMAL);L.copy(R);this.position=R.clone();this.direction=ea.clone();this.lookAt=R.clone();this.normal=m.clone();la=da=ka=oa=this.rotation=0;a.SPEED=0;V.copy(a.START_NORMAL);V.normalize();X.far=V.length();X.set(a.START_POSITION,
V);E.copy(a.START_NORMAL);C.copy(a.START_NORMAL);C.add(a.START_POSITION);ca.updateProjectionMatrix();e=!0;Xa.reset();na.reset();uas.reset();g=[];z=k=0;this.IMPORT||(z=window.performance.now());for(H=0;H<N.generate.checkpoints.length;H++)N.generate.checkpoints[H].display.material.color=ba[5];if(g[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY)for(this.DEBUG_BUFFER=
[],c=0,this.IMPORT||(a.best=a.overwrite(a.CHECKPOINT,a.best)),N.best=a.overwrite(a.CHECKPOINT,N.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,a.inputs=[],a.inputs.push({key:0,time:0}),a.PHYSICSBUFFER=[],H={},Object.assign(H,g[k]),a.PHYSICSBUFFER.push(H),H=0;H<Y.length;H++)Y[H].reset();this.VALIDATE_CHECKPOINT=[];this.VALIDATE_CHECKPOINT.length=6;q.position.copy(a.START_POSITION);q.lookAt(C);pa.lookAt(C);q.rotateOnAxis(n,0);W=K=!1;u=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(H){H=
void 0===H?window.performance.now():H;Ma||a.END||!e||a.REPLAY||a.RESET?(w=!1,r=!1,D=!1,A=!1):(w=G.UP,r=G.DOWN,D=G.LEFT,A=G.RIGHT,D&&A&&(D=!1,A=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?H+99999-z:H-z;H=0;if(this.TIMESTAMP>g[k].time){var Z={};Object.assign(Z,g[k]);var ha=Z.time;g=[];k=0;for(g.push({time:ha,position:Z.position.clone(),normal:Z.normal.clone(),direction:Z.direction.clone(),velocity:Z.velocity.clone(),rotation:Z.rotation,step:Z.step,U:Z.U,D:Z.D,L:Z.L,R:Z.R});ha<this.TIMESTAMP;){var ra;
ha+=Ka;this.REPLAY&&this.START&&(H=this.tapeReplay(ha));g.push({time:ha,position:g[k].position.clone(),normal:g[k].normal.clone(),direction:g[k].direction.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,step:g[k].step,U:w,D:r,L:D,R:A});k=g.length-1;a.START&&(Ha=wa=void 0,Ha=D&&A?0:D?1:A?-1:0,da=g[k].step,0!=Ha&&Math.abs(da)<aa?da+=Ha:Math.abs(da)>aa?(wa=da/Math.abs(da),da=aa*wa):0<Math.abs(da)&&(wa=da/Math.abs(da),da-=da/Math.abs(da),da/Math.abs(da)!=wa&&(da=0)),ka=da/aa*T,g[k].rotation+=
ka,g[k].step=da,la=g[k].velocity.length(),wa=void 0,w&&u&&(Pa.copy(g[k].direction),Pa.multiplyScalar(ia),g[k].velocity.add(Pa)),r&&u&&g[k].velocity.multiplyScalar(.95),u?(W=!1,wa=K?U-.01:U,g[k].velocity.multiplyScalar(wa)):u||(W?g[k].velocity.add(y):W=!0,g[k].velocity.multiplyScalar(.998)),g[k].position.add(g[k].velocity),q.position.copy(g[k].position),function(){P=[];L.copy(g[k].position);L.z-=50;V.set(0,0,1);X.far=100;X.set(L,V);N.surface.raycast(X,P);0<P.length?(L.copy(P[0].point),K=g[k].position.z<
L.z&&5>Math.abs(g[k].position.z-L.z)?(f=0,u=!0,m.copy(P[0].face.normal),g[k].position.copy(L),1!==P[0].face.color.r):u=!1):0===P.length&&(u=!1,K=!1,w||r||D||A||a.REPLAY||(f+=Ka),1E3<f&&!a.END&&!Ma&&(Ma=!0,S.dnf()));var ua=W?.001:.25;E.copy(g[k].normal);E.lerp(m,ua);ua=E.clone();ua.add(g[k].position);g[k].normal=E.clone();q.lookAt(ua);q.rotateOnAxis(n,g[k].rotation);ea.copy(q.localToWorld(p.clone()));ea.sub(g[k].position);ea.normalize();g[k].direction.copy(ea)}(),function(){P=[];V.copy(g[k].position);
V.sub(g[k-1].position);V.normalize();X.far=V.length();X.set(g[k].position,V);for(var ua=0,xa=!1,Ba=t;5>Ba;Ba++)if(N.generate.checkpoints[Ba].collision.raycast(X,P),0<P.length){ua=Ba;xa=!0;break}if(xa){Ba=g[k].position;xa=P[0].point;var La=g[k-1].position.distanceTo(xa);xa=Ba.distanceTo(xa);xa=g[k-1].time+La/(La+xa)*a.TIMESTEP;N.generate.checkpoints[ua].display.material.color=ba[4];a.CHECKPOINT[ua]=Math.floor(xa/10);xa=t!==ua;a.CHECKPOINT[5]=0;for(Ba=1;Ba<ua;Ba++)void 0===a.CHECKPOINT[Ba]&&--a.CHECKPOINT[5];
t=ua+1;4<=ua&&!a.REPLAY?(a.END=!0,a.REPLAY||S.complete()):a.REPLAY||a.IMPORT||S.checkpoint(xa)}a.SPEED=Math.round(60*la/1E3*3600);a.START&&!a.END&&(c=Math.floor(g[k].time/10));a.OBJECTIVE=t;F.copy(R)}());this.FRAME++;this.START&&!this.REPLAY?(ra={},Object.assign(ra,g[k]),this.PHYSICSBUFFER.push(ra)):this.REPLAY&&H<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(ra={time:g[k].time,position:g[k].position.clone(),direction:g[k].direction.clone(),normal:g[k].normal.clone(),velocity:g[k].velocity.clone(),
rotation:g[k].rotation,U:g[k].U,D:g[k].D,L:g[k].L,R:g[k].R,step:g[k].step,lookAt:C.clone()},a.DEBUG_BUFFER.push(ra));!this.IMPORT&&5E3<this.TIMESTAMP-ha&&x.reset(this.REPLAY)}}var wa,Ha;if(h=(Ka-(g[k].time-this.TIMESTAMP))/Ka,1<g.length)this.position.copy(g[k-1].position),this.position.lerp(g[k].position,h),this.direction.copy(g[k-1].direction),this.direction.lerp(g[k].direction,h),this.rotation=g[k].rotation,this.rotation-=g[k-1].rotation,this.rotation*=h,this.rotation+=g[k].rotation,this.lookAt.copy(this.position),
this.normal.copy(g[k-1].normal),this.normal.lerp(g[k].normal,h),this.lookAt.copy(g[k].position),this.normal.copy(g[k].normal),ra=this.normal.clone(),ra.add(this.position),pa.position.copy(this.position),pa.lookAt(ra),pa.rotateOnAxis(n,this.rotation),Xa.update(w,this.position,this.direction,la);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:Q,yen:0}};this.AT=function(){return c};this.convert=function(H){for(var Z=[],ha=0;ha<
H.length;ha++){var ra=H[ha].U,wa=H[ha].D,Ha=H[ha].L,ua=H[ha].R,xa=ra&&wa&&Ha,Ba=ra&&wa&&ua,La=0;xa||Ba?xa?La="a":Ba&&(La="b"):(La+=ra?3:wa?6:0,La+=Ha?1:ua?2:0);Z.push(La.toString())}return Z};this.replay=function(H){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),va=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(H,Z){void 0===H||H?(a.SAVE_PARAM.power=Z.power,a.SAVE_PARAM.drag=Z.drag,a.SAVE_PARAM.sensitivity=Z.sensitivity,a.SAVE_PARAM.model=
Z.model,a.SAVE_PARAM.paint=Z.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var H=Y.length+" / "+S.BATTLE.length;0===Y.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);Y.length<S.BATTLE.length?(S.scan(H,
!1),this.reset(),a.PAINT=S.BATTLE[Y.length].param.paint,a.MODEL=S.BATTLE[Y.length].param.model,a.paint(),a.body(),a.tune.power(S.BATTLE[Y.length].param.power),a.tune.drag(S.BATTLE[Y.length].param.drag),a.tune.sensitivity(S.BATTLE[Y.length].param.sensitivity),a.INPUTS=S.BATTLE[Y.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(g[k].time=0,this.IMPORT=!1,ya?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),S.replay("import"),this.INPUTS=
[]):(this.reset(!1),S.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(H){H=void 0===H?B.power:H;B.power=0>H?0:5<H?5:H;ia=.016+B.power/5*I},drag:function(H){H=void 0===H?B.drag:H;B.drag=0>H?0:5<H?5:H;U=.985-B.drag/5*J},sensitivity:function(H){H=void 0===H?B.sensitivity:H;B.sensitivity=0>H?0:5<H?5:H;T=.06+B.sensitivity/5*O},ease:function(H){H=
void 0===H?B.ease:H;B.ease=0>H?0:5<H?5:H;aa=6+B.ease}};this.param=function(){return array=Object.assign(B,[]),array.model=a.MODEL,array.paint=a.PAINT,array};this.paint=function(H){H=void 0===H?a.PAINT:H;a.PAINT=H;Xa.paint(Ja[H]);Ca.color.set(Ja[H]);Ca.needsUpdate=!0};this.body=function(){pa.geometry.dispose();pa.geometry=ta[a.MODEL].geometry().clone();pa.geometry.verticesNeedUpdate=!0};this.yen=function(){return S.cSave("YEN",0),0};this.debug=function(){console.log("position:",R);console.log("direction:",
ea);console.log("rotation:",oa);console.log("dt:",1);console.log("TIME:",Va);console.log("INTERPOLATION:",h);console.log("PHYSICS MESH:",q.rotation);console.log("EASE",aa);console.log(g);console.log(f);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",g[k]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(H){var Z=0;if(0==a.INPUTS.length)Z=0;else if(H<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[Z].time<
H;)Z++;w=this.INPUTS[Z].U;r=this.INPUTS[Z].D;D=this.INPUTS[Z].L;A=this.INPUTS[Z].R}else if(this.IMPORT){H=!0;for(var ha="",ra=1;ra<this.CHECKPOINT.length;ra++)this.CHECKPOINT[ra]!==S.BATTLE[Y.length].cp[ra]&&(""===ha&&(ha+="checkpoint_discrepancy"),H=!1);if(a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==S.BATTLE[Y.length].time&&(H=!1,ha+="final_time_discrepancy"),H){H=[];for(ha=0;ha<this.DEBUG_BUFFER.length;ha++)H.push({time:this.DEBUG_BUFFER[ha].time,position:this.DEBUG_BUFFER[ha].position.clone(),direction:this.DEBUG_BUFFER[ha].direction.clone(),
rotation:this.DEBUG_BUFFER[ha].rotation,normal:this.DEBUG_BUFFER[ha].normal.clone(),lookAt:this.DEBUG_BUFFER[ha].lookAt.clone(),U:this.DEBUG_BUFFER[ha].U});Y.push(new lb(H,this.MODEL,this.PAINT,this.CHECKPOINT.slice(),S.BATTLE[Y.length].name))}else firebase.analytics().logEvent("invalid_data",{seed:N.name,uid:S.BATTLE[Y.length].uid,name:S.BATTLE[Y.length].name,report:N.name+"/"+S.BATTLE[Y.length].uid+"("+S.BATTLE[Y.length].name+")"+ha+" : "+ma+"/("+ja+")",error:ha}),S.BATTLE.splice(Y.length,1);this["import"]()}else a.replay(!1),
this.START=this.IMPORT=!1;return Z};this.overwrite=function(H,Z,ha){ha=void 0===ha?!0:ha;var ra=H[4]<Z[4],wa=H[5]>=Z[5],Ha=H[5]>Z[5];return void 0===Z[4]||ra&&wa||Ha?!ha||H:!!ha&&Z};this.decode=function(H){var Z=[function(){G.UP=!1;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!1;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!0},function(){G.UP=!0;G.DOWN=!1;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!0;G.DOWN=!1;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!0;G.DOWN=!1;G.LEFT=
!1;G.RIGHT=!0},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!0;G.RIGHT=!1},function(){G.UP=!1;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!0},function(){G.UP=!0;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!1}];Z.a=function(){G.UP=!0;G.DOWN=!0;G.LEFT=!0;G.RIGHT=!1};Z.b=function(){G.UP=!0;G.DOWN=!0;G.LEFT=!1;G.RIGHT=!0};Z[H]()};this.audit=function(){}}function zb(a){var g=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return g.tape[k].timer};this.DT=
ib();var k=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(h){this.keybuffer.push({key:(G.UP?3:G.DOWN?6:0)+(G.LEFT?1:G.RIGHT?2:0),time:h})};this.simulate=function(){};this.capture=function(h){return{position:(new THREE.Vector3).copy(h.position),normal:(new THREE.Vector3).copy(h.normal),lookTarget:h.lookTarget.clone(),rotation:h.rotation,timer:h.getTime(),objective:h.getObjective(),check:h.check,UP:h.UP}};this.record=function(h){g.tape[k]=h.record();k=24E4<g.tape[k].TS?0:k+1};this.play=
function(h){if(this.RECORD){this.RECORD=!1;for(var q=g.frame=0;q<Y.length;q++)Y[q].reset();na.reset()}if(g.frame>g.tape.length-10){g.frame=0;na.reset();for(q=0;q<Y.length;q++)Y[q].reset();N.generate.resetCheckpoints()}if(h.replay(),this.tape[g.frame].check)N.generate.checkpoints[0===this.tape[g.frame].objective?4:this.tape[g.frame].objective-1].display.material.color=ba[4]};this.reset=function(){N.generate.resetCheckpoints();k=0;g.frame=0;na.reset();g.PLAY=!1;g.RECORD=!0;g.tape=[]};this["export"]=
function(h,q){h=void 0===h?function(){S.results()}:h;var w=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((w<Na||!1===Na)&&""!==ja&&null!==ja&&!1!==ma&&void 0!==ma&&!g.SCAN||void 0!==q&&!q){S.STATE=function(){b.clear();b.print("uploading vhs to db","2","2")};S.STATE();ma;var r=N.name,D=x.CHECKPOINT.slice(),A=x.CHECKPOINT[0];q=x.param();for(var u=[];u.length<x.PHYSICSBUFFER.length;){var e=u.length;e={time:x.PHYSICSBUFFER[e].time,U:x.PHYSICSBUFFER[e].U,D:x.PHYSICSBUFFER[e].D,L:x.PHYSICSBUFFER[e].L,R:x.PHYSICSBUFFER[e].R};
u.push(e)}q={version:"006",id:ma,seed:r,time:w,cp:D,utc:A,debug:u,param:q};firebase.database().ref("vhs/006/"+q.seed+"/"+ma).set(q,function(c){c?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2","2"));window.setTimeout(h,1E3);uas.replay();x.replay()})}else void 0===ma||!1===ma||null===ja||""===ja||void 0===ja?S.register():(S.results(),uas.replay(),x.replay())};this.burn=function(h){return Math.round(1E9*h).toString(16)};this.read=function(h){return parseInt(h,
16)/1E9};this.scan=function(h,q){g.SCAN=!0;var w=[];firebase.database().ref("vhs/006/"+h).orderByChild("time").limitToFirst(99).once("value").then(function(r){r.forEach(function(D){var A=D.child("id").val(),u=D.child("time").val();D=D.child("utc").val();w.push({uid:A,time:u,utc:D})});g.SCAN=!1;q(w)})};this.checkTime=function(h,q,w){h===q&&(Na=w)};this.requestName=function(h,q){firebase.database().ref("uid/"+h).once("value").then(function(w){w=w.child("name").val();return q(w),w})};this["import"]=
function(h,q){q=void 0===q?function(){}:q;firebase.database().ref("vhs/006/"+h).once("value").then(function(w){var r=w.val(),D=r.id,A=r.seed,u=r.cp.slice();w=r.utc;r.model;r.paint;r.param;q({uid:D,seed:A,cp:u,utc:w,debug:r.debug.slice(),param:r.param})})};this.save=function(h,q){q=void 0===q?1E3/30:q;for(var w=0,r=[],D=h[h.length-1].TS,A=0;A<D;)A+=q,A<D&&r.push({TS:A});for(D=0;D<r.length;D++)w=g.convert(h,r[D],w);return r};this.convert=function(h,q,w){for(var r=h[w].time,D=h[w+1].TS,A=D-r;q.time>
D&&w<h.length-2;)r=h[++w].time,D=h[w+1].time,A=D-r;r=w;var u=w+1;D=(A-(D-q.time))/A;return q.position=new THREE.Vector3,q.position.copy(h[r].position),q.position.lerp(h[u].position,D),q.lookTarget=new THREE.Vector3,q.lookTarget.copy(h[r].normal),q.lookTarget.lerp(h[u].normal,D),q.rotation=(h[u].rotation-h[r].rotation)*D,q.rotation+=h[r].rotation,q.rotation=(h[u].rotation-h[r].rotation)*D,q.rotation+=h[r].rotation,q.AT=(h[u].AT-h[r].AT)*D,q.AT+=h[r].AT,q.UP=h[r].UP,q.check=h[r].check,q.objective=h[r].objective,
w}}var lb=function(a,g,k,h,q){k=void 0===k?0:k;h=void 0===h?[]:h;var w=[];this.inputs=[];this.name=void 0===q?"":q;this.cp=h;w[0]={name:"logistics crate",geometry:function(){return Ta.logistics_crate()}};w[1]={name:"ag-86",geometry:function(){return Ta.ag_86()}};q=void 0===g?0:g;g=k;var r=a.slice();this.PHYSICS=r;var D=0,A=new THREE.Vector3(0,0,1);r[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;
this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var u=w[q].geometry(),e=new THREE.MeshBasicMaterial({color:Ja[g]}),c=new THREE.LineSegments(u,e);c.visible=!0;c.name="ghost_"+Y.length;c.position.copy(r[0].position);fa.add(c);var f=new Ta.emitter;f.connect(Ja[k]);0===N.best.length||h[4]<N.best[4]&&(h[5],N.best[5]);uas.TARGETS.push(this);ya&&(uas.TARGET=1);this.reset=function(){na.reset();f.reset();D=0};this.update=function(l){this.index(l);
var z=(1E3/60-(r[D].time-l))/(1E3/60),K=r[D].U;0!==D&&0!==l||(D=1,z=0,K=!1);l=this.velocity.length();f.update(K,this.position,this.direction,l);l=this.normal.clone();l.add(this.position);c.position.copy(this.position);c.lookAt(l);c.rotateOnAxis(A,this.rotation);this.interpolate(z);this.lookAt.copy(this.position);this.velocity.copy(r[D].position);this.velocity.sub(r[D-1].position)};this.interpolate=function(l){this.position.copy(r[D-1].position);this.position.lerp(r[D].position,l);this.normal.copy(r[D-
1].normal);this.normal.lerp(r[D].normal,l);this.rotation=r[D].rotation;this.rotation-=r[D-1].rotation;this.rotation*=l;this.rotation+=r[D].rotation;this.direction.copy(r[D-1].direction);this.direction.lerp(r[D].direction,l)};this.discrete=function(){this.position.copy(r[D].position);this.rotation=r[D].rotation;this.normal.copy(r[D].normal)};this.index=function(l){if(D=0,l<=r[r.length-2].time)for(;r[D].time<=l;)D++;else D=r.length-2};this.toggleEmitter=function(l){void 0===l||l?f.connect():f.disconnect()};
this.disconnect=function(){fa.remove(c);u.dispose();e.dispose();f.disconnect()};this.debug=function(){console.log(r)};this.hide=function(){c.visible=!1};this.show=function(){c.visible=!0}};window.onload=function(){window.addEventListener("touchstart",gb);window.addEventListener("contextmenu",function(){event.preventDefault()});fa=new THREE.Scene;fa.background=mb;nb=new THREE.Vector3(0,0,1);ca=new THREE.PerspectiveCamera;ca.up=nb;ca.position.z=2E3;ca.lookAt(0,0,0);ca.fov=70;ca.near=1E-5;ca.far=3E3;
ca.name="Camera";fa.add(ca);za=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});za.setClearColor(mb);za.domElement.id="renderer";za.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(za.domElement);G=new ob;G.connect();b=new xb;N=new rb;x=new yb;sa=new zb;S=new tb;S.login();S.checksave();S.decodeURL();uas=new wb;uas.connect();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,
"#eeeeee");b.format(6,"#DA4DFA");ca.position.set(0,25,10);ca.lookAt(0,0,0);Ia();hb();S.intro()}};window.onresize=Ia;window.fullscreenchange=Ia;window.focus=Ia;var fb="artology forest;coen mountain;coffee forest;coyote forest;deadmans wonderland;development mountain;do it pass;eenetsu pass;ego mountain;ghxst mountain;ghxst pass;ghxstly forest;ginko mountain;haunted forest;hoekage mountain;ifuta pass;jaywalk pass;kae mountain;lotus mountain;low tunnel pass;lyla forest;mach mountain;mew mountain;nephil pass;nminke pass;ogj route;olive forest;ovo mountain;pine forest;prey first pass;r3 mountain;r3evaluate pass;ratty mountain;rekenase mountain;rex mountain;rutsuyo pass;sheep pass;shinigami graveyard;sleeping forest;the lotus order;tofu route;tora forest;tora tora pass;totoworo forest;ultra mountain;utopia district;vancouver island survey;vr pass;wasabi mountain;zynra mountain".split(";"),
ba=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],cb;for(cb in ba){var Ab=new THREE.Color(ba[cb]);ba[cb]=Ab}var Ja=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],ub="snow sakura melon peach bumblebee lavender ice".split(" "),Na=!1,Ua="",Ra=Math.floor(2147483647*Math.random()),eb="",fa,ca,za,N,x,G,b,sa,S,Y=[],Ka=1E3/60,Da=20,Aa=9,Ea=0,Ya=!0,bb=!1,ab=!1,ma=null,ja="",nb,va=!1,mb=ba[0],sb=0,Ma=!1,Sa=!1,qa=!1,$a=!1,Ga=!1,
Oa=!0,Va=0,Wa=!1,Za=!1,ya=!1,qb=!1,kb=!1,jb=!1,Fa=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Ta={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,
-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=
this;this.maxLife=100;for(var g=0,k=new THREE.Geometry;k.vertices.length<a.maxLife;){var h=new THREE.Vector3(0,0,0);h.life=0;h.maxLife=a.maxLife;h.acc=new THREE.Vector3(0,0,0);k.vertices.push(h);h=new THREE.Color(4294967040);k.colors.push(h)}k.verticesNeedUpdate=!0;var q=new THREE.Points(k,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));q.name="Emitter";var w=new THREE.Color;a.connect=function(r){r=void 0===r?16777215:r;fa.add(q);
a.paint(r)};a.paint=function(r){r=new THREE.Color(void 0===r?16777215:r);w=new THREE.Color;r.getHSL(w);for(r=0;r<q.geometry.vertices.length;r++)q.geometry.colors[r].setHSL(w.h,w.s,0),q.geometry.vertices[r].life=0};a.reset=function(){for(var r=0;r<q.geometry.colors.length;r++)q.geometry.colors[r].setHSL(w.h,w.s,0),q.geometry.vertices[r].life=0};a.disconnect=function(){fa.remove(q);q.geometry.dispose();q.material.dispose()};a.update=function(r,D,A,u){if(r)for(r=0;1>r;){q.geometry.vertices[g].copy(A);
q.geometry.vertices[g].multiplyScalar(-1-Math.random()*u);q.geometry.vertices[g].add(D);q.geometry.vertices[g].life=q.geometry.vertices[g].maxLife;Math.random();Math.random();Math.random();var e=.1*-Math.random();q.geometry.vertices[g].acc.copy(A);q.geometry.vertices[g].acc.multiplyScalar(e);g++;g%=q.geometry.vertices.length;r++}for(var c in q.geometry.vertices){var f;0<q.geometry.vertices[c].life&&(q.geometry.vertices[c].add(q.geometry.vertices[c].acc),--q.geometry.vertices[c].life,f=q.geometry.vertices[c].life/
100,q.geometry.colors[c].setHSL(w.h,w.s,w.l*f));0>=q.geometry.vertices[c].life&&(q.geometry.vertices[c].set(0,0,0),q.geometry.vertices[g].acc.x=0,q.geometry.vertices[g].acc.y=0,q.geometry.vertices[g].acc.z=0)}q.geometry.verticesNeedUpdate=!0;q.geometry.colorsNeedUpdate=!0;q.geometry.computeBoundingSphere()}}},pb=function(){function a(w){return w*w*w*(w*(6*w-15)+10)}function g(w,r,D){return r+w*(D-r)}function k(w,r,D,A){var u=15&w;w=8>u?r:D;A=4>u?D:12==u||14==u?r:A;return(0==(1&u)?w:-w)+(0==(2&u)?
A:-A)}for(var h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,
118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],q=0;256>q;q++)h[256+q]=h[q];return{noise:function(w,r,D){var A=Math.floor(w),
u=Math.floor(r),e=Math.floor(D),c=255&A,f=255&u,l=255&e,z=(w-=A)-1,K=(r-=u)-1,W=(D-=e)-1,Q=a(w),t=a(r);A=a(D);u=h[c]+f;e=h[u]+l;u=h[u+1]+l;c=h[1+c]+f;f=h[c]+l;l=h[c+1]+l;return g(A,g(t,g(Q,k(h[e],w,r,D),k(h[f],z,r,D)),g(Q,k(h[u],w,K,D),k(h[l],z,K,D))),g(t,g(Q,k(h[e+1],w,r,W),k(h[f+1],z,r,D-1)),g(Q,k(h[u+1],w,K,W),k(h[l+1],z,K,W))))}}},vb=function(a,g){for(var k="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61 736d65676d61".split(" "),
h="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),q=a.toLowerCase(),w=0;w<q.length;w++){var r=q.charCodeAt(w);if(122<r||57<r&&61>r||33>r||40==r||41==r)return"";r="";for(var D=w;D<q.length;D++){q.charAt(D);var A=q.charCodeAt(D);(48<=A&&57>=A||97<=A&&122>=A)&&(r+=A.toString(16));for(A=0;A<k.length;A++){for(var u="",e="",c=[],f=0,l=0,z=0;z<k[A].length;z+=2){var K=r.charAt(z+f)+r.charAt(z+1+f),W=k[A].charAt(z)+k[A].charAt(z+1);if((K===u||K===e)&&0!==K.length&&(l++,0<
l))for(;K===u||K===e;)f+=2,K=r.charAt(z+f)+r.charAt(z+1+f);if(K===W)c[z/2]=!0,u=K,e=W;else{c[z/2]=!1;for(var Q=0;Q<h.length;Q++){var t=h[Q].charCodeAt(1).toString(16),B=h[Q].charCodeAt(0).toString(16);K===t&&(B===W?(c[z/2]=!0,u=t,e=W):B!==u&&B!==e||(l++,0<l&&(f+=2,z-=2)))}!1===c[z/2]&&(z=k[A].length)}}for(e=u=0;e<c.length;e++)if(!0===c[e]&&u++,u===c.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();na.time=
0;na.last=0;na.timestep=1E3/60;na.dt=1}},ib=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var g="[\n",k=0;k<a.length;k++){g+="'";for(var h=0;h<a[k].length;h++)g+=a[k].charCodeAt(h).toString(16);g+="',\n"}return g+="]",console.log(g),g}})();