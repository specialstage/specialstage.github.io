(function(){function mb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],g=0,k=!1;this.POV=0;var f=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:0,roll:0,yaw:0,pov:0,target:0,targeting:!1,autopilot:!0}},l=[],z=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,
lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},u=this.AUTOPILOT=!0;this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var t=this.CAM=1;this.camera=[];this.camera[0]=f();this.camera[0].distance=22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=f();this.camera[1].distance=22;this.camera[1].position.set(20,20,10);this.camera[1].lerp=
.05;this.camera[2]=f();this.camera[2].distance=22;this.camera[2].position.set(-20,20,20);this.camera[2].lerp=.05;this.camera[3]=f();this.camera[3].distance=22;this.camera[3].position.set(16,-16,9);this.camera[3].pov=2;this.camera[3].lerp=.05;this.camera[4]=f();this.camera[4].distance=0;this.camera[4].position.set(0,-20,50);this.camera[4].lerp=.075;l[0]=z();l[1]=z();l[2]=z();l[3]=z();l[4]=z();this.reset=function(b){if(void 0===b?0:b)for(this.TARGET=this.CAM=0,this.TARGETS=[],b=0;b<this.camera.length;b++)this.camera[b].target=
0;1<a.length?a[g].time=0:(g=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:9E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:.0015,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:.0015,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var b=
0;b<this.camera.length;b++)this.camera[b].target=0,this.camera[b].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var b=0;b<this.camera.length;b++)this.camera[b].target=1,this.camera[b].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(b,e,h){b=void 0===b?new THREE.Vector3:b;e=void 0===e?new THREE.Vector3:e;h=void 0===h?new THREE.Vector3:h;var r=Ka||y.END?1E-5:.1;this.up.set(0,0,1);e=e.clone();e.multiplyScalar(-this.camera[0].distance+
4*(c.scale-1));e.add(b);e.z+=this.camera[0].position.z;a[g].position.lerp(e,r);a[g].lookAt.copy(h);a[g].up.set(0,0,1)};this.fpv=function(b,e,h,r){b=void 0===b?new THREE.Vector3:b;e=void 0===e?new THREE.Vector3:e;void 0===h&&new THREE.Vector3;r=void 0===r?new THREE.Vector3:r;a[g].position.copy(b);e=e.clone();e.add(b);a[g].lookAt.copy(e);r=r.clone();a[g].up.copy(r)};this.orbit=function(b,e,h){b=void 0===b?new THREE.Vector3:b;void 0===e&&new THREE.Vector3;h=void 0===h?new THREE.Vector3:h;E.SPACE;E.SHIFT;
E.UP;E.DOWN;E.LEFT;E.RIGHT;b=b.clone();b.add(this.camera[t].position);a[g].position.lerp(b,this.camera[t].lerp);a[g].lookAt.copy(h);a[g].up.set(0,0,1)};this.physics=function(b,e,h){b=void 0===b?0:b;if(b>a[g].time){var r=e.position.clone(),w=e.direction.clone(),O=e.lookAt.clone();e=e.normal.clone();h=((void 0!==h?h:r).clone(),{});Object.assign(h,a[g]);a=[];g=0;for(a.push(h);a[g].time<b;)h={},Object.assign(h,a[g]),a.push(h),g++,y.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(r,w,O):2===this.POV?this.fpv(r,
w,O,e):this.orbit(r,w,O):this.pilot():y.FPV?this.fpv(r,w,O,e):this.pov(r,w,r),a[g].time+=Na}};this.target=function(b){this.lookAt.copy(this.TARGETS[b].position)};this.update=function(b,e){b=void 0===b?0:b;e=void 0===e?this.TARGETS:e;this.CAM!==t?(t=this.CAM,this.TARGET=this.camera[t].target,this.TARGETING=this.camera[t].targeting,this.AUTOPILOT=this.camera[t].autopilot,this.POV=this.camera[t].pov,u=this.AUTOPILOT,u?(a[g].position.copy(this.camera[t].position),a[g].position.add(e[this.TARGET].position),
a[g].up.copy(this.camera[t].up),k=!0):(a[g].position.copy(l[t].position),a[g].lookAt.copy(l[t].lookAt),a[g].up.copy(l[t].up),a[g].velocity.copy(l[t].velocity),a[g].pitch.axis.copy(l[t].pitch.axis),a[g].roll.axis.copy(l[t].roll.axis),a[g].yaw.axis.copy(l[t].yaw.axis),a[g].pitch.value=l[t].pitch.value,a[g].roll.value=l[t].roll.value,a[g].yaw.value=l[t].yaw.value,a[g].speed=l[t].speed)):(this.camera[t].target=this.TARGET,this.camera[t].pov=this.POV,this.camera[t].targeting=this.TARGETING,this.camera[t].autopilot=
this.AUTOPILOT);this.AUTOPILOT!==u&&(u=this.AUTOPILOT,this.AUTOPILOT?(a[g].position.copy(this.camera[t].position),a[g].up.copy(this.camera[t].up)):a[g].speed=0);this.physics(b,e[xa?0:this.camera[t].target]);Na;a[g].time;Na;1<a.length&&(this.position.copy(a[g].position),this.direction.copy(a[g].direction),this.lookAt.copy(a[g].lookAt),this.velocity.copy(a[g].velocity),this.up.copy(a[g].up),ca.position.copy(this.position),ca.up.set(this.up.x,this.up.y,this.up.z),ca.lookAt(this.lookAt));k=!1};this.pilot=
function(){var b=a[g],e=E.SPACE,h=E.SHIFT,r=E.UP,w=E.DOWN,O=E.LEFT,P=E.RIGHT;E.TARGET&&(this.TARGETING=!this.TARGETING,E.TARGET=!1,S.replay());b.pitch.value+=r?-b.pitch.power:w?+b.pitch.power:0;h&&!this.TARGETING?b.roll.value+=O?-b.roll.power:P?b.roll.power:0:(b.yaw.value+=O?b.yaw.power:P?-b.yaw.power:0,b.yaw.value*=b.yaw.drag);b.pitch.value*=b.pitch.drag;b.roll.value*=b.roll.drag;b.yaw.value*=b.yaw.drag;b.pitch.axis.applyAxisAngle(b.roll.axis,b.roll.value);b.pitch.axis.applyAxisAngle(b.yaw.axis,
b.yaw.value);b.roll.axis.applyAxisAngle(b.pitch.axis,b.pitch.value);b.roll.axis.applyAxisAngle(b.yaw.axis,b.yaw.value);b.yaw.axis.applyAxisAngle(b.pitch.axis,b.pitch.value);b.yaw.axis.applyAxisAngle(b.roll.axis,b.roll.value);h&&e&&-1<b.speed?b.speed-=.005:e&&1>b.speed&&(b.speed+=.005);b.velocity.copy(b.roll.axis);b.velocity.multiplyScalar(b.speed);b.position.add(b.velocity);this.TARGETING?(O&&0<this.TARGET&&(--this.TARGET,S.replay(),E.LEFT=!1),P&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,
S.replay(),E.RIGHT=!1),this.up.set(0,0,1),k?b.lookAt.lerp(this.TARGETS[this.TARGET].position,.1):b.lookAt.copy(this.TARGETS[this.TARGET].position)):(b.up.copy(b.yaw.axis),b.lookAt.copy(b.roll.axis),b.lookAt.add(b.position));l[t].position.copy(b.position);l[t].lookAt.copy(b.lookAt);l[t].velocity.copy(b.velocity);l[t].up.copy(b.up);l[t].pitch.axis.copy(b.pitch.axis);l[t].roll.axis.copy(b.roll.axis);l[t].yaw.axis.copy(b.yaw.axis);l[t].pitch.value=b.pitch.value;l[t].roll.value=b.roll.value;l[t].yaw.value=
b.yaw.value;l[t].speed=b.speed};this.debug=function(){console.log("Vehicle Timestamp:",y.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt)}}function nb(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var g="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",
a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",
a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(k){var f="keydown"==k.type;switch(f||(g+=k.key),3<g.length&&(g=g.slice(1,4)),k.key){case "ArrowUp":a.UP=f;break;case "ArrowDown":a.DOWN=f;break;case "ArrowLeft":a.LEFT=f;break;case "ArrowRight":a.RIGHT=f;break;case "w":a.UP=f;break;case "s":a.DOWN=f;break;case "a":a.LEFT=
f;break;case "d":a.RIGHT=f;break;case "r":a.RESET=f;break;case " ":a.SPACE=f;break;case "Shift":a.SHIFT=f;break;case "Enter":a.ENTER=f;break;case "Control":a.CTRL=f;break;case "Escape":case "Backspace":a.ESC=f;break;case "=":a.ZOOM_IN=f;break;case "-":a.ZOOM_OUT=f;break;case "t":a.TARGET=f;break;case "h":a.HIDE=f;break;case ">":!f&&2>Da&&(Da+=.5);Ha();break;case "<":!f&&.5<Da&&(Da-=.5),Ha()}Ra?!ra.PLAY||qa||cb||"vhs"===g&&(c.print("code detected: ghost data overwrite","2","2"),window.setTimeout(ra["export"],
1E3,S.results,!1),g=""):"uas"===g&&(Ra=!0,qa=!0,S.settings(S.STATE),c.print("code detected: uas enabled","2","2"),g="")};this.mousedown=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!0}};this.mouseup=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!1}};this.touchSetup=function(k){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",
a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(k)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(k){k=k.touches;a.touches=[];for(var f=0;f<k.length;f++)a.touches[f]={x:k[f].clientX,y:k[f].clientY,
start:!0}};this.touchmove=function(k){a.touches=[];k=k.touches;for(var f=0;f<k.length;f++)a.touches[f]={x:k[f].clientX,y:k[f].clientY,start:!1}};this.touchend=function(k){a.touches=[];k=k.touches;for(var f=0;f<k.length;f++)a.touches[f]={x:k[f].clientX,y:k[f].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var g=[],k=0;g[0]={name:"forest",palette:aa[9],tree:function(p,m){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};g[0].map[0]=function(p,
m){var n=aa[10],C=!1;return.92<Math.abs(p)&&(n=.92<Math.abs(p)?aa[9]:aa[2],C=!0),g[0].flags[m]=C,n};g[1]={name:"sakura",palette:aa[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};g[1].map[0]=function(p,m){var n=aa[1],C=!1;return.95<Math.abs(p)&&(n=.92<Math.abs(p)?aa[12]:aa[1],C=!0),g[1].flags[m]=C,n};g[2]={name:"summit",palette:aa[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};g[2].map[0]=function(p,m){var n=
aa[7],C=!1;return.95<Math.abs(p)&&(n=.92<Math.abs(p)?aa[2]:aa[7],C=!0),g[2].flags[m]=C,n};var f=new THREE.Points(new THREE.Geometry);f.name="Generative Extruder";f.visible=!1;var l=new THREE.Line(new THREE.Geometry);l.name="Generative Nodes";l.visible=!1;l.material.color=aa[6];l.material.name="Node Material";l.position.z+=2;var z=new THREE.LineSegments(new THREE.Geometry);z.name="Generative Segments";z.visible=!0;z.material.color=aa[3];z.material.name="Segments Material";var u=new THREE.Mesh(new THREE.Geometry);
u.name="Generative Surface";u.visible=!1;u.material.color=aa[0];u.material.name="Surface Material";var t=new THREE.LineSegments(new THREE.Geometry);t.name="Generative Perimeter";t.material.color=aa[1];t.material.name="Perimeter Material";var b=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));b.name="Terrain";b.material.name="Terrain Material";b.material.wireframe=!0;b.material.side=THREE.DoubleSide;b.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,
new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var e=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));e.name="Trees";var h=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);h.name="Background";h.material.color=aa[0];h.material.name="Background Material";
h.material.wireframe=!1;h.material.side=THREE.FrontSide;h.material.opacity=.75;h.material.blendMode=THREE.MultiplyBlending;h.material.transparent=!0;var r=new THREE.Points(new THREE.Geometry);r.material.color=aa[1];r.material.sizeAttenuation=!1;r.material.size=1.5;r.material.fog=!1;scope.stars=r;var w=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);w.name="Collision Mesh";w.visible=!0;w.material.name="Collision Material";w.material.side=THREE.BackSide;this.checkpoints=[];var O=new THREE.Vector3(0,
0,1),P=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var N=new THREE.Vector3(0,3,0),ia=new THREE.Vector3(0,0,1),T=l.geometry.clone(),q=u.geometry.clone(),B=z.geometry.clone(),F=t.geometry.clone(),H=[],L=[],ea=new THREE.Vector3;H[0]=new THREE.Vector3(5,3,0);H[1]=new THREE.Vector3(-5,3,0);L[0]=H[0].clone();L.z+=1;L[1]=H[1].clone();L.z+=1;var U=Math.PI/64,Q=Math.PI/32,Y=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var ba=!1,ja=!1,ha=!1;this.IMPORT=this.END=!1;
this.DISTANCE=0;var Sa=18,Ta=new THREE.Raycaster;Ta.far=800;f.geometry.vertices[0]=N.clone();f.geometry.vertices[1]=O.clone().add(N);f.geometry.vertices[2]=H[0].clone();f.geometry.vertices[3]=H[1].clone();f.geometry.vertices[4]=L[0].clone();f.geometry.vertices[5]=L[1].clone();this.connect=function(){scope.SEED=Oa;k=scope.randomInt(0,3);K.SNOW=2===k;K.SNOW&&K.snow.init();da.add(f);da.add(l);da.add(z);da.add(t);da.add(u);da.add(wireframe);da.add(h);la=window.performance.now();window.setTimeout(scope.generate,
0)};this.disconnect=function(){for(var p in Y=[],da.remove(f),da.remove(l),da.remove(z),da.remove(t),da.remove(u),da.remove(wireframe),da.remove(h),da.remove(e),g)g[p].flag=[];for(var m in scope.checkpoints)da.remove(scope.checkpoints[m].display),scope.checkpoints[m].display.geometry.dispose(),scope.checkpoints[m].collision.geometry.dispose()};this.complete=function(){w.geometry.mergeVertices();w.geometry.verticesNeedUpdate=!0;w.geometry.elementsNeedUpdate=!0;w.geometry.computeFaceNormals();w.geometry.computeVertexNormals();
w.geometry.computeBoundingSphere();h.geometry.copy(w.geometry);--h.position.z;for(var p=[],m=0;m<w.geometry.faces.length;m++)p[w.geometry.faces[m].a]=w.geometry.faces[m].vertexNormals[0].clone(),p[w.geometry.faces[m].b]=w.geometry.faces[m].vertexNormals[1].clone(),p[w.geometry.faces[m].c]=w.geometry.faces[m].vertexNormals[2].clone();for(m=0;m<w.geometry.vertices.length;m++)w.geometry.vertices[m].add(p[m].multiplyScalar(2));w.geometry.verticesNeedUpdate=!0;w.geometry.computeFaceNormals();w.geometry.computeVertexNormals();
w.geometry.computeBoundingSphere();wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();p=new THREE.IcosahedronGeometry(1200,10);for(var n in p.vertices).3>scope.random()&&-400<p.vertices[n].z&&r.geometry.vertices.push(p.vertices[n].clone());p.dispose();r.geometry.computeBoundingSphere();K.surface=w.clone();K.start=scope.start.clone();la=window.performance.now()-
la;ba=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(la/1E3)});Za?(c.clear(),y.connect(K.start,K.surface),y.PLAY=!1,ra.PLAY=!0):S.ready()};this.reset=function(){Sa=(36+scope.random()-.5)/2;a=0;l.geometry.dispose();z.geometry.dispose();u.geometry.dispose();f.geometry.dispose();t.geometry.dispose();b.geometry.dispose();wireframe.geometry.dispose();w.geometry.dispose();e.geometry.dispose();r.geometry.dispose();B.dispose();F.dispose();T.dispose();q.dispose();
B.copy(new THREE.Geometry);F.copy(new THREE.Geometry);T.copy(new THREE.Geometry);q.copy(new THREE.Geometry);l.geometry.copy(new THREE.Geometry);f.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);u.geometry.copy(new THREE.Geometry);b.geometry.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);N.set(0,3,0);ia.set(0,0,1);H[0]=new THREE.Vector3(4,3,0);H[1]=new THREE.Vector3(-4,3,0);ba&&(ba=!1,ja=!1,ha=!1);this.END=!1;f.position.set(0,
0,0);f.geometry.vertices[0]=N.clone();f.geometry.vertices[1]=O.clone().add(N);f.geometry.vertices[2]=H[0].clone();f.geometry.vertices[3]=H[1].clone();f.geometry.vertices[4]=L[0].clone();f.geometry.vertices[5]=L[1].clone();f.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(p,m,n,C,A,x,R,D,J,I){p=void 0===p?0:p;m=void 0===m?0:m;n=void 0===n?0:n;C=void 0===C?0:C;A=void 0===A?0:A;x=void 0===x?{start:0,end:30,angle:0,slope:0}:x;R=void 0===R?[]:R;D=void 0===D?[]:
D;J=void 0===J?!1:J;I=void 0===I?999:I;var M=window.performance.now(),V=0;for(0===C&&(C=.5<scope.random()?1:-1);32>V&&!ja;){if(p===x.end+1){D=[];for(n=0;1>n;n++)if(p>=scope.length)D.push({angle:0,slope:0,end:30}),I=p+30;else if(0===m){var W=scope.randomInt(2,4)*C;V=Math.floor(Math.abs(36/W));C=.01>scope.random()?+C:-1*C;V=scope.randomInt(1,V);D.push({angle:W,slope:0,end:V})}else W=scope.randomInt(-5,-1),V=scope.random(),W=2!==k&&.05>V?W*=-1:W,V=scope.randomInt(2,20),D.push({angle:0,slope:W,end:V});
V=scope.randomInt(0,D.length);m=D[V].angle;n=D[V].slope;x.start=p;x.end=p+D[V].end;D=D.slice(V,1)}if(J||(scope.extrude(m,n),Y.push({angle:m,slope:n}),T.verticesNeedUpdate=!0,p++),10<=p&&!J){V=new THREE.Vector2(T.vertices[p-1].x,T.vertices[p-1].y);for(W=0;W<T.vertices.length-1-10;W++)if(18>(new THREE.Vector2(T.vertices[W].x,T.vertices[W].y)).distanceTo(V)){J=!0;break}J&&window.setTimeout(K.reset(!0),0)}0;p===I&&(ja=!0,l.geometry.dispose(),l.geometry=T.clone(),l.geometry.computeBoundingSphere(),l.geometry.center(),
l.updateMatrixWorld(),0<l.geometry.vertices.length&&(ka.copy(l.geometry.vertices[0]),ka.sub(T.vertices[0])),window.setTimeout(function(){S.PATH=!0;S.STATE();scope["import"]()},0));V=window.performance.now()-M}ja||J||window.setTimeout(scope.path,0,p,m,n,C,A,x,R,D,J,I)};this.skijump=function(p,m,n,C,A,x,R,D,J,I,M){p=void 0===p?0:p;m=void 0===m?0:m;n=void 0===n?0:n;C=void 0===C?0:C;A=void 0===A?0:A;x=void 0===x?{start:0,end:20,angle:0,slope:0}:x;R=void 0===R?[]:R;D=void 0===D?[]:D;J=void 0===J?!1:J;
I=void 0===I?300:I;M=void 0===M?0:M;var V=window.performance.now(),W=0;for(0===C&&(C=.5<scope.random()?1:-1);32>W&&!ja;){if(p===x.end+1){D=[];for(m=0;1>m;m++)0===n&&20===x.end?(M=-1,D.push({angle:0,slope:-4,end:30})):3===n?D.push({angle:0,slope:4,end:3}):4===n?D.push({angle:0,slope:-32,end:10}):-4===n?(M=1,D.push({angle:0,slope:n+1,end:1})):-32===n?D.push({angle:0,slope:-4,end:40}):1==M?D.push({angle:0,slope:n+1,end:1}):-1==M&&D.push({angle:0,slope:n-1,end:1});W=scope.randomInt(0,D.length);m=D[W].angle;
n=D[W].slope;x.start=p;x.end=p+D[W].end;D=D.slice(W,1)}if(J||(scope.extrude(m,n),Y.push({angle:m,slope:n}),T.verticesNeedUpdate=!0,p++),10<=p&&!J){W=new THREE.Vector2(T.vertices[p-1].x,T.vertices[p-1].y);for(var ta=0;ta<T.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(T.vertices[ta].x,T.vertices[ta].y)).distanceTo(W)){J=!0;break}J&&window.setTimeout(K.reset(!0),0)}0;I<=p&&(ja=!0,l.geometry.dispose(),l.geometry=T.clone(),l.geometry.computeBoundingSphere(),l.geometry.center(),l.updateMatrixWorld(),
0<l.geometry.vertices.length&&(ka.copy(l.geometry.vertices[0]),ka.sub(T.vertices[0])),window.setTimeout(function(){scope["import"]()},0));W=window.performance.now()-V}ja||J||window.setTimeout(scope.skijump,0,p,m,n,C,A,x,R,D,J,I)};this["import"]=function(p){p=void 0===p?0:p;for(var m=window.performance.now(),n=0;!ha&&32>n;){if(0===p&&(f.position.set(0,0,0),f.rotation.z=0,N.set(0,3,0),f.geometry.vertices[0]=N.clone(),f.geometry.vertices[1]=O.clone().add(N),f.geometry.vertices[2]=H[0].clone(),f.geometry.vertices[3]=
H[1].clone(),f.geometry.vertices[4]=L[0].clone(),f.geometry.vertices[5]=L[1].clone(),f.geometry.verticesNeedUpdate=!0,f.updateMatrixWorld()),p<Y.length)a=p,angle=Y[p].angle,slope=Y[p].slope,scope.extrude(angle,slope),z.geometry.dispose(),z.geometry=B.clone(),z.geometry.computeBoundingSphere(),t.geometry.dispose(),t.geometry=F.clone(),t.geometry.computeBoundingSphere(),u.geometry.dispose(),u.geometry=q.clone(),u.geometry.computeBoundingSphere(),p++;else if(!ha&&p===Y.length){for(var C in scope.checkpoints=
scope.checkpoint(),scope.checkpoints)da.add(scope.checkpoints[C].display);ha=!0;window.setTimeout(function(){scope.terrain(!0)},0)}n=window.performance.now()-m}ha||window.setTimeout(scope["import"],0,p,angle,slope)};this.extrude=function(p,m){p=void 0===p?0:p;m=void 0===m?0:m;for(var n in f.updateMatrixWorld(),f.rotateZ(p*Q),f.geometry.vertices)f.geometry.vertices[n].applyAxisAngle(P,m*U);f.geometry.verticesNeedUpdate=!0;n=f.geometry.vertices[0].clone();var C=f.geometry.vertices[2].clone(),A=f.geometry.vertices[3].clone(),
x=f.geometry.vertices[1].clone();if(n.applyMatrix4(f.matrix),C.applyMatrix4(f.matrix),A.applyMatrix4(f.matrix),x.applyMatrix4(f.matrix),x.sub(n),ja){if(C.add(ka),A.add(ka),0<B.vertices.length){var R=B.vertices[B.vertices.length-1].clone().sub(ea),D=B.vertices[B.vertices.length-2].clone().sub(ea);q.vertices.push(C.clone().sub(x));q.vertices.push(A.clone().sub(x));q.vertices.push(D);q.vertices.push(A.clone().sub(x));q.vertices.push(R);q.vertices.push(D);var J=C.clone();p=A.clone();R=B.vertices[B.vertices.length-
1].clone();D=B.vertices[B.vertices.length-2].clone();w.geometry.vertices.push(J);w.geometry.vertices.push(p);w.geometry.vertices.push(D);w.geometry.vertices.push(p);w.geometry.vertices.push(R);w.geometry.vertices.push(D);R=q.vertices.length;var I=new THREE.Face3(R-3,R-2,R-1);J=new THREE.Face3(R-5,R-4,R-6);q.faces.push(I);q.faces.push(J);I=I.clone();J=J.clone();I.color=new THREE.Color(16777215);J.color=new THREE.Color(16777215);w.geometry.faces.push(I);w.geometry.faces.push(J)}0<F.vertices.length?
(I=2,J=1,4<F.vertices.length&&(I=4,J=2),I=F.vertices[F.vertices.length-I].clone(),J=F.vertices[F.vertices.length-J].clone(),F.vertices.push(C.clone().add(x)),F.vertices.push(I.clone()),F.vertices.push(A.clone().add(x)),F.vertices.push(J.clone()),a==Y.length-1&&(D=C.clone().add(x),R=A.clone().add(x),F.vertices.push(D),F.vertices.push(R))):(F.vertices.push(C.clone().add(x)),F.vertices.push(A.clone().add(x)));B.vertices.push(C.clone());B.vertices.push(A.clone());ea.copy(x)}else T.vertices.push(n.clone());
for(var M in N.copy(n).sub(f.position),f.position.add(N),f.geometry.vertices)f.geometry.vertices[M].applyAxisAngle(P,-1*m*U)};this.terrain=function(p,m,n,C,A,x,R){m=void 0===m?[]:m;n=void 0===n?[]:n;C=void 0===C?[]:C;A=void 0===A?0:A;x=void 0===x?0:x;R=void 0===R?0:R;if(void 0===p||p){z.updateMatrixWorld();b.geometry.dispose();b.geometry.copy(new THREE.Geometry);m=[];n=[];C=[];for(p=0;2>p;p++)C[p]=[],m[p]=[],n[p]=[];for(p=0;p<z.geometry.vertices.length;p++)n[p%2].push(z.geometry.vertices[p]);for(p=
0;2>p;p++)for(var D=0;D<n[p].length;D++){var J=0===p?1:-1,I=n[p][D].clone();I.sub(n[p+J][D]);I.normalize().multiplyScalar(3);C[p][D]=I.clone()}}D=0;var M;p=window.performance.now();if(4>A){if(b.geometry.verticesNeedUpdate=!0,b.geometry.elementsNeedUpdate=!0,b.geometry.computeBoundingSphere(),b.geometry.computeFaceNormals(),b.geometry.computeVertexNormals(),b.updateMatrixWorld(),0<A&&0===R)for(n[x]=[],J=0;J<m[x].length;J++)n[x][J]=b.geometry.vertices[m[x][J]];0===R&&(m[x]=[]);for(v=R;v<n[x].length&&
32>D;){D=!1;if(void 0!==n[x][v]&&void 0!==n[x][v-1]){if(void 0===C[x][v])C[x][v]=C[s][v-1].clone();else if(b.geometry.computeBoundingSphere(),J=n[x][v].clone().add(C[x][v]),J.z-=100,Ta.set(J,O),J.z+=100,I=Ta.intersectObjects([b],!0),0<I.length)for(var V in I).01<I[V].point.distanceTo(J)&&(m[x][v]=void 0,D=!0);D||(b.geometry.vertices.push(n[x][v].clone()),b.geometry.vertices.push(n[x][v].clone().add(C[x][v])),m[x][v]=b.geometry.vertices.length-1,0<v&&(b.geometry.vertices.push(n[x][v-1].clone()),M=
b.geometry.vertices.length,0===x?b.geometry.faces.push(new THREE.Face3(M-2,M-1,M-3)):1===x&&b.geometry.faces.push(new THREE.Face3(M-1,M-2,M-3))))}D=window.performance.now()-p;v++;R=v}if(R===n[x].length){R=0;for(M=1;M<m[x].length;M++)if(void 0!==m[x][M]&&void 0!==m[x][M-1]){V=b.geometry.vertices[m[x][M]];var W;p=b.geometry.vertices[m[x][M-1]];2.8>V.distanceTo(p)?(V.copy(p),m[x][M]=m[x][M-1],C[x][M].copy(C[x][M-1])):1<M&&(b.geometry.vertices.push(n[x][M-1]),W=0===x?m[x][M]:m[x][M-1],p=0===x?m[x][M-
1]:m[x][M],b.geometry.faces.push(new THREE.Face3(W,p,b.geometry.vertices.length-1)))}x++}1<x&&(x=0,A++)}if(4===A){b.geometry.verticesNeedUpdate=!0;b.geometry.elementsNeedUpdate=!0;b.geometry.colorsNeedUpdate=!0;b.geometry.computeFaceNormals();b.geometry.computeVertexNormals();b.geometry.mergeVertices();b.geometry.computeBoundingSphere();scope.noise(b.geometry);for(W=0;W<b.geometry.faces.length;W++)V=b.geometry.vertices[b.geometry.faces[W].a].clone(),p=b.geometry.vertices[b.geometry.faces[W].b].clone(),
M=b.geometry.vertices[b.geometry.faces[W].c].clone(),b.geometry.colors[b.geometry.faces[W].a],b.geometry.colors[b.geometry.faces[W].b],b.geometry.colors[b.geometry.faces[W].c],w.geometry.vertices.push(V),w.geometry.vertices.push(p),w.geometry.vertices.push(M),wireframe.geometry.vertices.push(V),wireframe.geometry.vertices.push(p),wireframe.geometry.vertices.push(M),M=w.geometry.vertices.length,V=new THREE.Face3(M-1,M-2,M-3),V.color=new THREE.Color(0),w.geometry.faces.push(V),wireframe.geometry.faces.push(new THREE.Face3(M-
1,M-2,M-3));wireframe.geometry.copy(b.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,m.slice(),n.slice(),C.slice(),A,x,R)},0)};this.biome=function(){for(var p=k,m=wireframe.geometry.faces,n=[],C=[],A=0;A<m.length;A++)for(var x=0;x<g[k].map.length;x++)m[A].vertexColors[0]=g[k].map[x](m[A].vertexNormals[0].z,m[A].a),m[A].vertexColors[1]=g[k].map[x](m[A].vertexNormals[1].z,m[A].b),m[A].vertexColors[2]=
g[k].map[x](m[A].vertexNormals[2].z,m[A].c);for(m=0;m<g[k].flags.length;m++)for(A=0;A<z.geometry.vertices.length;A++).1>wireframe.geometry.vertices[m].distanceTo(z.geometry.vertices[A])&&(g[k].flags[m]=!1);for(m=0;m<g[k].flags.length;m++)g[k].flags[m]&&n.push(m);for(m=0;m<g[k].limit&&m<n.length;){A=scope.randomInt(0,n.length);x=!0;if(0<C.length&&0<n.length)for(;x;){for(var R in C){if(wireframe.geometry.vertices[n[A]].distanceTo(wireframe.geometry.vertices[C[R]])<g[k].range){x=!0;n.slice(A,1);A=scope.randomInt(0,
n.length);break}x=!1}0>=n.length&&(x=!1)}if(0<n.length){x=g[p].tree();for(var D in x.vertices)e.geometry.vertices.push(x.vertices[D].clone().add(wireframe.geometry.vertices[n[A]])),e.geometry.colors[e.geometry.vertices.length-1]=x.colors[D];C.push(n[A]);n.slice(A,1)}m++}e.verticesNeedUpdate=!0;e.elementsNeedUpdate=!0;da.add(e)};this.sakura=function(){var p=new THREE.Geometry,m=[],n=[],C=1,A,x=new THREE.Vector3(0,0,0),R=new THREE.Vector3(0,0,3),D=12,J=0,I=new THREE.Vector3(1,0,0),M=new THREE.Vector3(0,
0,1);p.vertices.push(x);p.vertices.push(R);p.colors.push(aa[2]);p.colors.push(aa[2]);n.push({v:R.clone(),n:R.clone(),pitch:I.clone(),roll:M.clone()});for(x=[];4>J;){R=[];for(I=0;I<n.length;I++)for(var V=M=0;3>V;V++){var W=0===J&&2===V&&1>M?1:scope.random();if(.2<W){W=scope.randomInt(-2,2);var ta=n[I].n.clone(),pa=aa[2];ta.applyAxisAngle(n[I].pitch,2*Math.PI/(D+W));ta.applyAxisAngle(n[I].roll,2*Math.PI/3*V);ta.multiplyScalar(C);W=ta.clone().add(n[I].v);p.vertices.push(n[I].v.clone());p.vertices.push(W);
p.colors.push(pa);p.colors.push(pa);pa=n[I].pitch.clone();pa.applyAxisAngle(n[I].roll,2*Math.PI/3*V);pa.applyAxisAngle(n[I].pitch,2*Math.PI/D);var Ea=n[I].roll.clone();Ea.applyAxisAngle(n[I].pitch,2*Math.PI/D);Ea.applyAxisAngle(n[I].roll,2*Math.PI/3*V);0<V&&m.push({a:W.clone(),b:n[I].v.clone(),pitch:pa,roll:Ea});R.push({v:W.clone(),n:ta.clone(),pitch:pa,roll:Ea});M++}else 0===M&&2===V&&x.push({v:n[I].v.clone(),n:n[I].n.clone(),pitch:n[I].pitch.clone(),roll:n[I].roll.clone()})}n=R.slice();C*=.9;J++}for(A in D=
6,m)C=m[A].a.clone(),R=m[A].b.clone(),C=C.clone().sub(R),I=C.clone().multiplyScalar(.5).add(R),J=scope.randomInt(0,3)-1,C.applyAxisAngle(m[A].pitch,2*Math.PI/D),C.applyAxisAngle(m[A].roll,2*Math.PI/J),C.multiplyScalar(.5),R=I,I=C.clone().add(I),p.vertices.push(R),p.vertices.push(I),p.colors.push(aa[2]),p.colors.push(aa[2]),R=m[A].pitch.clone(),R.applyAxisAngle(m[A].roll,2*Math.PI/J),R.applyAxisAngle(m[A].pitch,2*Math.PI/D),M=m[A].roll.clone(),M.applyAxisAngle(m[A].pitch,2*Math.PI/D),M.applyAxisAngle(m[A].roll,
2*Math.PI/J),n.push({v:I.clone(),n:C.clone(),pitch:R,roll:M});n=n.concat(x);for(m=0;m<n.length;m++)for(A=0;5>A;A++)D=n[m].n.clone(),D.normalize(),D.applyAxisAngle(n[m].pitch,2*Math.PI/6),D.applyAxisAngle(n[m].roll,2*Math.PI/5*A),D.multiplyScalar(.5),D=D.add(n[m].v),x=n[m].v.clone(),p.vertices.push(D),p.vertices.push(x),p.colors.push(aa[12]),p.colors.push(aa[12]);return p.colorsNeedUpdate=!0,p};this.pine=function(){var p=Math.floor(8*scope.random())+6,m=2*Math.PI/6,n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,
0,0));n.vertices.push(new THREE.Vector3(0,0,+p-.5+1));n.colors.push(aa[9]);n.colors.push(aa[9]);n.colors.push(aa[9]);for(var C=1;C<p;C++)for(var A=0;6>A;A++)off=C%2*m*.5,n.vertices.push(new THREE.Vector3(0,0,+C+1)),n.vertices.push(new THREE.Vector3(.3*(p-C),0,+C-.3+1)),n.vertices[n.vertices.length-1].applyAxisAngle(O,m*A+off),n.colors.push(aa[9]),n.colors.push(aa[9]);return n};this.checkpoint=function(){function p(A,x,R){var D=new THREE.Geometry,J=(new THREE.Vector3).copy(A).sub(x),I=(new THREE.Vector3).copy(A).add(J.clone().multiplyScalar(1.5));
J=(new THREE.Vector3).copy(x).sub(J.clone().multiplyScalar(1.5));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z-12));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));D.faces.push(new THREE.Face3(0,1,2));D.faces.push(new THREE.Face3(3,4,5));I=new THREE.Geometry;I.vertices.push(new THREE.Vector3(A.x,
A.y,A.z+6));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+8));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+6));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+8));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+6));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+6));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+8));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+8));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+1));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+1));A=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,
wireframe:!1,fog:!0});A.color=aa[5];D=new THREE.Mesh(D,A);D.visible=!0;A=new THREE.LineSegments(I,A);return D.name="Objective "+R,A.name="Checkpoint"+R,{display:A,collision:D}}var m=z.geometry,n=m.vertices.length-80;n=Math.floor(n/4)-Math.floor(n/4)%2;var C=[];C[0]=p(m.vertices[40],m.vertices[41],0);C[1]=p(m.vertices[40+n],m.vertices[1+n+40],1);C[2]=p(m.vertices[2*n+40],m.vertices[2*n+41],2);C[3]=p(m.vertices[3*n+40],m.vertices[3*n+41],3);C[4]=p(m.vertices[4*n+40],m.vertices[4*n+41],4);this.DISTANCE=
4*n/2*3;scope.start.copy(m.vertices[36]);scope.start.sub(m.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(m.vertices[36]);for(m=0;5>m;m++)null==K.best&&(K.best[m]=4>m?n*(m+1)/Sa:K.best[m]=K.best[m-1]);return S.STATE(),C};this.resetCheckpoints=function(){for(var p in scope.checkpoints)scope.checkpoints[p].display.material.color=aa[5]};this.random=function(){Oa=(Oa+1)%2147483647;var p=1E4*Math.sin(Oa);return p-Math.floor(p)};this.randomInt=function(p,m){return Math.floor(scope.random()*
(m-p))+p};this.noise=function(p){var m=new ob,n=[],C=8,A=0,x=0,R=1E3*scope.random();k;for(var D=0;D<p.vertices.length;D++)n[D]=0;for(D=0;2>D;D++){for(var J=0;J<p.vertices.length;J++)n[J]+=Math.floor(m.noise(p.vertices[J].x/C,p.vertices[J].y/C,R)*C),n[J]>A&&(A=n[J]),n[J]<x&&(x=n[J]);C*=3}for(m=0;m<n.length;m++){C=2===k?2:.5;for(A=0;A<z.geometry.vertices.length;A++)x=p.vertices[m].distanceTo(z.geometry.vertices[A]),x=x*x/100,x<C&&(C=x);p.vertices[m].z+=n[m]*C}};this.name=function(){var p="";if(Ua)p=
S.custom_seed;else if(Fa||Za)p=S.CHALLENGES.seed;else{var m=[" forest"," pass"," mountain"],n="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var C=Math.ceil(3*Math.random())+1,A=0;A<C;)p+=n[Math.floor(Math.random()*n.length)],A++;n=2===k?1:0;n=m[Math.floor(n+Math.random()*(m.length-n))];p+=n;(.02<Math.random()||p!==eb)&&(p="",n=Math.floor(Math.random()*fb.length),p=fb[n])}return eb=
p,p}}function gb(){$a=!0;window.removeEventListener("touchstart",gb)}function Ha(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,g=window.innerWidth,k=window.innerHeight;ca.aspect=g/k;ca.updateProjectionMatrix();c.resize(g,k,a,Da);S.resize(g,k,a)}function hb(){if(window.requestAnimationFrame(hb),Va=window.performance.now(),!xa||y.IMPORT||Aa)if(y.REPLAY){if(ib(),K.update(),y.update(),!y.IMPORT){uas.update(y.TIMESTAMP);for(var a=0;a<Z.length;a++)Z[a].update(y.TIMESTAMP,
y.FRAME),Aa&&y.TIMESTAMP>Z[0].tape[Z[0].tape.length-1].time+5E3&&y.reset(!0)}}else if(Pa||ra.SCAN&&!xa)ca.up.set(0,0,1),ca.position.applyAxisAngle(ca.up,.01),ca.lookAt(new THREE.Vector3),Pa&&S.loading(),S.scanning();else{if(Aa||y.IMPORT){for(a="";a.length<Math.floor(Va/500)%4;)a+=".";c.clear();c.text("importing ghost data"+a,16,16);K.update()}ca.up.set(0,0,1);ca.position.applyAxisAngle(ca.up,.01);ca.lookAt(new THREE.Vector3,0,0,0)}else{y.update();for(a=0;a<Z.length;a++)y.START?Z[a].update(y.TIMESTAMP,
y.FRAME):Z[a].update(0,0);uas.update(y.TIMESTAMP);qa||ab||S.update();!$a||qa||Ka||c.dpad();E.RESET&&!qa&&(S.reset(),E.RESET=!1);K.update()}ya.render(da,ca);c.update(E.touches)}function pb(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,
mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var k=new THREE.Vector3;k.copy(ca.position);k.x+=Math.random()*a.snow.distance-a.snow.distance/2;k.y+=Math.random()*a.snow.distance-a.snow.distance/2;k.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(k)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var k=0;k<a.snow.mesh.geometry.vertices.length;k++){var f=
a.snow.mesh.geometry.vertices[k];f.z-=.5*y.DT();(Math.abs(f.z-ca.position.z)>a.snow.height/2||Math.abs(f.x-ca.position.x)>a.snow.distance/2||Math.abs(f.y-ca.position.y)>a.snow.distance/2)&&(f.copy(ca.position),f.x+=Math.random()*a.snow.distance-a.snow.distance/2,f.y+=Math.random()*a.snow.distance-a.snow.distance/2,f.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var g=0;4>g;g++)this.checkpoint[this.checkpoint.length]=
new THREE.Mesh(new THREE.Geometry);this.connect=function(k){k=void 0===k?!1:k;if(ca.position.set(0,400,200),ca.far=2E3,ca.updateProjectionMatrix(),ca.lookAt(new THREE.Vector3),ya.render(da,ca),!k){this.name=this.generate.name();k="";for(var f in this.name)k+=this.name.charCodeAt(f).toString();Oa=k}a.generate.connect();qb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(k){k=void 0===k?!1:k;Oa++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;
a.connect(k)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function rb(){var a=this,g,k,f=0,l=0;this.custom_seed="";var z="#1#ffffff#334#",u=Ba+"#1#",t=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(b){return b?(ma=b.uid,a.STATE(),ra.requestName(ma,function(e){fa=e;a.STATE()})):(ma=!1,a.STATE()),
null})};this.register=function(b){c.clear();a.STATE=function(){a.register(b)};ab=!0;a.inputName(function(){ab=!1;ra["export"]()},!0,"input name to save data")};this.resize=function(b,e){g=c.width;k=c.height;Ya=Math.floor((window.innerHeight/c.scale/c.row-34)/2)};this.wallet=function(){var b=y.yen();c.print("$ "+b.toString(),"2","1.0-4")};this.nav=function(b){b=void 0===b?function(){c.clear()}:b;c.style=0;c.sprite(8,64,8,8,"1.0-4+2p","2",8,8);c.button("","2","2+4p","1.0-4","8",function(){a.menu(b)},
!1)};this.title=function(b,e){a.breadcrumb(b,e);c.sprite(16,64,8,8,"1.0-4+2p","2",8,8);c.button("","1.0-7","2+4p","7","5",function(){t||c.backdrop(!1);b();qa=!1;a.SETTINGS=!1},!1);Wa?(c.style=1,c.sprite(40,72,8,10,"1.0-14","2",8,10),c.sprite(48,72,16,16,"1.0-19","2",16,16),c.sprite(16,72,16,16,"1.0-10","2",16,16),c.style=0,c.button("","1.0-23","2+4p","7","5",function(){var h=document.getElementById("mp3_player");h.currentTime=Math.random()*h.duration;h.play();a.STATE()},!1),c.button("","1.0-14","2+4p",
"7","5",function(){document.getElementById("mp3_player").pause();Wa=!1;a.STATE()},!1)):(c.style=2,c.sprite(16,72,16,16,"1.0-10","2",16,16),c.style=0,c.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();Wa=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=function(b,e){var h=void 0===e?function(){t||c.backdrop(!1);b();qa=!1;a.SETTINGS=!1}:function(){a.menu(b);qa=!0};c.style=Wa?1:0;e=Wa?" low recordings 0.0.6 feature mix":" menu";c.print(" "+
e,"2","2");c.style=0;c.print("<","2","2");c.button("","2","2+4p","7","8",h,!1)};this.menu=function(b){qa=!0;c.style=0;a.STATE=function(){a.menu(b)};t||c.backdrop();c.clear();a.title(b);c.sprite(0,0,1,1,"2","6","1.0-4",1);Aa?(c.print(" > view spectator controls","2","8"),c.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(c.print(" > modify vehicle","2","8"),c.button("","2","8+4p","1.0-4","5",function(){a.vehicle(b)},!1));c.sprite(0,0,1,1,"2","11","1.0-4",1);c.print(" > settings","2","13");
c.button("","2","13+4p","1.0-4","5",function(){a.settings(b)},!1);c.sprite(0,0,1,1,"2","16","1.0-4",1);var e=8,h;Aa?(h=uas.AUTOPILOT?"disable":"enable",c.button(h+" autopilot","2","1.0-2-"+e,"1.0-4","6",function(){c.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),e+=8,c.button("deploy vehicle","2","1.0-2-"+e,"1.0-4","6",function(){c.backdrop(!1);Aa=!1;a.STATE=function(){};y.reset(!1);a.reset();xa=!0;y.START=!1;y.disconnect();y.connect(K.start,K.surface,!1);a.play()},!0)):(xa||y.REPLAY)&&
(c.button("restart stage","2","1.0-2-"+e,"1.0-4","6",function(){c.backdrop(!1);a.reset()},!0),e+=8,c.button("next stage","2","1.0-2-"+e,"1.0-4","6",function(){c.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var b;a.STATE=function(){a.intro()};t=!0;c.clear();c.print("specialstage.io","2","2");c.print("-","2","4");c.style=0;Fa?(c.style=4,c.print("challenge detected!","2","12"),c.style=0,b=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",c.style=2,c.print("rival:","2","15"),
c.style=0,c.print(b,"9","15"),ra.requestName(a.CHALLENGES.uid,function(e){a.CHALLENGER=e;a.STATE()}),c.style=2,c.print("seed:","2","17"),c.style=0,c.print(a.CHALLENGES.seed,"9","17")):Ua&&(c.style=3,c.print("seed detected","2","13",1),c.style=0,c.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===ma||""!==fa?null!==fa&&""!==fa?(c.style=5,c.print("welcome back!","2","6"),c.style=0,c.print("> "+fa,"2","9"),c.style=2,c.print("[edit]",fa.length+"+5","9"),c.style=0,c.button("","2","9+4p",fa.length+
"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===fa||null===fa)||!1!==ma&&null===fa)&&(c.style=2,c.print("user data not detected","2","6"),c.style=0,c.print("> [register/sign in]","2","9"),c.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(c.style=2,c.print("> loading user data...","2","6"),c.style=0);c.style=2;c.print("0.0.6","2","1.0-4");c.style=0;a.nav(function(){a.intro()});c.print("menu","1.0-9","2");c.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},
!1);a.discord();a.startButton()};this.startButton=function(){c.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){c.clear();t=!1;c.renderer.style.background="transparent";c.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");K.connect();a.load()})};this.discord=function(){c.style=3;c.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);c.print("discord","1.0-9","1.0-4");c.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");c.style=
0};this.load=function(){a.STATE=function(){a.target();a.setBattleName()};a.TIMELIST=[];ra.scan(K.name,function(b){for(var e={$jscomp$loop$prop$t$91$156:0};e.$jscomp$loop$prop$t$91$156<b.length;e={$jscomp$loop$prop$t$91$156:e.$jscomp$loop$prop$t$91$156},e.$jscomp$loop$prop$t$91$156++)a.TIMELIST[e.$jscomp$loop$prop$t$91$156]={uid:b[e.$jscomp$loop$prop$t$91$156].uid,utc:b[e.$jscomp$loop$prop$t$91$156].utc,time:b[e.$jscomp$loop$prop$t$91$156].time,name:"..."},ra.requestName(b[e.$jscomp$loop$prop$t$91$156].uid,
function(w){return function(O){a.TIMELIST[w.$jscomp$loop$prop$t$91$156].name=O;a.STATE()}}(e)),ra.checkTime(ma,b[e.$jscomp$loop$prop$t$91$156].uid,b[e.$jscomp$loop$prop$t$91$156].time);e=a.TIMELIST.length<Ba?a.TIMELIST.length:Ba;var h=[];switch(Ca){case 0:h=b.slice(0,e);break;case 1:for(b=b.slice();h.length<e;){var r=Math.floor(Math.random()*b.length);h.push(Object.assign({},b[r]));b.splice(r,1)}}a.BATTLE=h.slice();a.STATE()});Pa=!0;a.target();f=0};this.ready=function(){Pa=!1;a.STATE()};this.play=
function(){c.clear();a.nav(a.play);qa=!1;c.style=0};this.complete=function(){qa=!0;c.clear();a.STATE=function(){};a.nav(a.complete);var b="stage complete!";c.style=0;c.print(b,"0.5-"+2*Math.round(b.length/2),"0.3-1",2);c.style=0;K.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=function(){a.results();y.replay()}):(a.STATE=function(){a.results()},y.REPLAY||(a.STATE=function(){},ra["export"](a.results)))},2E3);b=y.param().model+" ("+(y.param().power+1)+"/"+(y.param().drag+
1)+"/"+(y.param().sensitivity+1)+"/"+(y.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:fa,time:y.AT(),penalty:y.PENALTY(),score:y.AT()+y.PENALTY(),seed:K.name,rating:Math.round(K.generate.DISTANCE/(y.AT()+y.PENALTY())),distance:K.generate.DISTANCE,vehicle:b})};this.results=function(){a.STATE=function(){a.results()};c.clear();c.style=0;qa=!0;var b=0,e=y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5];if((e<La||!1===La)&&(La=e),0<a.TIMELIST.length){for(var h=0;h<a.TIMELIST.length;h++)if(e<
a.TIMELIST[h].time){b=h+1;break}0==b&&(b=a.TIMELIST.length+1)}a.nav(a.results);c.style=5;c.print("stage complete! "+K.name,"2","2");c.style=0;e=c.time(e);c.print(e,"2","5",2);h=y.overwrite(y.CHECKPOINT,K.best,!1);0!=b?c.print("rank "+b,2*e.length+"+3".toString(),"5+4p"):h?(h=Fa?"challenge victory!":"new record!",c.style=1,c.print(h,2*e.length+"+3".toString(),"5+4p"),c.style=0):Fa&&c.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");e=9;h=y.CHECKPOINT;if(320<k){for(var r=1;r<h.length-1;r++){c.style=
5;c.print("cp "+r,"2",e+"+"+r.toString());r;var w=h[r],O=a.split(r);c.print(O,"0.5+1",e+"+"+r.toString());"number"==typeof h[r]?(c.style=0,w=c.time(h[r])):(c.style=4,w="penalty",d="");c.print(w,"0.5 -1-"+w.length.toString(),e+"+"+r.toString());c.style=0;e+=1}e+=5}1===b&&(c.style=4,c.print("new record!","2",e.toString(),2),c.style=0);c.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);c.button("modify vehicle","2","1.0-20","0.5-3","4",function(){c.backdrop();a.vehicle(a.results)});
c.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});c.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});c.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){qa=!1;uas.replay();a.replay()})};this.checkpoint=function(b){b=void 0===b?!1:b;c.clear();c.style=0;a.nav(function(){a.checkpoint(b)});var e="";b?e+="missed checkpoint X "+Math.abs(y.CHECKPOINT[5]):e=this.split(y.OBJECTIVE);c.text(e,16,32);c.style=0};this.split=function(b){var e="",h=K.best[b]-
y.CHECKPOINT[b],r=2,w="";return Number.isNaN(h)?void 0===y.CHECKPOINT[b]?(r=4,e+="- 100 sec"):void 0===K.best[b]&&0>K.best[5]?(r=1,e+="+ 100 sec"):void 0===K.best[b]&&(r=1,e+="new time!"):(0<h?(w="+ ",r=1):0>h?(w="- ",r=4):w="+ ",h=Math.abs(h),e+="( "+w+c.time(h)+" )"),c.style=r,e};this.battle=function(){var b=new jb(ra.save(ra.tape),y.MODEL,y.PAINT);Z.push(b);a.reset()};this.replay=function(){if(!y.IMPORT&&!xa){a.STATE=function(){a.replay()};c.clear();Aa?a.nav(function(){a.replay()}):a.nav(a.results);
uas.AUTOPILOT?a.autopilot():a.drone();var b={};for(b.$jscomp$loop$prop$e$96$158=c.style=0;4>b.$jscomp$loop$prop$e$96$158;b={$jscomp$loop$prop$e$96$158:b.$jscomp$loop$prop$e$96$158},b.$jscomp$loop$prop$e$96$158++){var e="7+"+(4*b.$jscomp$loop$prop$e$96$158).toString(),h=b.$jscomp$loop$prop$e$96$158===uas.CAM-1?48:40;c.button("",e+"-10p","1.0-4+4p","3","4",function(r){return function(){uas.CAM=r.$jscomp$loop$prop$e$96$158+1;a.STATE()}}(b),!1);c.sprite(h,64,8,8,e,"1.0-4",8,8)}c.style=0;b=(uas.AUTOPILOT||
uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:fa;(uas.AUTOPILOT||uas.TARGETING)&&c.print(b,"2","1.0-7");c.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){c.style=0;c.style=0<uas.camera[uas.CAM].pov?4:2;c.sprite(72,64,8,8,"3","1.0-4",8,8);c.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);Aa||(c.print("<","2","2"),
c.button("","2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){c.style=uas.TARGETING?4:2;c.sprite(64,64,8,8,"3","1.0-4",8,8);c.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){c.clear();Pa=!0;Ua=Za=Fa=!1;a.PATH=!1;custom_seed="";K.name="";a.BATTLE=[];La=!1;window.history.pushState("","","/");ya.clear();y.REPLAY=!1;y.RESET=!0;y.disconnect();for(var b=0;b<Z.length;b++)Z[b].disconnect();uas.reset(!0);
Z=[];K.SNOW&&da.remove(K.snow.mesh);K.reset();xa=qa=!1;ra.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};c.backdrop(!1);c.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");c.print("dnf","0.5-3+3p","0.5-8",2);c.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(b){b=void 0===b?"reset":b;Z.index=0;c.clear();a.nav(a.play);xa=!0;qa=!1;y.reset(!1);for(var e=0;e<Z.length;e++)Z[e].reset();
firebase.analytics().logEvent("stage_restart",{status:b})};this.hide=function(b){};this.update=function(){qa||!xa||Ka||(c["delete"](16,16,g-64,16),c["delete"](16,k-32,64,16),c.text(c.time(y.AT()),16,16),c.text(y.SPEED.toString(),16,k-32))};this.loading=function(){for(var b="";b.length<Math.floor(Va/500)%4;)b+=".";qa||(c["delete"](16,16,160,8),c.style=2,c.text("stage generating"+b,16,16),c.style=0);f++};this.scanning=function(){if(0===S.TIMELIST.length&&ra.SCAN&&!qa){c["delete"](16,72,88,8);for(var b=
"";b.length<Math.floor(Va/500)%4;)b+=".";c.style=5;c.text("scanning"+b,16,72)}};this.target=function(){c.clear();a.STATE=function(){a.target()};a.nav(a.target);var b,e,h=K.name,r=function(){c.clear();K.SNOW&&da.add(K.snow.mesh);a.STATE=function(){};K.generate.END=!1;a.play();y.SPECTATE=!1;xa=!0;y.connect(K.start,K.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")};if(Pa||(c.style=2,c.print("stage generated.","2","2"),ra.SCAN?(c.style=2,c.button("ready (no data)","2","1.0-10",
"1.0-4","8",function(){r()})):(c.style=0,c.button("ready","2","1.0-10","1.0-4","8",function(){r()}),c.style=4,c.style=1,0<a.BATTLE.length&&c.button("spectate!","1.0-14","1.0-18","12","3",function(){cb=!0;xa=!1;K.generate.END=!1;K.SNOW&&da.add(K.snow.mesh);c.style=0;y.connect(K.start,K.surface);Aa=!0;a["import"]();c.clear();da.add(K.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),c.style=5,c.print(h,"2","5-1p",2),c.style=0,0!==a.TIMELIST.length||!ra.SCAN)if(0!==a.TIMELIST.length){var w=
a.TIMELIST.slice();for(h=0;h<w.length;h++)for(var O=0;O<w.length;O++)w[h].time<=w[O].time&&w[h].utc<w[O].utc&&h>O&&(b={},Object.assign(b,w[h]),e={},Object.assign(e,w[O]),w[h]=e,w[O]=b);c.style=2;c.print("best time:","2","9");c.style=0;c.print(c.time(w[0].time),"2","12",2);c.style=5;b=(h=w.length<Ya)?w.length:Ya;h=h?0:w.length-Ya;for(e=0;e<b;e++)c.print(e+1+". "+w[e].name,"2","16+"+2*e),c.print(c.time(w[e].time),"18","16+"+2*e);0<h&&c.print("+ "+h+" more entries","2",2*b+"+17")}else c.style=2,c.print("no entries found.",
"2","9"),c.style=0};this.setBattleName=function(){for(var b=0;b<a.BATTLE.length;b++)a.BATTLE[b].name=a.TIMELIST[b].name};this["import"]=function(){a.setBattleName();for(var b={$jscomp$loop$prop$o$105$160:0};b.$jscomp$loop$prop$o$105$160<a.BATTLE.length;b={$jscomp$loop$prop$o$105$160:b.$jscomp$loop$prop$o$105$160},b.$jscomp$loop$prop$o$105$160++)y.IMPORT=!0,ra["import"](K.name+"/"+a.BATTLE[b.$jscomp$loop$prop$o$105$160].uid,function(e){return function(h){a.BATTLE[e.$jscomp$loop$prop$o$105$160].IMPORT_BUFFER=
[];y.INPUTS=[];a.BATTLE[e.$jscomp$loop$prop$o$105$160].data=[];a.BATTLE[e.$jscomp$loop$prop$o$105$160].param={power:h.param.power,drag:h.param.drag,sensitivity:h.param.sensitivity,model:h.param.model,paint:h.param.paint};a.BATTLE[e.$jscomp$loop$prop$o$105$160].cp=h.cp;for(var r=0;r<h.debug.length;r++){var w={time:h.debug[r].time,U:h.debug[r].U,D:h.debug[r].D,L:h.debug[r].L,R:h.debug[r].R};a.BATTLE[e.$jscomp$loop$prop$o$105$160].data.push({U:h.debug[r].U,D:h.debug[r].D,L:h.debug[r].L,R:h.debug[r].R,
time:h.debug[r].time});a.BATTLE[e.$jscomp$loop$prop$o$105$160].IMPORT_BUFFER.push(w)}e.$jscomp$loop$prop$o$105$160===a.BATTLE.length-1&&y["import"]()}}(b))};this.uasComputer=function(){c.clear();c.style=0;var b;c.print("autopilot "+(uas.AUTOPILOT?"enabled":"disabled"),"2","2");uas.AUTOPILOT?(b=S.TIMELIST[uas.data().target].name,c.print("targeting: "+b,"2","4")):(b=0<Z.length?S.TIMELIST[uas.data().target].name:"disabled",c.print("targeting: "+b,"2","4"),c.style=2,b=uas.CTRL||E.SHIFT?"roll":"yaw",c.print("ctrl: "+
b,"2","1.0-4"),c.button("","0","1.0-4+4p","14","4",function(){a.uas(!0);uas.tutorial=!0},!1),c.style=0)};this.uas=function(b){c.clear();c.style=0;a.STATE=function(){a.uas()};c.backdrop();c.sprite(16,64,8,8,"1.0-4+2p","2",8,8);c.button("","2","2","1.0","4",function(){c.backdrop(!1);a.replay()},!1);c.style=0;c.print("spectator controls","2","2");c.print("pilot mode","2","6");c.style=2;c.print("arrow            pitch/yaw/roll","2","10");c.print("shift + arrow    roll/yaw modifier","2","12");c.print("space            power +",
"2","14");c.print("shift + space    power -","2","16");c.print("ctrl:            roll/yaw toggle","2","18");c.print("r                reset","2","20");c.print("t                targeting mode toggle","2","22");c.print("shift + arrow    change target (targeting)","2","24");c.style=0};this.timelist=function(){c.style=0};this.save=function(){var b=fa+"#"+y.MODEL+"#"+y.PAINT+"#"+y.param().power+y.param().drag+ +y.param().sensitivity+"#"+Date.now();b!==z&&(z=b,a.cSave("SAVE",z))};this.vehicle=function(b){a.STATE=
function(){a.vehicle(b)};qa=!0;c.clear();a.title(function(){b();a.save()},function(){a.menu();sv()});y.REPLAY&&a.reset();var e=[],h=y.param();e.push({id:"power",value:h.power,funct:function(N){y.tune.power(N)}});e.push({id:"drag",value:h.drag,funct:function(N){y.tune.drag(N)}});e.push({id:"sensitivity",value:h.sensitivity,funct:function(N){y.tune.sensitivity(N)}});c.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);c.print("model","2","8+");c.print(y.models()[y.MODEL].name,"2+8","8+");c.sprite(0,0,1,1,"2",
"8++3","1.0-2-2",1);c.button(">","1.0-6","8++4p","4","4",function(){y.MODEL+=1;1<y.MODEL&&(y.MODEL=0);y.body();a.vehicle(b)},!1);c.button("<","1.0-12","8++4p","4","4",function(){--y.MODEL;0>y.MODEL&&(y.MODEL=1);y.body();a.vehicle(b)},!1);c.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);c.print("paint","2","8+5+");c.print(sb[y.PAINT],"10","8+5+");c.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);c.button(">","1.0-6","8+5++4p","4","4",function(){y.PAINT+=1;y.PAINT>Ia.length-1&&(y.PAINT=0);y.paint();a.vehicle(b)},
!1);c.button("<","1.0-12","8+5++4p","4","4",function(){--y.PAINT;0>y.PAINT&&(y.PAINT=Ia.length-1);y.paint();a.vehicle(b)},!1);for(h={$jscomp$loop$prop$t$107$162:0};h.$jscomp$loop$prop$t$107$162<e.length;h={$jscomp$loop$prop$t$107$162:h.$jscomp$loop$prop$t$107$162},h.$jscomp$loop$prop$t$107$162++){var r="8+5+5+"+(5*h.$jscomp$loop$prop$t$107$162).toString();c.print(e[h.$jscomp$loop$prop$t$107$162].id,"2",r);c.sprite(0,0,1,1,"2",r+"+3","1.0-2-2",1);for(var w={$jscomp$loop$prop$e$108$164:0};6>w.$jscomp$loop$prop$e$108$164;w=
{$jscomp$loop$prop$e$108$164:w.$jscomp$loop$prop$e$108$164},w.$jscomp$loop$prop$e$108$164++){var O="1.0-18+"+(3*w.$jscomp$loop$prop$e$108$164).toString(),P=w.$jscomp$loop$prop$e$108$164<=e[h.$jscomp$loop$prop$t$107$162].value?48:40;c.button("",O+"-10p",r+"+4p","3","4",function(N,ia){return function(){e[N.$jscomp$loop$prop$t$107$162].funct(ia.$jscomp$loop$prop$e$108$164);a.vehicle(b)}}(h,w),!1);c.sprite(P,64,8,8,O,r,8,8)}}};this.scan=function(b,e){};this.settings=function(b){a.STATE=function(){a.settings(b)};
a.SETTINGS=!0;u=Ba+"#"+Ca+"#"+(Ma?1:0)+"#"+(Ra?1:0)+"#";a.cSave("SETTINGS",u);c.clear();t||c.backdrop();a.title(b,a.menu);c.sprite(0,0,1,1,"2","6","1.0-4",1);c.print("ghost config","2","8");c.print("[edit]","1.0-2-6","8");c.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(b)},!1);c.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(e=Ma?"enabled":"disabled",c.print("display touch hitboxes","2","13"),c.print(e,"1.0-2-"+e.length,"13"),c.sprite(0,0,1,1,"2","21","1.0-4",1),c.button("","2","13+4p","1.0-4",
"5",function(){Ma=!Ma;a.settings(b)},!1)):(c.print("keybindings","2","13"),c.print("arrow / wasdr","1.0-15","13"),c.sprite(0,0,1,1,"2","21","1.0-4",1));c.sprite(0,0,1,1,"2","16","1.0-4",1);c.print("pixel scale","2","18");c.print(""+Da,"1.0-18","18");c.button("+","1.0-6","18+4p","4","4",function(){2>Da&&(Da+=.5);c.style=0;a.settings(b);Ha()},!1);c.button("-","1.0-12","18+4p","4","4",function(){1<Da&&(Da-=.5);c.style=0;a.settings(b);Ha()},!1);c.sprite(0,0,1,1,"2","26","1.0-4",1);c.print("camera mode",
"2","23");var e=y.FPV?"fpv":"tpv";c.print(e,"1.0-6","23");c.button("","2","23+4p","1.0-4","5",function(){y.FPV=!y.FPV;a.settings(b)},!1);c.print("www.procedural.ca","2","1.0-10");c.print("www.ginko.ltd","2","1.0-8");a.discord();c.style=0};this.ghostConfig=function(b,e){a.STATE=function(){a.ghostConfig(b)};var h=Ra?1:0;u=Ba+"#"+Ca+"#"+(Ma?1:0)+"#"+h;a.cSave("SETTINGS",u);c.clear();t||c.backdrop();a.title(b,function(){a.settings(b)});c.sprite(0,0,1,1,"2","6","1.0-4",1);c.print("ghost name","2","8");
c.print(fa,"1.0-13-"+fa.length,"8");c.print("[edit]","1.0-8","8");c.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(b)},!1)},!1);c.sprite(0,0,1,1,"2","11","1.0-4",1);c.print("ghost limit","2","13");h=Ba.toString();c.print(h,"1.0-13-"+h.length,"13");c.button(">","1.0-6","13+4p","4","4",function(){20>Ba&&(Ba+=1);a.ghostConfig(b)},!1);c.button("<","1.0-12","13+4p","4","4",function(){0<Ba&&--Ba;a.ghostConfig(b)},!1);c.sprite(0,0,1,1,"2","16","1.0-4",1);c.print("ghost priority",
"2","18");h=0===Ca?"best":"random";c.print(h,"1.0-13-"+h.length,"18");c.button(">","1.0-6","18+4p","4","4",function(){Ca+=1;1<Ca&&(Ca=0);a.STATE()},!1);c.button("<","1.0-12","18+4p","4","4",function(){--Ca;0>Ca&&(Ca=1);a.STATE()},!1);c.sprite(0,0,1,1,"2","21","1.0-4",1);c.print("ghost particles","2","23");h=Xa?"enabled":"disabled";c.print(h,"1.0-2-"+h.length,"23");c.button("","2","23+4p","1.0-4","4",function(){Xa=!Xa;for(var r=0;r<Z.length;r++)Z[r].toggleEmitter(Xa);a.ghostConfig(b)},!1);c.sprite(0,
0,1,1,"2","26","1.0-4",1)};this.controls=function(b){c.clear();a.title(b,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){c.clear();c.print("specialstage.io","4","4",2);c.print("-","4","8",2)};this.challenge=function(b){c.clear();a.nav(function(){a.challenge()},a.menu);c.print("issue challenge url","2","2");c.print("-","2","4");c.style=2;c.print("issued by","2","6");
c.style=0;c.print("> "+fa,"2","9");c.style=2;c.print("[edit]",fa.length+"+9","9");c.button("","2","9+4p",fa.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);c.style=2;c.print("seed","2","13");c.style=5;c.print(K.name,"2","15");c.style=2;c.print("time","2","19");b=c.time(y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5]);c.style=5;c.print(b,"2","21");c.style=0;c.button("copy challenge url","1","1.0-8","1.0-2","8",function(){c.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){c.clear();
a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(b,e,h){e=void 0===e?!1:e;h=void 0===h?"enter display name:":h;a.STATE=function(){a.inputName(b,e,h)};c.clear();qa=!0;e?a.nav(function(){b()},a.menu):a.title(b);c.print(h,"2","2");c.textinput(fa,"2","4","1.0-2","6","operator_id");var r=document.getElementById("operator_id");c.button("accept","2","14","1.0-4","6",function(){c.clear();c.print("submitting name to db","2","2");fa=tb(r.value.toLowerCase());
!1===ma&&1<fa.length&&null!==fa?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,b,e);a.STATE=function(){}})["catch"](function(w){w.code;w.message}):!1!==ma&&1<fa.length&&null!==fa?a.submitName(ma,b,e):(c.clear(),c.print("invalid name","2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(b,e,h){h=void 0===h?!1:h;1<fa.length&&10>fa.length?firebase.database().ref("uid/"+b).set({name:fa},function(r){r?(c.clear(),r="PERMISSION_DENIED"===
r.code?"invalid name":"network error",c.print(r,"2","2"),window.setTimeout(function(){a.inputName(e,h)},1E3)):(c.clear(),c.print("name change successful","2","2"),window.setTimeout(e,1E3))}):(c.clear(),c.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(e,h)},1E3))};this.encodeURL=function(){for(var b="",e=K.name,h=0;h<e.length;h++){var r=e.charAt(h);r=" "===r?"-":r;b+=r}b=b+"/"+ma;window.history.pushState("","","/");e=window.location.href;var w="./#/"+b;navigator.clipboard.writeText("https://specialstage.io/#/"+
b).then(function(){c.print("url copied to clipboard","2","2");window.history.pushState("","",w)},function(){window.history.pushState("","",w);c.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:e+"#/"+b})};this.decodeURL=function(){for(var b=window.location.href,e="",h=[],r=!1,w=0,O=0;O<b.length;O++){var P=b.charAt(O);r?"/"===P?(Fa=!0,w++):(1===w&&(P="-"===P?" ":P,e+=P),1<w&&(h+=P)):"#"===P&&(r=!0,Ua=!0,w=0)}Fa&&0<h.length?(a.custom_seed=e,K.name=e,
a.CHALLENGES={seed:e,uid:h}):Ua&&(a.custom_seed=e,K.name=e,Fa=!1);Fa&&firebase.analytics().logEvent("challenge_accepted",{url:b})};this.cSave=function(b,e){var h=new Date;h.setTime(h.getTime()+2808E7);h="expires="+h.toUTCString();document.cookie=b+"="+e+";"+h+";path=/"};this.cLoad=function(b){b+="=";for(var e=document.cookie.split(";"),h=0;h<e.length;h++){for(var r=e[h];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(b))return r.substring(b.length,r.length)}return""};this.checksave=function(){var b=
a.cLoad("SAVE");if(0!==b.length&&null!=b){for(var e=0,h="",r="",w="",O="",P=0,N=0;N<b.length;N++){var ia=b.charAt(N);if("#"!==ia)switch(P){case 1:e=parseInt(ia);break;case 2:h+=ia;break;case 3:r+=b.charAt(N),w+=b.charAt(N+1),O+=b.charAt(N+2),N+=2}else P++}y.MODEL=parseInt(e);y.PAINT=parseInt(h);y.paint();y.tune.power(parseInt(r));y.tune.drag(parseInt(w));y.tune.sensitivity(parseInt(O))}else y.PAINT=0,y.paint();if(b=a.cLoad("SETTINGS"),0!==b.length&&null!=b){e=0;w=r=h="";for(O=0;O<b.length;O++)if(P=
b.charAt(O),"#"!==P)switch(e){case 0:h+=P;break;case 1:Ca=parseInt(P);break;case 2:r=parseInt(P);break;case 3:w=parseInt(P)}else e++;Ba=parseInt(h);Ma=0!==r;1===w&&(Ra=!0)}};this.credit=function(){c.clear();c.print("procedural.ca","2","1.0-6");c.print("ginko.ltd","2","1.0-4")};this.promo=function(){c.clear();c.print("0.0.5.3","2","2");c.sprite(0,88,47,8,"2","6-4p",188,32,4);c.sprite(49,88,40,8,"2","12-4p",160,32,4);c.sprite(1,0,255,16,"2","1.0-6",255,16);c.print("www.specialstage.io  ","2","1.0-8")};
this.fpv=function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2");c.print("new feature","4","0.5");c.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2");c.print("new feature","4","0.5");c.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2")},
4E3)};this.physics=function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2");c.print("update","4","0.5");c.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){c.clear();c.print("play at","2","0.25-4");c.print("https://specialstage.io","2","0.25",1);c.print("challenges posted on discord","4","0.25+ 6");c.print("> discord.ginko.ltd","4","0.25 + 10");c.print("> discord.specialstage.io",
"4","0.25 + 12");window.setTimeout(a.music,2E3)};this.music=function(b){window.setTimeout(function(){c.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){c.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){c.clear();c.print("https://specialstage.io - 0.0.4","2","2");c.print("updates","2","6");c.print("> added ice biome","2","10");c.print("> added fpv camera","2","12");c.print("> added snow particle effects","2","14");c.print("> added terrain drag penalty",
"2","16");c.print("> improved vehicle physics","2","18");c.print("> increased gravity","2","20");c.print("> decreased air resistance","2","22");c.print("> disabled DNF timeout during button input for big jumps","2","24");c.print("> removed framerate dependecies","2","26");c.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){c.clear()},1E4)};this.plug=function(b){if("n"===b.key)switch(l){case 0:c.clear();window.setTimeout(a.promo,1E3);l++;break;case 1:window.setTimeout(a.biome,
1E3);l++;y.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);l++;y.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);l++;y.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);l++;y.CAMERA=1;break;case 5:c.clear(),l=0}}}function ub(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var g=this.renderer.getContext("2d");this.context=g;var k=document.createElement("img");k.src="./img/stage.font.0.0.6.png";k.onload=function(){a.connect();
a.onload()};document.createElement("canvas");this.onload=function(){};var f=document.createElement("canvas"),l=f.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var z=128,u=180,t=128,b=80,e;var h=128;var r=u;var w=128;var O=80;var P=!(e={x:128,y:u+60,w:128,h:40}),N=[],ia=[],T=[];this.connect=function(){g.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(q,B){q=void 0===q?0:q;B=void 0===B?"#ffffff":B;void 0===f[q]&&(f[q]=document.createElement("canvas"),
l[q]=f[q].getContext("2d"));l[q].drawImage(k,0,0,128,128,0,0,128,128);l[q].globalCompositeOperation="source-atop";l[q].fillStyle=B;l[q].fillRect(0,0,128,128);l[q].globalCompositeOperation="source-out"};this.resize=function(q,B,F,H){H=void 0===H?1:H;a.scale=F*H;var L=window.devicePixelRatio,ea=300>Math.ceil(L)/L*q?Math.floor(L):Math.ceil(L);0!=ea-L&&(F=ea/L*H);1>=L&&1<a.scale&&(F=a.scale);this.width=q/F;this.height=B/F;this.renderer.width=this.width;this.renderer.height=this.height;ya.setSize(this.width,
this.height);a.scale=F;this.renderer.style.transform="scale("+F+","+F+")";ya.domElement.style.transform="scale("+F+","+F+")";this.renderer.style.transformOrigin="top left";ya.domElement.style.transformOrigin="top left";g.imageSmoothingEnabled=!1;this.redraw();z=128;u=180;t=128;b=80;h=128;r=u;w=128;O=80;e={x:128,y:u+60,w:128,h:40};this.automate(this.width,this.height)};this.update=function(q){var B=0,F;for(F in q)for(var H in T)if(q[F].x>T[H].x*a.scale&&q[F].y>T[H].y*a.scale&&q[F].x<T[H].w*a.scale&&
q[F].y<T[H].h*a.scale&&(B++,1==q[F].start)){T[H].funct();q[F].start=!1;break}};this.print=function(q,B,F,H){H=void 0===H?1:H;for(var L=0,ea=a.compile(B,a.width,a.col),U=a.compile(F,a.height,a.row),Q=a.style;L<q.length;)a.encode(q.charAt(L),ea+L*a.col*H,U,H),L++;P||N.push(function(){a.style=Q;a.print(q,B,F,H)})};this.text=function(q,B,F,H,L){H=void 0===H?1:H;for(L=0;L<q.length;)a.encode(q.charAt(L),B+L*a.col*H,F,H),L++};this.button=function(q,B,F,H,L,ea,U,Q){U=void 0===U?!0:U;Q=void 0===Q?1:Q;var Y=
a.compile(B,a.width,a.col),la=a.compile(F,a.height,a.row),ka=a.compile(H,a.width,a.col),ba=a.compile(L,a.height,a.row),ja=a.style;U&&(g.drawImage(f[a.style],0,0,1,1,Y,la+ba/2,ka+1,1),g.drawImage(f[a.style],0,0,1,1,Y,la-ba/2,ka+1,1),g.drawImage(f[a.style],0,0,1,1,Y,la-ba/2,1,ba),g.drawImage(f[a.style],0,0,1,1,Y+ka-1,la-ba/2,1,ba+1));for(var ha=0;ha<q.length;)a.encode(q.charAt(ha),Y+ha*a.col+ka/2-Math.round(q.length*a.col)/2+2,la-a.row/2,Q),ha++;T.push({x:Y,y:la-ba/2,w:Y+ka,h:la+ba/2,funct:function(){ea()}});
P||N.push(function(){a.style=ja;a.button(q,B,F,H,L,ea,U,Q)})};this.line=function(q,B,F,H){a.sprite(0,0,1,1,q,B,F,H)};this.sprite=function(q,B,F,H,L,ea,U,Q){var Y=a.compile(L,a.width,a.col),la=a.compile(ea,a.height,a.row),ka=a.compile(U,a.width,a.col),ba=a.compile(Q,a.height,a.row),ja=a.style;g.drawImage(f[a.style],q,B,F,H,Y,la,ka,ba);P||N.push(function(){a.style=ja;a.sprite(q,B,F,H,L,ea,U,Q)})};this.backdrop=function(q,B,F,H,L){q=void 0===q?"#10101099":q;!1===q?(a.clear(),a.renderer.style.background=
"transparent"):(a.clear(),a.renderer.style.background=q)};this.getDrawList=function(){return N};this.redraw=function(){P=!0;a.clear();for(var q=0;q<N.length;q++)N[q]();q=document.body.getElementsByTagName("input");for(var B=0;B<q.length;B++)a.text(q[B].value,q[B].style.top,q[B].style.left);P=!1};this.automate=function(q,B){q=Math.floor(q/3)-2;B=Math.floor(B/4);t>q&&(t=q,z=q,w=q,h=q,e.w=q,e.x=q);u>B&&(u=B+40,r=u,e.y=u+60)};this.pad=function(q,B,F,H,L,ea,U){var Q=0;for(U();Q<E.touches.length;)E.touches[Q].x>
B*a.scale&&E.touches[Q].y>F*a.scale&&E.touches[Q].x<(B+H)*a.scale&&E.touches[Q].y<(F+L)*a.scale&&ea(),Q++;Ma&&(g.drawImage(f[a.style],0,0,1,1,B+1,F,H-1,1),g.drawImage(f[a.style],0,0,1,1,B+1,F+L,H-1,1),g.drawImage(f[a.style],0,0,1,1,B+1,F,1,L),g.drawImage(f[a.style],0,0,1,1,B+H-1,F,1,L));a.encode(q,B+H/2-a.col/2,F+L/2-a.row/2)};this.dpad=function(){g.drawImage(f[a.style],88,88,40,40,a.width-h+w/2-20,a.height-r+O/2-20,40,40);a.pad("<",z-t-1,a.height-u,t,b,function(){E.LEFT=!0},function(){E.LEFT=!1});
a.pad(">",z+1,a.height-u,t,b,function(){E.RIGHT=!0},function(){E.RIGHT=!1});a.pad("^",a.width-h,a.height-r,w,O,function(){E.UP=!0},function(){E.UP=!1});a.pad("b",a.width-e.x,a.height-e.y+e.h/2,e.w,e.h,function(){E.DOWN=!0},function(){E.DOWN=!1})};this.clear=function(){if(!P){for(var q=document.body.getElementsByTagName("input"),B=0;B<q.length;B++)document.body.removeChild(q[B]);if(!a.REDRAW){N=[];for(q=0;q<ia.length;q++)document.body.removeChild(ia[q]);ia=[]}N=[]}T=[];g.clearRect(0,0,a.width,a.height)};
this["delete"]=function(q,B,F,H){B=void 0===B?0:B;F=void 0===F?ya.width:F;H=void 0===H?ya.height:H;q=a.compile(void 0===q?0:q,a.width,a.col);B=a.compile(B,a.height,a.row);F=a.compile(F,a.width,a.col);H=a.compile(H,a.height,a.row);g.clearRect(q,B,F,H)};this.encode=function(q,B,F,H){H=void 0===H?1:H;var L=q.charCodeAt(0);q=8*L%128;L=8*Math.floor(L/16);g.clearRect(B,F,8,8);g.drawImage(f[a.style],q,L,8,8,B,F,8*H,8*H)};this["float"]=function(q,B){var F=Math.floor(Math.abs(100*q));F=F.toString();var H=
F.slice(0,F.length-2),L=F.slice(F.length-2,F.length);return 0==q?"0.00":(0==H.length&&(H="0"),2>L.length&&(L+="0"),B&&0<q?H="+"+H:0>q&&(H="-"+H),F=H+"."+L,F)};this.compile=function(q,B,F){var H=0;switch(B=Math.floor(B),typeof q){case "number":H=q;break;case "function":H=q();break;case "string":for(var L=!1,ea=1,U=0,Q="";U<q.length;){var Y=q.charAt(U);"."===Y?(Q+=Y,L=!0):"+"===Y?(Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,ea=1,H+=Q,L=!1,Q=""):"-"===Y?(Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,ea=-1,H+=Q,L=!1,Q=""):
"p"===Y?(Q=Number(Q),Q*=ea,H+=Q,Q=""):U===q.length-1?(Q+=Y,Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,H+=Q,Q=""):Q+=Y;U++}}return H};this.textinput=function(q,B,F,H,L,ea,U){var Q=a.compile(B,a.width,a.col),Y=a.compile(F,a.height,a.row),la=a.compile(H,a.width,a.col),ka=a.compile(L,a.height,a.row),ba=a.style;if(P)a.text("> "+U.value,Q,Y+ka/2);else{(U=document.createElement("input")).type="text";U.id=ea;U.name=ea;U.value=q;U.style.position="fixed";U.style.top=Y+"px";U.style.left=Q+"px";U.style.width=la+"px";
U.style.height=ka+"px";U.style.paddingLeft="12px";U.style.fontSize="14px";U.style.zIndex=9999;U.style.opacity=0;U.maxlength=10;a.text("> "+U.value,Q,Y+ka/2);document.body.appendChild(U);window.setTimeout(function(){U.focus();U.select()},200);U.oninput=function(){ja()};U.onfocusout=function(){ja()};U.onfocusin=function(){ja()};U.onclick=function(){ja()};var ja=function(ha){a["delete"](Q,Y,la,ka);a.text("> "+U.value,Q,Y+ka/2);a.text("_",U.selectionStart*a.col+2*a.col+Q,Y+ka/2)};N.push(function(){a.style=
ba;a.textinput(U.value,B,F,H,L,ea,U)})}};this.link=function(q,B,F,H,L,ea,U,Q){var Y=a.compile(B,a.width,a.col)*a.scale,la=a.compile(F,a.height,a.row)*a.scale,ka=a.compile(H,a.width,a.col)*a.scale,ba=a.compile(L,a.height,a.row)*a.scale,ja=a.style;P||N.push(function(){return new function(){a.style=ja;ha.style.left=Y+"px";ha.style.top=la+"px";ha.style.width=ka+"px";ha.style.height=ba+"px";a.print(q,Y,la)}});var ha=document.createElement("a");ha.href=ea;ha.style.left=Y+"px";ha.style.top=la+"px";ha.style.width=
ka+"px";ha.style.height=ba+"px";ha.style.display="block";ha.style.zIndex=400;ha.style.position="fixed";ha.target="_blank";ha.id=ea;document.body.appendChild(ha);ia.push(ha);P=!0;a.print(q,Y,la);P=!1};this.time=function(q){return(q/100).toFixed(2)};this.typewrite=function(q){a.clear();for(var B={$jscomp$loop$prop$e$136$166:0};B.$jscomp$loop$prop$e$136$166<q.length;B={$jscomp$loop$prop$e$136$166:B.$jscomp$loop$prop$e$136$166},B.$jscomp$loop$prop$e$136$166++){var F=(B.$jscomp$loop$prop$e$136$166,0);
F=Math.floor(B.$jscomp$loop$prop$e$136$166%32);var H=Math.floor(B.$jscomp$loop$prop$e$136$166/32);F=32+F%32*8;H=32+16*H;window.setTimeout(function(L){return function(){c.text(q.charAt(L.$jscomp$loop$prop$e$136$166),F,H)}}(B),50*B.$jscomp$loop$prop$e$136$166)}}}function vb(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return w};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=
[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.START_ROTATION=0;this.START_MESH=new THREE.Mesh;this.FRAME_TIME=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var g=[],k=0;this.TIMESTEP=Na;this.TIMESTAMP=0;this.REPLAY_START=
this.REPLAY=!1;this.INPUTS=[];var f=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),l=!1,z=!1,u=!1,t=!1,b=!0,e=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var h=0,r=0,w=0,O=0,P=!1,N=!1,ia=0,T=0;this.DT=function(){return 1};var q={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},B=0,F=0,H=0;B=.004;F=.985-.98;H=.08-.06;var L,ea,U,Q=6,Y,la=0,ka=0,ba=0,ja=new THREE.Vector3(0,1,0),ha=new THREE.Vector3(0,0,0),Sa=new THREE.Vector3,Ta=new THREE.Vector3(0,
5,0);new THREE.Vector3(1,0,0);var p=new THREE.Vector3(0,0,1),m=new THREE.Vector3(0,0,1),n=new THREE.Vector3(0,0,1),C=new THREE.Vector3(0,0,1),A=new THREE.Vector3(0,0,-.008),x=new THREE.Vector3,R=new THREE.Vector3,D=new THREE.Vector3,J=new THREE.Vector3;this.position=x.clone();this.direction=ja.clone();this.lookAt=x.clone();this.normal=m.clone();this.rotation=0;var I=[],M=new THREE.Vector3(0,0,1),V=new THREE.Raycaster(J,M,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};
this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var W=[{name:"logistics crate",geometry:function(){return Qa.logistics_crate()}},{name:"ag-86",geometry:function(){return Qa.ag_86()}}];this.models=function(){return W};this.PAINT=0;var ta=
new THREE.MeshBasicMaterial({color:Ia[a.PAINT]}),pa=(new THREE.LineSegments(W[a.MODEL].geometry(),ta)).clone();pa.name="Vehicle";var Ea=new Qa.emitter;this.connect=function(G,X){pa.copy(new THREE.LineSegments(W[a.MODEL].geometry(),ta));pa.name="Vehicle";pa.geometry.computeBoundingSphere();D.copy(G);D.z+=2;pa.position.copy(D);da.add(pa);Ea.connect(Ia[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();da.fog=new THREE.FogExp2(aa[0],.005);ca.fov=90;ca.updateProjectionMatrix();
da.add(K.generate.stars);a.START_POSITION.copy(D);a.START_NORMAL.copy(m);a.START_DIRECTION.copy(ja);a.START_VELOCITY.copy(Sa);a.START_MESH.copy(f);uas.TARGETS.length<Z.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);da.remove(pa);Ea.disconnect();da.fog=new THREE.FogExp2(aa[0],0);da.remove(K.generate.stars);this.DISCONNECT=!1};this.ready=function(G){G=void 0===G?window.performance.now():
G;var X;!l&&!this.REPLAY||this.RESET||(K.generate.checkpoints[0].display.material.color=aa[4],uas.reset(),T=1,P=!1,N=!1,b=!0,na.reset(),O=G,h=0,k=0,this.FRAME=0,g[k].time=0,g=[],g.length=0,k=0,g.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],X={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),
velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(X),a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,X={},Object.assign(X,g[k]),a.PHYSICSBUFFER.push(X),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(G){G=void 0===G?!1:G;a.REPLAY=G;a.RESET=!0;xa=!G;this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;e=Ka=this.END=this.START=!1;E.UP=!1;E.DOWN=!1;E.LEFT=!1;t=u=z=l=E.RIGHT=!1;T=w=ia=0;x.copy(a.START_POSITION);R.copy(x);ja.copy(a.START_DIRECTION);
Sa.copy(a.START_VELOCITY);m.copy(a.START_NORMAL);J.copy(x);this.position=x.clone();this.direction=ja.clone();this.lookAt=x.clone();this.normal=m.clone();Y=ba=la=ka=this.rotation=0;a.SPEED=0;M.copy(a.START_NORMAL);M.normalize();V.far=M.length();V.set(a.START_POSITION,M);n.copy(a.START_NORMAL);C.copy(a.START_NORMAL);C.add(a.START_POSITION);ca.updateProjectionMatrix();e=!0;Ea.reset();na.reset();uas.reset();g=[];O=k=0;this.IMPORT||(O=window.performance.now());for(G=0;G<K.generate.checkpoints.length;G++)K.generate.checkpoints[G].display.material.color=
aa[5];if(g[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY){this.DEBUG_BUFFER=[];h=0;a.best=a.overwrite(a.CHECKPOINT,a.best);K.best=a.overwrite(a.CHECKPOINT,K.best);this.CHECKPOINT=[];this.CHECKPOINT.length=6;a.inputs=[];a.inputs.push({key:0,time:0});for(G=0;G<Z.length;G++)Z[G].reset();a.PHYSICSBUFFER=[];G={};Object.assign(G,g[k]);a.PHYSICSBUFFER.push(G)}this.VALIDATE_CHECKPOINT=
[];this.VALIDATE_CHECKPOINT.length=6;f.position.copy(a.START_POSITION);f.lookAt(C);pa.lookAt(C);f.rotateOnAxis(p,0);f.updateMatrix();pa.updateMatrix();N=P=!1;b=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(G){G=void 0===G?window.performance.now():G;Ka||a.END||!e||a.REPLAY||a.RESET?(l=!1,z=!1,u=!1,t=!1):(l=E.UP,z=E.DOWN,u=E.LEFT,t=E.RIGHT,u&&t&&(u=!1,t=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?G+99999-O:G-O;G=0;if(this.TIMESTAMP>g[k].time){var X={};Object.assign(X,g[k]);
var oa=X.time;g=[];k=0;for(g.push({time:oa,position:X.position.clone(),normal:X.normal.clone(),direction:X.direction.clone(),velocity:X.velocity.clone(),rotation:X.rotation,step:X.step,U:X.U,D:X.D,L:X.L,R:X.R});oa<this.TIMESTAMP;){var sa;oa+=Na;this.REPLAY&&this.START&&(G=this.tapeReplay(oa));g.push({time:oa,position:g[k].position.clone(),normal:g[k].normal.clone(),direction:g[k].direction.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,step:g[k].step,U:l,D:z,L:u,R:t});k=g.length-1;
a.START&&(Ga=va=void 0,Ga=u&&t?0:u?1:t?-1:0,ba=g[k].step,0!=Ga&&Math.abs(ba)<Q?ba+=Ga:Math.abs(ba)>Q?(va=ba/Math.abs(ba),ba=Q*va):0<Math.abs(ba)&&(va=ba/Math.abs(ba),ba-=ba/Math.abs(ba),ba/Math.abs(ba)!=va&&(ba=0)),la=ba/Q*U,g[k].rotation+=la,g[k].step=ba,Y=g[k].velocity.length(),va=void 0,l&&b&&(ha.copy(g[k].direction),ha.multiplyScalar(L),g[k].velocity.add(ha)),z&&b&&g[k].velocity.multiplyScalar(.95),b?(N=!1,va=P?ea-.01:ea,g[k].velocity.multiplyScalar(va)):b||(N?g[k].velocity.add(A):N=!0,g[k].velocity.multiplyScalar(.998)),
g[k].position.add(g[k].velocity),f.position.copy(g[k].position),function(){I=[];J.copy(g[k].position);J.z-=50;M.set(0,0,1);V.far=100;V.set(J,M);K.surface.raycast(V,I);0<I.length?(J.copy(I[0].point),P=g[k].position.z<J.z&&5>Math.abs(g[k].position.z-J.z)?(r=0,b=!0,m.copy(I[0].face.normal),g[k].position.copy(J),1!==I[0].face.color.r):b=!1):0===I.length&&(b=!1,P=!1,l||z||u||t||a.REPLAY||(r+=Na),1E3<r&&!a.END&&!Ka&&(Ka=!0,S.dnf()));var ua=N?.001:.25;n.copy(g[k].normal);n.lerp(m,ua);ua=n.clone();ua.add(g[k].position);
g[k].normal=n.clone();f.lookAt(ua);f.rotateOnAxis(p,g[k].rotation);ja.copy(f.localToWorld(Ta.clone()));ja.sub(g[k].position);ja.normalize();g[k].direction.copy(ja)}(),function(){I=[];M.copy(g[k].position);M.sub(g[k-1].position);M.normalize();V.far=M.length();V.set(g[k].position,M);for(var ua=0,wa=!1,za=T;5>za;za++)if(K.generate.checkpoints[za].collision.raycast(V,I),0<I.length){ua=za;wa=!0;break}if(wa){za=g[k].position;wa=I[0].point;var Ja=g[k-1].position.distanceTo(wa);wa=za.distanceTo(wa);wa=g[k-
1].time+Ja/(Ja+wa)*a.TIMESTEP;K.generate.checkpoints[ua].display.material.color=aa[4];a.CHECKPOINT[ua]=Math.floor(wa/10);wa=T!==ua;a.CHECKPOINT[5]=0;for(za=1;za<ua;za++)void 0===a.CHECKPOINT[za]&&--a.CHECKPOINT[5];T=ua+1;4<=ua&&!a.REPLAY?(a.END=!0,a.REPLAY||S.complete()):a.REPLAY||a.IMPORT||S.checkpoint(wa)}a.SPEED=Math.round(60*Y/1E3*3600);a.START&&!a.END&&(h=Math.floor(g[k].time/10));a.OBJECTIVE=T;R.copy(x)}());f.updateMatrix();this.FRAME++;this.START&&!this.REPLAY?(sa={},Object.assign(sa,g[k]),
this.PHYSICSBUFFER.push(sa)):this.REPLAY&&G<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(sa={time:g[k].time,position:g[k].position.clone(),direction:g[k].direction.clone(),normal:g[k].normal.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,U:g[k].U,D:g[k].D,L:g[k].L,R:g[k].R,step:g[k].step},a.DEBUG_BUFFER.push(sa))}}var va,Ga;this.position.copy(g[k].position);this.direction.copy(g[k].direction);this.rotation=g[k].rotation;this.lookAt.copy(g[k].position);this.normal.copy(g[k].normal);
sa=this.normal.clone();sa.add(this.position);pa.position.copy(this.position);pa.lookAt(sa);pa.rotateOnAxis(p,this.rotation);Ea.update(l,this.position,this.direction,Y);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:ia,yen:0}};this.AT=function(){return h};this.convert=function(G){for(var X=[],oa=0;oa<G.length;oa++){var sa=G[oa].U,va=G[oa].D,Ga=G[oa].L,ua=G[oa].R,wa=sa&&va&&Ga,za=sa&&va&&ua,Ja=0;wa||za?wa?Ja="a":za&&(Ja="b"):
(Ja+=sa?3:va?6:0,Ja+=Ga?1:ua?2:0);X.push(Ja.toString())}return X};this.replay=function(G){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),xa=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(G,X){void 0===G||G?(a.SAVE_PARAM.power=X.power,a.SAVE_PARAM.drag=X.drag,a.SAVE_PARAM.sensitivity=X.sensitivity,a.SAVE_PARAM.model=X.model,a.SAVE_PARAM.paint=X.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),
a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var G=Z.length+" / "+S.BATTLE.length;0===Z.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);Z.length<S.BATTLE.length?(S.scan(G,!1),this.reset(),a.PAINT=S.BATTLE[Z.length].param.paint,a.MODEL=S.BATTLE[Z.length].param.model,a.paint(),a.body(),a.tune.power(S.BATTLE[Z.length].param.power),
a.tune.drag(S.BATTLE[Z.length].param.drag),a.tune.sensitivity(S.BATTLE[Z.length].param.sensitivity),a.INPUTS=S.BATTLE[Z.length].data,a.IMPORT_BUFFER=S.BATTLE[Z.length].IMPORT_BUFFER,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(g[k].time=0,this.IMPORT=!1,Aa?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),S.replay("import"),this.INPUTS=[]):(this.reset(!1),S.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),
a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(G){G=void 0===G?q.power:G;q.power=0>G?0:5<G?5:G;L=.016+q.power/5*B},drag:function(G){G=void 0===G?q.drag:G;q.drag=0>G?0:5<G?5:G;ea=.985-q.drag/5*F},sensitivity:function(G){G=void 0===G?q.sensitivity:G;q.sensitivity=0>G?0:5<G?5:G;U=.06+q.sensitivity/5*H},ease:function(G){G=void 0===G?q.ease:G;q.ease=0>G?0:5<G?5:G;Q=6+q.ease}};this.param=function(){return array=Object.assign(q,[]),array.model=a.MODEL,
array.paint=a.PAINT,array};this.paint=function(G){G=void 0===G?a.PAINT:G;a.PAINT=G;Ea.paint(Ia[G]);ta.color.set(Ia[G]);ta.needsUpdate=!0};this.body=function(){pa.geometry.dispose();pa.geometry=W[a.MODEL].geometry().clone();pa.geometry.verticesNeedUpdate=!0};this.yen=function(){return S.cSave("YEN",0),0};this.debug=function(){console.log("position:",x);console.log("direction:",ja);console.log("rotation:",ka);console.log("dt:",1);console.log("TIME:",Va);console.log("INTERPOLATION:",1);console.log("PHYSICS MESH:",
f.rotation);console.log("EASE",Q);console.log(g);console.log(r);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",g[k]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(G){var X=0;if(0==a.INPUTS.length)X=0;else if(G<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[X].time<G;)X++;l=this.INPUTS[X].U;z=this.INPUTS[X].D;u=this.INPUTS[X].L;t=this.INPUTS[X].R}else if(this.IMPORT){G=!0;for(var oa="",sa=1;sa<this.CHECKPOINT.length;sa++)this.CHECKPOINT[sa]!==
S.BATTLE[Z.length].cp[sa]&&(""===oa&&(oa+="checkpoint_discrepancy"),G=!1);a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==S.BATTLE[Z.length].time&&(G=!1,oa+="final_time_discrepancy");G?Z.push(new jb(this.DEBUG_BUFFER.slice(),this.MODEL,this.PAINT,this.CHECKPOINT.slice())):(firebase.analytics().logEvent("invalid_data",{seed:K.name,uid:S.BATTLE[Z.length].uid,name:S.BATTLE[Z.length].name,report:K.name+"/"+S.BATTLE[Z.length].uid+"("+S.BATTLE[Z.length].name+")"+oa+" : "+ma+"/("+fa+")",error:oa}),S.BATTLE.splice(Z.length,
1));this["import"]()}else a.replay(!1),this.START=this.IMPORT=!1;return X};this.overwrite=function(G,X,oa){oa=void 0===oa?!0:oa;var sa=G[4]+1E3*G[5]<X[4]*X[5]*1E3,va=G[5]>X[5],Ga=void 0!==G[4];return(0===X.length||sa||va)&&Ga?!oa||G:!!oa&&X};this.decode=function(G){var X=[function(){E.UP=!1;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!1;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!0;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!0;E.DOWN=
!1;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!0;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!0;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!1}];X.a=function(){E.UP=!0;E.DOWN=!0;E.LEFT=!0;E.RIGHT=!1};X.b=function(){E.UP=!0;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!0};X[G]()};this.audit=function(){}}function wb(a){var g=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=
this.frame=0;this.AT=function(){return g.tape[k].timer};this.DT=ib();var k=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(f){this.keybuffer.push({key:(E.UP?3:E.DOWN?6:0)+(E.LEFT?1:E.RIGHT?2:0),time:f})};this.simulate=function(){};this.capture=function(f){return{position:(new THREE.Vector3).copy(f.position),normal:(new THREE.Vector3).copy(f.normal),lookTarget:f.lookTarget.clone(),rotation:f.rotation,timer:f.getTime(),objective:f.getObjective(),check:f.check,UP:f.UP}};this.record=function(f){g.tape[k]=
f.record();k=24E4<g.tape[k].TS?0:k+1};this.play=function(f){if(this.RECORD){this.RECORD=!1;for(var l=g.frame=0;l<Z.length;l++)Z[l].reset();na.reset()}if(g.frame>g.tape.length-10){g.frame=0;na.reset();for(l=0;l<Z.length;l++)Z[l].reset();K.generate.resetCheckpoints()}if(f.replay(),this.tape[g.frame].check)K.generate.checkpoints[0===this.tape[g.frame].objective?4:this.tape[g.frame].objective-1].display.material.color=aa[4]};this.reset=function(){K.generate.resetCheckpoints();k=0;g.frame=0;na.reset();
g.PLAY=!1;g.RECORD=!0;g.tape=[]};this["export"]=function(f,l){f=void 0===f?function(){S.results()}:f;var z=y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5];if((z<La||!1===La)&&""!==fa&&null!==fa&&!1!==ma&&void 0!==ma&&!g.SCAN){S.STATE=function(){c.clear();c.print("uploading vhs to db","2","2")};S.STATE();ma;for(var u=K.name,t=y.CHECKPOINT.slice(),b=y.CHECKPOINT[0],e=y.param(),h=[];h.length<y.PHYSICSBUFFER.length;){var r=h.length;r={time:y.PHYSICSBUFFER[r].time,U:y.PHYSICSBUFFER[r].U,D:y.PHYSICSBUFFER[r].D,L:y.PHYSICSBUFFER[r].L,
R:y.PHYSICSBUFFER[r].R};h.push(r)}e={version:"006",id:ma,seed:u,time:z,cp:t,utc:b,debug:h,param:e};firebase.database().ref("vhs/006/"+e.seed+"/"+ma).set(e,function(w){w?(c.clear(),c.print("network error","2","2")):(c.clear(),c.print("vhs succesfully submitted","2","2"));window.setTimeout(f,1E3);uas.replay();y.replay()})}else void 0===ma||!1===ma||null===fa||""===fa||void 0===fa?S.register():(S.results(),uas.replay(),y.replay())};this.burn=function(f){return Math.round(1E9*f).toString(16)};this.read=
function(f){return parseInt(f,16)/1E9};this.scan=function(f,l){g.SCAN=!0;var z=[];firebase.database().ref("vhs/006/"+f).orderByChild("time").limitToFirst(99).once("value").then(function(u){u.forEach(function(t){var b=t.child("id").val(),e=t.child("time").val();t=t.child("utc").val();z.push({uid:b,time:e,utc:t})});g.SCAN=!1;l(z)})};this.checkTime=function(f,l,z){f===l&&(La=z)};this.requestName=function(f,l){firebase.database().ref("uid/"+f).once("value").then(function(z){z=z.child("name").val();return l(z),
z})};this["import"]=function(f,l){l=void 0===l?function(){}:l;firebase.database().ref("vhs/006/"+f).once("value").then(function(z){var u=z.val(),t=u.id,b=u.seed,e=u.cp.slice();z=u.utc;u.model;u.paint;u.param;l({uid:t,seed:b,cp:e,utc:z,debug:u.debug.slice(),param:u.param})})};this.save=function(f,l){l=void 0===l?1E3/30:l;for(var z=0,u=[],t=f[f.length-1].TS,b=0;b<t;)b+=l,b<t&&u.push({TS:b});for(t=0;t<u.length;t++)z=g.convert(f,u[t],z);return u};this.convert=function(f,l,z){for(var u=f[z].time,t=f[z+
1].TS,b=t-u;l.time>t&&z<f.length-2;)u=f[++z].time,t=f[z+1].time,b=t-u;u=z;var e=z+1;t=(b-(t-l.time))/b;return l.position=new THREE.Vector3,l.position.copy(f[u].position),l.position.lerp(f[e].position,t),l.lookTarget=new THREE.Vector3,l.lookTarget.copy(f[u].normal),l.lookTarget.lerp(f[e].normal,t),l.rotation=(f[e].rotation-f[u].rotation)*t,l.rotation+=f[u].rotation,l.rotation=(f[e].rotation-f[u].rotation)*t,l.rotation+=f[u].rotation,l.AT=(f[e].AT-f[u].AT)*t,l.AT+=f[u].AT,l.UP=f[u].UP,l.check=f[u].check,
l.objective=f[u].objective,z}}var jb=function(a,g,k,f){k=void 0===k?0:k;f=void 0===f?[]:f;var l=this,z=[];this.inputs=[];z[0]={name:"logistics crate",geometry:function(){return Qa.logistics_crate()}};z[1]={name:"ag-86",geometry:function(){return Qa.ag_86()}};var u=void 0===g?0:g;g=k;var t=a.slice();this.tape=t;var b=new THREE.Vector3(0,0,1),e=t[0].position.clone(),h=new THREE.Vector3;new THREE.Vector3(0,0,1);var r=new THREE.Vector3,w=new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;
this.direction=new THREE.Vector3;this.lookAt=e;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var O=z[u].geometry(),P=new THREE.MeshBasicMaterial({color:Ia[g]}),N=new THREE.LineSegments(O,P);N.name="ghost_"+Z.length;N.position.copy(t[0].position);da.add(N);var ia=new Qa.emitter;ia.connect(Ia[k]);a=f.slice();(a[4]<K.best[4]||null==K.best[4])&&(K.best=a.slice());uas.TARGETS.push(this);Aa&&(uas.TARGET=1);this.reset=function(){na.reset();ia.reset();l.update()};this.update=function(T,q){q=
q<t.length-1?q:t.length-1;t[q].time;var B=t[q].U;0!==q&&0!==T||(B=!1);N.position.copy(e);N.lookAt(r);N.rotateOnAxis(b,t[q].rotation);N.updateMatrix();Xa&&ia.update(B,e,h,l.velocity.length());e.copy(t[q].position);h.copy(t[q].direction);w.copy(t[q].normal);r.copy(w);r.add(e);this.position.copy(e);this.direction.copy(h);this.normal.copy(w)};this.index=function(T){var q=0;if(T<=t[t.length-2].time)for(;t[q].time<=T;)q++;else q=t.length-1;return q};this.toggleEmitter=function(T){void 0===T||T?ia.connect():
ia.disconnect()};this.disconnect=function(){da.remove(N);O.dispose();P.dispose();ia.disconnect()};this.debug=function(){console.log(t)}};window.onload=function(){window.addEventListener("touchstart",gb);window.addEventListener("contextmenu",function(){event.preventDefault()});da=new THREE.Scene;da.background=kb;lb=new THREE.Vector3(0,0,1);ca=new THREE.PerspectiveCamera;ca.up=lb;ca.position.z=2E3;ca.lookAt(0,0,0);ca.fov=70;ca.near=1E-5;ca.far=3E3;ca.name="Camera";da.add(ca);ya=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,
antialias:!1,precision:"highp"});ya.setClearColor(kb);ya.domElement.id="renderer";ya.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(ya.domElement);E=new nb;E.connect();c=new ub;K=new pb;y=new vb;ra=new wb;S=new rb;S.login();S.checksave();S.decodeURL();uas=new mb;uas.connect();c.onload=function(){c.format(1,"#50ffae");c.format(2,"#999999");c.format(3,"#75e8ff");c.format(4,"#ff7272");c.format(5,"#eeeeee");ca.position.set(0,25,10);ca.lookAt(0,0,0);Ha();hb();S.intro()}};window.onresize=
Ha;window.fullscreenchange=Ha;window.focus=Ha;var fb="development mountain;haunted forest;sheep pass;pine forest;shinigami graveyard;tofu route;ego mountain;lotus mountain;prey first pass;ginko mountain;ghxst pass;ghxstly forest;sleeping forest;do it pass;mew mountain;ultra mountain;vr pass;ratty mountain;coffee forest;r3 mountain;low tunnel pass;ogj route;lyla forest;the lotus order;deadmans wonderland;zynra mountain;nephil pass;r3evaluate pass;coen mountain;hoekage mountain;tora tora pass;tora forest;olive forest".split(";"),
aa=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],bb;for(bb in aa){var xb=new THREE.Color(aa[bb]);aa[bb]=xb}var Ia=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],sb="snow sakura melon peach bumblebee lavender ice".split(" "),La=!1,Ua="",Oa=Math.floor(2147483647*Math.random()),eb="",da,ca,ya,K,y,E,c,ra,S,Z=[],Na=1E3/60,Ba=12,Ya=9,Ca=0,Xa=!0,cb,Ra=!1,ab=!1,ma=null,fa="",lb,xa=!1,kb=aa[0],qb=0,Ka=!1,Pa=!1,qa=!1,$a=!1,Fa=
!1,Ma=!0,Va=0,Wa=!1,Za=!1,Aa=!1,Da=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Qa={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,
-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=
this;this.maxLife=100;for(var g=0,k=new THREE.Geometry;k.vertices.length<a.maxLife;){var f=new THREE.Vector3(0,0,0);f.life=0;f.maxLife=a.maxLife;f.acc=new THREE.Vector3(0,0,0);k.vertices.push(f);f=new THREE.Color(4294967040);k.colors.push(f)}k.verticesNeedUpdate=!0;var l=new THREE.Points(k,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));l.name="Emitter";var z=new THREE.Color;a.connect=function(u){u=void 0===u?16777215:u;da.add(l);
a.paint(u)};a.paint=function(u){u=new THREE.Color(void 0===u?16777215:u);z=new THREE.Color;u.getHSL(z);for(u=0;u<l.geometry.vertices.length;u++)l.geometry.colors[u].setHSL(z.h,z.s,0),l.geometry.vertices[u].life=0};a.reset=function(){for(var u=0;u<l.geometry.colors.length;u++)l.geometry.colors[u].setHSL(z.h,z.s,0),l.geometry.vertices[u].life=0};a.disconnect=function(){da.remove(l);l.geometry.dispose();l.material.dispose()};a.update=function(u,t,b,e){if(u)for(u=0;1>u;){l.geometry.vertices[g].copy(b);
l.geometry.vertices[g].multiplyScalar(-1-Math.random()*e);l.geometry.vertices[g].add(t);l.geometry.vertices[g].life=l.geometry.vertices[g].maxLife;Math.random();Math.random();Math.random();var h=.1*-Math.random();l.geometry.vertices[g].acc.copy(b);l.geometry.vertices[g].acc.multiplyScalar(h);g++;g%=l.geometry.vertices.length;u++}for(var r in l.geometry.vertices){var w;0<l.geometry.vertices[r].life&&(l.geometry.vertices[r].add(l.geometry.vertices[r].acc),--l.geometry.vertices[r].life,w=l.geometry.vertices[r].life/
100,l.geometry.colors[r].setHSL(z.h,z.s,z.l*w));0>=l.geometry.vertices[r].life&&(l.geometry.vertices[r].set(0,0,0),l.geometry.vertices[g].acc.x=0,l.geometry.vertices[g].acc.y=0,l.geometry.vertices[g].acc.z=0)}l.geometry.verticesNeedUpdate=!0;l.geometry.colorsNeedUpdate=!0;l.geometry.computeBoundingSphere()}}},ob=function(){function a(z){return z*z*z*(z*(6*z-15)+10)}function g(z,u,t){return u+z*(t-u)}function k(z,u,t,b){var e=15&z;z=8>e?u:t;b=4>e?t:12==e||14==e?u:b;return(0==(1&e)?z:-z)+(0==(2&e)?
b:-b)}for(var f=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,
118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],l=0;256>l;l++)f[256+l]=f[l];return{noise:function(z,u,t){var b=Math.floor(z),
e=Math.floor(u),h=Math.floor(t),r=255&b,w=255&e,O=255&h,P=(z-=b)-1,N=(u-=e)-1,ia=(t-=h)-1,T=a(z),q=a(u);b=a(t);e=f[r]+w;h=f[e]+O;e=f[e+1]+O;r=f[1+r]+w;w=f[r]+O;O=f[r+1]+O;return g(b,g(q,g(T,k(f[h],z,u,t),k(f[w],P,u,t)),g(T,k(f[e],z,N,t),k(f[O],P,N,t))),g(q,g(T,k(f[h+1],z,u,ia),k(f[w+1],P,u,t-1)),g(T,k(f[e+1],z,N,ia),k(f[O+1],P,N,ia))))}}},tb=function(a,g){for(var k="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e".split(" "),
f="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),l=a.toLowerCase(),z=0;z<l.length;z++){var u=l.charCodeAt(z);if(122<u||57<u&&61>u||33>u||40==u||41==u)return"";u="";for(var t=z;t<l.length;t++){l.charAt(t);var b=l.charCodeAt(t);(48<=b&&57>=b||97<=b&&122>=b)&&(u+=b.toString(16));for(b=0;b<k.length;b++){for(var e="",h="",r=[],w=0,O=0,P=0;P<k[b].length;P+=2){var N=u.charAt(P+w)+u.charAt(P+1+w),ia=k[b].charAt(P)+k[b].charAt(P+1);if((N===e||N===h)&&0!==N.length&&(O++,
0<O))for(;N===e||N===h;)w+=2,N=u.charAt(P+w)+u.charAt(P+1+w);if(N===ia)r[P/2]=!0,e=N,h=ia;else{r[P/2]=!1;for(var T=0;T<f.length;T++){var q=f[T].charCodeAt(1).toString(16),B=f[T].charCodeAt(0).toString(16);N===q&&(B===ia?(r[P/2]=!0,e=q,h=ia):B!==e&&B!==h||(O++,0<O&&(w+=2,P-=2)))}!1===r[P/2]&&(P=k[b].length)}}for(h=e=0;h<r.length;h++)if(!0===r[h]&&e++,e===r.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();
na.time=0;na.last=0;na.timestep=1E3/60;na.dt=1}},ib=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var g="[\n",k=0;k<a.length;k++){g+="'";for(var f=0;f<a[k].length;f++)g+=a[k].charCodeAt(f).toString(16);g+="',\n"}return g+="]",console.log(g),g}})();