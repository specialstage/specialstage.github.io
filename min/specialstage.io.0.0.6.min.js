(function(){function lb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],g=0;this.POV=0;var k=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:0,roll:0,yaw:0,pov:0,target:0,targeting:!1,autopilot:!0}},e=[],t=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,
lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},z=this.AUTOPILOT=!0;this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var m=this.CAM=1;this.camera=[];this.camera[0]=k();this.camera[0].distance=22;this.camera[0].position.set(0,0,9);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=k();this.camera[1].distance=22;this.camera[1].position.set(16,16,9);this.camera[1].lerp=
.05;this.camera[2]=k();this.camera[2].distance=22;this.camera[2].position.set(-16,16,9);this.camera[2].lerp=.05;this.camera[3]=k();this.camera[3].distance=22;this.camera[3].position.set(16,-16,9);this.camera[3].lerp=.05;this.camera[4]=k();this.camera[4].distance=0;this.camera[4].position.set(0,0,50);this.camera[4].lerp=.075;e[0]=t();e[1]=t();e[2]=t();e[3]=t();e[4]=t();this.reset=function(h){if(void 0===h?0:h)for(this.TARGET=this.CAM=0,this.TARGETS=[],h=0;h<this.camera.length;h++)this.camera[h].target=
0;1<a.length?a[g].time=0:(g=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:9E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:.0015,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:.0015,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var h=
0;h<this.camera.length;h++)this.camera[h].target=0,this.camera[h].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var h=0;h<this.camera.length;h++)this.camera[h].target=1,this.camera[h].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(h,c,f){h=void 0===h?new THREE.Vector3:h;c=void 0===c?new THREE.Vector3:c;f=void 0===f?new THREE.Vector3:f;var l=Ka||y.END?1E-5:.1;this.up.set(0,0,1);c=c.clone();c.multiplyScalar(-this.camera[0].distance+
4*(b.scale-1));c.add(h);c.z+=this.camera[0].position.z;a[g].position.lerp(c,l);a[g].lookAt.copy(f);a[g].up.set(0,0,1)};this.fpv=function(h,c,f,l){h=void 0===h?new THREE.Vector3:h;c=void 0===c?new THREE.Vector3:c;void 0===f&&new THREE.Vector3;l=void 0===l?new THREE.Vector3:l;a[g].position.copy(h);c=c.clone();c.add(h);a[g].lookAt.copy(c);l=l.clone();a[g].up.copy(l)};this.orbit=function(h,c,f){h=void 0===h?new THREE.Vector3:h;void 0===c&&new THREE.Vector3;f=void 0===f?new THREE.Vector3:f;E.SPACE;E.SHIFT;
E.UP;E.DOWN;E.LEFT;E.RIGHT;h=h.clone();h.add(this.camera[m].position);a[g].position.lerp(h,this.camera[m].lerp);a[g].lookAt.copy(f);a[g].up.set(0,0,1)};this.physics=function(h,c,f){h=void 0===h?0:h;if(h>a[g].time){var l=c.position.clone(),u=c.direction.clone(),w=c.lookAt.clone();c=c.normal.clone();f=((void 0!==f?f:l).clone(),{});Object.assign(f,a[g]);a=[];g=0;for(a.push(f);a[g].time<h;)f={},Object.assign(f,a[g]),a.push(f),g++,y.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(l,u,w):2===this.POV?this.fpv(l,
u,w,c):this.orbit(l,u,w):this.pilot():y.FPV?this.fpv(l,u,w,c):this.pov(l,u,l),a[g].time+=Na}};this.target=function(h){this.lookAt.copy(this.TARGETS[h].position)};this.update=function(h,c){h=void 0===h?0:h;c=void 0===c?this.TARGETS:c;this.CAM!==m?(m=this.CAM,this.TARGET=this.camera[m].target,this.TARGETING=this.camera[m].targeting,this.AUTOPILOT=this.camera[m].autopilot,this.POV=this.camera[m].pov,z=this.AUTOPILOT,z?(a[g].position.copy(this.camera[m].position),a[g].position.add(c[this.TARGET].position),
a[g].up.copy(this.camera[m].up)):(a[g].position.copy(e[m].position),a[g].lookAt.copy(e[m].lookAt),a[g].up.copy(e[m].up),a[g].velocity.copy(e[m].velocity),a[g].pitch.axis.copy(e[m].pitch.axis),a[g].roll.axis.copy(e[m].roll.axis),a[g].yaw.axis.copy(e[m].yaw.axis),a[g].pitch.value=e[m].pitch.value,a[g].roll.value=e[m].roll.value,a[g].yaw.value=e[m].yaw.value,a[g].speed=e[m].speed),S.replay()):(this.camera[m].target=this.TARGET,this.camera[m].pov=this.POV,this.camera[m].targeting=this.TARGETING,this.camera[m].autopilot=
this.AUTOPILOT);this.AUTOPILOT!==z&&(z=this.AUTOPILOT,this.AUTOPILOT?(a[g].position.copy(this.camera[m].position),a[g].up.copy(this.camera[m].up)):a[g].speed=0);this.physics(h,c[xa?0:this.camera[m].target]);h=(Na-(a[g].time-h))/Na;1<a.length&&(this.lookAt.copy(a[g-1].lookAt),this.lookAt.lerp(a[g].lookAt,h),this.position.copy(a[g].position),this.direction.copy(a[g].direction),this.lookAt.copy(a[g].lookAt),this.velocity.copy(a[g].velocity),this.up.copy(a[g].up),ca.position.copy(this.position),ca.up.set(this.up.x,
this.up.y,this.up.z),ca.lookAt(this.lookAt))};this.pilot=function(){var h=a[g],c=E.SPACE,f=E.SHIFT,l=E.UP,u=E.DOWN,w=E.LEFT,O=E.RIGHT;E.TARGET&&(this.TARGETING=!this.TARGETING,E.TARGET=!1,S.replay());h.pitch.value+=l?-h.pitch.power:u?+h.pitch.power:0;f&&!this.TARGETING?h.roll.value+=w?-h.roll.power:O?h.roll.power:0:(h.yaw.value+=w?h.yaw.power:O?-h.yaw.power:0,h.yaw.value*=h.yaw.drag);h.pitch.value*=h.pitch.drag;h.roll.value*=h.roll.drag;h.yaw.value*=h.yaw.drag;h.pitch.axis.applyAxisAngle(h.roll.axis,
h.roll.value);h.pitch.axis.applyAxisAngle(h.yaw.axis,h.yaw.value);h.roll.axis.applyAxisAngle(h.pitch.axis,h.pitch.value);h.roll.axis.applyAxisAngle(h.yaw.axis,h.yaw.value);h.yaw.axis.applyAxisAngle(h.pitch.axis,h.pitch.value);h.yaw.axis.applyAxisAngle(h.roll.axis,h.roll.value);f&&c&&-1<h.speed?h.speed-=.005:c&&1>h.speed&&(h.speed+=.005);h.velocity.copy(h.roll.axis);h.velocity.multiplyScalar(h.speed);h.position.add(h.velocity);this.TARGETING?(w&&0<this.TARGET&&(--this.TARGET,S.replay(),E.LEFT=!1),
O&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,S.replay(),E.RIGHT=!1),this.up.set(0,0,1),h.lookAt.lerp(this.TARGETS[this.TARGET].position,.1)):(h.up.copy(h.yaw.axis),h.lookAt.copy(h.roll.axis),h.lookAt.add(h.position));e[m].position.copy(h.position);e[m].lookAt.copy(h.lookAt);e[m].velocity.copy(h.velocity);e[m].up.copy(h.up);e[m].pitch.axis.copy(h.pitch.axis);e[m].roll.axis.copy(h.roll.axis);e[m].yaw.axis.copy(h.yaw.axis);e[m].pitch.value=h.pitch.value;e[m].roll.value=h.roll.value;e[m].yaw.value=
h.yaw.value;e[m].speed=h.speed};this.debug=function(){console.log("Vehicle Timestamp:",y.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt)}}function mb(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var g="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",
a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",
a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(k){var e="keydown"==k.type;switch(e||(g+=k.key),3<g.length&&(g=g.slice(1,4)),k.key){case "ArrowUp":a.UP=e;break;case "ArrowDown":a.DOWN=e;break;case "ArrowLeft":a.LEFT=e;break;case "ArrowRight":a.RIGHT=e;break;case "w":a.UP=e;break;case "s":a.DOWN=e;break;case "a":a.LEFT=
e;break;case "d":a.RIGHT=e;break;case "r":a.RESET=e;break;case " ":a.SPACE=e;break;case "Shift":a.SHIFT=e;break;case "Enter":a.ENTER=e;break;case "Control":a.CTRL=e;break;case "Escape":case "Backspace":a.ESC=e;break;case "=":a.ZOOM_IN=e;break;case "-":a.ZOOM_OUT=e;break;case "t":a.TARGET=e;break;case "h":a.HIDE=e;break;case ">":!e&&2>Da&&(Da+=.5);Ha();break;case "<":!e&&.5<Da&&(Da-=.5),Ha()}Ra?!ra.PLAY||qa||cb||"vhs"===g&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(ra["export"],
1E3,S.results,!1),g=""):"uas"===g&&(Ra=!0,qa=!0,S.settings(S.STATE),b.print("code detected: uas enabled","2","2"),g="")};this.mousedown=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!0}};this.mouseup=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!1}};this.touchSetup=function(k){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",
a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(k)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(k){k=k.touches;a.touches=[];for(var e=0;e<k.length;e++)a.touches[e]={x:k[e].clientX,y:k[e].clientY,
start:!0}};this.touchmove=function(k){a.touches=[];k=k.touches;for(var e=0;e<k.length;e++)a.touches[e]={x:k[e].clientX,y:k[e].clientY,start:!1}};this.touchend=function(k){a.touches=[];k=k.touches;for(var e=0;e<k.length;e++)a.touches[e]={x:k[e].clientX,y:k[e].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var g=[],k=0;g[0]={name:"forest",palette:aa[9],tree:function(q,n){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};g[0].map[0]=function(q,
n){var p=aa[10],C=!1;return.92<Math.abs(q)&&(p=.92<Math.abs(q)?aa[9]:aa[2],C=!0),g[0].flags[n]=C,p};g[1]={name:"sakura",palette:aa[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};g[1].map[0]=function(q,n){var p=aa[1],C=!1;return.95<Math.abs(q)&&(p=.92<Math.abs(q)?aa[12]:aa[1],C=!0),g[1].flags[n]=C,p};g[2]={name:"summit",palette:aa[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};g[2].map[0]=function(q,n){var p=
aa[7],C=!1;return.95<Math.abs(q)&&(p=.92<Math.abs(q)?aa[2]:aa[7],C=!0),g[2].flags[n]=C,p};var e=new THREE.Points(new THREE.Geometry);e.name="Generative Extruder";e.visible=!1;var t=new THREE.Line(new THREE.Geometry);t.name="Generative Nodes";t.visible=!1;t.material.color=aa[6];t.material.name="Node Material";t.position.z+=2;var z=new THREE.LineSegments(new THREE.Geometry);z.name="Generative Segments";z.visible=!0;z.material.color=aa[3];z.material.name="Segments Material";var m=new THREE.Mesh(new THREE.Geometry);
m.name="Generative Surface";m.visible=!1;m.material.color=aa[0];m.material.name="Surface Material";var h=new THREE.LineSegments(new THREE.Geometry);h.name="Generative Perimeter";h.material.color=aa[1];h.material.name="Perimeter Material";var c=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));c.name="Terrain";c.material.name="Terrain Material";c.material.wireframe=!0;c.material.side=THREE.DoubleSide;c.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,
new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var f=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));f.name="Trees";var l=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);l.name="Background";l.material.color=aa[0];l.material.name="Background Material";
l.material.wireframe=!1;l.material.side=THREE.FrontSide;l.material.opacity=.75;l.material.blendMode=THREE.MultiplyBlending;l.material.transparent=!0;var u=new THREE.Points(new THREE.Geometry);u.material.color=aa[1];u.material.sizeAttenuation=!1;u.material.size=1.5;u.material.fog=!1;scope.stars=u;var w=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);w.name="Collision Mesh";w.visible=!0;w.material.name="Collision Material";w.material.side=THREE.BackSide;this.checkpoints=[];var O=new THREE.Vector3(0,
0,1),P=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var N=new THREE.Vector3(0,3,0),ia=new THREE.Vector3(0,0,1),T=t.geometry.clone(),r=m.geometry.clone(),B=z.geometry.clone(),F=h.geometry.clone(),H=[],L=[],ea=new THREE.Vector3;H[0]=new THREE.Vector3(5,3,0);H[1]=new THREE.Vector3(-5,3,0);L[0]=H[0].clone();L.z+=1;L[1]=H[1].clone();L.z+=1;var U=Math.PI/64,Q=Math.PI/32,Y=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var ba=!1,ja=!1,ha=!1;this.IMPORT=this.END=!1;
this.DISTANCE=0;var Sa=18,Ta=new THREE.Raycaster;Ta.far=800;e.geometry.vertices[0]=N.clone();e.geometry.vertices[1]=O.clone().add(N);e.geometry.vertices[2]=H[0].clone();e.geometry.vertices[3]=H[1].clone();e.geometry.vertices[4]=L[0].clone();e.geometry.vertices[5]=L[1].clone();this.connect=function(){scope.SEED=Oa;k=scope.randomInt(0,3);K.SNOW=2===k;K.SNOW&&K.snow.init();da.add(e);da.add(t);da.add(z);da.add(h);da.add(m);da.add(wireframe);da.add(l);la=window.performance.now();window.setTimeout(scope.generate,
0)};this.disconnect=function(){for(var q in Y=[],da.remove(e),da.remove(t),da.remove(z),da.remove(h),da.remove(m),da.remove(wireframe),da.remove(l),da.remove(f),g)g[q].flag=[];for(var n in scope.checkpoints)da.remove(scope.checkpoints[n].display),scope.checkpoints[n].display.geometry.dispose(),scope.checkpoints[n].collision.geometry.dispose()};this.complete=function(){w.geometry.mergeVertices();w.geometry.verticesNeedUpdate=!0;w.geometry.elementsNeedUpdate=!0;w.geometry.computeFaceNormals();w.geometry.computeVertexNormals();
w.geometry.computeBoundingSphere();l.geometry.copy(w.geometry);--l.position.z;for(var q=[],n=0;n<w.geometry.faces.length;n++)q[w.geometry.faces[n].a]=w.geometry.faces[n].vertexNormals[0].clone(),q[w.geometry.faces[n].b]=w.geometry.faces[n].vertexNormals[1].clone(),q[w.geometry.faces[n].c]=w.geometry.faces[n].vertexNormals[2].clone();for(n=0;n<w.geometry.vertices.length;n++)w.geometry.vertices[n].add(q[n].multiplyScalar(2));w.geometry.verticesNeedUpdate=!0;w.geometry.computeFaceNormals();w.geometry.computeVertexNormals();
w.geometry.computeBoundingSphere();wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();q=new THREE.IcosahedronGeometry(1200,10);for(var p in q.vertices).3>scope.random()&&-400<q.vertices[p].z&&u.geometry.vertices.push(q.vertices[p].clone());q.dispose();u.geometry.computeBoundingSphere();K.surface=w.clone();K.start=scope.start.clone();la=window.performance.now()-
la;ba=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(la/1E3)});Za?(b.clear(),y.connect(K.start,K.surface),y.PLAY=!1,ra.PLAY=!0):S.ready()};this.reset=function(){Sa=(36+scope.random()-.5)/2;a=0;t.geometry.dispose();z.geometry.dispose();m.geometry.dispose();e.geometry.dispose();h.geometry.dispose();c.geometry.dispose();wireframe.geometry.dispose();w.geometry.dispose();f.geometry.dispose();u.geometry.dispose();B.dispose();F.dispose();T.dispose();r.dispose();
B.copy(new THREE.Geometry);F.copy(new THREE.Geometry);T.copy(new THREE.Geometry);r.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);e.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);m.geometry.copy(new THREE.Geometry);c.geometry.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);N.set(0,3,0);ia.set(0,0,1);H[0]=new THREE.Vector3(4,3,0);H[1]=new THREE.Vector3(-4,3,0);ba&&(ba=!1,ja=!1,ha=!1);this.END=!1;e.position.set(0,
0,0);e.geometry.vertices[0]=N.clone();e.geometry.vertices[1]=O.clone().add(N);e.geometry.vertices[2]=H[0].clone();e.geometry.vertices[3]=H[1].clone();e.geometry.vertices[4]=L[0].clone();e.geometry.vertices[5]=L[1].clone();e.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(q,n,p,C,A,x,R,D,J,I){q=void 0===q?0:q;n=void 0===n?0:n;p=void 0===p?0:p;C=void 0===C?0:C;A=void 0===A?0:A;x=void 0===x?{start:0,end:30,angle:0,slope:0}:x;R=void 0===R?[]:R;D=void 0===D?[]:
D;J=void 0===J?!1:J;I=void 0===I?999:I;var M=window.performance.now(),V=0;for(0===C&&(C=.5<scope.random()?1:-1);32>V&&!ja;){if(q===x.end+1){D=[];for(p=0;1>p;p++)if(q>=scope.length)D.push({angle:0,slope:0,end:30}),I=q+30;else if(0===n){var W=scope.randomInt(2,4)*C;V=Math.floor(Math.abs(36/W));C=.01>scope.random()?+C:-1*C;V=scope.randomInt(1,V);D.push({angle:W,slope:0,end:V})}else W=scope.randomInt(-5,-1),V=scope.random(),W=2!==k&&.05>V?W*=-1:W,V=scope.randomInt(2,20),D.push({angle:0,slope:W,end:V});
V=scope.randomInt(0,D.length);n=D[V].angle;p=D[V].slope;x.start=q;x.end=q+D[V].end;D=D.slice(V,1)}if(J||(scope.extrude(n,p),Y.push({angle:n,slope:p}),T.verticesNeedUpdate=!0,q++),10<=q&&!J){V=new THREE.Vector2(T.vertices[q-1].x,T.vertices[q-1].y);for(W=0;W<T.vertices.length-1-10;W++)if(18>(new THREE.Vector2(T.vertices[W].x,T.vertices[W].y)).distanceTo(V)){J=!0;break}J&&window.setTimeout(K.reset(!0),0)}0;q===I&&(ja=!0,t.geometry.dispose(),t.geometry=T.clone(),t.geometry.computeBoundingSphere(),t.geometry.center(),
t.updateMatrixWorld(),0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(T.vertices[0])),window.setTimeout(function(){S.PATH=!0;S.STATE();scope["import"]()},0));V=window.performance.now()-M}ja||J||window.setTimeout(scope.path,0,q,n,p,C,A,x,R,D,J,I)};this.skijump=function(q,n,p,C,A,x,R,D,J,I,M){q=void 0===q?0:q;n=void 0===n?0:n;p=void 0===p?0:p;C=void 0===C?0:C;A=void 0===A?0:A;x=void 0===x?{start:0,end:20,angle:0,slope:0}:x;R=void 0===R?[]:R;D=void 0===D?[]:D;J=void 0===J?!1:J;
I=void 0===I?300:I;M=void 0===M?0:M;var V=window.performance.now(),W=0;for(0===C&&(C=.5<scope.random()?1:-1);32>W&&!ja;){if(q===x.end+1){D=[];for(n=0;1>n;n++)0===p&&20===x.end?(M=-1,D.push({angle:0,slope:-4,end:30})):3===p?D.push({angle:0,slope:4,end:3}):4===p?D.push({angle:0,slope:-32,end:10}):-4===p?(M=1,D.push({angle:0,slope:p+1,end:1})):-32===p?D.push({angle:0,slope:-4,end:40}):1==M?D.push({angle:0,slope:p+1,end:1}):-1==M&&D.push({angle:0,slope:p-1,end:1});W=scope.randomInt(0,D.length);n=D[W].angle;
p=D[W].slope;x.start=q;x.end=q+D[W].end;D=D.slice(W,1)}if(J||(scope.extrude(n,p),Y.push({angle:n,slope:p}),T.verticesNeedUpdate=!0,q++),10<=q&&!J){W=new THREE.Vector2(T.vertices[q-1].x,T.vertices[q-1].y);for(var ta=0;ta<T.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(T.vertices[ta].x,T.vertices[ta].y)).distanceTo(W)){J=!0;break}J&&window.setTimeout(K.reset(!0),0)}0;I<=q&&(ja=!0,t.geometry.dispose(),t.geometry=T.clone(),t.geometry.computeBoundingSphere(),t.geometry.center(),t.updateMatrixWorld(),
0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(T.vertices[0])),window.setTimeout(function(){scope["import"]()},0));W=window.performance.now()-V}ja||J||window.setTimeout(scope.skijump,0,q,n,p,C,A,x,R,D,J,I)};this["import"]=function(q){q=void 0===q?0:q;for(var n=window.performance.now(),p=0;!ha&&32>p;){if(0===q&&(e.position.set(0,0,0),e.rotation.z=0,N.set(0,3,0),e.geometry.vertices[0]=N.clone(),e.geometry.vertices[1]=O.clone().add(N),e.geometry.vertices[2]=H[0].clone(),e.geometry.vertices[3]=
H[1].clone(),e.geometry.vertices[4]=L[0].clone(),e.geometry.vertices[5]=L[1].clone(),e.geometry.verticesNeedUpdate=!0,e.updateMatrixWorld()),q<Y.length)a=q,angle=Y[q].angle,slope=Y[q].slope,scope.extrude(angle,slope),z.geometry.dispose(),z.geometry=B.clone(),z.geometry.computeBoundingSphere(),h.geometry.dispose(),h.geometry=F.clone(),h.geometry.computeBoundingSphere(),m.geometry.dispose(),m.geometry=r.clone(),m.geometry.computeBoundingSphere(),q++;else if(!ha&&q===Y.length){for(var C in scope.checkpoints=
scope.checkpoint(),scope.checkpoints)da.add(scope.checkpoints[C].display);ha=!0;window.setTimeout(function(){scope.terrain(!0)},0)}p=window.performance.now()-n}ha||window.setTimeout(scope["import"],0,q,angle,slope)};this.extrude=function(q,n){q=void 0===q?0:q;n=void 0===n?0:n;for(var p in e.updateMatrixWorld(),e.rotateZ(q*Q),e.geometry.vertices)e.geometry.vertices[p].applyAxisAngle(P,n*U);e.geometry.verticesNeedUpdate=!0;p=e.geometry.vertices[0].clone();var C=e.geometry.vertices[2].clone(),A=e.geometry.vertices[3].clone(),
x=e.geometry.vertices[1].clone();if(p.applyMatrix4(e.matrix),C.applyMatrix4(e.matrix),A.applyMatrix4(e.matrix),x.applyMatrix4(e.matrix),x.sub(p),ja){if(C.add(ka),A.add(ka),0<B.vertices.length){var R=B.vertices[B.vertices.length-1].clone().sub(ea),D=B.vertices[B.vertices.length-2].clone().sub(ea);r.vertices.push(C.clone().sub(x));r.vertices.push(A.clone().sub(x));r.vertices.push(D);r.vertices.push(A.clone().sub(x));r.vertices.push(R);r.vertices.push(D);var J=C.clone();q=A.clone();R=B.vertices[B.vertices.length-
1].clone();D=B.vertices[B.vertices.length-2].clone();w.geometry.vertices.push(J);w.geometry.vertices.push(q);w.geometry.vertices.push(D);w.geometry.vertices.push(q);w.geometry.vertices.push(R);w.geometry.vertices.push(D);R=r.vertices.length;var I=new THREE.Face3(R-3,R-2,R-1);J=new THREE.Face3(R-5,R-4,R-6);r.faces.push(I);r.faces.push(J);I=I.clone();J=J.clone();I.color=new THREE.Color(16777215);J.color=new THREE.Color(16777215);w.geometry.faces.push(I);w.geometry.faces.push(J)}0<F.vertices.length?
(I=2,J=1,4<F.vertices.length&&(I=4,J=2),I=F.vertices[F.vertices.length-I].clone(),J=F.vertices[F.vertices.length-J].clone(),F.vertices.push(C.clone().add(x)),F.vertices.push(I.clone()),F.vertices.push(A.clone().add(x)),F.vertices.push(J.clone()),a==Y.length-1&&(D=C.clone().add(x),R=A.clone().add(x),F.vertices.push(D),F.vertices.push(R))):(F.vertices.push(C.clone().add(x)),F.vertices.push(A.clone().add(x)));B.vertices.push(C.clone());B.vertices.push(A.clone());ea.copy(x)}else T.vertices.push(p.clone());
for(var M in N.copy(p).sub(e.position),e.position.add(N),e.geometry.vertices)e.geometry.vertices[M].applyAxisAngle(P,-1*n*U)};this.terrain=function(q,n,p,C,A,x,R){n=void 0===n?[]:n;p=void 0===p?[]:p;C=void 0===C?[]:C;A=void 0===A?0:A;x=void 0===x?0:x;R=void 0===R?0:R;if(void 0===q||q){z.updateMatrixWorld();c.geometry.dispose();c.geometry.copy(new THREE.Geometry);n=[];p=[];C=[];for(q=0;2>q;q++)C[q]=[],n[q]=[],p[q]=[];for(q=0;q<z.geometry.vertices.length;q++)p[q%2].push(z.geometry.vertices[q]);for(q=
0;2>q;q++)for(var D=0;D<p[q].length;D++){var J=0===q?1:-1,I=p[q][D].clone();I.sub(p[q+J][D]);I.normalize().multiplyScalar(3);C[q][D]=I.clone()}}D=0;var M;q=window.performance.now();if(4>A){if(c.geometry.verticesNeedUpdate=!0,c.geometry.elementsNeedUpdate=!0,c.geometry.computeBoundingSphere(),c.geometry.computeFaceNormals(),c.geometry.computeVertexNormals(),c.updateMatrixWorld(),0<A&&0===R)for(p[x]=[],J=0;J<n[x].length;J++)p[x][J]=c.geometry.vertices[n[x][J]];0===R&&(n[x]=[]);for(v=R;v<p[x].length&&
32>D;){D=!1;if(void 0!==p[x][v]&&void 0!==p[x][v-1]){if(void 0===C[x][v])C[x][v]=C[s][v-1].clone();else if(c.geometry.computeBoundingSphere(),J=p[x][v].clone().add(C[x][v]),J.z-=100,Ta.set(J,O),J.z+=100,I=Ta.intersectObjects([c],!0),0<I.length)for(var V in I).01<I[V].point.distanceTo(J)&&(n[x][v]=void 0,D=!0);D||(c.geometry.vertices.push(p[x][v].clone()),c.geometry.vertices.push(p[x][v].clone().add(C[x][v])),n[x][v]=c.geometry.vertices.length-1,0<v&&(c.geometry.vertices.push(p[x][v-1].clone()),M=
c.geometry.vertices.length,0===x?c.geometry.faces.push(new THREE.Face3(M-2,M-1,M-3)):1===x&&c.geometry.faces.push(new THREE.Face3(M-1,M-2,M-3))))}D=window.performance.now()-q;v++;R=v}if(R===p[x].length){R=0;for(M=1;M<n[x].length;M++)if(void 0!==n[x][M]&&void 0!==n[x][M-1]){V=c.geometry.vertices[n[x][M]];var W;q=c.geometry.vertices[n[x][M-1]];2.8>V.distanceTo(q)?(V.copy(q),n[x][M]=n[x][M-1],C[x][M].copy(C[x][M-1])):1<M&&(c.geometry.vertices.push(p[x][M-1]),W=0===x?n[x][M]:n[x][M-1],q=0===x?n[x][M-
1]:n[x][M],c.geometry.faces.push(new THREE.Face3(W,q,c.geometry.vertices.length-1)))}x++}1<x&&(x=0,A++)}if(4===A){c.geometry.verticesNeedUpdate=!0;c.geometry.elementsNeedUpdate=!0;c.geometry.colorsNeedUpdate=!0;c.geometry.computeFaceNormals();c.geometry.computeVertexNormals();c.geometry.mergeVertices();c.geometry.computeBoundingSphere();scope.noise(c.geometry);for(W=0;W<c.geometry.faces.length;W++)V=c.geometry.vertices[c.geometry.faces[W].a].clone(),q=c.geometry.vertices[c.geometry.faces[W].b].clone(),
M=c.geometry.vertices[c.geometry.faces[W].c].clone(),c.geometry.colors[c.geometry.faces[W].a],c.geometry.colors[c.geometry.faces[W].b],c.geometry.colors[c.geometry.faces[W].c],w.geometry.vertices.push(V),w.geometry.vertices.push(q),w.geometry.vertices.push(M),wireframe.geometry.vertices.push(V),wireframe.geometry.vertices.push(q),wireframe.geometry.vertices.push(M),M=w.geometry.vertices.length,V=new THREE.Face3(M-1,M-2,M-3),V.color=new THREE.Color(0),w.geometry.faces.push(V),wireframe.geometry.faces.push(new THREE.Face3(M-
1,M-2,M-3));wireframe.geometry.copy(c.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,n.slice(),p.slice(),C.slice(),A,x,R)},0)};this.biome=function(){for(var q=k,n=wireframe.geometry.faces,p=[],C=[],A=0;A<n.length;A++)for(var x=0;x<g[k].map.length;x++)n[A].vertexColors[0]=g[k].map[x](n[A].vertexNormals[0].z,n[A].a),n[A].vertexColors[1]=g[k].map[x](n[A].vertexNormals[1].z,n[A].b),n[A].vertexColors[2]=
g[k].map[x](n[A].vertexNormals[2].z,n[A].c);for(n=0;n<g[k].flags.length;n++)for(A=0;A<z.geometry.vertices.length;A++).1>wireframe.geometry.vertices[n].distanceTo(z.geometry.vertices[A])&&(g[k].flags[n]=!1);for(n=0;n<g[k].flags.length;n++)g[k].flags[n]&&p.push(n);for(n=0;n<g[k].limit&&n<p.length;){A=scope.randomInt(0,p.length);x=!0;if(0<C.length&&0<p.length)for(;x;){for(var R in C){if(wireframe.geometry.vertices[p[A]].distanceTo(wireframe.geometry.vertices[C[R]])<g[k].range){x=!0;p.slice(A,1);A=scope.randomInt(0,
p.length);break}x=!1}0>=p.length&&(x=!1)}if(0<p.length){x=g[q].tree();for(var D in x.vertices)f.geometry.vertices.push(x.vertices[D].clone().add(wireframe.geometry.vertices[p[A]])),f.geometry.colors[f.geometry.vertices.length-1]=x.colors[D];C.push(p[A]);p.slice(A,1)}n++}f.verticesNeedUpdate=!0;f.elementsNeedUpdate=!0;da.add(f)};this.sakura=function(){var q=new THREE.Geometry,n=[],p=[],C=1,A,x=new THREE.Vector3(0,0,0),R=new THREE.Vector3(0,0,3),D=12,J=0,I=new THREE.Vector3(1,0,0),M=new THREE.Vector3(0,
0,1);q.vertices.push(x);q.vertices.push(R);q.colors.push(aa[2]);q.colors.push(aa[2]);p.push({v:R.clone(),n:R.clone(),pitch:I.clone(),roll:M.clone()});for(x=[];4>J;){R=[];for(I=0;I<p.length;I++)for(var V=M=0;3>V;V++){var W=0===J&&2===V&&1>M?1:scope.random();if(.2<W){W=scope.randomInt(-2,2);var ta=p[I].n.clone(),pa=aa[2];ta.applyAxisAngle(p[I].pitch,2*Math.PI/(D+W));ta.applyAxisAngle(p[I].roll,2*Math.PI/3*V);ta.multiplyScalar(C);W=ta.clone().add(p[I].v);q.vertices.push(p[I].v.clone());q.vertices.push(W);
q.colors.push(pa);q.colors.push(pa);pa=p[I].pitch.clone();pa.applyAxisAngle(p[I].roll,2*Math.PI/3*V);pa.applyAxisAngle(p[I].pitch,2*Math.PI/D);var Ea=p[I].roll.clone();Ea.applyAxisAngle(p[I].pitch,2*Math.PI/D);Ea.applyAxisAngle(p[I].roll,2*Math.PI/3*V);0<V&&n.push({a:W.clone(),b:p[I].v.clone(),pitch:pa,roll:Ea});R.push({v:W.clone(),n:ta.clone(),pitch:pa,roll:Ea});M++}else 0===M&&2===V&&x.push({v:p[I].v.clone(),n:p[I].n.clone(),pitch:p[I].pitch.clone(),roll:p[I].roll.clone()})}p=R.slice();C*=.9;J++}for(A in D=
6,n)C=n[A].a.clone(),R=n[A].b.clone(),C=C.clone().sub(R),I=C.clone().multiplyScalar(.5).add(R),J=scope.randomInt(0,3)-1,C.applyAxisAngle(n[A].pitch,2*Math.PI/D),C.applyAxisAngle(n[A].roll,2*Math.PI/J),C.multiplyScalar(.5),R=I,I=C.clone().add(I),q.vertices.push(R),q.vertices.push(I),q.colors.push(aa[2]),q.colors.push(aa[2]),R=n[A].pitch.clone(),R.applyAxisAngle(n[A].roll,2*Math.PI/J),R.applyAxisAngle(n[A].pitch,2*Math.PI/D),M=n[A].roll.clone(),M.applyAxisAngle(n[A].pitch,2*Math.PI/D),M.applyAxisAngle(n[A].roll,
2*Math.PI/J),p.push({v:I.clone(),n:C.clone(),pitch:R,roll:M});p=p.concat(x);for(n=0;n<p.length;n++)for(A=0;5>A;A++)D=p[n].n.clone(),D.normalize(),D.applyAxisAngle(p[n].pitch,2*Math.PI/6),D.applyAxisAngle(p[n].roll,2*Math.PI/5*A),D.multiplyScalar(.5),D=D.add(p[n].v),x=p[n].v.clone(),q.vertices.push(D),q.vertices.push(x),q.colors.push(aa[12]),q.colors.push(aa[12]);return q.colorsNeedUpdate=!0,q};this.pine=function(){var q=Math.floor(8*scope.random())+6,n=2*Math.PI/6,p=new THREE.Geometry;p.vertices.push(new THREE.Vector3(0,
0,0));p.vertices.push(new THREE.Vector3(0,0,+q-.5+1));p.colors.push(aa[9]);p.colors.push(aa[9]);p.colors.push(aa[9]);for(var C=1;C<q;C++)for(var A=0;6>A;A++)off=C%2*n*.5,p.vertices.push(new THREE.Vector3(0,0,+C+1)),p.vertices.push(new THREE.Vector3(.3*(q-C),0,+C-.3+1)),p.vertices[p.vertices.length-1].applyAxisAngle(O,n*A+off),p.colors.push(aa[9]),p.colors.push(aa[9]);return p};this.checkpoint=function(){function q(A,x,R){var D=new THREE.Geometry,J=(new THREE.Vector3).copy(A).sub(x),I=(new THREE.Vector3).copy(A).add(J.clone().multiplyScalar(1.5));
J=(new THREE.Vector3).copy(x).sub(J.clone().multiplyScalar(1.5));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));D.vertices.push(new THREE.Vector3(J.x,J.y,J.z-12));D.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));D.faces.push(new THREE.Face3(0,1,2));D.faces.push(new THREE.Face3(3,4,5));I=new THREE.Geometry;I.vertices.push(new THREE.Vector3(A.x,
A.y,A.z+6));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+8));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+6));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+8));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+6));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+6));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+8));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+8));I.vertices.push(new THREE.Vector3(A.x,A.y,A.z+1));I.vertices.push(new THREE.Vector3(x.x,x.y,x.z+1));A=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,
wireframe:!1,fog:!0});A.color=aa[5];D=new THREE.Mesh(D,A);D.visible=!0;A=new THREE.LineSegments(I,A);return D.name="Objective "+R,A.name="Checkpoint"+R,{display:A,collision:D}}var n=z.geometry,p=n.vertices.length-80;p=Math.floor(p/4)-Math.floor(p/4)%2;var C=[];C[0]=q(n.vertices[40],n.vertices[41],0);C[1]=q(n.vertices[40+p],n.vertices[1+p+40],1);C[2]=q(n.vertices[2*p+40],n.vertices[2*p+41],2);C[3]=q(n.vertices[3*p+40],n.vertices[3*p+41],3);C[4]=q(n.vertices[4*p+40],n.vertices[4*p+41],4);this.DISTANCE=
4*p/2*3;scope.start.copy(n.vertices[36]);scope.start.sub(n.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(n.vertices[36]);for(n=0;5>n;n++)null==K.best&&(K.best[n]=4>n?p*(n+1)/Sa:K.best[n]=K.best[n-1]);return S.STATE(),C};this.resetCheckpoints=function(){for(var q in scope.checkpoints)scope.checkpoints[q].display.material.color=aa[5]};this.random=function(){Oa=(Oa+1)%2147483647;var q=1E4*Math.sin(Oa);return q-Math.floor(q)};this.randomInt=function(q,n){return Math.floor(scope.random()*
(n-q))+q};this.noise=function(q){var n=new nb,p=[],C=8,A=0,x=0,R=1E3*scope.random();k;for(var D=0;D<q.vertices.length;D++)p[D]=0;for(D=0;2>D;D++){for(var J=0;J<q.vertices.length;J++)p[J]+=Math.floor(n.noise(q.vertices[J].x/C,q.vertices[J].y/C,R)*C),p[J]>A&&(A=p[J]),p[J]<x&&(x=p[J]);C*=3}for(n=0;n<p.length;n++){C=2===k?2:.5;for(A=0;A<z.geometry.vertices.length;A++)x=q.vertices[n].distanceTo(z.geometry.vertices[A]),x=x*x/100,x<C&&(C=x);q.vertices[n].z+=p[n]*C}};this.name=function(){var q="";if(Ua)q=
S.custom_seed;else if(Fa||Za)q=S.CHALLENGES.seed;else{var n=[" forest"," pass"," mountain"],p="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var C=Math.ceil(3*Math.random())+1,A=0;A<C;)q+=p[Math.floor(Math.random()*p.length)],A++;p=2===k?1:0;p=n[Math.floor(p+Math.random()*(n.length-p))];q+=p;.02<Math.random()&&(q="",p=Math.floor(Math.random()*eb.length),q=eb[p])}return q}}function fb(){$a=
!0;window.removeEventListener("touchstart",fb)}function Ha(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,g=window.innerWidth,k=window.innerHeight;ca.aspect=g/k;ca.updateProjectionMatrix();b.resize(g,k,a,Da);S.resize(g,k,a)}function gb(){if(window.requestAnimationFrame(gb),Va=window.performance.now(),!xa||y.IMPORT||Aa)if(y.REPLAY){if(hb(),K.update(),y.update(),!y.IMPORT){uas.update(y.TIMESTAMP);for(var a=0;a<Z.length;a++)Z[a].update(y.TIMESTAMP,y.FRAME),Aa&&
y.TIMESTAMP>Z[0].tape[Z[0].tape.length-1].time+5E3&&y.reset(!0)}}else if(Pa||ra.SCAN&&!xa)ca.up.set(0,0,1),ca.position.applyAxisAngle(ca.up,.01),ca.lookAt(new THREE.Vector3),Pa&&S.loading(),S.scanning();else{if(Aa||y.IMPORT){for(a="";a.length<Math.floor(Va/500)%4;)a+=".";b.clear();b.text("importing ghost data"+a,16,16);K.update()}ca.up.set(0,0,1);ca.position.applyAxisAngle(ca.up,.01);ca.lookAt(new THREE.Vector3,0,0,0)}else{y.update();for(a=0;a<Z.length;a++)y.START?Z[a].update(y.TIMESTAMP,y.FRAME):
Z[a].update(0,0);uas.update(y.TIMESTAMP);qa||ab||S.update();!$a||qa||Ka||b.dpad();E.RESET&&!qa&&(S.reset(),E.RESET=!1);K.update()}ya.render(da,ca);b.update(E.touches)}function ob(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,
new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var k=new THREE.Vector3;k.copy(ca.position);k.x+=Math.random()*a.snow.distance-a.snow.distance/2;k.y+=Math.random()*a.snow.distance-a.snow.distance/2;k.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(k)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var k=0;k<a.snow.mesh.geometry.vertices.length;k++){var e=
a.snow.mesh.geometry.vertices[k];e.z-=.5*y.DT();(Math.abs(e.z-ca.position.z)>a.snow.height/2||Math.abs(e.x-ca.position.x)>a.snow.distance/2||Math.abs(e.y-ca.position.y)>a.snow.distance/2)&&(e.copy(ca.position),e.x+=Math.random()*a.snow.distance-a.snow.distance/2,e.y+=Math.random()*a.snow.distance-a.snow.distance/2,e.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var g=0;4>g;g++)this.checkpoint[this.checkpoint.length]=
new THREE.Mesh(new THREE.Geometry);this.connect=function(k){k=void 0===k?!1:k;if(ca.position.set(0,400,200),ca.far=2E3,ca.updateProjectionMatrix(),ca.lookAt(new THREE.Vector3),ya.render(da,ca),!k){this.name=this.generate.name();k="";for(var e in this.name)k+=this.name.charCodeAt(e).toString();Oa=k}a.generate.connect();pb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(k){k=void 0===k?!1:k;Oa++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;
a.connect(k)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function qb(){var a=this,g,k,e=0,t=0;this.custom_seed="";var z="#1#ffffff#334#",m=Ba+"#1#",h=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(c){return c?(ma=c.uid,a.STATE(),ra.requestName(ma,function(f){fa=f;a.STATE()})):(ma=!1,a.STATE()),
null})};this.register=function(c){b.clear();a.STATE=function(){a.register(c)};ab=!0;a.inputName(function(){ab=!1;ra["export"]()},!0,"input name to save data")};this.resize=function(c,f){g=b.width;k=b.height;Ya=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var c=y.yen();b.print("$ "+c.toString(),"2","1.0-4")};this.nav=function(c){c=void 0===c?function(){b.clear()}:c;b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2+4p","1.0-4","8",function(){a.menu(c)},
!1)};this.title=function(c,f){a.breadcrumb(c,f);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){h||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1},!1);Wa?(b.style=1,b.sprite(40,72,8,10,"1.0-14","2",8,10),b.sprite(48,72,16,16,"1.0-19","2",16,16),b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-23","2+4p","7","5",function(){var l=document.getElementById("mp3_player");l.currentTime=Math.random()*l.duration;l.play();a.STATE()},!1),b.button("","1.0-14","2+4p",
"7","5",function(){document.getElementById("mp3_player").pause();Wa=!1;a.STATE()},!1)):(b.style=2,b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();Wa=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=function(c,f){var l=void 0===f?function(){h||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1}:function(){a.menu(c);qa=!0};b.style=Wa?1:0;f=Wa?" low recordings 0.0.6 feature mix":" menu";b.print(" "+
f,"2","2");b.style=0;b.print("<","2","2");b.button("","2","2+4p","7","8",l,!1)};this.menu=function(c){qa=!0;b.style=0;a.STATE=function(){a.menu(c)};h||b.backdrop();b.clear();a.title(c);b.sprite(0,0,1,1,"2","6","1.0-4",1);Aa?(b.print(" > view spectator controls","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(c)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");
b.button("","2","13+4p","1.0-4","5",function(){a.settings(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var f=8,l;Aa?(l=uas.AUTOPILOT?"disable":"enable",b.button(l+" autopilot","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),f+=8,b.button("deploy vehicle","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);Aa=!1;a.STATE=function(){};y.reset(!1);a.reset();xa=!0;y.START=!1;y.disconnect();y.connect(K.start,K.surface,!1);a.play()},!0)):(xa||y.REPLAY)&&
(b.button("restart stage","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),f+=8,b.button("next stage","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var c;a.STATE=function(){a.intro()};h=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");b.style=0;Fa?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,c=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),
b.style=0,b.print(c,"9","15"),ra.requestName(a.CHALLENGES.uid,function(f){a.CHALLENGER=f;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ua&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===ma||""!==fa?null!==fa&&""!==fa?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+fa,"2","9"),b.style=2,b.print("[edit]",fa.length+"+5","9"),b.style=0,b.button("","2","9+4p",fa.length+
"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===fa||null===fa)||!1!==ma&&null===fa)&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.6","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},
!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();h=!1;b.renderer.style.background="transparent";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");K.connect();a.load()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=
0};this.load=function(){a.STATE=function(){a.target();a.setBattleName()};a.TIMELIST=[];ra.scan(K.name,function(c){for(var f={$jscomp$loop$prop$t$91$156:0};f.$jscomp$loop$prop$t$91$156<c.length;f={$jscomp$loop$prop$t$91$156:f.$jscomp$loop$prop$t$91$156},f.$jscomp$loop$prop$t$91$156++)a.TIMELIST[f.$jscomp$loop$prop$t$91$156]={uid:c[f.$jscomp$loop$prop$t$91$156].uid,utc:c[f.$jscomp$loop$prop$t$91$156].utc,time:c[f.$jscomp$loop$prop$t$91$156].time,name:"..."},ra.requestName(c[f.$jscomp$loop$prop$t$91$156].uid,
function(w){return function(O){a.TIMELIST[w.$jscomp$loop$prop$t$91$156].name=O;a.STATE()}}(f)),ra.checkTime(ma,c[f.$jscomp$loop$prop$t$91$156].uid,c[f.$jscomp$loop$prop$t$91$156].time);f=a.TIMELIST.length<Ba?a.TIMELIST.length:Ba;var l=[];switch(Ca){case 0:l=c.slice(0,f);break;case 1:for(c=c.slice();l.length<f;){var u=Math.floor(Math.random()*c.length);l.push(Object.assign({},c[u]));c.splice(u,1)}}a.BATTLE=l.slice();a.STATE()});Pa=!0;a.target();e=0};this.ready=function(){Pa=!1;a.STATE()};this.play=
function(){b.clear();a.nav(a.play);qa=!1;b.style=0};this.complete=function(){qa=!0;b.clear();a.STATE=function(){};a.nav(a.complete);var c="stage complete!";b.style=0;b.print(c,"0.5-"+2*Math.round(c.length/2),"0.3-1",2);b.style=0;K.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=function(){a.results();uas.replay();y.replay()}):(a.STATE=function(){a.results()},y.REPLAY||ra["export"](a.results),uas.replay(),y.replay())},2E3);c=y.param().model+" ("+(y.param().power+1)+
"/"+(y.param().drag+1)+"/"+(y.param().sensitivity+1)+"/"+(y.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:fa,time:y.AT(),penalty:y.PENALTY(),score:y.AT()+y.PENALTY(),seed:K.name,rating:Math.round(K.generate.DISTANCE/(y.AT()+y.PENALTY())),distance:K.generate.DISTANCE,vehicle:c})};this.results=function(){a.STATE=function(){a.results()};b.clear();b.style=0;qa=!0;var c=0,f=y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5];if((f<La||!1===La)&&(La=f),0<a.TIMELIST.length){for(var l=0;l<
a.TIMELIST.length;l++)if(f<a.TIMELIST[l].time){c=l+1;break}0==c&&(c=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+K.name,"2","2");b.style=0;f=b.time(f);b.print(f,"2","5",2);l=y.overwrite(y.CHECKPOINT,K.best,!1);0!=c?b.print("rank "+c,2*f.length+"+3".toString(),"5+4p"):l?(l=Fa?"challenge victory!":"new record!",b.style=1,b.print(l,2*f.length+"+3".toString(),"5+4p"),b.style=0):Fa&&b.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");f=9;l=y.CHECKPOINT;if(320<k){for(var u=
1;u<l.length-1;u++){b.style=5;b.print("cp "+u,"2",f+"+"+u.toString());u;var w=l[u],O=a.split(u);b.print(O,"0.5+1",f+"+"+u.toString());"number"==typeof l[u]?(b.style=0,w=b.time(l[u])):(b.style=4,w="penalty",d="");b.print(w,"0.5 -1-"+w.length.toString(),f+"+"+u.toString());b.style=0;f+=1}f+=5}1===c&&(b.style=4,b.print("new record!","2",f.toString(),2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();
a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){qa=!1;uas.replay();a.replay()})};this.checkpoint=function(c){c=void 0===c?!1:c;b.clear();b.style=0;a.nav(function(){a.checkpoint(c)});var f="";c?f+="missed checkpoint X "+Math.abs(y.CHECKPOINT[5]):f=this.split(y.OBJECTIVE);b.text(f,16,32);b.style=0};this.split=function(c){var f=
"",l=K.best[c]-y.CHECKPOINT[c],u=2,w="";return Number.isNaN(l)?void 0===y.CHECKPOINT[c]?(u=4,f+="- 100 sec"):void 0===K.best[c]&&0>K.best[5]?(u=1,f+="+ 100 sec"):void 0===K.best[c]&&(u=1,f+="new time!"):(0<l?(w="+ ",u=1):0>l?(w="- ",u=4):w="+ ",l=Math.abs(l),f+="( "+w+b.time(l)+" )"),b.style=u,f};this.battle=function(){var c=new ib(ra.save(ra.tape),y.MODEL,y.PAINT);Z.push(c);a.reset()};this.replay=function(){var c=this;if(!y.IMPORT&&!xa){a.STATE=function(){c.replay()};b.clear();Aa?a.nav(a.replay):
a.nav(a.results);uas.AUTOPILOT?a.autopilot():a.drone();var f={};for(f.$jscomp$loop$prop$e$96$158=b.style=0;4>f.$jscomp$loop$prop$e$96$158;f={$jscomp$loop$prop$e$96$158:f.$jscomp$loop$prop$e$96$158},f.$jscomp$loop$prop$e$96$158++){var l="7+"+(4*f.$jscomp$loop$prop$e$96$158).toString(),u=f.$jscomp$loop$prop$e$96$158===uas.CAM-1?48:40;b.button("",l+"-10p","1.0-4+4p","3","4",function(w){return function(){uas.CAM=w.$jscomp$loop$prop$e$96$158+1;a.replay()}}(f),!1);b.sprite(u,64,8,8,l,"1.0-4",8,8)}b.style=
0;f=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:fa;(uas.AUTOPILOT||uas.TARGETING)&&b.print(f,"2","1.0-7");b.button("","0","1.0-8+4p","20","4",function(){uas.TARGETING&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){b.style=0;for(var c="";c.length<K.name.length;){var f=K.name.charAt(c.length);c+=" "===f?"-":f}b.style=0<uas.POV?4:2;b.sprite(72,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",
function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);Aa||(b.print("<","2","2"),b.button("","2","2+4p","7","8",function(){a.results(a.replay)},!1))};this.drone=function(){b.style=uas.TARGETING?4:2;b.sprite(64,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){b.clear();Pa=!0;Ua=Za=Fa=!1;a.PATH=!1;custom_seed="";K.name="";a.BATTLE=[];La=!1;window.history.pushState("","","/");ya.clear();y.REPLAY=!1;y.RESET=!0;y.disconnect();
for(var c=0;c<Z.length;c++)Z[c].disconnect();uas.reset(!0);Z=[];K.SNOW&&da.remove(K.snow.mesh);K.reset();xa=qa=!1;ra.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(c){c=void 0===c?"reset":c;Z.index=0;b.clear();a.nav(a.play);
xa=!0;qa=!1;y.reset(!1);for(var f=0;f<Z.length;f++)Z[f].reset();firebase.analytics().logEvent("stage_restart",{status:c})};this.hide=function(c){};this.update=function(){qa||!xa||Ka||(b["delete"](16,16,g-64,16),b["delete"](16,k-32,64,16),b.text(b.time(y.AT()),16,16),b.text(y.SPEED.toString(),16,k-32))};this.loading=function(){for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";qa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+c,16,16),b.style=0);e++};this.scanning=function(){if(0===
S.TIMELIST.length&&ra.SCAN&&!qa){b["delete"](16,72,88,8);for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";b.style=5;b.text("scanning"+c,16,72)}};this.target=function(){b.clear();a.STATE=function(){a.target()};a.nav(a.target);var c,f,l=K.name,u=function(){b.clear();K.SNOW&&da.add(K.snow.mesh);a.STATE=function(){};K.generate.END=!1;a.play();y.SPECTATE=!1;xa=!0;y.connect(K.start,K.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")};if(Pa||(b.style=2,b.print("stage generated.","2",
"2"),ra.SCAN?(b.style=2,b.button("ready (no data)","2","1.0-10","1.0-4","8",function(){u()})):(b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){u()}),b.style=4,b.style=1,0<a.BATTLE.length&&b.button("spectate!","1.0-14","1.0-18","12","3",function(){cb=!0;xa=!1;K.generate.END=!1;K.SNOW&&da.add(K.snow.mesh);b.style=0;y.connect(K.start,K.surface);Aa=!0;a["import"]();b.clear();da.add(K.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),b.style=5,b.print(l,"2","5-1p",2),
b.style=0,0!==a.TIMELIST.length||!ra.SCAN)if(0!==a.TIMELIST.length){var w=a.TIMELIST.slice();for(l=0;l<w.length;l++)for(var O=0;O<w.length;O++)w[l].time<=w[O].time&&w[l].utc<w[O].utc&&l>O&&(c={},Object.assign(c,w[l]),f={},Object.assign(f,w[O]),w[l]=f,w[O]=c);b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(w[0].time),"2","12",2);b.style=5;c=(l=w.length<Ya)?w.length:Ya;l=l?0:w.length-Ya;for(f=0;f<c;f++)b.print(f+1+". "+w[f].name,"2","16+"+2*f),b.print(b.time(w[f].time),"18","16+"+2*
f);0<l&&b.print("+ "+l+" more entries","2",2*c+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.setBattleName=function(){for(var c=0;c<a.BATTLE.length;c++)a.BATTLE[c].name=a.TIMELIST[c].name};this["import"]=function(){a.setBattleName();for(var c={$jscomp$loop$prop$o$105$160:0};c.$jscomp$loop$prop$o$105$160<a.BATTLE.length;c={$jscomp$loop$prop$o$105$160:c.$jscomp$loop$prop$o$105$160},c.$jscomp$loop$prop$o$105$160++)y.IMPORT=!0,ra["import"](K.name+"/"+a.BATTLE[c.$jscomp$loop$prop$o$105$160].uid,
function(f){return function(l){a.BATTLE[f.$jscomp$loop$prop$o$105$160].IMPORT_BUFFER=[];y.INPUTS=[];a.BATTLE[f.$jscomp$loop$prop$o$105$160].data=[];a.BATTLE[f.$jscomp$loop$prop$o$105$160].param={power:l.param.power,drag:l.param.drag,sensitivity:l.param.sensitivity,model:l.param.model,paint:l.param.paint};a.BATTLE[f.$jscomp$loop$prop$o$105$160].cp=l.cp;for(var u=0;u<l.debug.length;u++){var w={time:l.debug[u].time,U:l.debug[u].U,D:l.debug[u].D,L:l.debug[u].L,R:l.debug[u].R};a.BATTLE[f.$jscomp$loop$prop$o$105$160].data.push({U:l.debug[u].U,
D:l.debug[u].D,L:l.debug[u].L,R:l.debug[u].R,time:l.debug[u].time});a.BATTLE[f.$jscomp$loop$prop$o$105$160].IMPORT_BUFFER.push(w)}f.$jscomp$loop$prop$o$105$160===a.BATTLE.length-1&&y["import"]()}}(c))};this.uasComputer=function(){b.clear();b.style=0;var c;b.print("autopilot "+(uas.AUTOPILOT?"enabled":"disabled"),"2","2");uas.AUTOPILOT?(c=S.TIMELIST[uas.data().target].name,b.print("targeting: "+c,"2","4")):(c=0<Z.length?S.TIMELIST[uas.data().target].name:"disabled",b.print("targeting: "+c,"2","4"),
b.style=2,c=uas.CTRL||E.SHIFT?"roll":"yaw",b.print("ctrl: "+c,"2","1.0-4"),b.button("","0","1.0-4+4p","14","4",function(){a.uas(!0);uas.tutorial=!0},!1),b.style=0)};this.uas=function(c){b.clear();b.style=0;a.STATE=function(){a.uas()};b.backdrop();b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2","1.0","4",function(){b.backdrop(!1);a.replay()},!1);b.style=0;b.print("spectator controls","2","2");b.print("pilot mode","2","6");b.style=2;b.print("arrow            pitch/yaw/roll","2","10");b.print("shift + arrow    roll/yaw modifier",
"2","12");b.print("space            power +","2","14");b.print("shift + space    power -","2","16");b.print("ctrl:            roll/yaw toggle","2","18");b.print("r                reset","2","20");b.print("t                targeting mode toggle","2","22");b.print("shift + arrow    change target (targeting)","2","24");b.style=0};this.timelist=function(){b.style=0};this.save=function(){var c=fa+"#"+y.MODEL+"#"+y.PAINT+"#"+y.param().power+y.param().drag+ +y.param().sensitivity+"#"+Date.now();c!==z&&(z=
c,a.cSave("SAVE",z))};this.vehicle=function(c){a.STATE=function(){a.vehicle(c)};qa=!0;b.clear();a.title(function(){c();a.save()},function(){a.menu();sv()});y.REPLAY&&a.reset();var f=[],l=y.param();f.push({id:"power",value:l.power,funct:function(N){y.tune.power(N)}});f.push({id:"drag",value:l.drag,funct:function(N){y.tune.drag(N)}});f.push({id:"sensitivity",value:l.sensitivity,funct:function(N){y.tune.sensitivity(N)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(y.models()[y.MODEL].name,
"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){y.MODEL+=1;1<y.MODEL&&(y.MODEL=0);y.body();a.vehicle(c)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--y.MODEL;0>y.MODEL&&(y.MODEL=1);y.body();a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(rb[y.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){y.PAINT+=1;y.PAINT>Ia.length-1&&
(y.PAINT=0);y.paint();a.vehicle(c)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--y.PAINT;0>y.PAINT&&(y.PAINT=Ia.length-1);y.paint();a.vehicle(c)},!1);for(l={$jscomp$loop$prop$t$107$162:0};l.$jscomp$loop$prop$t$107$162<f.length;l={$jscomp$loop$prop$t$107$162:l.$jscomp$loop$prop$t$107$162},l.$jscomp$loop$prop$t$107$162++){var u="8+5+5+"+(5*l.$jscomp$loop$prop$t$107$162).toString();b.print(f[l.$jscomp$loop$prop$t$107$162].id,"2",u);b.sprite(0,0,1,1,"2",u+"+3","1.0-2-2",1);for(var w={$jscomp$loop$prop$e$108$164:0};6>
w.$jscomp$loop$prop$e$108$164;w={$jscomp$loop$prop$e$108$164:w.$jscomp$loop$prop$e$108$164},w.$jscomp$loop$prop$e$108$164++){var O="1.0-18+"+(3*w.$jscomp$loop$prop$e$108$164).toString(),P=w.$jscomp$loop$prop$e$108$164<=f[l.$jscomp$loop$prop$t$107$162].value?48:40;b.button("",O+"-10p",u+"+4p","3","4",function(N,ia){return function(){f[N.$jscomp$loop$prop$t$107$162].funct(ia.$jscomp$loop$prop$e$108$164);a.vehicle(c)}}(l,w),!1);b.sprite(P,64,8,8,O,u,8,8)}}};this.scan=function(c,f){};this.settings=function(c){a.STATE=
function(){a.settings(c)};a.SETTINGS=!0;m=Ba+"#"+Ca+"#"+(Ma?1:0)+"#"+(Ra?1:0)+"#";a.cSave("SETTINGS",m);b.clear();h||b.backdrop();a.title(c,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(f=Ma?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(f,"1.0-2-"+f.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("",
"2","13+4p","1.0-4","5",function(){Ma=!Ma;a.settings(c)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+Da,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",function(){2>Da&&(Da+=.5);b.style=0;a.settings(c);Ha()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<Da&&(Da-=.5);b.style=0;a.settings(c);Ha()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);
b.print("camera mode","2","23");var f=y.FPV?"fpv":"tpv";b.print(f,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){y.FPV=!y.FPV;a.settings(c)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(c,f){a.STATE=function(){a.ghostConfig(c)};var l=Ra?1:0;m=Ba+"#"+Ca+"#"+(Ma?1:0)+"#"+l;a.cSave("SETTINGS",m);b.clear();h||b.backdrop();a.title(c,function(){a.settings(c)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name",
"2","8");b.print(fa,"1.0-13-"+fa.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(c)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");l=Ba.toString();b.print(l,"1.0-13-"+l.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Ba&&(Ba+=1);a.ghostConfig(c)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Ba&&--Ba;a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority",
"2","18");l=0===Ca?"best":"random";b.print(l,"1.0-13-"+l.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Ca+=1;1<Ca&&(Ca=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Ca;0>Ca&&(Ca=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2","23");l=Xa?"enabled":"disabled";b.print(l,"1.0-2-"+l.length,"23");b.button("","2","23+4p","1.0-4","4",function(){Xa=!Xa;for(var u=0;u<Z.length;u++)Z[u].toggleEmitter(Xa);a.ghostConfig(c)},!1);b.sprite(0,
0,1,1,"2","26","1.0-4",1)};this.controls=function(c){b.clear();a.title(c,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(c){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");
b.style=0;b.print("> "+fa,"2","9");b.style=2;b.print("[edit]",fa.length+"+9","9");b.button("","2","9+4p",fa.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(K.name,"2","15");b.style=2;b.print("time","2","19");c=b.time(y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5]);b.style=5;b.print(c,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();
a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(c,f,l){f=void 0===f?!1:f;l=void 0===l?"enter display name:":l;a.STATE=function(){a.inputName(c,f,l)};b.clear();qa=!0;f?a.nav(function(){c()},a.menu):a.title(c);b.print(l,"2","2");b.textinput(fa,"2","4","1.0-2","6","operator_id");var u=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");fa=sb(u.value.toLowerCase());
!1===ma&&1<fa.length&&null!==fa?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,c,f);a.STATE=function(){}})["catch"](function(w){w.code;w.message}):!1!==ma&&1<fa.length&&null!==fa?a.submitName(ma,c,f):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(c,f,l){l=void 0===l?!1:l;1<fa.length&&10>fa.length?firebase.database().ref("uid/"+c).set({name:fa},function(u){u?(b.clear(),u="PERMISSION_DENIED"===
u.code?"invalid name":"network error",b.print(u,"2","2"),window.setTimeout(function(){a.inputName(f,l)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(f,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(f,l)},1E3))};this.encodeURL=function(){for(var c="",f=K.name,l=0;l<f.length;l++){var u=f.charAt(l);u=" "===u?"-":u;c+=u}c=c+"/"+ma;window.history.pushState("","","/");f=window.location.href;var w="./#/"+c;navigator.clipboard.writeText("https://specialstage.io/#/"+
c).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",w)},function(){window.history.pushState("","",w);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:f+"#/"+c})};this.decodeURL=function(){for(var c=window.location.href,f="",l=[],u=!1,w=0,O=0;O<c.length;O++){var P=c.charAt(O);u?"/"===P?(Fa=!0,w++):(1===w&&(P="-"===P?" ":P,f+=P),1<w&&(l+=P)):"#"===P&&(u=!0,Ua=!0,w=0)}Fa&&0<l.length?(a.custom_seed=f,K.name=f,
a.CHALLENGES={seed:f,uid:l}):Ua&&(a.custom_seed=f,K.name=f,Fa=!1);Fa&&firebase.analytics().logEvent("challenge_accepted",{url:c})};this.cSave=function(c,f){var l=new Date;l.setTime(l.getTime()+2808E7);l="expires="+l.toUTCString();document.cookie=c+"="+f+";"+l+";path=/"};this.cLoad=function(c){c+="=";for(var f=document.cookie.split(";"),l=0;l<f.length;l++){for(var u=f[l];" "==u.charAt(0);)u=u.substring(1);if(0==u.indexOf(c))return u.substring(c.length,u.length)}return""};this.checksave=function(){var c=
a.cLoad("SAVE");if(0!==c.length&&null!=c){for(var f=0,l="",u="",w="",O="",P=0,N=0;N<c.length;N++){var ia=c.charAt(N);if("#"!==ia)switch(P){case 1:f=parseInt(ia);break;case 2:l+=ia;break;case 3:u+=c.charAt(N),w+=c.charAt(N+1),O+=c.charAt(N+2),N+=2}else P++}y.MODEL=parseInt(f);y.PAINT=parseInt(l);y.paint();y.tune.power(parseInt(u));y.tune.drag(parseInt(w));y.tune.sensitivity(parseInt(O))}else y.PAINT=0,y.paint();if(c=a.cLoad("SETTINGS"),0!==c.length&&null!=c){f=0;w=u=l="";for(O=0;O<c.length;O++)if(P=
c.charAt(O),"#"!==P)switch(f){case 0:l+=P;break;case 1:Ca=parseInt(P);break;case 2:u=parseInt(P);break;case 3:w=parseInt(P)}else f++;Ba=parseInt(l);Ma=0!==u;1===w&&(Ra=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();b.print("0.0.5.3","2","2");b.sprite(0,88,47,8,"2","6-4p",188,32,4);b.sprite(49,88,40,8,"2","12-4p",160,32,4);b.sprite(1,0,255,16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};
this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},
4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("https://specialstage.io","2","0.25",1);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.ginko.ltd","4","0.25 + 10");b.print("> discord.specialstage.io",
"4","0.25 + 12");window.setTimeout(a.music,2E3)};this.music=function(c){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty",
"2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(c){if("n"===c.key)switch(t){case 0:b.clear();window.setTimeout(a.promo,1E3);t++;break;case 1:window.setTimeout(a.biome,
1E3);t++;y.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);t++;y.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);t++;y.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);t++;y.CAMERA=1;break;case 5:b.clear(),t=0}}}function tb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var g=this.renderer.getContext("2d");this.context=g;var k=document.createElement("img");k.src="./img/stage.font.0.0.6.png";k.onload=function(){a.connect();
a.onload()};document.createElement("canvas");this.onload=function(){};var e=document.createElement("canvas"),t=e.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var z=128,m=180,h=128,c=80,f;var l=128;var u=m;var w=128;var O=80;var P=!(f={x:128,y:m+60,w:128,h:40}),N=[],ia=[],T=[];this.connect=function(){g.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(r,B){r=void 0===r?0:r;B=void 0===B?"#ffffff":B;void 0===e[r]&&(e[r]=document.createElement("canvas"),
t[r]=e[r].getContext("2d"));t[r].drawImage(k,0,0,128,128,0,0,128,128);t[r].globalCompositeOperation="source-atop";t[r].fillStyle=B;t[r].fillRect(0,0,128,128);t[r].globalCompositeOperation="source-out"};this.resize=function(r,B,F,H){H=void 0===H?1:H;a.scale=F*H;var L=window.devicePixelRatio,ea=300>Math.ceil(L)/L*r?Math.floor(L):Math.ceil(L);0!=ea-L&&(F=ea/L*H);1>=L&&1<a.scale&&(F=a.scale);this.width=r/F;this.height=B/F;this.renderer.width=this.width;this.renderer.height=this.height;ya.setSize(this.width,
this.height);a.scale=F;this.renderer.style.transform="scale("+F+","+F+")";ya.domElement.style.transform="scale("+F+","+F+")";this.renderer.style.transformOrigin="top left";ya.domElement.style.transformOrigin="top left";g.imageSmoothingEnabled=!1;this.redraw();z=128;m=180;h=128;c=80;l=128;u=m;w=128;O=80;f={x:128,y:m+60,w:128,h:40};this.automate(this.width,this.height)};this.update=function(r){var B=0,F;for(F in r)for(var H in T)if(r[F].x>T[H].x*a.scale&&r[F].y>T[H].y*a.scale&&r[F].x<T[H].w*a.scale&&
r[F].y<T[H].h*a.scale&&(B++,1==r[F].start)){T[H].funct();r[F].start=!1;break}};this.print=function(r,B,F,H){H=void 0===H?1:H;for(var L=0,ea=a.compile(B,a.width,a.col),U=a.compile(F,a.height,a.row),Q=a.style;L<r.length;)a.encode(r.charAt(L),ea+L*a.col*H,U,H),L++;P||N.push(function(){a.style=Q;a.print(r,B,F,H)})};this.text=function(r,B,F,H,L){H=void 0===H?1:H;for(L=0;L<r.length;)a.encode(r.charAt(L),B+L*a.col*H,F,H),L++};this.button=function(r,B,F,H,L,ea,U,Q){U=void 0===U?!0:U;Q=void 0===Q?1:Q;var Y=
a.compile(B,a.width,a.col),la=a.compile(F,a.height,a.row),ka=a.compile(H,a.width,a.col),ba=a.compile(L,a.height,a.row),ja=a.style;U&&(g.drawImage(e[a.style],0,0,1,1,Y,la+ba/2,ka+1,1),g.drawImage(e[a.style],0,0,1,1,Y,la-ba/2,ka+1,1),g.drawImage(e[a.style],0,0,1,1,Y,la-ba/2,1,ba),g.drawImage(e[a.style],0,0,1,1,Y+ka-1,la-ba/2,1,ba+1));for(var ha=0;ha<r.length;)a.encode(r.charAt(ha),Y+ha*a.col+ka/2-Math.round(r.length*a.col)/2+2,la-a.row/2,Q),ha++;T.push({x:Y,y:la-ba/2,w:Y+ka,h:la+ba/2,funct:function(){ea()}});
P||N.push(function(){a.style=ja;a.button(r,B,F,H,L,ea,U,Q)})};this.line=function(r,B,F,H){a.sprite(0,0,1,1,r,B,F,H)};this.sprite=function(r,B,F,H,L,ea,U,Q){var Y=a.compile(L,a.width,a.col),la=a.compile(ea,a.height,a.row),ka=a.compile(U,a.width,a.col),ba=a.compile(Q,a.height,a.row),ja=a.style;g.drawImage(e[a.style],r,B,F,H,Y,la,ka,ba);P||N.push(function(){a.style=ja;a.sprite(r,B,F,H,L,ea,U,Q)})};this.backdrop=function(r,B,F,H,L){r=void 0===r?"#10101099":r;!1===r?(a.clear(),a.renderer.style.background=
"transparent"):(a.clear(),a.renderer.style.background=r)};this.getDrawList=function(){return N};this.redraw=function(){P=!0;a.clear();for(var r=0;r<N.length;r++)N[r]();r=document.body.getElementsByTagName("input");for(var B=0;B<r.length;B++)a.text(r[B].value,r[B].style.top,r[B].style.left);P=!1};this.automate=function(r,B){r=Math.floor(r/3)-2;B=Math.floor(B/4);h>r&&(h=r,z=r,w=r,l=r,f.w=r,f.x=r);m>B&&(m=B+40,u=m,f.y=m+60)};this.pad=function(r,B,F,H,L,ea,U){var Q=0;for(U();Q<E.touches.length;)E.touches[Q].x>
B*a.scale&&E.touches[Q].y>F*a.scale&&E.touches[Q].x<(B+H)*a.scale&&E.touches[Q].y<(F+L)*a.scale&&ea(),Q++;Ma&&(g.drawImage(e[a.style],0,0,1,1,B+1,F,H-1,1),g.drawImage(e[a.style],0,0,1,1,B+1,F+L,H-1,1),g.drawImage(e[a.style],0,0,1,1,B+1,F,1,L),g.drawImage(e[a.style],0,0,1,1,B+H-1,F,1,L));a.encode(r,B+H/2-a.col/2,F+L/2-a.row/2)};this.dpad=function(){g.drawImage(e[a.style],88,88,40,40,a.width-l+w/2-20,a.height-u+O/2-20,40,40);a.pad("<",z-h-1,a.height-m,h,c,function(){E.LEFT=!0},function(){E.LEFT=!1});
a.pad(">",z+1,a.height-m,h,c,function(){E.RIGHT=!0},function(){E.RIGHT=!1});a.pad("^",a.width-l,a.height-u,w,O,function(){E.UP=!0},function(){E.UP=!1});a.pad("b",a.width-f.x,a.height-f.y+f.h/2,f.w,f.h,function(){E.DOWN=!0},function(){E.DOWN=!1})};this.clear=function(){if(!P){for(var r=document.body.getElementsByTagName("input"),B=0;B<r.length;B++)document.body.removeChild(r[B]);if(!a.REDRAW){N=[];for(r=0;r<ia.length;r++)document.body.removeChild(ia[r]);ia=[]}N=[]}T=[];g.clearRect(0,0,a.width,a.height)};
this["delete"]=function(r,B,F,H){B=void 0===B?0:B;F=void 0===F?ya.width:F;H=void 0===H?ya.height:H;r=a.compile(void 0===r?0:r,a.width,a.col);B=a.compile(B,a.height,a.row);F=a.compile(F,a.width,a.col);H=a.compile(H,a.height,a.row);g.clearRect(r,B,F,H)};this.encode=function(r,B,F,H){H=void 0===H?1:H;var L=r.charCodeAt(0);r=8*L%128;L=8*Math.floor(L/16);g.clearRect(B,F,8,8);g.drawImage(e[a.style],r,L,8,8,B,F,8*H,8*H)};this["float"]=function(r,B){var F=Math.floor(Math.abs(100*r));F=F.toString();var H=
F.slice(0,F.length-2),L=F.slice(F.length-2,F.length);return 0==r?"0.00":(0==H.length&&(H="0"),2>L.length&&(L+="0"),B&&0<r?H="+"+H:0>r&&(H="-"+H),F=H+"."+L,F)};this.compile=function(r,B,F){var H=0;switch(B=Math.floor(B),typeof r){case "number":H=r;break;case "function":H=r();break;case "string":for(var L=!1,ea=1,U=0,Q="";U<r.length;){var Y=r.charAt(U);"."===Y?(Q+=Y,L=!0):"+"===Y?(Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,ea=1,H+=Q,L=!1,Q=""):"-"===Y?(Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,ea=-1,H+=Q,L=!1,Q=""):
"p"===Y?(Q=Number(Q),Q*=ea,H+=Q,Q=""):U===r.length-1?(Q+=Y,Q=L?Number(Q)*B:Number(Q)*F,Q*=ea,H+=Q,Q=""):Q+=Y;U++}}return H};this.textinput=function(r,B,F,H,L,ea,U){var Q=a.compile(B,a.width,a.col),Y=a.compile(F,a.height,a.row),la=a.compile(H,a.width,a.col),ka=a.compile(L,a.height,a.row),ba=a.style;if(P)a.text("> "+U.value,Q,Y+ka/2);else{(U=document.createElement("input")).type="text";U.id=ea;U.name=ea;U.value=r;U.style.position="fixed";U.style.top=Y+"px";U.style.left=Q+"px";U.style.width=la+"px";
U.style.height=ka+"px";U.style.paddingLeft="12px";U.style.fontSize="14px";U.style.zIndex=9999;U.style.opacity=0;U.maxlength=10;a.text("> "+U.value,Q,Y+ka/2);document.body.appendChild(U);window.setTimeout(function(){U.focus();U.select()},200);U.oninput=function(){ja()};U.onfocusout=function(){ja()};U.onfocusin=function(){ja()};U.onclick=function(){ja()};var ja=function(ha){a["delete"](Q,Y,la,ka);a.text("> "+U.value,Q,Y+ka/2);a.text("_",U.selectionStart*a.col+2*a.col+Q,Y+ka/2)};N.push(function(){a.style=
ba;a.textinput(U.value,B,F,H,L,ea,U)})}};this.link=function(r,B,F,H,L,ea,U,Q){var Y=a.compile(B,a.width,a.col)*a.scale,la=a.compile(F,a.height,a.row)*a.scale,ka=a.compile(H,a.width,a.col)*a.scale,ba=a.compile(L,a.height,a.row)*a.scale,ja=a.style;P||N.push(function(){return new function(){a.style=ja;ha.style.left=Y+"px";ha.style.top=la+"px";ha.style.width=ka+"px";ha.style.height=ba+"px";a.print(r,Y,la)}});var ha=document.createElement("a");ha.href=ea;ha.style.left=Y+"px";ha.style.top=la+"px";ha.style.width=
ka+"px";ha.style.height=ba+"px";ha.style.display="block";ha.style.zIndex=400;ha.style.position="fixed";ha.target="_blank";ha.id=ea;document.body.appendChild(ha);ia.push(ha);P=!0;a.print(r,Y,la);P=!1};this.time=function(r){return(r/100).toFixed(2)};this.typewrite=function(r){a.clear();for(var B={$jscomp$loop$prop$e$136$166:0};B.$jscomp$loop$prop$e$136$166<r.length;B={$jscomp$loop$prop$e$136$166:B.$jscomp$loop$prop$e$136$166},B.$jscomp$loop$prop$e$136$166++){var F=(B.$jscomp$loop$prop$e$136$166,0);
F=Math.floor(B.$jscomp$loop$prop$e$136$166%32);var H=Math.floor(B.$jscomp$loop$prop$e$136$166/32);F=32+F%32*8;H=32+16*H;window.setTimeout(function(L){return function(){b.text(r.charAt(L.$jscomp$loop$prop$e$136$166),F,H)}}(B),50*B.$jscomp$loop$prop$e$136$166)}}}function ub(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return w};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=
[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.START_ROTATION=0;this.START_MESH=new THREE.Mesh;this.FRAME_TIME=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var g=[],k=0;this.TIMESTEP=Na;this.TIMESTAMP=0;this.REPLAY_START=
this.REPLAY=!1;this.INPUTS=[];var e=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),t=!1,z=!1,m=!1,h=!1,c=!0,f=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var l=0,u=0,w=0,O=0,P=!1,N=!1,ia=0,T=0;this.DT=function(){return 1};var r={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},B=0,F=0,H=0;B=.004;F=.985-.98;H=.08-.06;var L,ea,U,Q=6,Y,la=0,ka=0,ba=0,ja=new THREE.Vector3(0,1,0),ha=new THREE.Vector3(0,0,0),Sa=new THREE.Vector3,Ta=new THREE.Vector3(0,
5,0);new THREE.Vector3(1,0,0);var q=new THREE.Vector3(0,0,1),n=new THREE.Vector3(0,0,1),p=new THREE.Vector3(0,0,1),C=new THREE.Vector3(0,0,1),A=new THREE.Vector3(0,0,-.008),x=new THREE.Vector3,R=new THREE.Vector3,D=new THREE.Vector3,J=new THREE.Vector3;this.position=x.clone();this.direction=ja.clone();this.lookAt=x.clone();this.normal=n.clone();this.rotation=0;var I=[],M=new THREE.Vector3(0,0,1),V=new THREE.Raycaster(J,M,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};
this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var W=[{name:"logistics crate",geometry:function(){return Qa.logistics_crate()}},{name:"ag-86",geometry:function(){return Qa.ag_86()}}];this.models=function(){return W};this.PAINT=0;var ta=
new THREE.MeshBasicMaterial({color:Ia[a.PAINT]}),pa=(new THREE.LineSegments(W[a.MODEL].geometry(),ta)).clone();pa.name="Vehicle";var Ea=new Qa.emitter;this.connect=function(G,X){pa.copy(new THREE.LineSegments(W[a.MODEL].geometry(),ta));pa.name="Vehicle";pa.geometry.computeBoundingSphere();D.copy(G);D.z+=2;pa.position.copy(D);da.add(pa);Ea.connect(Ia[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();da.fog=new THREE.FogExp2(aa[0],.005);ca.fov=90;ca.updateProjectionMatrix();
da.add(K.generate.stars);a.START_POSITION.copy(D);a.START_NORMAL.copy(n);a.START_DIRECTION.copy(ja);a.START_VELOCITY.copy(Sa);a.START_MESH.copy(e);uas.TARGETS.length<Z.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);da.remove(pa);Ea.disconnect();da.fog=new THREE.FogExp2(aa[0],0);da.remove(K.generate.stars);this.DISCONNECT=!1};this.ready=function(G){G=void 0===G?window.performance.now():
G;var X;!t&&!this.REPLAY||this.RESET||(K.generate.checkpoints[0].display.material.color=aa[4],uas.reset(),T=1,P=!1,N=!1,c=!0,na.reset(),O=G,l=0,k=0,this.FRAME=0,g[k].time=0,g=[],g.length=0,k=0,g.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],X={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),
velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(X),a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,X={},Object.assign(X,g[k]),a.PHYSICSBUFFER.push(X),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(G){G=void 0===G?!1:G;a.REPLAY=G;a.RESET=!0;xa=!G;this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;f=Ka=this.END=this.START=!1;E.UP=!1;E.DOWN=!1;E.LEFT=!1;h=m=z=t=E.RIGHT=!1;T=w=ia=0;x.copy(a.START_POSITION);R.copy(x);ja.copy(a.START_DIRECTION);
Sa.copy(a.START_VELOCITY);n.copy(a.START_NORMAL);J.copy(x);this.position=x.clone();this.direction=ja.clone();this.lookAt=x.clone();this.normal=n.clone();Y=ba=la=ka=this.rotation=0;a.SPEED=0;M.copy(a.START_NORMAL);M.normalize();V.far=M.length();V.set(a.START_POSITION,M);p.copy(a.START_NORMAL);C.copy(a.START_NORMAL);C.add(a.START_POSITION);ca.updateProjectionMatrix();f=!0;Ea.reset();na.reset();uas.reset();g=[];O=k=0;this.IMPORT||(O=window.performance.now());for(G=0;G<K.generate.checkpoints.length;G++)K.generate.checkpoints[G].display.material.color=
aa[5];if(g[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY){this.DEBUG_BUFFER=[];l=0;a.best=a.overwrite(a.CHECKPOINT,a.best);K.best=a.overwrite(a.CHECKPOINT,K.best);this.CHECKPOINT=[];this.CHECKPOINT.length=6;a.inputs=[];a.inputs.push({key:0,time:0});for(G=0;G<Z.length;G++)Z[G].reset();a.PHYSICSBUFFER=[];G={};Object.assign(G,g[k]);a.PHYSICSBUFFER.push(G)}this.VALIDATE_CHECKPOINT=
[];this.VALIDATE_CHECKPOINT.length=6;e.position.copy(a.START_POSITION);e.lookAt(C);pa.lookAt(C);e.rotateOnAxis(q,0);e.updateMatrix();pa.updateMatrix();N=P=!1;c=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(G){G=void 0===G?window.performance.now():G;Ka||a.END||!f||a.REPLAY||a.RESET?(t=!1,z=!1,m=!1,h=!1):(t=E.UP,z=E.DOWN,m=E.LEFT,h=E.RIGHT,m&&h&&(m=!1,h=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?G+99999-O:G-O;G=0;if(this.TIMESTAMP>g[k].time){var X={};Object.assign(X,g[k]);
var oa=X.time;g=[];k=0;for(g.push({time:oa,position:X.position.clone(),normal:X.normal.clone(),direction:X.direction.clone(),velocity:X.velocity.clone(),rotation:X.rotation,step:X.step,U:X.U,D:X.D,L:X.L,R:X.R});oa<this.TIMESTAMP;){var sa;oa+=Na;this.REPLAY&&this.START&&(G=this.tapeReplay(oa));g.push({time:oa,position:g[k].position.clone(),normal:g[k].normal.clone(),direction:g[k].direction.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,step:g[k].step,U:t,D:z,L:m,R:h});k=g.length-1;
a.START&&(Ga=va=void 0,Ga=m&&h?0:m?1:h?-1:0,ba=g[k].step,0!=Ga&&Math.abs(ba)<Q?ba+=Ga:Math.abs(ba)>Q?(va=ba/Math.abs(ba),ba=Q*va):0<Math.abs(ba)&&(va=ba/Math.abs(ba),ba-=ba/Math.abs(ba),ba/Math.abs(ba)!=va&&(ba=0)),la=ba/Q*U,g[k].rotation+=la,g[k].step=ba,Y=g[k].velocity.length(),va=void 0,t&&c&&(ha.copy(g[k].direction),ha.multiplyScalar(L),g[k].velocity.add(ha)),z&&c&&g[k].velocity.multiplyScalar(.95),c?(N=!1,va=P?ea-.01:ea,g[k].velocity.multiplyScalar(va)):c||(N?g[k].velocity.add(A):N=!0,g[k].velocity.multiplyScalar(.998)),
g[k].position.add(g[k].velocity),e.position.copy(g[k].position),function(){I=[];J.copy(g[k].position);J.z-=50;M.set(0,0,1);V.far=100;V.set(J,M);K.surface.raycast(V,I);0<I.length?(J.copy(I[0].point),P=g[k].position.z<J.z&&5>Math.abs(g[k].position.z-J.z)?(u=0,c=!0,n.copy(I[0].face.normal),g[k].position.copy(J),1!==I[0].face.color.r):c=!1):0===I.length&&(c=!1,P=!1,t||z||m||h||a.REPLAY||(u+=Na),1E3<u&&!a.END&&!Ka&&(Ka=!0,S.dnf()));var ua=N?.001:.25;p.copy(g[k].normal);p.lerp(n,ua);ua=p.clone();ua.add(g[k].position);
g[k].normal=p.clone();e.lookAt(ua);e.rotateOnAxis(q,g[k].rotation);ja.copy(e.localToWorld(Ta.clone()));ja.sub(g[k].position);ja.normalize();g[k].direction.copy(ja)}(),function(){I=[];M.copy(g[k].position);M.sub(g[k-1].position);M.normalize();V.far=M.length();V.set(g[k].position,M);for(var ua=0,wa=!1,za=T;5>za;za++)if(K.generate.checkpoints[za].collision.raycast(V,I),0<I.length){ua=za;wa=!0;break}if(wa){za=g[k].position;wa=I[0].point;var Ja=g[k-1].position.distanceTo(wa);wa=za.distanceTo(wa);wa=g[k-
1].time+Ja/(Ja+wa)*a.TIMESTEP;K.generate.checkpoints[ua].display.material.color=aa[4];a.CHECKPOINT[ua]=Math.floor(wa/10);wa=T!==ua;a.CHECKPOINT[5]=0;for(za=1;za<ua;za++)void 0===a.CHECKPOINT[za]&&--a.CHECKPOINT[5];T=ua+1;4<=ua&&!a.REPLAY?(a.END=!0,a.REPLAY||S.complete()):a.REPLAY||a.IMPORT||S.checkpoint(wa)}a.SPEED=Math.round(60*Y/1E3*3600);a.START&&!a.END&&(l=Math.floor(g[k].time/10));a.OBJECTIVE=T;R.copy(x)}());e.updateMatrix();this.FRAME++;this.START&&!this.REPLAY?(sa={},Object.assign(sa,g[k]),
this.PHYSICSBUFFER.push(sa)):this.REPLAY&&G<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(sa={time:g[k].time,position:g[k].position.clone(),direction:g[k].direction.clone(),normal:g[k].normal.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,U:g[k].U,D:g[k].D,L:g[k].L,R:g[k].R,step:g[k].step},a.DEBUG_BUFFER.push(sa))}}var va,Ga;this.position.copy(g[k].position);this.direction.copy(g[k].direction);this.rotation=g[k].rotation;this.lookAt.copy(g[k].position);this.normal.copy(g[k].normal);
sa=this.normal.clone();sa.add(this.position);pa.position.copy(this.position);pa.lookAt(sa);pa.rotateOnAxis(q,this.rotation);Ea.update(t,this.position,this.direction,Y);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:ia,yen:0}};this.AT=function(){return l};this.convert=function(G){for(var X=[],oa=0;oa<G.length;oa++){var sa=G[oa].U,va=G[oa].D,Ga=G[oa].L,ua=G[oa].R,wa=sa&&va&&Ga,za=sa&&va&&ua,Ja=0;wa||za?wa?Ja="a":za&&(Ja="b"):
(Ja+=sa?3:va?6:0,Ja+=Ga?1:ua?2:0);X.push(Ja.toString())}return X};this.replay=function(G){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),xa=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(G,X){void 0===G||G?(a.SAVE_PARAM.power=X.power,a.SAVE_PARAM.drag=X.drag,a.SAVE_PARAM.sensitivity=X.sensitivity,a.SAVE_PARAM.model=X.model,a.SAVE_PARAM.paint=X.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),
a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var G=Z.length+" / "+S.BATTLE.length;0===Z.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);Z.length<S.BATTLE.length?(S.scan(G,!1),this.reset(),a.PAINT=S.BATTLE[Z.length].param.paint,a.MODEL=S.BATTLE[Z.length].param.model,a.paint(),a.body(),a.tune.power(S.BATTLE[Z.length].param.power),
a.tune.drag(S.BATTLE[Z.length].param.drag),a.tune.sensitivity(S.BATTLE[Z.length].param.sensitivity),a.INPUTS=S.BATTLE[Z.length].data,a.IMPORT_BUFFER=S.BATTLE[Z.length].IMPORT_BUFFER,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),this.replay()):(g[k].time=0,this.IMPORT=!1,Aa?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,this.replay(),uas.spectate(),S.replay(),this.INPUTS=[]):(this.reset(!1),S.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),
a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(G){G=void 0===G?r.power:G;r.power=0>G?0:5<G?5:G;L=.016+r.power/5*B},drag:function(G){G=void 0===G?r.drag:G;r.drag=0>G?0:5<G?5:G;ea=.985-r.drag/5*F},sensitivity:function(G){G=void 0===G?r.sensitivity:G;r.sensitivity=0>G?0:5<G?5:G;U=.06+r.sensitivity/5*H},ease:function(G){G=void 0===G?r.ease:G;r.ease=0>G?0:5<G?5:G;Q=6+r.ease}};this.param=function(){return array=Object.assign(r,[]),array.model=a.MODEL,
array.paint=a.PAINT,array};this.paint=function(G){G=void 0===G?a.PAINT:G;a.PAINT=G;Ea.paint(Ia[G]);ta.color.set(Ia[G]);ta.needsUpdate=!0};this.body=function(){pa.geometry.dispose();pa.geometry=W[a.MODEL].geometry().clone();pa.geometry.verticesNeedUpdate=!0};this.yen=function(){return S.cSave("YEN",0),0};this.debug=function(){console.log("position:",x);console.log("direction:",ja);console.log("rotation:",ka);console.log("dt:",1);console.log("TIME:",Va);console.log("INTERPOLATION:",1);console.log("PHYSICS MESH:",
e.rotation);console.log("EASE",Q);console.log(g);console.log(u);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",g[k]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(G){var X=0;if(0==a.INPUTS.length)X=0;else if(G<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[X].time<G;)X++;t=this.INPUTS[X].U;z=this.INPUTS[X].D;m=this.INPUTS[X].L;h=this.INPUTS[X].R}else if(this.IMPORT){G=!0;for(var oa="",sa=1;sa<this.CHECKPOINT.length;sa++)this.CHECKPOINT[sa]!==
S.BATTLE[Z.length].cp[sa]&&(""===oa&&(oa+="checkpoint_discrepancy"),G=!1);a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==S.BATTLE[Z.length].time&&(G=!1,oa+="final_time_discrepancy");G?Z.push(new ib(this.DEBUG_BUFFER.slice(),this.MODEL,this.PAINT,this.CHECKPOINT.slice())):(firebase.analytics().logEvent("invalid_data",{seed:K.name,uid:S.BATTLE[Z.length].uid,name:S.BATTLE[Z.length].name,report:K.name+"/"+S.BATTLE[Z.length].uid+"("+S.BATTLE[Z.length].name+")"+oa+" : "+ma+"/("+fa+")",error:oa}),S.BATTLE.splice(Z.length,
1));this["import"]()}else a.replay(!1),this.START=this.IMPORT=!1;return X};this.overwrite=function(G,X,oa){oa=void 0===oa?!0:oa;var sa=G[4]<X[4]&&G[5]>=K.best[5],va=G[5]>X[5],Ga=void 0!==G[4];return(0===X.length||sa||va)&&Ga?!oa||G:!!oa&&X};this.decode=function(G){var X=[function(){E.UP=!1;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!1;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!0;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!0;E.DOWN=
!1;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!0;E.DOWN=!1;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!0;E.RIGHT=!1},function(){E.UP=!1;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!0},function(){E.UP=!0;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!1}];X.a=function(){E.UP=!0;E.DOWN=!0;E.LEFT=!0;E.RIGHT=!1};X.b=function(){E.UP=!0;E.DOWN=!0;E.LEFT=!1;E.RIGHT=!0};X[G]()};this.audit=function(){}}function vb(a){var g=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=
this.frame=0;this.AT=function(){return g.tape[k].timer};this.DT=hb();var k=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(e){this.keybuffer.push({key:(E.UP?3:E.DOWN?6:0)+(E.LEFT?1:E.RIGHT?2:0),time:e})};this.simulate=function(){};this.capture=function(e){return{position:(new THREE.Vector3).copy(e.position),normal:(new THREE.Vector3).copy(e.normal),lookTarget:e.lookTarget.clone(),rotation:e.rotation,timer:e.getTime(),objective:e.getObjective(),check:e.check,UP:e.UP}};this.record=function(e){g.tape[k]=
e.record();k=24E4<g.tape[k].TS?0:k+1};this.play=function(e){if(this.RECORD){this.RECORD=!1;for(var t=g.frame=0;t<Z.length;t++)Z[t].reset();na.reset()}if(g.frame>g.tape.length-10){g.frame=0;na.reset();for(t=0;t<Z.length;t++)Z[t].reset();K.generate.resetCheckpoints()}if(e.replay(),this.tape[g.frame].check)K.generate.checkpoints[0===this.tape[g.frame].objective?4:this.tape[g.frame].objective-1].display.material.color=aa[4]};this.reset=function(){K.generate.resetCheckpoints();k=0;g.frame=0;na.reset();
g.PLAY=!1;g.RECORD=!0;g.tape=[]};this["export"]=function(e,t){e=void 0===e?function(){S.results()}:e;var z=y.CHECKPOINT[4]-1E4*y.CHECKPOINT[5];if(y.replay(),(z<La||!1===La)&&""!==fa&&null!==fa&&!1!==ma&&void 0!==ma&&!g.SCAN){S.STATE=function(){b.clear();b.print("uploading vhs to db","2","2")};S.STATE();ma;for(var m=K.name,h=y.CHECKPOINT.slice(),c=y.CHECKPOINT[0],f=y.param(),l=[];l.length<y.PHYSICSBUFFER.length;){var u=l.length;u={time:y.PHYSICSBUFFER[u].time,U:y.PHYSICSBUFFER[u].U,D:y.PHYSICSBUFFER[u].D,
L:y.PHYSICSBUFFER[u].L,R:y.PHYSICSBUFFER[u].R};l.push(u)}f={version:"006",id:ma,seed:m,time:z,cp:h,utc:c,debug:l,param:f};firebase.database().ref("vhs/006/"+f.seed+"/"+ma).set(f,function(w){w?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2","2"));window.setTimeout(e,1E3)})}else void 0===ma||!1===ma||null===fa||""===fa||void 0===fa?S.register():S.results()};this.burn=function(e){return Math.round(1E9*e).toString(16)};this.read=function(e){return parseInt(e,
16)/1E9};this.scan=function(e,t){g.SCAN=!0;var z=[];firebase.database().ref("vhs/006/"+e).orderByChild("time").limitToFirst(99).once("value").then(function(m){m.forEach(function(h){var c=h.child("id").val(),f=h.child("time").val();h=h.child("utc").val();z.push({uid:c,time:f,utc:h})});g.SCAN=!1;t(z)})};this.checkTime=function(e,t,z){e===t&&(La=z)};this.requestName=function(e,t){firebase.database().ref("uid/"+e).once("value").then(function(z){z=z.child("name").val();return t(z),z})};this["import"]=
function(e,t){t=void 0===t?function(){}:t;firebase.database().ref("vhs/006/"+e).once("value").then(function(z){var m=z.val(),h=m.id,c=m.seed,f=m.cp.slice();z=m.utc;m.model;m.paint;m.param;t({uid:h,seed:c,cp:f,utc:z,debug:m.debug.slice(),param:m.param})})};this.save=function(e,t){t=void 0===t?1E3/30:t;for(var z=0,m=[],h=e[e.length-1].TS,c=0;c<h;)c+=t,c<h&&m.push({TS:c});for(h=0;h<m.length;h++)z=g.convert(e,m[h],z);return m};this.convert=function(e,t,z){for(var m=e[z].time,h=e[z+1].TS,c=h-m;t.time>
h&&z<e.length-2;)m=e[++z].time,h=e[z+1].time,c=h-m;m=z;var f=z+1;h=(c-(h-t.time))/c;return t.position=new THREE.Vector3,t.position.copy(e[m].position),t.position.lerp(e[f].position,h),t.lookTarget=new THREE.Vector3,t.lookTarget.copy(e[m].normal),t.lookTarget.lerp(e[f].normal,h),t.rotation=(e[f].rotation-e[m].rotation)*h,t.rotation+=e[m].rotation,t.rotation=(e[f].rotation-e[m].rotation)*h,t.rotation+=e[m].rotation,t.AT=(e[f].AT-e[m].AT)*h,t.AT+=e[m].AT,t.UP=e[m].UP,t.check=e[m].check,t.objective=e[m].objective,
z}}var ib=function(a,g,k,e){k=void 0===k?0:k;e=void 0===e?[]:e;var t=this,z=[];this.inputs=[];z[0]={name:"logistics crate",geometry:function(){return Qa.logistics_crate()}};z[1]={name:"ag-86",geometry:function(){return Qa.ag_86()}};var m=void 0===g?0:g;g=k;var h=a.slice();this.tape=h;var c=new THREE.Vector3(0,0,1),f=h[0].position.clone(),l=new THREE.Vector3;new THREE.Vector3(0,0,1);var u=new THREE.Vector3,w=new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;this.direction=
new THREE.Vector3;this.lookAt=f;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var O=z[m].geometry(),P=new THREE.MeshBasicMaterial({color:Ia[g]}),N=new THREE.LineSegments(O,P);N.name="ghost_"+Z.length;N.position.copy(h[0].position);da.add(N);var ia=new Qa.emitter;ia.connect(Ia[k]);a=e.slice();(a[4]<K.best[4]||null==K.best[4])&&(K.best=a.slice());uas.TARGETS.push(this);Aa&&(uas.TARGET=1);this.reset=function(){na.reset();ia.reset();t.update()};this.update=function(T,r){r=r<h.length-1?
r:h.length-1;h[r].time;var B=h[r].U;0!==r&&0!==T||(B=!1);N.position.copy(f);N.lookAt(u);N.rotateOnAxis(c,h[r].rotation);Xa&&ia.update(B,f,l,t.velocity.length());f.copy(h[r].position);l.copy(h[r].direction);w.copy(h[r].normal);u.copy(w);u.add(f);this.position.copy(f);this.direction.copy(l);this.normal.copy(w)};this.index=function(T){var r=0;if(T<=h[h.length-2].time)for(;h[r].time<=T;)r++;else r=h.length-1;return r};this.toggleEmitter=function(T){void 0===T||T?ia.connect():ia.disconnect()};this.disconnect=
function(){da.remove(N);O.dispose();P.dispose();ia.disconnect()};this.debug=function(){console.log(h)}};window.onload=function(){window.addEventListener("touchstart",fb);window.addEventListener("contextmenu",function(){event.preventDefault()});da=new THREE.Scene;da.background=jb;kb=new THREE.Vector3(0,0,1);ca=new THREE.PerspectiveCamera;ca.up=kb;ca.position.z=2E3;ca.lookAt(0,0,0);ca.fov=70;ca.near=1E-4;ca.far=3E3;ca.name="Camera";da.add(ca);ya=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,
precision:"highp"});ya.setClearColor(jb);ya.domElement.id="renderer";ya.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(ya.domElement);E=new mb;E.connect();b=new tb;K=new ob;y=new ub;ra=new vb;S=new qb;S.login();S.checksave();S.decodeURL();uas=new lb;uas.connect();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,"#eeeeee");ca.position.set(0,25,10);ca.lookAt(0,0,0);Ha();gb();S.intro()}};window.onresize=
Ha;window.fullscreenchange=Ha;window.focus=Ha;var eb="development mountain;haunted forest;sheep pass;pine forest;shinigami graveyard;tofu route;ego mountain;lotus mountain;prey first pass;ginko mountain;ghxst pass;ghxstly forest;sleeping forest;do it pass;mew mountain;ultra mountain;vr pass;ratty mountain;coffee forest;r3 mountain;low tunnel pass;ogj route;lyla forest;the lotus order".split(";"),aa=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,
16756970],bb;for(bb in aa){var wb=new THREE.Color(aa[bb]);aa[bb]=wb}var Ia=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],rb="snow sakura melon peach bumblebee lavender ice".split(" "),La=!1,Ua="",Oa=Math.floor(2147483647*Math.random()),da,ca,ya,K,y,E,b,ra,S,Z=[],Na=1E3/60,Ba=12,Ya=9,Ca=0,Xa=!0,cb,Ra=!1,ab=!1,ma=null,fa="",kb,xa=!1,jb=aa[0],pb=0,Ka=!1,Pa=!1,qa=!1,$a=!1,Fa=!1,Ma=!0,Va=0,Wa=!1,Za=!1,Aa=!1,Da=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",
authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Qa={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,
1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),
geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=this;this.maxLife=100;for(var g=0,k=new THREE.Geometry;k.vertices.length<
a.maxLife;){var e=new THREE.Vector3(0,0,0);e.life=0;e.maxLife=a.maxLife;e.acc=new THREE.Vector3(0,0,0);k.vertices.push(e);e=new THREE.Color(4294967040);k.colors.push(e)}k.verticesNeedUpdate=!0;var t=new THREE.Points(k,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));t.name="Emitter";var z=new THREE.Color;a.connect=function(m){m=void 0===m?16777215:m;da.add(t);a.paint(m)};a.paint=function(m){m=new THREE.Color(void 0===m?16777215:m);
z=new THREE.Color;m.getHSL(z);for(m=0;m<t.geometry.vertices.length;m++)t.geometry.colors[m].setHSL(z.h,z.s,0),t.geometry.vertices[m].life=0};a.reset=function(){for(var m=0;m<t.geometry.colors.length;m++)t.geometry.colors[m].setHSL(z.h,z.s,0),t.geometry.vertices[m].life=0};a.disconnect=function(){da.remove(t);t.geometry.dispose();t.material.dispose()};a.update=function(m,h,c,f){if(m)for(m=0;1>m;){t.geometry.vertices[g].copy(c);t.geometry.vertices[g].multiplyScalar(-1-Math.random()*f);t.geometry.vertices[g].add(h);
t.geometry.vertices[g].life=t.geometry.vertices[g].maxLife;Math.random();Math.random();Math.random();var l=.1*-Math.random();t.geometry.vertices[g].acc.copy(c);t.geometry.vertices[g].acc.multiplyScalar(l);g++;g%=t.geometry.vertices.length;m++}for(var u in t.geometry.vertices){var w;0<t.geometry.vertices[u].life&&(t.geometry.vertices[u].add(t.geometry.vertices[u].acc),--t.geometry.vertices[u].life,w=t.geometry.vertices[u].life/100,t.geometry.colors[u].setHSL(z.h,z.s,z.l*w));0>=t.geometry.vertices[u].life&&
(t.geometry.vertices[u].set(0,0,0),t.geometry.vertices[g].acc.x=0,t.geometry.vertices[g].acc.y=0,t.geometry.vertices[g].acc.z=0)}t.geometry.verticesNeedUpdate=!0;t.geometry.colorsNeedUpdate=!0;t.geometry.computeBoundingSphere()}}},nb=function(){function a(z){return z*z*z*(z*(6*z-15)+10)}function g(z,m,h){return m+z*(h-m)}function k(z,m,h,c){var f=15&z;z=8>f?m:h;c=4>f?h:12==f||14==f?m:c;return(0==(1&f)?z:-z)+(0==(2&f)?c:-c)}for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,
30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,
248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;256>t;t++)e[256+t]=e[t];return{noise:function(z,m,h){var c=Math.floor(z),f=Math.floor(m),l=Math.floor(h),u=255&c,w=255&f,O=255&l,P=(z-=c)-1,N=(m-=f)-
1,ia=(h-=l)-1,T=a(z),r=a(m);c=a(h);f=e[u]+w;l=e[f]+O;f=e[f+1]+O;u=e[1+u]+w;w=e[u]+O;O=e[u+1]+O;return g(c,g(r,g(T,k(e[l],z,m,h),k(e[w],P,m,h)),g(T,k(e[f],z,N,h),k(e[O],P,N,h))),g(r,g(T,k(e[l+1],z,m,ia),k(e[w+1],P,m,h-1)),g(T,k(e[f+1],z,N,ia),k(e[O+1],P,N,ia))))}}},sb=function(a,g){for(var k="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e".split(" "),
e="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),t=a.toLowerCase(),z=0;z<t.length;z++){var m=t.charCodeAt(z);if(122<m||57<m&&61>m||33>m||40==m||41==m)return"";m="";for(var h=z;h<t.length;h++){t.charAt(h);var c=t.charCodeAt(h);(48<=c&&57>=c||97<=c&&122>=c)&&(m+=c.toString(16));for(c=0;c<k.length;c++){for(var f="",l="",u=[],w=0,O=0,P=0;P<k[c].length;P+=2){var N=m.charAt(P+w)+m.charAt(P+1+w),ia=k[c].charAt(P)+k[c].charAt(P+1);if((N===f||N===l)&&0!==N.length&&(O++,
0<O))for(;N===f||N===l;)w+=2,N=m.charAt(P+w)+m.charAt(P+1+w);if(N===ia)u[P/2]=!0,f=N,l=ia;else{u[P/2]=!1;for(var T=0;T<e.length;T++){var r=e[T].charCodeAt(1).toString(16),B=e[T].charCodeAt(0).toString(16);N===r&&(B===ia?(u[P/2]=!0,f=r,l=ia):B!==f&&B!==l||(O++,0<O&&(w+=2,P-=2)))}!1===u[P/2]&&(P=k[c].length)}}for(l=f=0;l<u.length;l++)if(!0===u[l]&&f++,f===u.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();
na.time=0;na.last=0;na.timestep=1E3/60;na.dt=1}},hb=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var g="[\n",k=0;k<a.length;k++){g+="'";for(var e=0;e<a[k].length;e++)g+=a[k].charCodeAt(e).toString(16);g+="',\n"}return g+="]",console.log(g),g}})();