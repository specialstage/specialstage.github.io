(function(){function ub(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var f="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",
a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;
ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(g){var e="keydown"==g.type;switch(e||(f+=g.key),3<f.length&&(f=f.slice(1,4)),g.key){case "ArrowUp":a.UP=e;break;case "ArrowDown":a.DOWN=e;break;case "ArrowLeft":a.LEFT=e;break;case "ArrowRight":a.RIGHT=e;break;case "w":a.UP=e;break;case "s":a.DOWN=e;break;case "a":a.LEFT=e;break;case "d":a.RIGHT=e;break;case "r":a.RESET=e;break;case " ":a.SPACE=e;break;case "Shift":a.SHIFT=e;break;case "Enter":a.ENTER=
e;break;case "Control":a.CTRL=e;break;case "Escape":case "Backspace":a.ESC=e;break;case "=":a.ZOOM_IN=e;break;case "-":a.ZOOM_OUT=e;break;case "t":a.TARGET=e;break;case "h":a.HIDE=e;break;case ">":!e&&2>za&&(za+=.5);Ja();break;case "<":!e&&.5<za&&(za-=.5),Ja()}Qa?!ea.PLAY||ra||Da||"vhs"===f&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(ea["export"],1E3,da.results,!1),f=""):"uas"===f&&(Qa=!0,ra=!0,da.settings(da.STATE),b.print("code detected: uas enabled","2","2"),f="")};
this.mousedown=function(g){g.preventDefault();a.touches[0]={x:g.clientX,y:g.clientY,start:!0}};this.mouseup=function(g){g.preventDefault();a.touches[0]={x:g.clientX,y:g.clientY,start:!1}};this.touchSetup=function(g){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,
!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(g)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(g){g=g.touches;a.touches=[];for(var e=0;e<g.length;e++)a.touches[e]={x:g[e].clientX,y:g[e].clientY,start:!0}};this.touchmove=function(g){a.touches=[];g=g.touches;for(var e=0;e<g.length;e++)a.touches[e]={x:g[e].clientX,
y:g[e].clientY,start:!1}};this.touchend=function(g){a.touches=[];g=g.touches;for(var e=0;e<g.length;e++)a.touches[e]={x:g[e].clientX,y:g[e].clientY,start:!1}}}function mb(){var a=(scope=this).SEED=0;this.length=480;var f=[],g=0;f[0]={name:"forest",palette:ba[9],tree:function(n,l){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};f[0].map[0]=function(n,l){var p=ba[10],D=!1;return.92<Math.abs(n)&&(p=.92<Math.abs(n)?ba[9]:ba[2],D=!0),f[0].flags[l]=D,p};f[1]={name:"sakura",
palette:ba[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};f[1].map[0]=function(n,l){var p=ba[1],D=!1;return.95<Math.abs(n)&&(p=.92<Math.abs(n)?ba[12]:ba[1],D=!0),f[1].flags[l]=D,p};f[2]={name:"summit",palette:ba[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};f[2].map[0]=function(n,l){var p=ba[7],D=!1;return.95<Math.abs(n)&&(p=.92<Math.abs(n)?ba[2]:ba[7],D=!0),f[2].flags[l]=D,p};var e=new THREE.Points(new THREE.Geometry);
e.name="Generative Extruder";e.visible=!1;var h=new THREE.Line(new THREE.Geometry);h.name="Generative Nodes";h.visible=!1;h.material.color=ba[6];h.material.name="Node Material";h.position.z+=2;var z=new THREE.LineSegments(new THREE.Geometry);z.name="Generative Segments";z.visible=!0;z.material.color=ba[3];z.material.name="Segments Material";var t=new THREE.Mesh(new THREE.Geometry);t.name="Generative Surface";t.visible=!1;t.material.color=ba[0];t.material.name="Surface Material";var x=new THREE.LineSegments(new THREE.Geometry);
x.name="Generative Perimeter";x.material.color=ba[1];x.material.name="Perimeter Material";var w=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));w.name="Terrain";w.material.name="Terrain Material";w.material.wireframe=!0;w.material.side=THREE.DoubleSide;w.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=
!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var d=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));d.name="Trees";var k=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);k.name="Background";k.material.color=ba[0];k.material.name="Background Material";k.material.wireframe=!1;k.material.side=THREE.FrontSide;k.material.opacity=.75;k.material.blendMode=THREE.MultiplyBlending;k.material.transparent=!0;var q=new THREE.Points(new THREE.Geometry);
q.material.color=ba[1];q.material.sizeAttenuation=!1;q.material.size=1.5;q.material.fog=!1;scope.stars=q;var m=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);m.name="Collision Mesh";m.visible=!0;m.material.name="Collision Material";m.material.side=THREE.BackSide;this.checkpoints=[];var B=new THREE.Vector3(0,0,1),H=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var K=new THREE.Vector3(0,3,0),Y=new THREE.Vector3(0,0,1),X=h.geometry.clone(),r=t.geometry.clone(),
C=z.geometry.clone(),A=x.geometry.clone(),E=[],P=[],ha=new THREE.Vector3;E[0]=new THREE.Vector3(5,3,0);E[1]=new THREE.Vector3(-5,3,0);P[0]=E[0].clone();P.z+=1;P[1]=E[1].clone();P.z+=1;var V=Math.PI/64,S=Math.PI/32,W=[],fa=0,ma=new THREE.Vector3;this.start=new THREE.Vector3;var oa=!1,pa=!1,ja=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Ra=18,Sa=new THREE.Raycaster;Sa.far=800;e.geometry.vertices[0]=K.clone();e.geometry.vertices[1]=B.clone().add(K);e.geometry.vertices[2]=E[0].clone();e.geometry.vertices[3]=
E[1].clone();e.geometry.vertices[4]=P[0].clone();e.geometry.vertices[5]=P[1].clone();this.connect=function(){scope.SEED=Ta;g=scope.randomInt(0,3);M.SNOW=2===g;M.SNOW&&M.snow.init();ca.add(e);ca.add(h);ca.add(z);ca.add(x);ca.add(t);ca.add(wireframe);ca.add(k);fa=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var n in W=[],ca.remove(e),ca.remove(h),ca.remove(z),ca.remove(x),ca.remove(t),ca.remove(wireframe),ca.remove(k),ca.remove(d),f)f[n].flag=[];for(var l in scope.checkpoints)ca.remove(scope.checkpoints[l].display),
scope.checkpoints[l].display.geometry.dispose(),scope.checkpoints[l].collision.geometry.dispose()};this.complete=function(){m.geometry.mergeVertices();m.geometry.verticesNeedUpdate=!0;m.geometry.elementsNeedUpdate=!0;m.geometry.computeFaceNormals();m.geometry.computeVertexNormals();m.geometry.computeBoundingSphere();k.geometry.copy(m.geometry);--k.position.z;for(var n=[],l=0;l<m.geometry.faces.length;l++)n[m.geometry.faces[l].a]=m.geometry.faces[l].vertexNormals[0].clone(),n[m.geometry.faces[l].b]=
m.geometry.faces[l].vertexNormals[1].clone(),n[m.geometry.faces[l].c]=m.geometry.faces[l].vertexNormals[2].clone();for(l=0;l<m.geometry.vertices.length;l++)m.geometry.vertices[l].add(n[l].multiplyScalar(2));m.geometry.verticesNeedUpdate=!0;wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();n=new THREE.IcosahedronGeometry(1200,10);for(var p in n.vertices).3>
scope.random()&&-400<n.vertices[p].z&&q.geometry.vertices.push(n.vertices[p].clone());n.dispose();q.geometry.computeBoundingSphere();M.surface=m.clone();M.start=scope.start.clone();fa=window.performance.now()-fa;oa=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(fa/1E3)});jb?(b.clear(),G.connect(M.start,M.surface),G.PLAY=!1,ea.PLAY=!0):da.ready()};this.reset=function(){Ra=(36+scope.random()-.5)/2;a=0;h.geometry.dispose();z.geometry.dispose();t.geometry.dispose();
e.geometry.dispose();x.geometry.dispose();w.geometry.dispose();wireframe.geometry.dispose();m.geometry.dispose();d.geometry.dispose();q.geometry.dispose();C.dispose();A.dispose();X.dispose();r.dispose();C.copy(new THREE.Geometry);A.copy(new THREE.Geometry);X.copy(new THREE.Geometry);r.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);e.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);x.geometry.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);
m.geometry.copy(new THREE.Geometry);K.set(0,3,0);Y.set(0,0,1);E[0]=new THREE.Vector3(4,3,0);E[1]=new THREE.Vector3(-4,3,0);oa&&(oa=!1,pa=!1,ja=!1);this.END=!1;e.position.set(0,0,0);e.geometry.vertices[0]=K.clone();e.geometry.vertices[1]=B.clone().add(K);e.geometry.vertices[2]=E[0].clone();e.geometry.vertices[3]=E[1].clone();e.geometry.vertices[4]=P[0].clone();e.geometry.vertices[5]=P[1].clone();e.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(n,l,p,D,y,u,
T,F,J,I){n=void 0===n?0:n;l=void 0===l?0:l;p=void 0===p?0:p;D=void 0===D?0:D;y=void 0===y?0:y;u=void 0===u?{start:0,end:30,angle:0,slope:0}:u;T=void 0===T?[]:T;F=void 0===F?[]:F;J=void 0===J?!1:J;I=void 0===I?999:I;var U=window.performance.now(),aa=0;for(0===D&&(D=.5<scope.random()?1:-1);32>aa&&!pa;){if(n===u.end+1){F=[];for(p=0;1>p;p++)if(n>=scope.length)F.push({angle:0,slope:0,end:30}),I=n+30;else if(0===l){var Z=scope.randomInt(2,4)*D;aa=Math.floor(Math.abs(36/Z));D=.01>scope.random()?+D:-1*D;
aa=scope.randomInt(1,aa);F.push({angle:Z,slope:0,end:aa})}else Z=scope.randomInt(-5,-1),aa=scope.random(),Z=2!==g&&.05>aa?Z*=-1:Z,aa=scope.randomInt(2,20),F.push({angle:0,slope:Z,end:aa});aa=scope.randomInt(0,F.length);l=F[aa].angle;p=F[aa].slope;u.start=n;u.end=n+F[aa].end;F=F.slice(aa,1)}if(J||(scope.extrude(l,p),W.push({angle:l,slope:p}),X.verticesNeedUpdate=!0,n++),10<=n&&!J){aa=new THREE.Vector2(X.vertices[n-1].x,X.vertices[n-1].y);for(Z=0;Z<X.vertices.length-1-10;Z++)if(18>(new THREE.Vector2(X.vertices[Z].x,
X.vertices[Z].y)).distanceTo(aa)){J=!0;break}J&&window.setTimeout(M.reset(!0),0)}0;n===I&&(pa=!0,h.geometry.dispose(),h.geometry=X.clone(),h.geometry.computeBoundingSphere(),h.geometry.center(),h.updateMatrixWorld(),0<h.geometry.vertices.length&&(ma.copy(h.geometry.vertices[0]),ma.sub(X.vertices[0])),window.setTimeout(function(){da.PATH=!0;da.STATE();scope["import"]()},0));aa=window.performance.now()-U}pa||J||window.setTimeout(scope.path,0,n,l,p,D,y,u,T,F,J,I)};this.skijump=function(n,l,p,D,y,u,T,
F,J,I,U){n=void 0===n?0:n;l=void 0===l?0:l;p=void 0===p?0:p;D=void 0===D?0:D;y=void 0===y?0:y;u=void 0===u?{start:0,end:20,angle:0,slope:0}:u;T=void 0===T?[]:T;F=void 0===F?[]:F;J=void 0===J?!1:J;I=void 0===I?300:I;U=void 0===U?0:U;var aa=window.performance.now(),Z=0;for(0===D&&(D=.5<scope.random()?1:-1);32>Z&&!pa;){if(n===u.end+1){F=[];for(l=0;1>l;l++)0===p&&20===u.end?(U=-1,F.push({angle:0,slope:-4,end:30})):3===p?F.push({angle:0,slope:4,end:3}):4===p?F.push({angle:0,slope:-32,end:10}):-4===p?(U=
1,F.push({angle:0,slope:p+1,end:1})):-32===p?F.push({angle:0,slope:-4,end:40}):1==U?F.push({angle:0,slope:p+1,end:1}):-1==U&&F.push({angle:0,slope:p-1,end:1});Z=scope.randomInt(0,F.length);l=F[Z].angle;p=F[Z].slope;u.start=n;u.end=n+F[Z].end;F=F.slice(Z,1)}if(J||(scope.extrude(l,p),W.push({angle:l,slope:p}),X.verticesNeedUpdate=!0,n++),10<=n&&!J){Z=new THREE.Vector2(X.vertices[n-1].x,X.vertices[n-1].y);for(var ya=0;ya<X.vertices.length-1-10;ya++)if(0>(new THREE.Vector2(X.vertices[ya].x,X.vertices[ya].y)).distanceTo(Z)){J=
!0;break}J&&window.setTimeout(M.reset(!0),0)}0;I<=n&&(pa=!0,h.geometry.dispose(),h.geometry=X.clone(),h.geometry.computeBoundingSphere(),h.geometry.center(),h.updateMatrixWorld(),0<h.geometry.vertices.length&&(ma.copy(h.geometry.vertices[0]),ma.sub(X.vertices[0])),window.setTimeout(function(){scope["import"]()},0));Z=window.performance.now()-aa}pa||J||window.setTimeout(scope.skijump,0,n,l,p,D,y,u,T,F,J,I)};this["import"]=function(n){n=void 0===n?0:n;for(var l=window.performance.now(),p=0;!ja&&32>
p;){if(0===n&&(e.position.set(0,0,0),e.rotation.z=0,K.set(0,3,0),e.geometry.vertices[0]=K.clone(),e.geometry.vertices[1]=B.clone().add(K),e.geometry.vertices[2]=E[0].clone(),e.geometry.vertices[3]=E[1].clone(),e.geometry.vertices[4]=P[0].clone(),e.geometry.vertices[5]=P[1].clone(),e.geometry.verticesNeedUpdate=!0,e.updateMatrixWorld()),n<W.length)a=n,angle=W[n].angle,slope=W[n].slope,scope.extrude(angle,slope),z.geometry.dispose(),z.geometry=C.clone(),z.geometry.computeBoundingSphere(),x.geometry.dispose(),
x.geometry=A.clone(),x.geometry.computeBoundingSphere(),t.geometry.dispose(),t.geometry=r.clone(),t.geometry.computeBoundingSphere(),n++;else if(!ja&&n===W.length){for(var D in scope.checkpoints=scope.checkpoint(),scope.checkpoints)ca.add(scope.checkpoints[D].display);ja=!0;window.setTimeout(function(){scope.terrain(!0)},0)}p=window.performance.now()-l}ja||window.setTimeout(scope["import"],0,n,angle,slope)};this.extrude=function(n,l){n=void 0===n?0:n;l=void 0===l?0:l;for(var p in e.updateMatrixWorld(),
e.rotateZ(n*S),e.geometry.vertices)e.geometry.vertices[p].applyAxisAngle(H,l*V);e.geometry.verticesNeedUpdate=!0;p=e.geometry.vertices[0].clone();var D=e.geometry.vertices[2].clone(),y=e.geometry.vertices[3].clone(),u=e.geometry.vertices[1].clone();if(p.applyMatrix4(e.matrix),D.applyMatrix4(e.matrix),y.applyMatrix4(e.matrix),u.applyMatrix4(e.matrix),u.sub(p),pa){if(D.add(ma),y.add(ma),0<C.vertices.length){var T=C.vertices[C.vertices.length-1].clone().sub(ha),F=C.vertices[C.vertices.length-2].clone().sub(ha);
r.vertices.push(D.clone().sub(u));r.vertices.push(y.clone().sub(u));r.vertices.push(F);r.vertices.push(y.clone().sub(u));r.vertices.push(T);r.vertices.push(F);var J=D.clone();n=y.clone();T=C.vertices[C.vertices.length-1].clone();F=C.vertices[C.vertices.length-2].clone();m.geometry.vertices.push(J);m.geometry.vertices.push(n);m.geometry.vertices.push(F);m.geometry.vertices.push(n);m.geometry.vertices.push(T);m.geometry.vertices.push(F);T=r.vertices.length;var I=new THREE.Face3(T-3,T-2,T-1);J=new THREE.Face3(T-
5,T-4,T-6);r.faces.push(I);r.faces.push(J);I=I.clone();J=J.clone();I.color=new THREE.Color(16777215);J.color=new THREE.Color(16777215);m.geometry.faces.push(I);m.geometry.faces.push(J)}0<A.vertices.length?(I=2,J=1,4<A.vertices.length&&(I=4,J=2),I=A.vertices[A.vertices.length-I].clone(),J=A.vertices[A.vertices.length-J].clone(),A.vertices.push(D.clone().add(u)),A.vertices.push(I.clone()),A.vertices.push(y.clone().add(u)),A.vertices.push(J.clone()),a==W.length-1&&(F=D.clone().add(u),T=y.clone().add(u),
A.vertices.push(F),A.vertices.push(T))):(A.vertices.push(D.clone().add(u)),A.vertices.push(y.clone().add(u)));C.vertices.push(D.clone());C.vertices.push(y.clone());ha.copy(u)}else X.vertices.push(p.clone());for(var U in K.copy(p).sub(e.position),e.position.add(K),e.geometry.vertices)e.geometry.vertices[U].applyAxisAngle(H,-1*l*V)};this.terrain=function(n,l,p,D,y,u,T){l=void 0===l?[]:l;p=void 0===p?[]:p;D=void 0===D?[]:D;y=void 0===y?0:y;u=void 0===u?0:u;T=void 0===T?0:T;if(void 0===n||n){z.updateMatrixWorld();
w.geometry.dispose();w.geometry.copy(new THREE.Geometry);l=[];p=[];D=[];for(n=0;2>n;n++)D[n]=[],l[n]=[],p[n]=[];for(n=0;n<z.geometry.vertices.length;n++)p[n%2].push(z.geometry.vertices[n]);for(n=0;2>n;n++)for(var F=0;F<p[n].length;F++){var J=0===n?1:-1,I=p[n][F].clone();I.sub(p[n+J][F]);I.normalize().multiplyScalar(3);D[n][F]=I.clone()}}F=0;var U;n=window.performance.now();if(4>y){if(w.geometry.verticesNeedUpdate=!0,w.geometry.elementsNeedUpdate=!0,w.geometry.computeBoundingSphere(),w.geometry.computeFaceNormals(),
w.geometry.computeVertexNormals(),w.updateMatrixWorld(),0<y&&0===T)for(p[u]=[],J=0;J<l[u].length;J++)p[u][J]=w.geometry.vertices[l[u][J]];0===T&&(l[u]=[]);for(v=T;v<p[u].length&&32>F;){F=!1;if(void 0!==p[u][v]&&void 0!==p[u][v-1]){if(void 0===D[u][v])D[u][v]=D[s][v-1].clone();else if(w.geometry.computeBoundingSphere(),J=p[u][v].clone().add(D[u][v]),J.z-=100,Sa.set(J,B),J.z+=100,I=Sa.intersectObjects([w],!0),0<I.length)for(var aa in I).01<I[aa].point.distanceTo(J)&&(l[u][v]=void 0,F=!0);F||(w.geometry.vertices.push(p[u][v].clone()),
w.geometry.vertices.push(p[u][v].clone().add(D[u][v])),l[u][v]=w.geometry.vertices.length-1,0<v&&(w.geometry.vertices.push(p[u][v-1].clone()),U=w.geometry.vertices.length,0===u?w.geometry.faces.push(new THREE.Face3(U-2,U-1,U-3)):1===u&&w.geometry.faces.push(new THREE.Face3(U-1,U-2,U-3))))}F=window.performance.now()-n;v++;T=v}if(T===p[u].length){T=0;for(U=1;U<l[u].length;U++)if(void 0!==l[u][U]&&void 0!==l[u][U-1]){aa=w.geometry.vertices[l[u][U]];var Z;n=w.geometry.vertices[l[u][U-1]];2.8>aa.distanceTo(n)?
(aa.copy(n),l[u][U]=l[u][U-1],D[u][U].copy(D[u][U-1])):1<U&&(w.geometry.vertices.push(p[u][U-1]),Z=0===u?l[u][U]:l[u][U-1],n=0===u?l[u][U-1]:l[u][U],w.geometry.faces.push(new THREE.Face3(Z,n,w.geometry.vertices.length-1)))}u++}1<u&&(u=0,y++)}if(4===y){w.geometry.verticesNeedUpdate=!0;w.geometry.elementsNeedUpdate=!0;w.geometry.colorsNeedUpdate=!0;w.geometry.computeFaceNormals();w.geometry.computeVertexNormals();w.geometry.mergeVertices();w.geometry.computeBoundingSphere();scope.noise(w.geometry);
for(Z=0;Z<w.geometry.faces.length;Z++)aa=w.geometry.vertices[w.geometry.faces[Z].a].clone(),n=w.geometry.vertices[w.geometry.faces[Z].b].clone(),U=w.geometry.vertices[w.geometry.faces[Z].c].clone(),w.geometry.colors[w.geometry.faces[Z].a],w.geometry.colors[w.geometry.faces[Z].b],w.geometry.colors[w.geometry.faces[Z].c],m.geometry.vertices.push(aa),m.geometry.vertices.push(n),m.geometry.vertices.push(U),wireframe.geometry.vertices.push(aa),wireframe.geometry.vertices.push(n),wireframe.geometry.vertices.push(U),
U=m.geometry.vertices.length,aa=new THREE.Face3(U-1,U-2,U-3),aa.color=new THREE.Color(0),m.geometry.faces.push(aa),wireframe.geometry.faces.push(new THREE.Face3(U-1,U-2,U-3));wireframe.geometry.copy(w.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,l.slice(),p.slice(),D.slice(),y,u,T)},0)};this.biome=function(){for(var n=g,l=wireframe.geometry.faces,p=[],D=[],y=0;y<l.length;y++)for(var u=0;u<f[g].map.length;u++)l[y].vertexColors[0]=
f[g].map[u](l[y].vertexNormals[0].z,l[y].a),l[y].vertexColors[1]=f[g].map[u](l[y].vertexNormals[1].z,l[y].b),l[y].vertexColors[2]=f[g].map[u](l[y].vertexNormals[2].z,l[y].c);for(l=0;l<f[g].flags.length;l++)for(y=0;y<z.geometry.vertices.length;y++).1>wireframe.geometry.vertices[l].distanceTo(z.geometry.vertices[y])&&(f[g].flags[l]=!1);for(l=0;l<f[g].flags.length;l++)f[g].flags[l]&&p.push(l);for(l=0;l<f[g].limit&&l<p.length;){y=scope.randomInt(0,p.length);u=!0;if(0<D.length&&0<p.length)for(;u;){for(var T in D){if(wireframe.geometry.vertices[p[y]].distanceTo(wireframe.geometry.vertices[D[T]])<
f[g].range){u=!0;p.slice(y,1);y=scope.randomInt(0,p.length);break}u=!1}0>=p.length&&(u=!1)}if(0<p.length){u=f[n].tree();for(var F in u.vertices)d.geometry.vertices.push(u.vertices[F].clone().add(wireframe.geometry.vertices[p[y]])),d.geometry.colors[d.geometry.vertices.length-1]=u.colors[F];D.push(p[y]);p.slice(y,1)}l++}d.verticesNeedUpdate=!0;d.elementsNeedUpdate=!0;ca.add(d)};this.sakura=function(){var n=new THREE.Geometry,l=[],p=[],D=1,y,u=new THREE.Vector3(0,0,0),T=new THREE.Vector3(0,0,3),F=12,
J=0,I=new THREE.Vector3(1,0,0),U=new THREE.Vector3(0,0,1);n.vertices.push(u);n.vertices.push(T);n.colors.push(ba[2]);n.colors.push(ba[2]);p.push({v:T.clone(),n:T.clone(),pitch:I.clone(),roll:U.clone()});for(u=[];4>J;){T=[];for(I=0;I<p.length;I++)for(var aa=U=0;3>aa;aa++){var Z=0===J&&2===aa&&1>U?1:scope.random();if(.2<Z){Z=scope.randomInt(-2,2);var ya=p[I].n.clone(),sa=ba[2];ya.applyAxisAngle(p[I].pitch,2*Math.PI/(F+Z));ya.applyAxisAngle(p[I].roll,2*Math.PI/3*aa);ya.multiplyScalar(D);Z=ya.clone().add(p[I].v);
n.vertices.push(p[I].v.clone());n.vertices.push(Z);n.colors.push(sa);n.colors.push(sa);sa=p[I].pitch.clone();sa.applyAxisAngle(p[I].roll,2*Math.PI/3*aa);sa.applyAxisAngle(p[I].pitch,2*Math.PI/F);var Ka=p[I].roll.clone();Ka.applyAxisAngle(p[I].pitch,2*Math.PI/F);Ka.applyAxisAngle(p[I].roll,2*Math.PI/3*aa);0<aa&&l.push({a:Z.clone(),b:p[I].v.clone(),pitch:sa,roll:Ka});T.push({v:Z.clone(),n:ya.clone(),pitch:sa,roll:Ka});U++}else 0===U&&2===aa&&u.push({v:p[I].v.clone(),n:p[I].n.clone(),pitch:p[I].pitch.clone(),
roll:p[I].roll.clone()})}p=T.slice();D*=.9;J++}for(y in F=6,l)D=l[y].a.clone(),T=l[y].b.clone(),D=D.clone().sub(T),I=D.clone().multiplyScalar(.5).add(T),J=scope.randomInt(0,3)-1,D.applyAxisAngle(l[y].pitch,2*Math.PI/F),D.applyAxisAngle(l[y].roll,2*Math.PI/J),D.multiplyScalar(.5),T=I,I=D.clone().add(I),n.vertices.push(T),n.vertices.push(I),n.colors.push(ba[2]),n.colors.push(ba[2]),T=l[y].pitch.clone(),T.applyAxisAngle(l[y].roll,2*Math.PI/J),T.applyAxisAngle(l[y].pitch,2*Math.PI/F),U=l[y].roll.clone(),
U.applyAxisAngle(l[y].pitch,2*Math.PI/F),U.applyAxisAngle(l[y].roll,2*Math.PI/J),p.push({v:I.clone(),n:D.clone(),pitch:T,roll:U});p=p.concat(u);for(l=0;l<p.length;l++)for(y=0;5>y;y++)F=p[l].n.clone(),F.normalize(),F.applyAxisAngle(p[l].pitch,2*Math.PI/6),F.applyAxisAngle(p[l].roll,2*Math.PI/5*y),F.multiplyScalar(.5),F=F.add(p[l].v),u=p[l].v.clone(),n.vertices.push(F),n.vertices.push(u),n.colors.push(ba[12]),n.colors.push(ba[12]);return n.colorsNeedUpdate=!0,n};this.pine=function(){var n=Math.floor(8*
scope.random())+6,l=2*Math.PI/6,p=new THREE.Geometry;p.vertices.push(new THREE.Vector3(0,0,0));p.vertices.push(new THREE.Vector3(0,0,+n-.5+1));p.colors.push(ba[9]);p.colors.push(ba[9]);p.colors.push(ba[9]);for(var D=1;D<n;D++)for(var y=0;6>y;y++)off=D%2*l*.5,p.vertices.push(new THREE.Vector3(0,0,+D+1)),p.vertices.push(new THREE.Vector3(.3*(n-D),0,+D-.3+1)),p.vertices[p.vertices.length-1].applyAxisAngle(B,l*y+off),p.colors.push(ba[9]),p.colors.push(ba[9]);return p};this.checkpoint=function(){function n(y,
u,T){var F=new THREE.Geometry,J=(new THREE.Vector3).copy(y).sub(u),I=(new THREE.Vector3).copy(y).add(J.clone().multiplyScalar(1.5));J=(new THREE.Vector3).copy(u).sub(J.clone().multiplyScalar(1.5));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));F.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));F.vertices.push(new THREE.Vector3(J.x,J.y,J.z+12));F.vertices.push(new THREE.Vector3(J.x,J.y,J.z-12));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));
F.faces.push(new THREE.Face3(0,1,2));F.faces.push(new THREE.Face3(3,4,5));I=new THREE.Geometry;I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));I.vertices.push(new THREE.Vector3(u.x,u.y,u.z+6));I.vertices.push(new THREE.Vector3(u.x,u.y,u.z+8));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));I.vertices.push(new THREE.Vector3(u.x,u.y,u.z+6));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));I.vertices.push(new THREE.Vector3(u.x,u.y,u.z+8));I.vertices.push(new THREE.Vector3(y.x,
y.y,y.z+1));I.vertices.push(new THREE.Vector3(u.x,u.y,u.z+1));y=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});y.color=ba[5];F=new THREE.Mesh(F,y);F.visible=!0;y=new THREE.LineSegments(I,y);return F.name="Objective "+T,y.name="Checkpoint"+T,{display:y,collision:F}}var l=z.geometry,p=l.vertices.length-80;p=Math.floor(p/4)-Math.floor(p/4)%2;var D=[];D[0]=n(l.vertices[40],l.vertices[41],0);D[1]=n(l.vertices[40+p],l.vertices[1+p+40],1);D[2]=n(l.vertices[2*p+40],l.vertices[2*
p+41],2);D[3]=n(l.vertices[3*p+40],l.vertices[3*p+41],3);D[4]=n(l.vertices[4*p+40],l.vertices[4*p+41],4);this.DISTANCE=4*p/2*3;scope.start.copy(l.vertices[36]);scope.start.sub(l.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(l.vertices[36]);for(l=0;5>l;l++)null==M.best&&(M.best[l]=4>l?p*(l+1)/Ra:M.best[l]=M.best[l-1]);return da.STATE(),D};this.resetCheckpoints=function(){for(var n in scope.checkpoints)scope.checkpoints[n].display.material.color=ba[5]};this.random=function(){Ta=(Ta+
1)%2147483647;var n=1E4*Math.sin(Ta);return n-Math.floor(n)};this.randomInt=function(n,l){return Math.floor(scope.random()*(l-n))+n};this.noise=function(n){var l=new vb,p=[],D=8,y=0,u=0,T=1E3*scope.random();g;for(var F=0;F<n.vertices.length;F++)p[F]=0;for(F=0;2>F;F++){for(var J=0;J<n.vertices.length;J++)p[J]+=Math.floor(l.noise(n.vertices[J].x/D,n.vertices[J].y/D,T)*D),p[J]>y&&(y=p[J]),p[J]<u&&(u=p[J]);D*=3}for(l=0;l<p.length;l++){D=2===g?2:.5;for(y=0;y<z.geometry.vertices.length;y++)u=n.vertices[l].distanceTo(z.geometry.vertices[y]),
u=u*u/100,u<D&&(D=u);n.vertices[l].z+=p[l]*D}};this.name=function(){var n="";if(Ya)n=da.custom_seed;else if(Ha||jb)n=da.CHALLENGES.seed;else{var l=[" forest"," pass"," mountain"],p="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var D=Math.ceil(3*Math.random())+1,y=0;y<D;)n+=p[Math.floor(Math.random()*p.length)],y++;p=2===g?1:0;p=l[Math.floor(p+Math.random()*(l.length-p))];if(n+=
p,.01<Math.random())for(p=Math.floor(Math.random()*cb.length),n=cb[p];n==nb;)n=cb[Math.floor(Math.random()*cb.length)]}return nb=n,n}}function ob(){db=!0;window.removeEventListener("touchstart",ob)}function Ja(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,f=window.innerWidth,g=window.innerHeight;O.aspect=f/g;O.updateProjectionMatrix();b.resize(f,g,a,za);da.resize(f,g,a)}function pb(){if(window.requestAnimationFrame(pb),Ea=window.performance.now(),Aa){G.update();
for(var a=0;a<ia.length;a++)G.START&&(eb(),ia[a].update());ra||kb||da.update();!db||ra||Na||b.dpad();Q.RESET&&!ra&&(da.reset(),Q.RESET=!1);M.update()}else if(ea.PLAY){eb();M.update();for(a=0;a<ia.length;a++)ia[a].update();if(0<ia.length&&Da&&la.time>ia[0].tape[ia[0].tape.length-1].TS+3E3)for(la.reset(),a=0;a<ia.length;a++)ia[a].reset();Da&&G.START?(uas.update(),ea.play(G)):Da?uas.update():ea.play(G)}else Za?(O.position.applyAxisAngle(O.up,.01),O.lookAt(new THREE.Vector3,0,0,0),da.loading()):(O.position.applyAxisAngle(O.up,
.01),O.lookAt(new THREE.Vector3,0,0,0));ua.render(ca,O);b.update(Q.touches)}function wb(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new mb;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<
a.snow.limit;){var g=new THREE.Vector3;g.copy(O.position);g.x+=Math.random()*a.snow.distance-a.snow.distance/2;g.y+=Math.random()*a.snow.distance-a.snow.distance/2;g.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(g)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var g=0;g<a.snow.mesh.geometry.vertices.length;g++){var e=a.snow.mesh.geometry.vertices[g];e.z-=.5*G.DT();(Math.abs(e.z-O.position.z)>a.snow.height/
2||Math.abs(e.x-O.position.x)>a.snow.distance/2||Math.abs(e.y-O.position.y)>a.snow.distance/2)&&(e.copy(O.position),e.x+=Math.random()*a.snow.distance-a.snow.distance/2,e.y+=Math.random()*a.snow.distance-a.snow.distance/2,e.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var f=0;4>f;f++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(g){g=void 0===g?!1:g;if(O.position.set(0,
400,200),O.far=2E3,O.updateProjectionMatrix(),O.lookAt(new THREE.Vector3),ua.render(ca,O),!g){this.name=this.generate.name();g="";for(var e in this.name)g+=this.name.charCodeAt(e).toString();Ta=g}a.generate.connect();xb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(g){g=void 0===g?!1:g;Ta++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new mb;a.connect(g)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}
function yb(){var a=this,f,g,e="",h=0,z=0;this.custom_seed="";var t="#1#ffffff#334#",x=Ba+"#1#",w=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(d){return d?(qa=d.uid,a.STATE(),ea.requestName(qa,function(k){ka=k;a.STATE()})):(qa=!1,a.STATE()),null})};this.register=function(d){b.clear();a.STATE=function(){a.register(d)};kb=!0;a.inputName(function(){kb=
!1;ea["export"]()},!0,"input name to save data")};this.resize=function(d,k){f=b.width;g=b.height;fb=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var d=G.yen();b.print("$ "+d.toString(),"2","1.0-4")};this.nav=function(d){d=void 0===d?function(){b.clear()}:d;Da?(b.sprite(24,64,8,8,"1.0-3","2",8,8),b.button("","0.5","0.5","1.0","1.0",function(){a.menu(d)},!1)):(b.sprite(8,64,8,8,"1.0-4+2p","2",8,8),b.button("","2","2+4p","1.0-4","8",function(){a.menu(d)},!1))};this.title=
function(d,k){a.breadcrumb(d,k);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){w||b.backdrop(!1);d();ra=!1;a.SETTINGS=!1},!1);a.wallet()};this.breadcrumb=function(d,k){k=void 0===k?function(){w||b.backdrop(!1);d();ra=!1;a.SETTINGS=!1}:function(){a.menu(d);ra=!0};b.print("< menu","2","2");b.button("","2","2+4p","7","8",k,!1)};this.menu=function(d){ra=!0;b.style=0;a.STATE=function(){a.menu(d)};w||b.backdrop();b.clear();a.title(d);b.sprite(0,0,1,1,"2","6","1.0-4",
1);Da?(b.print(" > view spectator controls","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(d)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");b.button("","2","13+4p","1.0-4","5",function(){a.settings(d)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var k=8;Da?(b.button("reset uas","2","1.0-2-"+k,"1.0-4","6",function(){b.backdrop(!1);uas.reset();a.uas()},!0),
k+=8,b.button("deploy vehicle","2","1.0-2-"+k,"1.0-4","6",function(){b.backdrop(!1);a.STATE=function(){};G.connect(M.start,M.generate.surface);uas.disconnect();a.reset()},!0)):(Aa||ea.PLAY)&&(b.button("restart stage","2","1.0-2-"+k,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),k+=8);M.COMPLETE&&(Aa||ea.PLAY)&&b.button("next stage","2","1.0-2-"+k,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0);a.discord()};this.intro=function(){var d;a.STATE=function(){a.intro()};w=!0;b.clear();b.print("specialstage.io",
"2","2");b.print("-","2","4");b.link("","0","1.0-24","26","6","https://ginko.ltd");b.print("new physical items","2","1.0-23");b.print("available at","2","1.0-21");b.style=1;b.print("ginko.ltd","2+13","1.0-21");b.style=0;Ha?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,d=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),b.style=0,b.print(d,"9","15"),ea.requestName(a.CHALLENGES.uid,function(k){a.CHALLENGER=k;a.STATE()}),b.style=2,b.print("seed:",
"2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ya&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==qa&&!1===qa||""!==ka?null!==ka&&""!==ka?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+ka,"2","9"),b.style=2,b.print("[edit]",ka.length+"+5","9"),b.style=0,b.button("","2","9+4p",ka.length+"+9","4",function(){a.inputName(a.intro)},!1)):!1!==qa||""!==ka&&null!==ka||(b.style=2,b.print("user data not detected","2","6"),
b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.5.5","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();w=!1;
b.renderer.style.background="transparent";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");M.connect();a.load()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=0};this.load=function(){a.STATE=function(){a.target()};a.TIMELIST=[];ea.scan(M.name,function(d){for(var k={$jscomp$loop$prop$t$90$158:0};k.$jscomp$loop$prop$t$90$158<
d.length;k={$jscomp$loop$prop$t$90$158:k.$jscomp$loop$prop$t$90$158},k.$jscomp$loop$prop$t$90$158++)a.TIMELIST[k.$jscomp$loop$prop$t$90$158]={uid:d[k.$jscomp$loop$prop$t$90$158].uid,time:d[k.$jscomp$loop$prop$t$90$158].time,name:"..."},ea.requestName(d[k.$jscomp$loop$prop$t$90$158].uid,function(B){return function(H){a.TIMELIST[B.$jscomp$loop$prop$t$90$158].name=H;a.STATE()}}(k)),ea.checkTime(qa,d[k.$jscomp$loop$prop$t$90$158].uid,d[k.$jscomp$loop$prop$t$90$158].time);var q=a.TIMELIST.length<Ba?a.TIMELIST.length:
Ba;k=[];switch(Ca){case 0:k=d.slice(0,q);break;case 1:for(d=d.slice();k.length<q;){var m=Math.floor(Math.random()*d.length);k.push(Object.assign({},d[m]));d.splice(m,1)}}if(a.BATTLE=k.slice(),Aa)for(q=0;q<k.length;q++)ea["import"](M.name+"/"+k[q].uid,function(B){ia.push(new gb(B.tape,B.model,B.paint,B.cp))});a.STATE()});Za=!0;a.target();h=0};this.ready=function(){Za=!1;a.STATE()};this.play=function(){b.clear();a.nav(a.play);ra=!1;b.style=0};this.complete=function(){ra=!0;b.clear();a.nav(a.complete);
var d="stage complete!";b.style=0;b.print(d,"0.5-"+2*Math.round(d.length/2),"0.3-1",2);b.style=0;M.COMPLETE=!0;window.setTimeout(function(){!1===qa||null===qa?(a.register(),a.STATE=function(){a.results()}):(a.STATE=function(){a.results()},ea["export"](a.results))},2E3);d=G.param().model+" ("+(G.param().power+1)+"/"+(G.param().drag+1)+"/"+(G.param().sensitivity+1)+"/"+(G.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:ka,time:G.AT(),penalty:G.PENALTY(),score:G.AT()+
G.PENALTY(),seed:M.name,rating:Math.round(M.generate.DISTANCE/(G.AT()+G.PENALTY())),distance:M.generate.DISTANCE,vehicle:d})};this.results=function(){a.STATE=function(){a.results()};b.style=0;ra=!0;b.clear();ka;ea.tape.slice();ra=!0;var d,k=b["float"](G.AT()+G.PENALTY()),q=0;if(0<a.TIMELIST.length){for(var m=Math.floor(100*(G.AT()+G.PENALTY()))/100,B=0;B<a.TIMELIST.length;B++)if(m<a.TIMELIST[B].time){q=B+1;break}0==q&&(q=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+M.name,
"2","2");b.style=0;b.print(k,"2","5",2);0!=q?b.print("rank "+q,2*k.length+"+3".toString(),"5+4p"):G.AT()+G.PENALTY()<M.best[4]?(d=Ha?"challenge victory!":"new record!",b.style=4,b.print(d,2*k.length+"+3".toString(),"5+4p"),b.style=0):Ha&&b.print("challenge failed",2*k.length+"+3".toString(),"5+4p");d=9;k=G.CP();if(320<g){for(m=0;m<k.length-1;m++){b.style=5;b.print("cp "+(m+1).toString(),"2",d+"+"+m.toString());m;var H=void 0;B=void 0;B="number"==typeof k[m]?(H=b["float"](k[m]),Number.isNaN(M.best[m])?
"+1 cp":k[m]-M.best[m]):(H="penalty",b.style=4,"");b.print(H.toString(),"0.5 -1-"+H.length.toString(),d+"+"+m.toString());b.style=0;H="penalty"===H?"25 sec":"+1 cp"==B?"+1 cp":0<B?"( - "+b["float"](B)+" )":"( + "+b["float"](Math.abs(B))+" )";b.style=0<B?4:0>B?1:0===B?2:4;b.print(H,"0.5+1",d+"+"+m.toString());b.style=0;d+=1}d+=5}1===q&&(b.style=1,b.print("new record!","2",d.toString(),2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20",
"0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){ra=!1;a.replay()});window.setTimeout(function(){Aa=!1;ea.PLAY=!0},0)};this.battle=function(){var d=new gb(ea.save(ea.tape),G.MODEL,G.PAINT);ia.push(d);a.reset()};this.replay=function(){a.STATE=function(){a.results()};b.clear();a.nav(a.results);
for(var d={$jscomp$loop$prop$e$97$160:0};4>d.$jscomp$loop$prop$e$97$160;d={$jscomp$loop$prop$e$97$160:d.$jscomp$loop$prop$e$97$160},d.$jscomp$loop$prop$e$97$160++){var k="4+"+(4*d.$jscomp$loop$prop$e$97$160).toString(),q=d.$jscomp$loop$prop$e$97$160===G.CAMERA-1?48:40;b.button("",k+"-10p","1.0-4+4p","3","4",function(m){return function(){G.CAMERA=m.$jscomp$loop$prop$e$97$160+1;a.replay()}}(d),!1);b.sprite(q,64,8,8,k,"1.0-4",8,8)}b.print("<","2","2");b.button("","2","2+4p","7","8",function(){a.results(a.replay)},
!1)};this.next=function(){b.clear();Za=!0;Ya=jb=Ha=!1;a.PATH=!1;custom_seed="";M.name="";a.BATTLE=[];$a=!1;window.history.pushState("","","/");ua.clear();G.reset();G.disconnect();for(var d=0;d<ia.length;d++)ia[d].disconnect();ia=[];M.SNOW&&ca.remove(M.snow.mesh);M.reset();Aa=ra=!1;ea.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",
2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(d){d=void 0===d?"reset":d;ia.index=0;b.clear();a.nav(a.play);Aa=!0;ra=!1;G.reset();for(var k=0;k<ia.length;k++)ia[k].reset();firebase.analytics().logEvent("stage_restart",{status:d})};this.hide=function(d){};this.update=function(){ra||!Aa||Na||(b["delete"](16,16,f-64,16),b["delete"](16,g-32,64,16),b.text(b["float"](G.AT()),16,16),b.text(G.SPEED.toString(),16,g-32))};this.loading=function(){e=
0!=h%16?e:3<=e.length?"":e+".";ra||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+e,16,16),b.style=0);h++};this.target=function(){b.clear();a.STATE=function(){a.target()};a.nav(a.target);var d=M.name;if(Za||(b.style=2,b.print("stage generated.","2","2"),b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){M.SNOW&&ca.add(M.snow.mesh);for(var m=0;m<a.BATTLE.length;m++)ea["import"](M.name+"/"+a.BATTLE[m].uid,function(B){ia.push(new gb(B.tape,B.model,B.paint,B.cp))});a.STATE=
function(){};M.generate.END=!1;b.clear();a.play();Aa=!0;G.connect(M.start,M.surface,!1);firebase.analytics().logEvent("stage_start")}),b.style=4,db||!Qa||ea.SCAN||(b.style=1,b.button("spectate!","1.0-14","1.0-18","12","3",function(){qb=!0;M.SNOW&&ca.add(M.snow.mesh);for(var m=b.style=0;m<a.BATTLE.length;m++)ea["import"](M.name+"/"+a.BATTLE[m].uid,function(B){ia.push(new gb(B.tape,B.model,B.paint,B.cp));uas.AUTOPILOT=!0;a.uas()});M.generate.END=!1;b.clear();Aa=!1;ea.PLAY=!0;uas.connect();a.uas();ca.add(M.generate.stars);
firebase.analytics().logEvent("uas_start")},!1))),b.style=5,b.print(d,"2","5-1p",2),(b.style=0)===a.TIMELIST.length&&ea.SCAN)b.style=5,b.print("scanning...","2","9");else if(0!==a.TIMELIST.length){b.style=2;b.print("best time:","2","9");b.style=0;b.print(b["float"](a.TIMELIST[0].time),"2","12",2);b.style=5;var k=(d=a.TIMELIST.length<fb)?a.TIMELIST.length:fb;d=d?0:a.TIMELIST.length-fb;for(var q=0;q<k;q++)b.print(q+1+". "+a.TIMELIST[q].name,"2","16+"+2*q),b.print(b["float"](a.TIMELIST[q].time),"18",
"16+"+2*q);0<d&&b.print("+ "+d+" more entries","2",2*k+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.uasComputer=function(){b.clear();b.style=0;var d;b.print("autopilot "+(uas.AUTOPILOT?"enabled":"disabled"),"2","2");uas.AUTOPILOT?(d=da.TIMELIST[uas.data().target].name,b.print("targeting: "+d,"2","4")):(d=0<ia.length?da.TIMELIST[uas.data().target].name:"disabled",b.print("targeting: "+d,"2","4"),b.style=2,d=uas.CTRL||Q.SHIFT?"roll":"yaw",b.print("ctrl: "+d,"2","1.0-4"),
b.button("","0","1.0-4+4p","14","4",function(){a.uas(!0);uas.tutorial=!0},!1),b.style=0)};this.uas=function(d){var k=this;d=void 0===d?!1:d;if(b.clear(),b.style=0,a.STATE=function(){a.uas()},a.nav(function(){k.uas()}),d)b.backdrop(),b.sprite(16,64,8,8,"1.0-4+2p","2",8,8),b.button("","2","2","1.0","4",function(){b.backdrop(!1);a.uas(!1);uas.tutorial=!1},!1),b.style=0,b.print("spectator controls","2","2"),b.style=2,b.print("esc              autopilot toggle","2","6"),b.style=0,b.print("autopilot controls",
"2","10"),b.style=2,b.print("arrow            pitch/yaw","2","14"),b.print("shift + arrow    change target","2","16"),b.print("+ -              adjust distance","2","18"),b.style=0,b.print("manual controls","2","22"),b.style=2,b.print("arrow            pitch/yaw/roll","2","26"),b.print("shift + arrow    roll/yaw modifier","2","28"),b.print("space            power +","2","30"),b.print("shift + space    power -","2","32"),b.print("ctrl:            roll/yaw toggle","2","34"),b.print("r                reset",
"2","36"),b.print("t                targeting mode toggle","2","38"),b.print("shift + arrow    change target (targeting mode)","2","40"),b.style=0;else if(qb){d="";for(var q=0;q<M.name.length;q++)c=" "===M.name.charAt(q)?"-":M.name.charAt(q),d+=c;b.style=0;b.print("specialstage.io/#/"+d,"2","2");b.style=2;d=new window.Date;b.print(d.getDate().toString()+" "+(d.getMonth()+1).toString()+" "+d.getFullYear().toString(),"1.0-10","1.0-4");(b.style=0)<ia.length?(b.print(a.TIMELIST[uas.data().target].name,
"2","1.0-6"),b.style=2,b.print("stage rank "+(uas.data().target+1).toString(),"2","1.0-4"),b.style=0):(uas.TARGET,b.style=2,b.print("no data".toString(),"2","1.0-4"))}else b.style=2,d=uas.CTRL||Q.SHIFT?"roll":"yaw",b.print("ctrl: "+d,"2","1.0-4"),b.button("","0","1.0-4+4p","14","4",function(){a.uas(!0);uas.tutorial=!0},!1),b.style=0};this.timelist=function(){b.style=0};this.save=function(){var d=ka+"#"+G.MODEL+"#"+G.PAINT+"#"+G.param().power+G.param().drag+ +G.param().sensitivity+"#"+Date.now();d!==
t&&(t=d,a.cSave("SAVE",t))};this.vehicle=function(d){a.STATE=function(){a.vehicle(d)};ra=!0;b.clear();a.title(function(){d();a.save()},function(){a.menu();sv()});var k=[],q=G.param();k.push({id:"power",value:q.power,funct:function(Y){G.tune.power(Y)}});k.push({id:"drag",value:q.drag,funct:function(Y){G.tune.drag(Y)}});k.push({id:"sensitivity",value:q.sensitivity,funct:function(Y){G.tune.sensitivity(Y)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(G.models()[G.MODEL].name,
"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){G.MODEL+=1;1<G.MODEL&&(G.MODEL=0);G.body();a.vehicle(d)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--G.MODEL;0>G.MODEL&&(G.MODEL=1);G.body();a.vehicle(d)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(zb[G.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){G.PAINT+=1;G.PAINT>La.length-1&&
(G.PAINT=0);G.paint();a.vehicle(d)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--G.PAINT;0>G.PAINT&&(G.PAINT=La.length-1);G.paint();a.vehicle(d)},!1);for(q={$jscomp$loop$prop$t$106$162:0};q.$jscomp$loop$prop$t$106$162<k.length;q={$jscomp$loop$prop$t$106$162:q.$jscomp$loop$prop$t$106$162},q.$jscomp$loop$prop$t$106$162++){var m="8+5+5+"+(5*q.$jscomp$loop$prop$t$106$162).toString();b.print(k[q.$jscomp$loop$prop$t$106$162].id,"2",m);b.sprite(0,0,1,1,"2",m+"+3","1.0-2-2",1);for(var B={$jscomp$loop$prop$e$107$164:0};6>
B.$jscomp$loop$prop$e$107$164;B={$jscomp$loop$prop$e$107$164:B.$jscomp$loop$prop$e$107$164},B.$jscomp$loop$prop$e$107$164++){var H="1.0-18+"+(3*B.$jscomp$loop$prop$e$107$164).toString(),K=B.$jscomp$loop$prop$e$107$164<=k[q.$jscomp$loop$prop$t$106$162].value?48:40;b.button("",H+"-10p",m+"+4p","3","4",function(Y,X){return function(){k[Y.$jscomp$loop$prop$t$106$162].funct(X.$jscomp$loop$prop$e$107$164);a.vehicle(d)}}(q,B),!1);b.sprite(K,64,8,8,H,m,8,8)}}};this.settings=function(d){a.STATE=function(){a.settings(d)};
a.SETTINGS=!0;x=Ba+"#"+Ca+"#"+(Oa?1:0)+"#"+(Qa?1:0)+"#";a.cSave("SETTINGS",x);b.clear();w||b.backdrop();a.title(d,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(d)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);db?(k=Oa?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(k,"1.0-2-"+k.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("","2","13+4p","1.0-4",
"5",function(){Oa=!Oa;a.settings(d)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+za,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",function(){2>za&&(za+=.5);b.style=0;a.settings(d);Ja()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<za&&(za-=.5);b.style=0;a.settings(d);Ja()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);b.print("camera mode",
"2","23");var k=G.FPV?"fpv":"tpv";b.print(k,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){G.FPV=!G.FPV;a.settings(d)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(d,k){a.STATE=function(){a.ghostConfig(d)};var q=Qa?1:0;x=Ba+"#"+Ca+"#"+(Oa?1:0)+"#"+q;a.cSave("SETTINGS",x);b.clear();w||b.backdrop();a.title(d,function(){a.settings(d)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name","2","8");
b.print(ka,"1.0-13-"+ka.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(d)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");q=Ba.toString();b.print(q,"1.0-13-"+q.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Ba&&(Ba+=1);a.ghostConfig(d)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Ba&&--Ba;a.ghostConfig(d)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority",
"2","18");q=0===Ca?"best":"random";b.print(q,"1.0-13-"+q.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Ca+=1;1<Ca&&(Ca=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Ca;0>Ca&&(Ca=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2","23");q=ab?"enabled":"disabled";b.print(q,"1.0-2-"+q.length,"23");b.button("","2","23+4p","1.0-4","4",function(){ab=!ab;for(var m=0;m<ia.length;m++)ia[m].toggleEmitter(ab);a.ghostConfig(d)},!1);b.sprite(0,
0,1,1,"2","26","1.0-4",1)};this.controls=function(d){b.clear();a.title(d,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(d){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");
b.style=0;b.print("> "+ka,"2","9");b.style=2;b.print("[edit]",ka.length+"+9","9");b.button("","2","9+4p",ka.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(M.name,"2","15");b.style=2;b.print("time","2","19");d=b["float"](G.CP()[3]+G.PENALTY());b.style=5;b.print(d,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();
a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(d,k,q){k=void 0===k?!1:k;q=void 0===q?"enter display name:":q;a.STATE=function(){a.inputName(d,k,q)};b.clear();ra=!0;k?a.nav(function(){d()},a.menu):a.title(d);b.print(q,"2","2");b.textinput(ka,"2","4","1.0-2","6","operator_id");var m=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ka=Ab(m.value.toLowerCase());
!1===qa&&1<ka.length&&null!==ka?firebase.auth().signInAnonymously().then(function(){qa=firebase.auth().currentUser.uid;a.submitName(qa,d,k);a.STATE=function(){}})["catch"](function(B){B.code;B.message}):!1!==qa&&1<ka.length&&null!==ka?a.submitName(qa,d,k):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(d,k,q){q=void 0===q?!1:q;1<ka.length&&10>ka.length?firebase.database().ref("uid/"+d).set({name:ka},function(m){m?(b.clear(),m="PERMISSION_DENIED"===
m.code?"invalid name":"network error",b.print(m,"2","2"),window.setTimeout(function(){a.inputName(k,q)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(k,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(k,q)},1E3))};this.encodeURL=function(){for(var d="",k=M.name,q=0;q<k.length;q++){var m=k.charAt(q);m=" "===m?"-":m;d+=m}d=d+"/"+qa;window.history.pushState("","","/");k=window.location.href;var B="./#/"+d;navigator.clipboard.writeText("https://specialstage.io/#/"+
d).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",B)},function(){window.history.pushState("","",B);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:k+"#/"+d})};this.decodeURL=function(){for(var d=window.location.href,k="",q=[],m=!1,B=0,H=0;H<d.length;H++){var K=d.charAt(H);m?"/"===K?(Ha=!0,B++):(1===B&&(K="-"===K?" ":K,k+=K),1<B&&(q+=K)):"#"===K&&(m=!0,Ya=!0,B=0)}Ha&&0<q.length?(a.custom_seed=k,M.name=k,
a.CHALLENGES={seed:k,uid:q}):Ya&&(a.custom_seed=k,M.name=k,Ha=!1);Ha&&firebase.analytics().logEvent("challenge_accepted",{url:d})};this.cSave=function(d,k){var q=new Date;q.setTime(q.getTime()+2808E7);q="expires="+q.toUTCString();document.cookie=d+"="+k+";"+q+";path=/"};this.cLoad=function(d){d+="=";for(var k=document.cookie.split(";"),q=0;q<k.length;q++){for(var m=k[q];" "==m.charAt(0);)m=m.substring(1);if(0==m.indexOf(d))return m.substring(d.length,m.length)}return""};this.checksave=function(){var d=
a.cLoad("SAVE");if(0!==d.length&&null!=d){for(var k=0,q="",m="",B="",H="",K=0,Y=0;Y<d.length;Y++){var X=d.charAt(Y);if("#"!==X)switch(K){case 1:k=parseInt(X);break;case 2:q+=X;break;case 3:m+=d.charAt(Y),B+=d.charAt(Y+1),H+=d.charAt(Y+2),Y+=2}else K++}G.MODEL=parseInt(k);G.PAINT=parseInt(q);G.paint();G.tune.power(parseInt(m));G.tune.drag(parseInt(B));G.tune.sensitivity(parseInt(H))}else G.PAINT=0,G.paint();if(d=a.cLoad("SETTINGS"),0!==d.length&&null!=d){k=0;B=m=q="";for(H=0;H<d.length;H++)if(K=d.charAt(H),
"#"!==K)switch(k){case 0:q+=K;break;case 1:Ca=parseInt(K);break;case 2:m=parseInt(K);break;case 3:B=parseInt(K)}else k++;Ba=parseInt(q);Oa=0!==m;1===B&&(Qa=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();b.print("0.0.5.3","2","2");b.sprite(0,88,47,8,"2","6-4p",188,32,4);b.sprite(49,88,40,8,"2","12-4p",160,32,4);b.sprite(1,0,255,16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};this.fpv=
function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};
this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("https://specialstage.io","2","0.25",1);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.ginko.ltd","4","0.25 + 10");b.print("> discord.specialstage.io",
"4","0.25 + 12");window.setTimeout(a.music,2E3)};this.music=function(d){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty",
"2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(d){if("n"===d.key)switch(z){case 0:b.clear();window.setTimeout(a.promo,1E3);z++;break;case 1:window.setTimeout(a.biome,
1E3);z++;G.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);z++;G.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);z++;G.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);z++;G.CAMERA=1;break;case 5:b.clear(),z=0}}}function Bb(){var a=this;this.tutorial=!0;this.CTRL=!1;this.AUTOPILOT=this.IS_FOLLOWING=this.IS_TRACKING=!0;this.RANDOMIZE=this.TARGET=this.TRACK=!1;this.RANDOM_TIMER=0;var f=function(){},g=!1,e=new THREE.Vector3,h=0,z=new THREE.Vector3(0,0,1);this.cameras=[];this.cameras[0]=
{distance:40,yaw:1.8,pitch:.698,position:new THREE.Vector3(0,1,0),lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:1,yaw:0,pitch:Math.PI/5,position:new THREE.Vector3(20,1,20),lerp:.1,lookAt:new THREE.Vector3};this.cameras[2]={distance:1,yaw:0,pitch:Math.PI/5,position:new THREE.Vector3(0,-20,10),lerp:.1,lookAt:new THREE.Vector3};this.cameras[4]={distance:1,yaw:0,pitch:Math.PI/5,position:new THREE.Vector3(0,-20,10),lerp:.1,lookAt:new THREE.Vector3};this.lookAt=new THREE.Vector3(0,0,0);this.altitude=
this.rotation=0;this.start=new THREE.Vector3;this.loc=new THREE.Vector3(0,0,0);this.vel=new THREE.Vector3(0,0,0);this.acc=new THREE.Vector3(0,0,0);this.last=new THREE.Vector3(this.loc.x,this.loc.y,this.loc.z);this.lift=0;this.power=.003;this.force=.02;this.vel_grip=.9;this.ang_grip=.96;this.yaw_vel=this.roll_vel=this.pitch_vel=0;this.pitch_grip=.95;this.roll_grip=.96;this.yaw_grip=.98;this.pitch=new THREE.Vector3(1,0,0);this.roll=new THREE.Vector3(0,1,0);this.yaw=new THREE.Vector3(0,0,1);this.pitch_acc=
9E-4;this.roll_acc=.0015;this.yaw_acc=9E-4;this.raycaster=new THREE.Raycaster;var t=new THREE.Vector3;this.reset=function(){this.AUTOPILOT||(this.lookAt.set(0,0,0),this.loc.copy(a.start),this.vel.set(0,0,0),this.acc.set(0,0,0),this.last.set(this.loc.x,this.loc.y,this.loc.z),this.pitch=new THREE.Vector3(1,0,0),this.roll=new THREE.Vector3(0,1,0),this.yaw=new THREE.Vector3(0,0,1),this.pitch_vel=0,this.roll_vel=0,this.yaw_vel=0,this.force=.02,O.up.set(this.yaw))};this.connect=function(){h=0;a.start.copy(M.start);
a.start.z+=10;a.start.y-=20;a.loc.copy(a.start);Da=!0;O.up.set(0,0,1);Aa=!1;ea.PLAY=!0;la.reset()};this.randomize=function(x){x=void 0===x?[]:x;h=Math.floor(Math.random()*x.length);da.uas()};this.disconnect=function(){a.reset();h=0;Da=!1};this.update=function(){0===ia.length&&(a.AUTOPILOT=!1);Q.ESC&&(a.AUTOPILOT=!a.AUTOPILOT,a.AUTOPILOT?(this.setOrbitPosition(ia,!0),t.copy(O.up),O.up.set(0,0,1)):O.up.copy(t),Q.ESC=!1);this.AUTOPILOT?(this.track(ia),this.target(ia)):this.flight(ia);Q.HIDE&&(g=!g,g?
(f=function(){da.STATE()},da.hide(da.STATE)):f())};this.passenger=function(x){x=void 0===x?[]:x;O.lookAt[0];O.position.lerp(x[0].position);O.position.add(a.cameras[c].position)};this.target=function(x){x=void 0===x?[]:x;0<x.length&&O.lookAt(x[h].position)};this.track=function(x){x=void 0===x?[]:x;0<x.length&&(Q.LEFT&&Q.SHIFT&&(h=0<h?h-1:x.length-1,da.uas(),Q.LEFT=!1),Q.RIGHT&&Q.SHIFT&&(h=h<x.length-1?h+1:0,da.uas(),Q.RIGHT=!1),a.setOrbitPosition(x,!1))};this.setOrbitPosition=function(x,w){w=void 0===
w?!1:w;var d=Q.UP?.1:Q.DOWN?-.1:0,k=Q.ZOOM_IN?-1:Q.ZOOM_OUT?1:0;a.cameras[0].yaw+=Q.RIGHT?.1:Q.LEFT?-.1:0;a.cameras[0].pitch+=d;a.cameras[0].distance+=k;d=a.cameras[0].position.clone();d.multiplyScalar(a.cameras[0].distance);d.multiplyScalar(1/za);d.applyAxisAngle(O.up,a.cameras[0].yaw);k=new THREE.Vector3(1,0,0);k.applyAxisAngle(O.up,a.cameras[0].yaw);d.applyAxisAngle(k,a.cameras[0].pitch);e.copy(d);e.add(x[h].position);w?O.position.copy(e):O.position.lerp(e,.1);O.position.add(x[h].velocity)};this.flight=
function(x){x=void 0===x?[]:x;Q.RESET&&a.reset();Q.CTRL&&!this.TARGET&&(a.CTRL=!a.CTRL,Q.CTRL=!1,da.uas(!1));Q.SPACE&&da.uas(!1);var w=Q.UP,d=Q.DOWN,k=Q.LEFT,q=Q.RIGHT,m=Q.SPACE,B=!a.TARGET&&Q.SHIFT;this.last.set(this.loc.x,this.loc.y,this.loc.z);var H=a.CTRL?a.roll_vel:a.yaw_vel,K=a.CTRL?a.yaw_vel:a.roll_vel,Y=a.CTRL?-a.roll_acc:a.yaw_acc,X=a.CTRL?-a.yaw_acc:a.roll_acc;w&&!B?this.pitch_vel-=this.pitch_acc:w&&(this.pitch_vel-=1.5*this.pitch_acc);d&&!B?this.pitch_vel+=this.pitch_acc:d&&(this.pitch_vel+=
1.5*this.pitch_acc);k&&!B?H+=Y:k&&(K-=X);q&&!B?H-=Y:q&&(K+=X);m&&!Q.SHIFT?this.force+=.005:m&&Q.SHIFT&&(this.force-=.005,0>this.force&&(this.force=0));a.yaw_vel=a.CTRL?K:H;a.roll_vel=a.CTRL?H:K;this.pitch_vel*=this.pitch_grip;this.roll_vel*=this.roll_grip;this.yaw_vel*=this.yaw_grip;this.pitch.applyAxisAngle(this.roll,this.roll_vel);this.pitch.applyAxisAngle(this.yaw,this.yaw_vel);this.roll.applyAxisAngle(this.pitch,this.pitch_vel);this.roll.applyAxisAngle(this.yaw,this.yaw_vel);this.yaw.applyAxisAngle(this.pitch,
this.pitch_vel);this.yaw.applyAxisAngle(this.roll,this.roll_vel);this.vel.set(this.roll.x*this.force,this.roll.y*this.force,this.roll.z*this.force);this.vel.z+=this.lift;.001>Math.abs(this.lift.z)&&(this.lift.z=0);this.loc.add(this.vel);O.position.set(this.loc.x,this.loc.y,this.loc.z);O.up.set(this.yaw.x,this.yaw.y,this.yaw.z);Q.TARGET&&0<x.length&&(this.TARGET=!this.TARGET,Q.TARGET=!1,this.TARGET?(t.copy(O.up),O.up.set(0,0,1)):O.up.copy(t));this.TARGET?(this.lookAt.lerp(x[h].position,.1),O.up.set(0,
0,1),Q.SHIFT&&this.TARGET&&(0!=(m=Q.LEFT?-1:Q.RIGHT?1:0)&&(Q.LEFT=!1,Q.RIGHT=!1),h+=m,h=h>x.length-1?0:0>h?x.length-1:h,da.uas())):(x=this.roll.clone(),z.lerp(x,.1),this.lookAt.copy(x),this.lookAt.add(this.loc));O.lookAt(this.lookAt);1200<O.position.clone().length()&&(a.reset(),da.next())};this.data=function(){return{target:h}}}function Cb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var f=this.renderer.getContext("2d");
this.context=f;var g=document.createElement("img");g.src="./img/stage.font.0.0.5.png";g.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var e=document.createElement("canvas"),h=e.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var z=128,t=180,x=128,w=80,d;var k=128;var q=t;var m=128;var B=80;var H=!(d={x:128,y:t+60,w:128,h:40}),K=[],Y=[],X=[];this.connect=function(){f.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};
this.format=function(r,C){r=void 0===r?0:r;C=void 0===C?"#ffffff":C;void 0===e[r]&&(e[r]=document.createElement("canvas"),h[r]=e[r].getContext("2d"));h[r].drawImage(g,0,0,128,128,0,0,128,128);h[r].globalCompositeOperation="source-atop";h[r].fillStyle=C;h[r].fillRect(0,0,128,128);h[r].globalCompositeOperation="source-out"};this.resize=function(r,C,A,E){E=void 0===E?1:E;a.scale=A*E;var P=window.devicePixelRatio,ha=300>Math.ceil(P)/P*r?Math.floor(P):Math.ceil(P);0!=ha-P&&(A=ha/P*E);1>=P&&1<a.scale&&
(A=a.scale);this.width=r/A;this.height=C/A;this.renderer.width=this.width;this.renderer.height=this.height;ua.setSize(this.width,this.height);a.scale=A;this.renderer.style.transform="scale("+A+","+A+")";ua.domElement.style.transform="scale("+A+","+A+")";this.renderer.style.transformOrigin="top left";ua.domElement.style.transformOrigin="top left";f.imageSmoothingEnabled=!1;this.redraw();z=128;t=180;x=128;w=80;k=128;q=t;m=128;B=80;d={x:128,y:t+60,w:128,h:40};this.automate(this.width,this.height)};this.update=
function(r){var C=0,A;for(A in r)for(var E in X)if(r[A].x>X[E].x*a.scale&&r[A].y>X[E].y*a.scale&&r[A].x<X[E].w*a.scale&&r[A].y<X[E].h*a.scale&&(C++,1==r[A].start)){X[E].funct();r[A].start=!1;break}};this.print=function(r,C,A,E){E=void 0===E?1:E;for(var P=0,ha=a.compile(C,a.width,a.col),V=a.compile(A,a.height,a.row),S=a.style;P<r.length;)a.encode(r.charAt(P),ha+P*a.col*E,V,E),P++;H||K.push(function(){a.style=S;a.print(r,C,A,E)})};this.text=function(r,C,A,E,P){E=void 0===E?1:E;for(P=0;P<r.length;)a.encode(r.charAt(P),
C+P*a.col*E,A,E),P++};this.button=function(r,C,A,E,P,ha,V,S){V=void 0===V?!0:V;S=void 0===S?1:S;var W=a.compile(C,a.width,a.col),fa=a.compile(A,a.height,a.row),ma=a.compile(E,a.width,a.col),oa=a.compile(P,a.height,a.row),pa=a.style;V&&(f.drawImage(e[a.style],0,0,1,1,W,fa+oa/2,ma+1,1),f.drawImage(e[a.style],0,0,1,1,W,fa-oa/2,ma+1,1),f.drawImage(e[a.style],0,0,1,1,W,fa-oa/2,1,oa),f.drawImage(e[a.style],0,0,1,1,W+ma-1,fa-oa/2,1,oa+1));for(var ja=0;ja<r.length;)a.encode(r.charAt(ja),W+ja*a.col+ma/2-Math.round(r.length*
a.col)/2+2,fa-a.row/2,S),ja++;X.push({x:W,y:fa-oa/2,w:W+ma,h:fa+oa/2,funct:function(){ha()}});H||K.push(function(){a.style=pa;a.button(r,C,A,E,P,ha,V,S)})};this.line=function(r,C,A,E){a.sprite(0,0,1,1,r,C,A,E)};this.sprite=function(r,C,A,E,P,ha,V,S){var W=a.compile(P,a.width,a.col),fa=a.compile(ha,a.height,a.row),ma=a.compile(V,a.width,a.col),oa=a.compile(S,a.height,a.row),pa=a.style;f.drawImage(e[a.style],r,C,A,E,W,fa,ma,oa);H||K.push(function(){a.style=pa;a.sprite(r,C,A,E,P,ha,V,S)})};this.backdrop=
function(r,C,A,E,P){r=void 0===r?"#10101099":r;!1===r?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=r)};this.getDrawList=function(){return K};this.redraw=function(){H=!0;a.clear();for(var r=0;r<K.length;r++)K[r]();r=document.body.getElementsByTagName("input");for(var C=0;C<r.length;C++)a.text(r[C].value,r[C].style.top,r[C].style.left);H=!1};this.automate=function(r,C){r=Math.floor(r/3)-2;C=Math.floor(C/4);x>r&&(x=r,z=r,m=r,k=r,d.w=r,d.x=r);t>C&&(t=C+
40,q=t,d.y=t+60)};this.pad=function(r,C,A,E,P,ha,V){var S=0;for(V();S<Q.touches.length;)Q.touches[S].x>C*a.scale&&Q.touches[S].y>A*a.scale&&Q.touches[S].x<(C+E)*a.scale&&Q.touches[S].y<(A+P)*a.scale&&ha(),S++;Oa&&(f.drawImage(e[a.style],0,0,1,1,C+1,A,E-1,1),f.drawImage(e[a.style],0,0,1,1,C+1,A+P,E-1,1),f.drawImage(e[a.style],0,0,1,1,C+1,A,1,P),f.drawImage(e[a.style],0,0,1,1,C+E-1,A,1,P));a.encode(r,C+E/2-a.col/2,A+P/2-a.row/2)};this.dpad=function(){f.drawImage(e[a.style],88,88,40,40,a.width-k+m/2-
20,a.height-q+B/2-20,40,40);a.pad("<",z-x-1,a.height-t,x,w,function(){Q.LEFT=!0},function(){Q.LEFT=!1});a.pad(">",z+1,a.height-t,x,w,function(){Q.RIGHT=!0},function(){Q.RIGHT=!1});a.pad("^",a.width-k,a.height-q,m,B,function(){Q.UP=!0},function(){Q.UP=!1});a.pad("b",a.width-d.x,a.height-d.y+d.h/2,d.w,d.h,function(){Q.DOWN=!0},function(){Q.DOWN=!1})};this.clear=function(){if(!H){for(var r=document.body.getElementsByTagName("input"),C=0;C<r.length;C++)document.body.removeChild(r[C]);if(!a.REDRAW){K=
[];for(r=0;r<Y.length;r++)document.body.removeChild(Y[r]);Y=[]}K=[]}X=[];f.clearRect(0,0,a.width,a.height)};this["delete"]=function(r,C,A,E){C=void 0===C?0:C;A=void 0===A?ua.width:A;E=void 0===E?ua.height:E;r=a.compile(void 0===r?0:r,a.width,a.col);C=a.compile(C,a.height,a.row);A=a.compile(A,a.width,a.col);E=a.compile(E,a.height,a.row);f.clearRect(r,C,A,E)};this.encode=function(r,C,A,E){E=void 0===E?1:E;var P=r.charCodeAt(0);r=8*P%128;P=8*Math.floor(P/16);f.clearRect(C,A,8,8);f.drawImage(e[a.style],
r,P,8,8,C,A,8*E,8*E)};this["float"]=function(r,C){var A=Math.floor(Math.abs(100*r));A=A.toString();var E=A.slice(0,A.length-2),P=A.slice(A.length-2,A.length);return 0==r?"0.00":(0==E.length&&(E="0"),2>P.length&&(P+="0"),C&&0<r?E="+"+E:0>r&&(E="-"+E),A=E+"."+P,A)};this.compile=function(r,C,A){var E=0;switch(C=Math.floor(C),typeof r){case "number":E=r;break;case "function":E=r();break;case "string":for(var P=!1,ha=1,V=0,S="";V<r.length;){var W=r.charAt(V);"."===W?(S+=W,P=!0):"+"===W?(S=P?Number(S)*
C:Number(S)*A,S*=ha,ha=1,E+=S,P=!1,S=""):"-"===W?(S=P?Number(S)*C:Number(S)*A,S*=ha,ha=-1,E+=S,P=!1,S=""):"p"===W?(S=Number(S),S*=ha,E+=S,S=""):V===r.length-1?(S+=W,S=P?Number(S)*C:Number(S)*A,S*=ha,E+=S,S=""):S+=W;V++}}return E};this.textinput=function(r,C,A,E,P,ha,V){var S=a.compile(C,a.width,a.col),W=a.compile(A,a.height,a.row),fa=a.compile(E,a.width,a.col),ma=a.compile(P,a.height,a.row),oa=a.style;if(H)a.text("> "+V.value,S,W+ma/2);else{(V=document.createElement("input")).type="text";V.id=ha;
V.name=ha;V.value=r;V.style.position="fixed";V.style.top=W+"px";V.style.left=S+"px";V.style.width=fa+"px";V.style.height=ma+"px";V.style.paddingLeft="12px";V.style.fontSize="14px";V.style.zIndex=9999;V.style.opacity=0;V.maxlength=10;a.text("> "+V.value,S,W+ma/2);document.body.appendChild(V);window.setTimeout(function(){V.focus();V.select()},200);V.oninput=function(){pa()};V.onfocusout=function(){pa()};V.onfocusin=function(){pa()};V.onclick=function(){pa()};var pa=function(ja){a["delete"](S,W,fa,ma);
a.text("> "+V.value,S,W+ma/2);a.text("_",V.selectionStart*a.col+2*a.col+S,W+ma/2)};K.push(function(){a.style=oa;a.textinput(V.value,C,A,E,P,ha,V)})}};this.link=function(r,C,A,E,P,ha,V,S){var W=a.compile(C,a.width,a.col)*a.scale,fa=a.compile(A,a.height,a.row)*a.scale,ma=a.compile(E,a.width,a.col)*a.scale,oa=a.compile(P,a.height,a.row)*a.scale,pa=a.style;H||K.push(function(){return new function(){a.style=pa;ja.style.left=W+"px";ja.style.top=fa+"px";ja.style.width=ma+"px";ja.style.height=oa+"px";a.print(r,
W,fa)}});var ja=document.createElement("a");ja.href=ha;ja.style.left=W+"px";ja.style.top=fa+"px";ja.style.width=ma+"px";ja.style.height=oa+"px";ja.style.display="block";ja.style.zIndex=400;ja.style.position="fixed";ja.target="_blank";ja.id=ha;document.body.appendChild(ja);Y.push(ja);H=!0;a.print(r,W,fa);H=!1}}function Db(){var a=this;this.TEXTTIME=this.SPEED="";this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return r};this.CAMERA=1;this.FPV=
!1;var f=[],g=0,e=1/60*1E3,h=1,z=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),t=new THREE.Vector3,x=new THREE.Vector3,w=new THREE.Vector3,d=0,k=!1,q=!1,m=!0,B=!1,H=1,K=0,Y=[],X=0,r=0,C=0,A=0,E=!1,P=!1,ha=!1,V=0,S=0,W=0;this.DT=function(){return 1};var fa={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},ma=0,oa=0,pa=0;ma=.004;oa=.985-.98;pa=.015;var ja,Ra,Sa,n=6,l,p=0,D=0,y=0,u=new THREE.Vector3(0,1,0),T=new THREE.Vector3(0,0,0),F=new THREE.Vector3,
J=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var I=new THREE.Vector3(0,0,1),U=new THREE.Vector3(0,0,1),aa=new THREE.Vector3(0,0,1),Z=new THREE.Vector3(0,0,1),ya=new THREE.Vector3(0,0,-.008),sa=new THREE.Vector3,Ka=new THREE.Vector3,hb=new THREE.Vector3,Ia=new THREE.Vector3,Fa=[],Ma=new THREE.Vector3(0,0,1),Ua=new THREE.Raycaster(Ia,Ma,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};
this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var Wa=[{name:"logistics crate",geometry:function(){return Va.logistics_crate()}},{name:"ag-86",geometry:function(){return Va.ag_86()}}];this.models=function(){return Wa};this.PAINT=0;var bb=new THREE.MeshBasicMaterial({color:La[a.PAINT]}),na=(new THREE.LineSegments(Wa[a.MODEL].geometry(),
bb)).clone();na.name="Vehicle";var Xa=new Va.emitter;this.init=function(){};this.connect=function(N,wa){na.copy(new THREE.LineSegments(Wa[a.MODEL].geometry(),bb));na.name="Vehicle";na.geometry.computeBoundingSphere();hb.copy(N);sa.copy(hb);na.position.copy(hb);Ka.copy(sa);ca.add(na);Xa.connect(La[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();ca.fog=new THREE.FogExp2(ba[0],.005);O.fov=90;O.updateProjectionMatrix();ca.add(M.generate.stars);B=!1;window.setTimeout(function(){B=
!0},1E3);f=[];g=0;A=Ea;f[0]={position:sa.clone(),normal:new THREE.Vector3(0,0,1),direction:new THREE.Vector3(0,1,0),camera:new THREE.Vector3,rotation:0,velocity:new THREE.Vector3,time:Ea};la.reset()};this.disconnect=function(){a.reset();ca.remove(na);Xa.disconnect();ca.fog=new THREE.FogExp2(ba[0],0);ca.remove(M.generate.stars)};this.ready=function(){k&&(la.reset(),A=window.performance.now(),K=0,a.START=!0)};this.reset=function(){if(a.END&&Y[3]+r<M.best[3])for(var N in M.best)M.best[N]=3===N?K+r:Y[N];
B=Na=this.END=this.START=!1;Q.UP=!1;Q.DOWN=!1;Q.LEFT=!1;R=L=q=k=Q.RIGHT=!1;K=0;Y=[];W=C=r=V=0;sa.copy(hb);Ka.copy(sa);u.set(0,1,0);F.set(0,0,0);Z.set(0,0,1);na.copy(new THREE.LineSegments(Wa[a.MODEL].geometry(),bb));na.lookAt(Z);p=D=0;O.position.copy(sa);O.position.add(u.clone().multiplyScalar(-60));O.position.z+=40;O.up.set(0,0,1);O.lookAt(na.position);O.updateProjectionMatrix();ua.render(ca,O);ea.reset();window.setTimeout(function(){B=!0},1E3);for(N=0;N<ia.length;N++)ia[N].reset();Xa.reset();la.reset();
f=[];g=0;A=Ea;f[0]={time:Ea,position:sa.clone(),normal:Z.clone(),direction:new THREE.Vector3(0,1,0),camera:O.position.clone(),velocity:new THREE.Vector3,rotation:0}};this.update=function(){R=Na||a.END||!B?(k=!1,q=!1,L=!1):(k=Q.UP,q=Q.DOWN,L=Q.LEFT,Q.RIGHT);var N=0;if(Ea>f[g].time){var wa={};Object.assign(wa,f[g]);var Pa=wa.time;f=[];g=0;f.push({time:Pa,position:wa.position.clone(),normal:wa.normal.clone(),direction:wa.direction.clone(),velocity:wa.velocity.clone(),rotation:wa.rotation,camera:wa.camera.clone()});
for(var Ga=window.performance.now();Pa<Ga;){Pa+=e;f.push({time:Pa,position:f[g].position.clone(),normal:f[g].normal.clone(),direction:f[g].direction.clone(),velocity:f[g].velocity.clone(),camera:wa.camera.clone(),rotation:f[g].rotation});g=f.length-1;var rb=Ga=void 0;0!=(rb=L&&R?0:L?1:R?-1:0)&&Math.abs(y)<n?y+=rb:Math.abs(y)>n?(Ga=y/Math.abs(y),y=n*Ga):0<Math.abs(y)&&(Ga=y/Math.abs(y),y-=y/Math.abs(y),y/Math.abs(y)!=Ga&&(y=0));p=y/n*Sa;f[g].rotation+=p;l=f[g].velocity.length();Ga=void 0;k&&m&&(T.copy(f[g].direction),
T.multiplyScalar(ja),f[g].velocity.add(T));q&&m&&f[g].velocity.multiplyScalar(.95);m?(ha=!1,Ga=P?Ra-.01:Ra,f[g].velocity.multiplyScalar(Ga)):m||(ha?f[g].velocity.add(ya):ha=!0,f[g].velocity.multiplyScalar(.998));f[g].position.add(f[g].velocity);z.position.copy(f[g].position);Ia.copy(f[g].position);Ia.z-=50;Fa=[];Ma.set(0,0,1);Ua.far=100;Ua.set(Ia,Ma);M.surface.raycast(Ua,Fa);0<Fa.length?(Ia.copy(Fa[0].point),P=f[g].position.z<Ia.z&&5>Math.abs(f[g].position.z-Ia.z)?(X=0,m=!0,U.copy(Fa[0].face.normal),
f[g].position.copy(Ia),1!==Fa[0].face.color.r):m=!1):0===Fa.length&&(m=!1,P=!1,k||q||L||R||(X+=e),1E3<X&&!a.END&&!Na&&(Na=!0,da.dnf()));U.clone().multiplyScalar(1);aa.lerp(U,ha?.001:.25);Z.copy(aa);Z.add(f[g].position);f[g].normal=aa.clone();z.lookAt(Z);z.rotateOnAxis(I,f[g].rotation);u.copy(z.localToWorld(J.clone()));u.sub(f[g].position);u.normalize();f[g].direction.copy(u);(function(){Fa=[];Ma.copy(f[g].position);Ma.sub(f[g-1].position);Ma.normalize();Ua.far=Ma.length();Ua.set(f[g].position,Ma);
for(var xa=0,ta=!1,ib=W;5>ib;ib++)if(M.generate.checkpoints[ib].collision.raycast(Ua,Fa),0<Fa.length){xa=ib;ta=!0;break}if(E=!1,ta){var va;ta=Math.floor(100*K)/100;if(xa===W)M.generate.checkpoints[W].display.material.color=ba[4],0<W&&(Y[W-1]=ta,b["delete"](16,32,b.width-16,16),va=Number.isNaN(M.best[W-1])?"+1 cp":ta-M.best[W-1],b.style=0<va?4:0>va?1:2,va=0<va?"(-"+b["float"](va)+")":"+1 cp"===va?"+1 cp":"(+"+b["float"](Math.abs(va))+")",b.text(va,16,32),b.style=0),4===W&&(E=!0,Y[xa-1]=ta,Y[xa]=ta+
r,V=K+r<M.best[3]?100-r+Math.floor(10*(M.best[3]-(ta+r))):100-r,S+=V,a.END=!0,Q.RESET=!1,da.complete()),E=!0,W++;else{E=!0;for(va=W-1;va<xa-1;va++)0<=va&&(Y[va]="-",C++);r=25*C;4===xa?(Y[xa-1]=ta,Y[xa]=ta+r,V=K+r<M.best[3]?100-r+Math.floor(10*(M.best[3]-(K+r))):100-r,S+=V,W=0,a.END=!0,Q.RESET=!1,da.complete()):(Y[xa-1]=ta,W=xa+1,b["delete"]("2","4","30","1"),b.style=2,b.text("missed checkpoint x "+C.toString()+" ( -"+r.toString()+".00 )",16,32),b.style=0);E=!0;M.generate.checkpoints[xa].display.material.color=
ba[4]}}a.SPEED=Math.round(60*l/1E3*3600);a.START&&!a.END&&(K=(Ea-A)/1E3);a.OBJECTIVE=W;Ka.copy(sa)})();N++;a.START&&ea.record(a);z.updateMatrix();Ga=window.performance.now()}}if(h=(e-(f[g].time-Ea))/e,1<h&&(h=1),1<f.length)t.copy(f[g-1].position),t.lerp(f[g].position,h),x.copy(f[g-1].normal),x.lerp(f[g].normal,h),x.multiplyScalar(5),N=x.clone(),N.add(t),d=f[g].rotation,d-=f[g-1].rotation,d=f[g-1].rotation+d*h,w.copy(f[g-1].direction),w.lerp(f[g].direction,h),w.multiplyScalar(5),w.normalize(),na.position.copy(t),
na.lookAt(N),na.rotateOnAxis(I,d),function(){if(a.FPV)a.fpv();else{var xa=Na||a.END?1E-5:.1,ta=w.clone();ta.multiplyScalar(-a.cameras[0].distance+4*(b.scale-1));ta.add(t);ta.z+=a.cameras[0].z;O.position.lerp(ta,xa);O.lookAt(na.position)}}(),Xa.update(k,t,w,l);this.START||this.ready()};this.results=function(){return{reward:V,yen:S}};this.AT=function(){return K};this.CP=function(){return Y.slice()};this.replay=function(N){eb();N={TS:la.time};ea.frame=ea.convert(ea.tape,N,ea.frame);t.copy(N.position);
aa.copy(N.lookTarget);d=N.rotation;x.copy(aa);x.add(t);na.position.copy(t);na.lookAt(x);na.rotateOnAxis(I,d);w.copy(na.localToWorld(J.clone()));w.sub(t);w.normalize();k=N.UP;E=N.CHECK;d=N.rotation;W=N.objective;N=t.clone();if(E&&(M.generate.checkpoints[W].display.material.color=ba[4]),!Da)if(3===a.CAMERA)a.fpv();else{var wa=1,Pa=1;a.CAMERA===H&&(wa=a.cameras[1].lerp,Pa=1);H=a.CAMERA;N.x+=a.cameras[a.CAMERA].x;N.y+=a.cameras[a.CAMERA].y;N.z+=a.cameras[a.CAMERA].z;O.up.set(0,0,1);O.position.lerp(N,
wa);a.cameras[H].lookAt.lerp(t,Pa);O.lookAt(a.cameras[H].lookAt)}Xa.update(k,t,w,l)};this.record=function(){return{position:f[g].position.clone(),lookTarget:f[g].normal.clone(),UP:k,AT:K,TS:ea.tape.length*e,rotation:f[g].rotation,objective:W,check:E}};this.fpv=function(){O.position.copy(t);var N=na.localToWorld(new THREE.Vector3(0,0,5));N.sub(t);N.normalize();O.up.copy(N);N=w.clone();N.add(t);O.lookAt(N)};this.tune={power:function(N){N=void 0===N?fa.power:N;fa.power=0>N?0:5<N?5:N;ja=.016+fa.power/
5*ma},drag:function(N){N=void 0===N?fa.drag:N;fa.drag=0>N?0:5<N?5:N;Ra=.985-fa.drag/5*oa},sensitivity:function(N){N=void 0===N?fa.sensitivity:N;fa.sensitivity=0>N?0:5<N?5:N;Sa=.06+fa.sensitivity/5*pa},ease:function(N){N=void 0===N?fa.ease:N;fa.ease=0>N?0:5<N?5:N;n=6+fa.ease}};this.param=function(){return array=Object.assign(fa,[]),array.model=Wa[a.MODEL].name,array};this.paint=function(N){N=void 0===N?a.PAINT:N;a.PAINT=N;Xa.paint(La[N]);bb.color.set(La[N]);bb.needsUpdate=!0};this.body=function(){na.geometry.dispose();
na.geometry=Wa[a.MODEL].geometry().clone();na.geometry.verticesNeedUpdate=!0};this.yen=function(){return da.cSave("YEN",S),S};this.debug=function(){console.log("position:",na.position,sa);console.log("direction:",u);console.log("rotation:",D);console.log("dt:",1);console.log("TIME:",Ea);console.log("TAPES:",Math.ceil(Ea-A)/e);console.log("INTERPOLATION:",h);console.log("PHYSICS MESH:",z.rotation);console.log("TAPE VELOCITY",f[g].velocity);console.log(f);console.log(X)}}function Eb(a){var f=this;this.PLAY=
!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return f.tape[g].timer};this.DT=eb();var g=0;this.keybuffer=[[],[]];this.SCAN=!1;this.capture=function(e){return{position:(new THREE.Vector3).copy(e.position),normal:(new THREE.Vector3).copy(e.normal),lookTarget:e.lookTarget.clone(),rotation:e.rotation,timer:e.getTime(),objective:e.getObjective(),check:e.check,UP:e.UP}};this.record=function(e){f.tape[g]=e.record();g=24E4<f.tape[g].TS?0:g+1};this.play=function(e){if(this.RECORD){this.RECORD=
!1;for(var h=f.frame=0;h<ia.length;h++)ia[h].reset();la.reset()}if(f.frame>f.tape.length-10){f.frame=0;la.reset();for(h=0;h<ia.length;h++)ia[h].reset();M.generate.resetCheckpoints()}if(e.replay(),this.tape[f.frame].check)M.generate.checkpoints[0===this.tape[f.frame].objective?4:this.tape[f.frame].objective-1].display.material.color=ba[4]};this.reset=function(){M.generate.resetCheckpoints();g=0;f.frame=0;la.reset();f.PLAY=!1;f.RECORD=!0;f.tape=[]};this["export"]=function(e,h){e=void 0===e?function(){da.results()}:
e;h=void 0===h?$a:h;if((!1===h||G.CP()[4]<$a)&&""!==ka&&null!==ka&&!1!==qa&&void 0!==qa&&!f.SCAN){b.clear();b.print("uploading vhs to db","2","2");$a=G.CP()[4];qa;var z=M.name,t=G.CP()[4],x=G.CP().slice(),w=G.MODEL;h=G.PAINT;for(var d=f.save(f.tape),k=[],q=0;q<d.length;q++){var m="";m+=f.burn(d[q].TS);m+="#";m+=f.burn(Math.round(100*d[q].AT)/100);m+="#";m+=f.burn(d[q].position.x);m+="#";m+=f.burn(d[q].position.y);m+="#";m+=f.burn(d[q].position.z);m+="#";m+=f.burn(d[q].lookTarget.x);m+="#";m+=f.burn(d[q].lookTarget.y);
m+="#";m+=f.burn(d[q].lookTarget.z);m+="#";m+=f.burn(d[q].rotation);k.push(m)}h={version:"005",id:qa,seed:z,time:Math.round(100*t)/100,cp:x,data:k,model:w,paint:h};firebase.database().ref("vhs/005/"+h.seed+"/"+qa).set(h,function(B){B?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2","2"));window.setTimeout(e,1E3)})}else void 0===qa||!1===qa||null===ka||""===ka||void 0===ka?da.register():da.results()};this.burn=function(e){return Math.round(1E9*e).toString(16)};
this.read=function(e){return parseInt(e,16)/1E9};this.scan=function(e,h){f.SCAN=!0;var z=[];firebase.database().ref("vhs/005/"+e).orderByChild("time").limitToFirst(99).once("value").then(function(t){t.forEach(function(x){var w=x.child("id").val();x=x.child("time").val();z.push({uid:w,time:x})});f.SCAN=!1;h(z)})};this.checkTime=function(e,h,z){e===h&&($a=z)};this.requestName=function(e,h){firebase.database().ref("uid/"+e).once("value").then(function(z){z=z.child("name").val();return h(z),z})};this["import"]=
function(e,h){h=void 0===h?function(){}:h;firebase.database().ref("vhs/005/"+e).once("value").then(function(z){var t=z.val(),x=t.id,w=t.seed,d=t.cp.slice(),k=[],q=t.model;z=t.paint;for(var m=0;m<t.data.length;m++){for(var B=0,H=[""],K=0;K<t.data[m].length;K++)"#"===t.data[m].charAt(K)?(H[B]=f.read(H[B]),B++,H[B]=""):H[B]+=t.data[m].charAt(K);H[8]=f.read(H[8]);k[m]={TS:H[0],AT:H[1],position:new THREE.Vector3(H[2],H[3],H[4]),lookTarget:new THREE.Vector3(H[5],H[6],H[7]),rotation:H[8]}}f.save(k,1E3/60);
h({uid:x,seed:w,cp:d,model:q,paint:z,tape:k.slice()})})};this.save=function(e,h){h=void 0===h?1E3/30:h;for(var z=0,t=[],x=e[e.length-1].TS,w=0;w<x;)w+=h,w<x&&t.push({TS:w});for(x=0;x<t.length;x++)z=f.convert(e,t[x],z);return t};this.convert=function(e,h,z){for(var t=e[z].TS,x=e[z+1].TS,w=x-t;h.TS>x&&z<e.length-2;)t=e[++z].TS,x=e[z+1].TS,w=x-t;t=z;var d=z+1;x=(w-(x-h.TS))/w;return h.position=new THREE.Vector3,h.position.copy(e[t].position),h.position.lerp(e[d].position,x),h.lookTarget=new THREE.Vector3,
h.lookTarget.copy(e[t].lookTarget),h.lookTarget.lerp(e[d].lookTarget,x),h.rotation=(e[d].rotation-e[t].rotation)*x,h.rotation+=e[t].rotation,h.rotation=(e[d].rotation-e[t].rotation)*x,h.rotation+=e[t].rotation,h.AT=(e[d].AT-e[t].AT)*x,h.AT+=e[t].AT,h.UP=e[t].UP,h.check=e[t].check,h.objective=e[t].objective,z}}var gb=function(a,f,g,e){g=void 0===g?0:g;e=void 0===e?[]:e;var h=this,z=void 0===f?0:f;f=g;var t=a.slice();this.tape=t;var x=this.frame=0,w=new THREE.Vector3(0,0,1),d=new THREE.Vector3,k=new THREE.Vector3,
q=new THREE.Vector3(0,0,1),m=new THREE.Vector3,B=new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;this.direction=new THREE.Vector3;var H;this.velocity=new THREE.Vector3;new THREE.Vector3;new THREE.Vector3;var K=new THREE.Vector3,Y=[{name:"logistics crate",geometry:function(){return Va.logistics_crate()}},{name:"ag-86",geometry:function(){return Va.ag_86()}}][z].geometry(),X=new THREE.MeshBasicMaterial({color:La[f]}),r=new THREE.LineSegments(Y,X);r.name="ghost_"+ia.length;r.position.copy(t[0].position);
ca.add(r);var C=new Va.emitter;C.connect(La[g]);x=0;cp=e.slice();(cp[4]<M.best[4]||null==M.best[4])&&(M.best=cp.slice());this.reset=function(){la.reset();C.reset();x=0;h.update()};this.update=function(A){A={TS:la.time};x=ea.convert(t,A,x);d.copy(A.position);q.copy(A.lookTarget);H=A.rotation;m.copy(q);m.add(d);r.position.copy(d);r.lookAt(m);r.rotateOnAxis(w,H);k.copy(r.localToWorld(B.clone()));k.sub(d);k.normalize();h.position.copy(d);h.direction.copy(k);this.velocity.copy(d);this.velocity.sub(K);
K.copy(d);h.frame=x;ab&&C.update(!0,h.position,h.direction,h.velocity.length())};this.toggleEmitter=function(A){void 0===A||A?C.connect():C.disconnect()};this.disconnect=function(){ca.remove(r);Y.dispose();X.dispose();C.disconnect()};this.debug=function(){console.log(t)}};window.onload=function(){window.addEventListener("touchstart",ob);window.addEventListener("contextmenu",function(){event.preventDefault()});ca=new THREE.Scene;ca.background=sb;tb=new THREE.Vector3(0,0,1);O=new THREE.PerspectiveCamera;
O.up=tb;O.position.z=2E3;O.lookAt(0,0,0);O.fov=70;O.near=1E-4;O.far=3E3;O.name="Camera";ca.add(O);ua=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});ua.setClearColor(sb);ua.domElement.id="renderer";ua.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(ua.domElement);Q=new ub;Q.connect();b=new Cb;M=new wb;G=new Db;ea=new Eb;da=new yb;da.login();da.checksave();da.decodeURL();uas=new Bb;G.init();b.onload=function(){b.format(1,"#50ffae");b.format(2,
"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,"#eeeeee");O.position.set(0,25,10);O.lookAt(0,0,0);Ja();pb();da.intro()}};window.onresize=Ja;window.fullscreenchange=Ja;window.focus=Ja;var cb="prey first pass;ego mountain;aretete pass;ato mountain;chimi forest;chiwi pass;eha pass;eva tribute;funano mountain;fuwinmi forest;ghxst forest;ghxst run;ginko mountain;haro forest;hefuhi mountain;hema forest;heronefu forest;hewae forest;hollow touge;iitsuwo forest;ikufu pass;ima pass;inutsuwa pass;irohazaka;kami mountain;kamomi pass;karanu mountain;ken pass;kikeori mountain;kitsumomi pass;kodama forest;koehako mountain;kokiri forest;kotewa forest;kouyo pass;kukaru forest;kusune mountain;kuu forest;machi pass;machiuso mountain;mamushi mountain;matoreko mountain;mawa mountain;mea pass;meihi pass;meikiru mountain;meina pass;meriko pass;mewi pass;miki pass;mikuma forest;mimu forest;minaaru pass;mise pass;misuriwe forest;miuchin pass;miyoheri pass;moko mountain;momayawa forest;momo mountain;morioto pass;morua pass;mowakaya mountain;muhinawa forest;mumetsu pass;muwo pass;nake forest;nani mountain;natewa mountain;nawowako mountain;nechika forest;neiwika mountain;nekona forest;neni pass;nenuro pass;nere mountain;netata pass;niawi pass;niemeri pass;nisu forest;nkake pass;nme forest;nosuyowo forest;nowitsuyo pass;noyahesu pass;nrofuha forest;ntsuna forest;nuke mountain;nuku mountain;numo pass;nune pass;osuchi forest;oyuni pass;pine forest;procedural;raa pass;rafu forest;ran forest;raranike mountain;rarimi pass;rawatsuku mountain;reoyana pass;rerike mountain;riara pass;rihama pass;rihayoya pass;rikemoo pass;roka mountain;rononi mountain;ruchitesu pass;rutsuyo pass;ryuk mountain;senitake forest;senuteme pass;sesh mountain;shiko mountain;shinpuru mountain;shiomawa pass;shiraseto pass;shisene forest;shiwa forest;shiwoya mountain;somamishi mountain;sowe forest;tamuro mountain;taruwoo mountain;tase mountain;tefuroha mountain;tena forest;teyawochi mountain;the lotus order;titan forest;tokoheru forest;towihe mountain;towiwo mountain;tsukeoshi mountain;tsukon forest;tsuraku mountain;tsuruchihi mountain;tsurutsu pass;tsuwimasu mountain;ui pass;umawaro forest;umoai mountain;unari mountain;ureso forest;wahiheya pass;wakaru pass;wamichi forest;wanano forest;wareto mountain;wariroru pass;wawako pass;wesotewe mountain;wifuwaku forest;woihime pass;woka mountain;womaso forest;worenaku mountain;worunera forest;yaa pass;yakayu pass;yasoha mountain;yawishise pass;yokakeo pass;yona mountain;yonewi pass;yori mountain;yorihaka mountain;yosurora mountain;yowo pass;yoyatsushi pass;yume pass;yunuwime pass;yure mountain;yuuneme pass;yuyuke pass".split(";"),
ba=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],lb;for(lb in ba){var Fb=new THREE.Color(ba[lb]);ba[lb]=Fb}var La=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],zb="snow sakura melon peach bumblebee lavender ice".split(" "),$a=!1,Ya="",Ta=Math.floor(2147483647*Math.random()),nb="",ca,O,ua,M,G,Q,b,ea,da,ia=[],Ba=12,fb=9,Ca=0,ab=!0,Da,Qa=!1,qb=!1,kb=!1,qa=null,ka="",tb,Aa=!1,sb=ba[0],xb=0,Na=!1,Za=!1,ra=!1,db=!1,Ha=!1,
Oa=!0,Ea=0,jb=!1,za=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Va={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),
geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,
-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=
this;this.maxLife=100;for(var f=0,g=new THREE.Geometry;g.vertices.length<a.maxLife;){var e=new THREE.Vector3(0,0,0);e.life=0;e.maxLife=a.maxLife;e.acc=new THREE.Vector3(0,0,0);g.vertices.push(e);e=new THREE.Color(4294967040);g.colors.push(e)}g.verticesNeedUpdate=!0;var h=new THREE.Points(g,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));h.name="Emitter";var z=new THREE.Color;a.connect=function(t){t=void 0===t?16777215:t;ca.add(h);
a.paint(t)};a.paint=function(t){t=new THREE.Color(void 0===t?16777215:t);z=new THREE.Color;t.getHSL(z);for(t=0;t<h.geometry.vertices.length;t++)h.geometry.colors[t].setHSL(z.h,z.s,0),h.geometry.vertices[t].life=0};a.reset=function(){for(var t=0;t<h.geometry.colors.length;t++)h.geometry.colors[t].setHSL(z.h,z.s,0),h.geometry.vertices[t].life=0};a.disconnect=function(){ca.remove(h);h.geometry.dispose();h.material.dispose()};a.update=function(t,x,w,d){if(t)for(t=0;1>t;){h.geometry.vertices[f].copy(w);
h.geometry.vertices[f].multiplyScalar(-1-Math.random()*d);h.geometry.vertices[f].add(x);h.geometry.vertices[f].life=h.geometry.vertices[f].maxLife;Math.random();Math.random();Math.random();var k=.1*-Math.random();h.geometry.vertices[f].acc.copy(w);h.geometry.vertices[f].acc.multiplyScalar(k);f++;f%=h.geometry.vertices.length;t++}for(var q in h.geometry.vertices){var m;0<h.geometry.vertices[q].life&&(h.geometry.vertices[q].add(h.geometry.vertices[q].acc),--h.geometry.vertices[q].life,m=h.geometry.vertices[q].life/
100,h.geometry.colors[q].setHSL(z.h,z.s,z.l*m));0>=h.geometry.vertices[q].life&&(h.geometry.vertices[q].set(0,0,0),h.geometry.vertices[f].acc.x=0,h.geometry.vertices[f].acc.y=0,h.geometry.vertices[f].acc.z=0)}h.geometry.verticesNeedUpdate=!0;h.geometry.colorsNeedUpdate=!0;h.geometry.computeBoundingSphere()}}},vb=function(){function a(z){return z*z*z*(z*(6*z-15)+10)}function f(z,t,x){return t+z*(x-t)}function g(z,t,x,w){var d=15&z;z=8>d?t:x;w=4>d?x:12==d||14==d?t:w;return(0==(1&d)?z:-z)+(0==(2&d)?
w:-w)}for(var e=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,
118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=0;256>h;h++)e[256+h]=e[h];return{noise:function(z,t,x){var w=Math.floor(z),
d=Math.floor(t),k=Math.floor(x),q=255&w,m=255&d,B=255&k,H=(z-=w)-1,K=(t-=d)-1,Y=(x-=k)-1,X=a(z),r=a(t);w=a(x);d=e[q]+m;k=e[d]+B;d=e[d+1]+B;q=e[1+q]+m;m=e[q]+B;B=e[q+1]+B;return f(w,f(r,f(X,g(e[k],z,t,x),g(e[m],H,t,x)),f(X,g(e[d],z,K,x),g(e[B],H,K,x))),f(r,f(X,g(e[k+1],z,t,Y),g(e[m+1],H,t,x-1)),f(X,g(e[d+1],z,K,Y),g(e[B+1],H,K,Y))))}}},Ab=function(a,f){for(var g="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e".split(" "),
e="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),h=a.toLowerCase(),z=0;z<h.length;z++){var t=h.charCodeAt(z);if(122<t||57<t&&61>t||33>t||40==t||41==t)return"";t="";for(var x=z;x<h.length;x++){h.charAt(x);var w=h.charCodeAt(x);(48<=w&&57>=w||97<=w&&122>=w)&&(t+=w.toString(16));for(w=0;w<g.length;w++){for(var d="",k="",q=[],m=0,B=0,H=0;H<g[w].length;H+=2){var K=t.charAt(H+m)+t.charAt(H+1+m),Y=g[w].charAt(H)+g[w].charAt(H+1);if((K===d||K===k)&&0!==K.length&&(B++,0<
B))for(;K===d||K===k;)m+=2,K=t.charAt(H+m)+t.charAt(H+1+m);if(K===Y)q[H/2]=!0,d=K,k=Y;else{q[H/2]=!1;for(var X=0;X<e.length;X++){var r=e[X].charCodeAt(1).toString(16),C=e[X].charCodeAt(0).toString(16);K===r&&(C===Y?(q[H/2]=!0,d=r,k=Y):C!==d&&C!==k||(B++,0<B&&(m+=2,H-=2)))}!1===q[H/2]&&(H=g[w].length)}}for(k=d=0;k<q.length;k++)if(!0===q[k]&&d++,d===q.length)return""}}}return a},la={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){la.start=window.performance.now();la.time=
0;la.last=0;la.timestep=16.6667;la.dt=1}},eb=function(){return la.time=window.performance.now()-la.start,la.timestep=la.time-la.last,la.dt=la.timestep/(1E3/60),2<la.dt&&(la.dt=2),la.last=la.time,la.dt};la.convert=function(a){a=void 0===a?[]:a;for(var f="[\n",g=0;g<a.length;g++){f+="'";for(var e=0;e<a[g].length;e++)f+=a[g].charCodeAt(e).toString(16);f+="',\n"}return f+="]",console.log(f),f}})();