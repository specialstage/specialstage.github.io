(function(){function mb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],g=0,k=!1,h=this.up.clone(),t=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,1,0),value:0},yaw:{axis:new THREE.Vector3(0,
0,1),value:0},pov:0,target:0,targeting:!1,autopilot:!0}},u=[],r=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},z=this.AUTOPILOT=!0,c=this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var f=this.CAM=1,l=this.POV=0;this.camera=[];this.camera[0]=t();this.camera[0].distance=22;this.camera[0].position.set(0,0,10);
this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=t();this.camera[1].distance=34;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=2*Math.PI/4;this.camera[1].pitch.value=Math.PI/4;this.camera[1].lerp=.1;this.camera[2]=t();this.camera[2].distance=20;this.camera[2].position.set(0,1,0);this.camera[2].yaw.value=2*Math.PI/4*3;this.camera[2].pitch.value=.79;this.camera[2].lerp=.1;this.camera[3]=t();this.camera[3].distance=34;this.camera[3].position.set(0,1,0);this.camera[3].yaw.value=
2*Math.PI/4*2;this.camera[3].pitch.value=Math.PI/6;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=t();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].pitch.value=1.07;this.camera[4].yaw.value=2*Math.PI/4*4;this.camera[4].lerp=.075;u[0]=r();u[1]=r();u[2]=r();u[3]=r();u[4]=r();this.reset=function(e){if(void 0===e?0:e)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],ba.up.copy(h),e=0;e<this.camera.length;e++)this.camera[e].target=0;1<a.length?a[g].time=0:(g=0,a=[],
a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:9E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:.0012,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:.0012,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var e=0;e<this.camera.length;e++)this.camera[e].target=
0,this.camera[e].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var e=0;e<this.camera.length;e++)this.camera[e].target=1,this.camera[e].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(e,p,J){e=void 0===e?new THREE.Vector3:e;p=void 0===p?new THREE.Vector3:p;J=void 0===J?new THREE.Vector3:J;var L=La||x.END?1E-5:.1;this.up.set(0,0,1);p=p.clone();p.multiplyScalar(-this.camera[0].distance+4*(b.scale-1));p.add(e);
p.z+=this.camera[0].position.z;a[g].position.lerp(p,L);a[g].lookAt.copy(J);a[g].up.set(0,0,1)};this.fpv=function(e,p,J,L){e=void 0===e?new THREE.Vector3:e;p=void 0===p?new THREE.Vector3:p;void 0===J&&new THREE.Vector3;L=void 0===L?new THREE.Vector3:L;a[g].position.copy(e);p=p.clone();p.add(e);a[g].lookAt.copy(p);L=L.clone();a[g].up.copy(L)};this.orbit=function(e,p,J){e=void 0===e?new THREE.Vector3:e;void 0===p&&new THREE.Vector3;J=void 0===J?new THREE.Vector3:J;D.SPACE;D.SHIFT;p=D.UP;var L=D.DOWN,
M=D.LEFT,da=D.RIGHT,S=D.ZOOM_IN,w=D.ZOOM_OUT;e=e.clone();a[g].yaw=a[g-1].yaw;var A=this.camera[f].position.clone();this.camera[f].distance+=S&&0<this.camera[f].distance?-.5:w&&100>this.camera[f].distance?.5:0;A.multiplyScalar(this.camera[f].distance);this.camera[f].yaw.value+=M?-.05:da?.05:0;this.camera[f].pitch.value+=p?.05:L?-.05:0;this.camera[f].pitch.value=0>this.camera[f].pitch.value?0:this.camera[f].pitch.value>Math.PI/2-.1?Math.PI/2-.1:this.camera[f].pitch.value;S=this.camera[f].pitch.axis.clone();
S.applyAxisAngle(h,this.camera[f].yaw.value);A.applyAxisAngle(h,this.camera[f].yaw.value);A.applyAxisAngle(S,this.camera[f].pitch.value);e.add(A);L=k?1:M||da||p||L?.1:this.camera[f].lerp;a[g].position.lerp(e,L);a[g].lookAt.copy(J);a[g].up.set(0,0,1)};this.physics=function(e,p,J){if((void 0===e?0:e)>a[g].time){var L=p.position.clone(),M=p.direction.clone();e=p.lookAt.clone();p=p.normal.clone();J=((void 0!==J?J:L).clone(),{});Object.assign(J,a[g]);a=[];g=0;a.push(J);J={};Object.assign(J,a[g]);a.push(J);
g++;x.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(L,M,e):2===this.POV?this.fpv(L,M,e,p):this.orbit(L,M,e):this.pilot():x.FPV?this.fpv(L,M,e,p):this.pov(L,M,L);a[g].time+=Ha}};this.target=function(e){this.lookAt.copy(this.TARGETS[e].position)};this.update=function(e,p){e=void 0===e?0:e;p=void 0===p?this.TARGETS:p;this.CAM!==f?(k=!0,f=this.CAM,this.TARGET=this.camera[f].target,this.TARGETING=this.camera[f].targeting,this.AUTOPILOT=this.camera[f].autopilot,this.POV=this.camera[f].pov,z=this.AUTOPILOT,
z?(a[g].position.copy(this.camera[f].position),a[g].position.add(p[this.TARGET].position),a[g].up.copy(this.camera[f].up),k=!0):(a[g].position.copy(u[f].position),a[g].lookAt.copy(u[f].lookAt),a[g].up.copy(u[f].up),a[g].velocity.copy(u[f].velocity),a[g].pitch.axis.copy(u[f].pitch.axis),a[g].roll.axis.copy(u[f].roll.axis),a[g].yaw.axis.copy(u[f].yaw.axis),a[g].pitch.value=u[f].pitch.value,a[g].roll.value=u[f].roll.value,a[g].yaw.value=u[f].yaw.value,a[g].speed=u[f].speed),U.STATE()):(this.camera[f].target=
this.TARGET,this.camera[f].pov=this.POV,this.camera[f].targeting=this.TARGETING,this.camera[f].autopilot=this.AUTOPILOT);this.AUTOPILOT!==z&&(z=this.AUTOPILOT,this.AUTOPILOT?(a[g].position.copy(this.camera[f].position),a[g].up.copy(this.camera[f].up)):a[g].speed=0);this.POV!==l&&(U.STATE(),l=this.POV,uas.camera[uas.CAM].pov=l);this.TARGET!==c&&(c=this.TARGET,uas.camera[uas.CAM].target=c);this.physics(e,p[va?0:this.camera[f].target]);Ha;a[g].time;Ha;1<a.length&&(this.position.copy(a[g].position),this.direction.copy(a[g].direction),
this.up.copy(a[g].up),this.lookAt.copy(a[g].lookAt),ba.position.copy(this.position),ba.up.set(this.up.x,this.up.y,this.up.z),ba.lookAt(this.lookAt));k=!1};this.pilot=function(){var e=a[g],p=D.SPACE,J=D.SHIFT,L=D.UP,M=D.DOWN,da=D.LEFT,S=D.RIGHT;D.TARGET&&(this.TARGETING=!this.TARGETING,D.TARGET=!1,U.replay());e.pitch.value+=L?-e.pitch.power:M?+e.pitch.power:0;J&&!this.TARGETING?e.roll.value+=da?-e.roll.power:S?e.roll.power:0:(e.yaw.value+=da?e.yaw.power:S?-e.yaw.power:0,e.yaw.value*=e.yaw.drag);e.pitch.value*=
e.pitch.drag;e.roll.value*=e.roll.drag;e.yaw.value*=e.yaw.drag;e.pitch.axis.applyAxisAngle(e.roll.axis,e.roll.value);e.pitch.axis.applyAxisAngle(e.yaw.axis,e.yaw.value);e.roll.axis.applyAxisAngle(e.pitch.axis,e.pitch.value);e.roll.axis.applyAxisAngle(e.yaw.axis,e.yaw.value);e.yaw.axis.applyAxisAngle(e.pitch.axis,e.pitch.value);e.yaw.axis.applyAxisAngle(e.roll.axis,e.roll.value);J&&p&&-1<e.speed?e.speed-=.005:p&&1>e.speed&&(e.speed+=.005);e.velocity.copy(e.roll.axis);e.velocity.multiplyScalar(e.speed);
e.position.add(e.velocity);this.TARGETING?(da&&J&&0<this.TARGET&&(--this.TARGET,U.replay(),D.LEFT=!1),S&&J&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,U.replay(),D.RIGHT=!1),this.up.set(0,0,1),k?e.lookAt.copy(this.TARGETS[this.TARGET].position):e.lookAt.lerp(this.TARGETS[this.TARGET].position,.1)):(e.up.copy(e.yaw.axis),e.lookAt.copy(e.roll.axis),e.lookAt.add(e.position));u[f].position.copy(e.position);u[f].lookAt.copy(e.lookAt);u[f].velocity.copy(e.velocity);u[f].up.copy(e.up);u[f].pitch.axis.copy(e.pitch.axis);
u[f].roll.axis.copy(e.roll.axis);u[f].yaw.axis.copy(e.yaw.axis);u[f].pitch.value=e.pitch.value;u[f].roll.value=e.roll.value;u[f].yaw.value=e.yaw.value;u[f].speed=e.speed};this.debug=function(){console.log("Vehicle Timestamp:",x.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt)}}function nb(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=
!1;this.touches=[];var g="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",
a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(k){var h="keydown"==k.type;switch(h||(g+=k.key),3<g.length&&(g=g.slice(1,4)),k.key){case "ArrowUp":a.UP=h;break;
case "ArrowDown":a.DOWN=h;break;case "ArrowLeft":a.LEFT=h;break;case "ArrowRight":a.RIGHT=h;break;case "w":a.UP=h;break;case "s":a.DOWN=h;break;case "a":a.LEFT=h;break;case "d":a.RIGHT=h;break;case "r":a.RESET=h;break;case " ":a.SPACE=h;break;case "Shift":a.SHIFT=h;break;case "1":uas.CAM=1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "Enter":a.ENTER=h;break;case "Control":a.CTRL=h;break;case "Escape":case "Backspace":a.ESC=h;break;case "=":a.ZOOM_IN=h;break;
case "-":a.ZOOM_OUT=h;break;case "t":a.TARGET=h;break;case "h":a.HIDE=h;break;case ">":!h&&2>Ea&&(Ea+=.5);Ia();break;case "<":!h&&.5<Ea&&(Ea-=.5),Ia()}!x.REPLAY||pa||Aa||"vhs"===g&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(sa["export"],1E3,U.results,!1),g="")};this.mousedown=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!0}};this.mouseup=function(k){k.preventDefault();a.touches[0]={x:k.clientX,y:k.clientY,start:!1}};this.touchSetup=function(k){window.removeEventListener("keydown",
a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(k)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=
this.DOWN=this.UP=!1};this.touchstart=function(k){k=k.touches;a.touches=[];for(var h=0;h<k.length;h++)a.touches[h]={x:k[h].clientX,y:k[h].clientY,start:!0}};this.touchmove=function(k){a.touches=[];k=k.touches;for(var h=0;h<k.length;h++)a.touches[h]={x:k[h].clientX,y:k[h].clientY,start:!1}};this.touchend=function(k){a.touches=[];k=k.touches;for(var h=0;h<k.length;h++)a.touches[h]={x:k[h].clientX,y:k[h].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var g=[],k=0;g[0]={name:"forest",
palette:Z[9],tree:function(q,n){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};g[0].map[0]=function(q,n){var m=Z[10],C=!1;return.92<Math.abs(q)&&(m=.92<Math.abs(q)?Z[9]:Z[2],C=!0),g[0].flags[n]=C,m};g[1]={name:"sakura",palette:Z[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};g[1].map[0]=function(q,n){var m=Z[1],C=!1;return.95<Math.abs(q)&&(m=.92<Math.abs(q)?Z[12]:Z[1],C=!0),g[1].flags[n]=C,m};g[2]={name:"summit",
palette:Z[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};g[2].map[0]=function(q,n){var m=Z[7],C=!1;return.95<Math.abs(q)&&(m=.92<Math.abs(q)?Z[2]:Z[7],C=!0),g[2].flags[n]=C,m};var h=new THREE.Points(new THREE.Geometry);h.name="Generative Extruder";h.visible=!1;var t=new THREE.Line(new THREE.Geometry);t.name="Generative Nodes";t.visible=!1;t.material.color=Z[6];t.material.name="Node Material";t.position.z+=2;var u=new THREE.LineSegments(new THREE.Geometry);u.name="Generative Segments";
u.visible=!0;u.material.color=Z[3];u.material.name="Segments Material";var r=new THREE.Mesh(new THREE.Geometry);r.name="Generative Surface";r.visible=!1;r.material.color=Z[0];r.material.name="Surface Material";var z=new THREE.LineSegments(new THREE.Geometry);z.name="Generative Perimeter";z.material.color=Z[1];z.material.name="Perimeter Material";var c=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));c.name="Terrain";c.material.name="Terrain Material";
c.material.wireframe=!0;c.material.side=THREE.DoubleSide;c.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var f=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));f.name="Trees";var l=new THREE.Mesh(new THREE.Geometry,
new THREE.MeshBasicMaterial);l.name="Background";l.material.color=Z[0];l.material.name="Background Material";l.material.wireframe=!1;l.material.side=THREE.FrontSide;l.material.opacity=.75;l.material.blendMode=THREE.MultiplyBlending;l.material.transparent=!0;var e=new THREE.Points(new THREE.Geometry);e.material.color=Z[1];e.material.sizeAttenuation=!1;e.material.size=1.5;e.material.fog=!1;scope.stars=e;var p=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);p.name="Collision Mesh";p.visible=
!0;p.material.name="Collision Material";p.material.side=THREE.BackSide;this.checkpoints=[];var J=new THREE.Vector3(0,0,1),L=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var M=new THREE.Vector3(0,3,0),da=new THREE.Vector3(0,0,1),S=t.geometry.clone(),w=r.geometry.clone(),A=u.geometry.clone(),G=z.geometry.clone(),H=[],O=[],ia=new THREE.Vector3;H[0]=new THREE.Vector3(5,3,0);H[1]=new THREE.Vector3(-5,3,0);O[0]=H[0].clone();O.z+=1;O[1]=H[1].clone();O.z+=1;var T=Math.PI/64,
R=Math.PI/32,Y=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var oa=!1,ca=!1,ea=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Oa=18,Pa=new THREE.Raycaster;Pa.far=800;h.geometry.vertices[0]=M.clone();h.geometry.vertices[1]=J.clone().add(M);h.geometry.vertices[2]=H[0].clone();h.geometry.vertices[3]=H[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();this.connect=function(){scope.SEED=Qa;k=scope.randomInt(0,3);N.SNOW=2===k;N.SNOW&&N.snow.init();fa.add(h);
fa.add(t);fa.add(u);fa.add(z);fa.add(r);fa.add(wireframe);fa.add(l);la=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var q in Y=[],fa.remove(h),fa.remove(t),fa.remove(u),fa.remove(z),fa.remove(r),fa.remove(wireframe),fa.remove(l),fa.remove(f),g)g[q].flag=[];for(var n in scope.checkpoints)fa.remove(scope.checkpoints[n].display),scope.checkpoints[n].display.geometry.dispose(),scope.checkpoints[n].collision.geometry.dispose()};this.complete=function(){p.geometry.mergeVertices();
p.geometry.verticesNeedUpdate=!0;p.geometry.elementsNeedUpdate=!0;p.geometry.computeFaceNormals();p.geometry.computeVertexNormals();p.geometry.computeBoundingSphere();l.geometry.copy(p.geometry);--l.position.z;for(var q=[],n=0;n<p.geometry.faces.length;n++)q[p.geometry.faces[n].a]=p.geometry.faces[n].vertexNormals[0].clone(),q[p.geometry.faces[n].b]=p.geometry.faces[n].vertexNormals[1].clone(),q[p.geometry.faces[n].c]=p.geometry.faces[n].vertexNormals[2].clone();for(n=0;n<p.geometry.vertices.length;n++)p.geometry.vertices[n].add(q[n].multiplyScalar(2));
p.geometry.verticesNeedUpdate=!0;p.geometry.computeFaceNormals();p.geometry.computeVertexNormals();p.geometry.computeBoundingSphere();wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();q=new THREE.IcosahedronGeometry(1200,10);for(var m in q.vertices).3>scope.random()&&-400<q.vertices[m].z&&e.geometry.vertices.push(q.vertices[m].clone());q.dispose();e.geometry.computeBoundingSphere();
N.surface=p.clone();N.start=scope.start.clone();la=window.performance.now()-la;oa=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(la/1E3)});Za?(b.clear(),x.connect(N.start,N.surface),x.PLAY=!1,sa.PLAY=!0):U.ready()};this.reset=function(){Oa=(36+scope.random()-.5)/2;a=0;t.geometry.dispose();u.geometry.dispose();r.geometry.dispose();h.geometry.dispose();z.geometry.dispose();c.geometry.dispose();wireframe.geometry.dispose();p.geometry.dispose();f.geometry.dispose();
e.geometry.dispose();A.dispose();G.dispose();S.dispose();w.dispose();A.copy(new THREE.Geometry);G.copy(new THREE.Geometry);S.copy(new THREE.Geometry);w.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);u.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);r.geometry.copy(new THREE.Geometry);c.geometry.copy(new THREE.Geometry);p.geometry.copy(new THREE.Geometry);M.set(0,3,0);da.set(0,0,1);H[0]=new THREE.Vector3(4,3,0);H[1]=new THREE.Vector3(-4,
3,0);oa&&(oa=!1,ca=!1,ea=!1);this.END=!1;h.position.set(0,0,0);h.geometry.vertices[0]=M.clone();h.geometry.vertices[1]=J.clone().add(M);h.geometry.vertices[2]=H[0].clone();h.geometry.vertices[3]=H[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();h.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(q,n,m,C,B,y,Q,F,K,I){q=void 0===q?0:q;n=void 0===n?0:n;m=void 0===m?0:m;C=void 0===C?0:C;B=void 0===B?0:B;y=void 0===y?{start:0,end:30,
angle:0,slope:0}:y;Q=void 0===Q?[]:Q;F=void 0===F?[]:F;K=void 0===K?!1:K;I=void 0===I?999:I;var P=window.performance.now(),V=0;for(0===C&&(C=.5<scope.random()?1:-1);32>V&&!ca;){if(q===y.end+1){F=[];for(m=0;1>m;m++)if(q>=scope.length)F.push({angle:0,slope:0,end:30}),I=q+30;else if(0===n){var W=scope.randomInt(2,4)*C;V=Math.floor(Math.abs(36/W));C=.01>scope.random()?+C:-1*C;V=scope.randomInt(1,V);F.push({angle:W,slope:0,end:V})}else W=scope.randomInt(-5,-1),V=scope.random(),W=2!==k&&.05>V?W*=-1:W,V=
scope.randomInt(2,20),F.push({angle:0,slope:W,end:V});V=scope.randomInt(0,F.length);n=F[V].angle;m=F[V].slope;y.start=q;y.end=q+F[V].end;F=F.slice(V,1)}if(K||(scope.extrude(n,m),Y.push({angle:n,slope:m}),S.verticesNeedUpdate=!0,q++),10<=q&&!K){V=new THREE.Vector2(S.vertices[q-1].x,S.vertices[q-1].y);for(W=0;W<S.vertices.length-1-10;W++)if(18>(new THREE.Vector2(S.vertices[W].x,S.vertices[W].y)).distanceTo(V)){K=!0;break}K&&window.setTimeout(N.reset(!0),0)}0;q===I&&(ca=!0,t.geometry.dispose(),t.geometry=
S.clone(),t.geometry.computeBoundingSphere(),t.geometry.center(),t.updateMatrixWorld(),0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(S.vertices[0])),window.setTimeout(function(){U.PATH=!0;U.STATE();scope["import"]()},0));V=window.performance.now()-P}ca||K||window.setTimeout(scope.path,0,q,n,m,C,B,y,Q,F,K,I)};this.skijump=function(q,n,m,C,B,y,Q,F,K,I,P){q=void 0===q?0:q;n=void 0===n?0:n;m=void 0===m?0:m;C=void 0===C?0:C;B=void 0===B?0:B;y=void 0===y?{start:0,end:20,angle:0,
slope:0}:y;Q=void 0===Q?[]:Q;F=void 0===F?[]:F;K=void 0===K?!1:K;I=void 0===I?300:I;P=void 0===P?0:P;var V=window.performance.now(),W=0;for(0===C&&(C=.5<scope.random()?1:-1);32>W&&!ca;){if(q===y.end+1){F=[];for(n=0;1>n;n++)0===m&&20===y.end?(P=-1,F.push({angle:0,slope:-4,end:30})):3===m?F.push({angle:0,slope:4,end:3}):4===m?F.push({angle:0,slope:-32,end:10}):-4===m?(P=1,F.push({angle:0,slope:m+1,end:1})):-32===m?F.push({angle:0,slope:-4,end:40}):1==P?F.push({angle:0,slope:m+1,end:1}):-1==P&&F.push({angle:0,
slope:m-1,end:1});W=scope.randomInt(0,F.length);n=F[W].angle;m=F[W].slope;y.start=q;y.end=q+F[W].end;F=F.slice(W,1)}if(K||(scope.extrude(n,m),Y.push({angle:n,slope:m}),S.verticesNeedUpdate=!0,q++),10<=q&&!K){W=new THREE.Vector2(S.vertices[q-1].x,S.vertices[q-1].y);for(var ta=0;ta<S.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(S.vertices[ta].x,S.vertices[ta].y)).distanceTo(W)){K=!0;break}K&&window.setTimeout(N.reset(!0),0)}0;I<=q&&(ca=!0,t.geometry.dispose(),t.geometry=S.clone(),t.geometry.computeBoundingSphere(),
t.geometry.center(),t.updateMatrixWorld(),0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(S.vertices[0])),window.setTimeout(function(){scope["import"]()},0));W=window.performance.now()-V}ca||K||window.setTimeout(scope.skijump,0,q,n,m,C,B,y,Q,F,K,I)};this["import"]=function(q){q=void 0===q?0:q;for(var n=window.performance.now(),m=0;!ea&&32>m;){if(0===q&&(h.position.set(0,0,0),h.rotation.z=0,M.set(0,3,0),h.geometry.vertices[0]=M.clone(),h.geometry.vertices[1]=J.clone().add(M),
h.geometry.vertices[2]=H[0].clone(),h.geometry.vertices[3]=H[1].clone(),h.geometry.vertices[4]=O[0].clone(),h.geometry.vertices[5]=O[1].clone(),h.geometry.verticesNeedUpdate=!0,h.updateMatrixWorld()),q<Y.length)a=q,angle=Y[q].angle,slope=Y[q].slope,scope.extrude(angle,slope),u.geometry.dispose(),u.geometry=A.clone(),u.geometry.computeBoundingSphere(),z.geometry.dispose(),z.geometry=G.clone(),z.geometry.computeBoundingSphere(),r.geometry.dispose(),r.geometry=w.clone(),r.geometry.computeBoundingSphere(),
q++;else if(!ea&&q===Y.length){for(var C in scope.checkpoints=scope.checkpoint(),scope.checkpoints)fa.add(scope.checkpoints[C].display);ea=!0;window.setTimeout(function(){scope.terrain(!0)},0)}m=window.performance.now()-n}ea||window.setTimeout(scope["import"],0,q,angle,slope)};this.extrude=function(q,n){q=void 0===q?0:q;n=void 0===n?0:n;for(var m in h.updateMatrixWorld(),h.rotateZ(q*R),h.geometry.vertices)h.geometry.vertices[m].applyAxisAngle(L,n*T);h.geometry.verticesNeedUpdate=!0;m=h.geometry.vertices[0].clone();
var C=h.geometry.vertices[2].clone(),B=h.geometry.vertices[3].clone(),y=h.geometry.vertices[1].clone();if(m.applyMatrix4(h.matrix),C.applyMatrix4(h.matrix),B.applyMatrix4(h.matrix),y.applyMatrix4(h.matrix),y.sub(m),ca){if(C.add(ka),B.add(ka),0<A.vertices.length){var Q=A.vertices[A.vertices.length-1].clone().sub(ia),F=A.vertices[A.vertices.length-2].clone().sub(ia);w.vertices.push(C.clone().sub(y));w.vertices.push(B.clone().sub(y));w.vertices.push(F);w.vertices.push(B.clone().sub(y));w.vertices.push(Q);
w.vertices.push(F);var K=C.clone();q=B.clone();Q=A.vertices[A.vertices.length-1].clone();F=A.vertices[A.vertices.length-2].clone();p.geometry.vertices.push(K);p.geometry.vertices.push(q);p.geometry.vertices.push(F);p.geometry.vertices.push(q);p.geometry.vertices.push(Q);p.geometry.vertices.push(F);Q=w.vertices.length;var I=new THREE.Face3(Q-3,Q-2,Q-1);K=new THREE.Face3(Q-5,Q-4,Q-6);w.faces.push(I);w.faces.push(K);I=I.clone();K=K.clone();I.color=new THREE.Color(16777215);K.color=new THREE.Color(16777215);
p.geometry.faces.push(I);p.geometry.faces.push(K)}0<G.vertices.length?(I=2,K=1,4<G.vertices.length&&(I=4,K=2),I=G.vertices[G.vertices.length-I].clone(),K=G.vertices[G.vertices.length-K].clone(),G.vertices.push(C.clone().add(y)),G.vertices.push(I.clone()),G.vertices.push(B.clone().add(y)),G.vertices.push(K.clone()),a==Y.length-1&&(F=C.clone().add(y),Q=B.clone().add(y),G.vertices.push(F),G.vertices.push(Q))):(G.vertices.push(C.clone().add(y)),G.vertices.push(B.clone().add(y)));A.vertices.push(C.clone());
A.vertices.push(B.clone());ia.copy(y)}else S.vertices.push(m.clone());for(var P in M.copy(m).sub(h.position),h.position.add(M),h.geometry.vertices)h.geometry.vertices[P].applyAxisAngle(L,-1*n*T)};this.terrain=function(q,n,m,C,B,y,Q){n=void 0===n?[]:n;m=void 0===m?[]:m;C=void 0===C?[]:C;B=void 0===B?0:B;y=void 0===y?0:y;Q=void 0===Q?0:Q;if(void 0===q||q){u.updateMatrixWorld();c.geometry.dispose();c.geometry.copy(new THREE.Geometry);n=[];m=[];C=[];for(q=0;2>q;q++)C[q]=[],n[q]=[],m[q]=[];for(q=0;q<u.geometry.vertices.length;q++)m[q%
2].push(u.geometry.vertices[q]);for(q=0;2>q;q++)for(var F=0;F<m[q].length;F++){var K=0===q?1:-1,I=m[q][F].clone();I.sub(m[q+K][F]);I.normalize().multiplyScalar(3);C[q][F]=I.clone()}}F=0;var P;q=window.performance.now();if(4>B){if(c.geometry.verticesNeedUpdate=!0,c.geometry.elementsNeedUpdate=!0,c.geometry.computeBoundingSphere(),c.geometry.computeFaceNormals(),c.geometry.computeVertexNormals(),c.updateMatrixWorld(),0<B&&0===Q)for(m[y]=[],K=0;K<n[y].length;K++)m[y][K]=c.geometry.vertices[n[y][K]];
0===Q&&(n[y]=[]);for(v=Q;v<m[y].length&&32>F;){F=!1;if(void 0!==m[y][v]&&void 0!==m[y][v-1]){if(void 0===C[y][v])C[y][v]=C[s][v-1].clone();else if(c.geometry.computeBoundingSphere(),K=m[y][v].clone().add(C[y][v]),K.z-=100,Pa.set(K,J),K.z+=100,I=Pa.intersectObjects([c],!0),0<I.length)for(var V in I).01<I[V].point.distanceTo(K)&&(n[y][v]=void 0,F=!0);F||(c.geometry.vertices.push(m[y][v].clone()),c.geometry.vertices.push(m[y][v].clone().add(C[y][v])),n[y][v]=c.geometry.vertices.length-1,0<v&&(c.geometry.vertices.push(m[y][v-
1].clone()),P=c.geometry.vertices.length,0===y?c.geometry.faces.push(new THREE.Face3(P-2,P-1,P-3)):1===y&&c.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3))))}F=window.performance.now()-q;v++;Q=v}if(Q===m[y].length){Q=0;for(P=1;P<n[y].length;P++)if(void 0!==n[y][P]&&void 0!==n[y][P-1]){V=c.geometry.vertices[n[y][P]];var W;q=c.geometry.vertices[n[y][P-1]];2.8>V.distanceTo(q)?(V.copy(q),n[y][P]=n[y][P-1],C[y][P].copy(C[y][P-1])):1<P&&(c.geometry.vertices.push(m[y][P-1]),W=0===y?n[y][P]:n[y][P-1],q=
0===y?n[y][P-1]:n[y][P],c.geometry.faces.push(new THREE.Face3(W,q,c.geometry.vertices.length-1)))}y++}1<y&&(y=0,B++)}if(4===B){c.geometry.verticesNeedUpdate=!0;c.geometry.elementsNeedUpdate=!0;c.geometry.colorsNeedUpdate=!0;c.geometry.computeFaceNormals();c.geometry.computeVertexNormals();c.geometry.mergeVertices();c.geometry.computeBoundingSphere();scope.noise(c.geometry);for(W=0;W<c.geometry.faces.length;W++)V=c.geometry.vertices[c.geometry.faces[W].a].clone(),q=c.geometry.vertices[c.geometry.faces[W].b].clone(),
P=c.geometry.vertices[c.geometry.faces[W].c].clone(),c.geometry.colors[c.geometry.faces[W].a],c.geometry.colors[c.geometry.faces[W].b],c.geometry.colors[c.geometry.faces[W].c],p.geometry.vertices.push(V),p.geometry.vertices.push(q),p.geometry.vertices.push(P),wireframe.geometry.vertices.push(V),wireframe.geometry.vertices.push(q),wireframe.geometry.vertices.push(P),P=p.geometry.vertices.length,V=new THREE.Face3(P-1,P-2,P-3),V.color=new THREE.Color(0),p.geometry.faces.push(V),wireframe.geometry.faces.push(new THREE.Face3(P-
1,P-2,P-3));wireframe.geometry.copy(c.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,n.slice(),m.slice(),C.slice(),B,y,Q)},0)};this.biome=function(){for(var q=k,n=wireframe.geometry.faces,m=[],C=[],B=0;B<n.length;B++)for(var y=0;y<g[k].map.length;y++)n[B].vertexColors[0]=g[k].map[y](n[B].vertexNormals[0].z,n[B].a),n[B].vertexColors[1]=g[k].map[y](n[B].vertexNormals[1].z,n[B].b),n[B].vertexColors[2]=
g[k].map[y](n[B].vertexNormals[2].z,n[B].c);for(n=0;n<g[k].flags.length;n++)for(B=0;B<u.geometry.vertices.length;B++).1>wireframe.geometry.vertices[n].distanceTo(u.geometry.vertices[B])&&(g[k].flags[n]=!1);for(n=0;n<g[k].flags.length;n++)g[k].flags[n]&&m.push(n);for(n=0;n<g[k].limit&&n<m.length;){B=scope.randomInt(0,m.length);y=!0;if(0<C.length&&0<m.length)for(;y;){for(var Q in C){if(wireframe.geometry.vertices[m[B]].distanceTo(wireframe.geometry.vertices[C[Q]])<g[k].range){y=!0;m.slice(B,1);B=scope.randomInt(0,
m.length);break}y=!1}0>=m.length&&(y=!1)}if(0<m.length){y=g[q].tree();for(var F in y.vertices)f.geometry.vertices.push(y.vertices[F].clone().add(wireframe.geometry.vertices[m[B]])),f.geometry.colors[f.geometry.vertices.length-1]=y.colors[F];C.push(m[B]);m.slice(B,1)}n++}f.verticesNeedUpdate=!0;f.elementsNeedUpdate=!0;fa.add(f)};this.sakura=function(){var q=new THREE.Geometry,n=[],m=[],C=1,B,y=new THREE.Vector3(0,0,0),Q=new THREE.Vector3(0,0,3),F=12,K=0,I=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,
0,1);q.vertices.push(y);q.vertices.push(Q);q.colors.push(Z[2]);q.colors.push(Z[2]);m.push({v:Q.clone(),n:Q.clone(),pitch:I.clone(),roll:P.clone()});for(y=[];4>K;){Q=[];for(I=0;I<m.length;I++)for(var V=P=0;3>V;V++){var W=0===K&&2===V&&1>P?1:scope.random();if(.2<W){W=scope.randomInt(-2,2);var ta=m[I].n.clone(),Ba=Z[2];ta.applyAxisAngle(m[I].pitch,2*Math.PI/(F+W));ta.applyAxisAngle(m[I].roll,2*Math.PI/3*V);ta.multiplyScalar(C);W=ta.clone().add(m[I].v);q.vertices.push(m[I].v.clone());q.vertices.push(W);
q.colors.push(Ba);q.colors.push(Ba);Ba=m[I].pitch.clone();Ba.applyAxisAngle(m[I].roll,2*Math.PI/3*V);Ba.applyAxisAngle(m[I].pitch,2*Math.PI/F);var qa=m[I].roll.clone();qa.applyAxisAngle(m[I].pitch,2*Math.PI/F);qa.applyAxisAngle(m[I].roll,2*Math.PI/3*V);0<V&&n.push({a:W.clone(),b:m[I].v.clone(),pitch:Ba,roll:qa});Q.push({v:W.clone(),n:ta.clone(),pitch:Ba,roll:qa});P++}else 0===P&&2===V&&y.push({v:m[I].v.clone(),n:m[I].n.clone(),pitch:m[I].pitch.clone(),roll:m[I].roll.clone()})}m=Q.slice();C*=.9;K++}for(B in F=
6,n)C=n[B].a.clone(),Q=n[B].b.clone(),C=C.clone().sub(Q),I=C.clone().multiplyScalar(.5).add(Q),K=scope.randomInt(0,3)-1,C.applyAxisAngle(n[B].pitch,2*Math.PI/F),C.applyAxisAngle(n[B].roll,2*Math.PI/K),C.multiplyScalar(.5),Q=I,I=C.clone().add(I),q.vertices.push(Q),q.vertices.push(I),q.colors.push(Z[2]),q.colors.push(Z[2]),Q=n[B].pitch.clone(),Q.applyAxisAngle(n[B].roll,2*Math.PI/K),Q.applyAxisAngle(n[B].pitch,2*Math.PI/F),P=n[B].roll.clone(),P.applyAxisAngle(n[B].pitch,2*Math.PI/F),P.applyAxisAngle(n[B].roll,
2*Math.PI/K),m.push({v:I.clone(),n:C.clone(),pitch:Q,roll:P});m=m.concat(y);for(n=0;n<m.length;n++)for(B=0;5>B;B++)F=m[n].n.clone(),F.normalize(),F.applyAxisAngle(m[n].pitch,2*Math.PI/6),F.applyAxisAngle(m[n].roll,2*Math.PI/5*B),F.multiplyScalar(.5),F=F.add(m[n].v),y=m[n].v.clone(),q.vertices.push(F),q.vertices.push(y),q.colors.push(Z[12]),q.colors.push(Z[12]);return q.colorsNeedUpdate=!0,q};this.pine=function(){var q=Math.floor(8*scope.random())+6,n=2*Math.PI/6,m=new THREE.Geometry;m.vertices.push(new THREE.Vector3(0,
0,0));m.vertices.push(new THREE.Vector3(0,0,+q-.5+1));m.colors.push(Z[9]);m.colors.push(Z[9]);m.colors.push(Z[9]);for(var C=1;C<q;C++)for(var B=0;6>B;B++)off=C%2*n*.5,m.vertices.push(new THREE.Vector3(0,0,+C+1)),m.vertices.push(new THREE.Vector3(.3*(q-C),0,+C-.3+1)),m.vertices[m.vertices.length-1].applyAxisAngle(J,n*B+off),m.colors.push(Z[9]),m.colors.push(Z[9]);return m};this.checkpoint=function(){function q(B,y,Q){var F=new THREE.Geometry,K=(new THREE.Vector3).copy(B).sub(y),I=(new THREE.Vector3).copy(B).add(K.clone().multiplyScalar(1.5));
K=(new THREE.Vector3).copy(y).sub(K.clone().multiplyScalar(1.5));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));F.vertices.push(new THREE.Vector3(K.x,K.y,K.z+12));F.vertices.push(new THREE.Vector3(K.x,K.y,K.z+12));F.vertices.push(new THREE.Vector3(K.x,K.y,K.z-12));F.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));F.faces.push(new THREE.Face3(0,1,2));F.faces.push(new THREE.Face3(3,4,5));I=new THREE.Geometry;I.vertices.push(new THREE.Vector3(B.x,
B.y,B.z+6));I.vertices.push(new THREE.Vector3(B.x,B.y,B.z+8));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));I.vertices.push(new THREE.Vector3(B.x,B.y,B.z+6));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));I.vertices.push(new THREE.Vector3(B.x,B.y,B.z+8));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));I.vertices.push(new THREE.Vector3(B.x,B.y,B.z+1));I.vertices.push(new THREE.Vector3(y.x,y.y,y.z+1));B=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,
wireframe:!1,fog:!0});B.color=Z[5];F=new THREE.Mesh(F,B);F.visible=!0;B=new THREE.LineSegments(I,B);return F.name="Objective "+Q,B.name="Checkpoint"+Q,{display:B,collision:F}}var n=u.geometry,m=n.vertices.length-80;m=Math.floor(m/4)-Math.floor(m/4)%2;var C=[];C[0]=q(n.vertices[40],n.vertices[41],0);C[1]=q(n.vertices[40+m],n.vertices[1+m+40],1);C[2]=q(n.vertices[2*m+40],n.vertices[2*m+41],2);C[3]=q(n.vertices[3*m+40],n.vertices[3*m+41],3);C[4]=q(n.vertices[4*m+40],n.vertices[4*m+41],4);this.DISTANCE=
4*m/2*3;scope.start.copy(n.vertices[36]);scope.start.sub(n.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(n.vertices[36]);for(n=0;5>n;n++)null==N.best&&(N.best[n]=4>n?m*(n+1)/Oa:N.best[n]=N.best[n-1]);return U.STATE(),C};this.resetCheckpoints=function(){for(var q in scope.checkpoints)scope.checkpoints[q].display.material.color=Z[5]};this.random=function(){Qa=(Qa+1)%2147483647;var q=1E4*Math.sin(Qa);return q-Math.floor(q)};this.randomInt=function(q,n){return Math.floor(scope.random()*
(n-q))+q};this.noise=function(q){var n=new ob,m=[],C=8,B=0,y=0,Q=1E3*scope.random();k;for(var F=0;F<q.vertices.length;F++)m[F]=0;for(F=0;2>F;F++){for(var K=0;K<q.vertices.length;K++)m[K]+=Math.floor(n.noise(q.vertices[K].x/C,q.vertices[K].y/C,Q)*C),m[K]>B&&(B=m[K]),m[K]<y&&(y=m[K]);C*=3}for(n=0;n<m.length;n++){C=2===k?2:.5;for(B=0;B<u.geometry.vertices.length;B++)y=q.vertices[n].distanceTo(u.geometry.vertices[B]),y=y*y/100,y<C&&(C=y);q.vertices[n].z+=m[n]*C}};this.name=function(){var q="";if(Ta)q=
U.custom_seed;else if(Fa||Za)q=U.CHALLENGES.seed;else{var n=[" forest"," pass"," mountain"],m="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var C=Math.ceil(3*Math.random())+1,B=0;B<C;)q+=m[Math.floor(Math.random()*m.length)],B++;m=2===k?1:0;m=n[Math.floor(m+Math.random()*(n.length-m))];q+=m;(.02<Math.random()||q!==eb)&&(q="",m=Math.floor(Math.random()*fb.length),q=fb[m])}return eb=
q,q}}function gb(){$a=!0;window.removeEventListener("touchstart",gb)}function Ia(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,g=window.innerWidth,k=window.innerHeight;ba.aspect=g/k;ba.updateProjectionMatrix();b.resize(g,k,a,Ea);U.resize(g,k,a)}function hb(){if(window.requestAnimationFrame(hb),Ua=window.performance.now(),!va||x.IMPORT||Aa)if(x.REPLAY&&!va){ib();N.update();x.update();uas.update(x.TIMESTAMP);for(var a=0;a<aa.length;a++)aa[a].update(x.TIMESTAMP,
x.FRAME),Aa&&x.TIMESTAMP>aa[0].PHYSICS[aa[0].PHYSICS.length-60].time+2E3&&x.reset(!0)}else if(Ra||sa.SCAN&&!va)ba.up.set(0,0,1),ba.position.applyAxisAngle(ba.up,.01),ba.lookAt(new THREE.Vector3),Ra&&U.loading(),U.scanning();else{if(Aa||x.IMPORT){for(a="";a.length<Math.floor(Ua/500)%4;)a+=".";b.clear();b.text("importing ghost data"+a,16,16);N.update()}ba.up.set(0,0,1);ba.position.applyAxisAngle(ba.up,.01);ba.lookAt(new THREE.Vector3,0,0,0)}else{x.update();for(a=0;a<aa.length;a++)x.START?aa[a].update(x.TIMESTAMP,
x.FRAME):aa[a].update(0,0);uas.update(x.TIMESTAMP);pa||ab||U.update();!$a||pa||La||b.dpad();D.RESET&&!pa&&(U.reset(),D.RESET=!1);N.update()}ya.render(fa,ba);b.update(D.touches)}function pb(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,
mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var k=new THREE.Vector3;k.copy(ba.position);k.x+=Math.random()*a.snow.distance-a.snow.distance/2;k.y+=Math.random()*a.snow.distance-a.snow.distance/2;k.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(k)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var k=0;k<a.snow.mesh.geometry.vertices.length;k++){var h=
a.snow.mesh.geometry.vertices[k];h.z-=.5*x.DT();(Math.abs(h.z-ba.position.z)>a.snow.height/2||Math.abs(h.x-ba.position.x)>a.snow.distance/2||Math.abs(h.y-ba.position.y)>a.snow.distance/2)&&(h.copy(ba.position),h.x+=Math.random()*a.snow.distance-a.snow.distance/2,h.y+=Math.random()*a.snow.distance-a.snow.distance/2,h.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var g=0;4>g;g++)this.checkpoint[this.checkpoint.length]=
new THREE.Mesh(new THREE.Geometry);this.connect=function(k){k=void 0===k?!1:k;if(ba.position.set(0,400,200),ba.far=2E3,ba.updateProjectionMatrix(),ba.lookAt(new THREE.Vector3),ya.render(fa,ba),!k){this.name=this.generate.name();k="";for(var h in this.name)k+=this.name.charCodeAt(h).toString();Qa=k}a.generate.connect();qb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(k){k=void 0===k?!1:k;Qa++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;
a.connect(k)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function rb(){var a=this,g,k,h=0,t=0;this.custom_seed="";var u="#1#ffffff#334#",r=Ca+"#1#",z=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(c){return c?(ma=c.uid,a.STATE(),sa.requestName(ma,function(f){ja=f;a.STATE()})):(ma=!1,a.STATE()),
null})};this.register=function(c){b.clear();a.STATE=function(){a.register(c)};ab=!0;a.inputName(function(){ab=!1;sa["export"]()},!0,"input name to save data")};this.resize=function(c,f){g=b.width;k=b.height;Xa=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var c=x.yen();b.print("$ "+c.toString(),"2","1.0-4")};this.nav=function(c){c=void 0===c?function(){b.clear()}:c;b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2+4p","1.0-4","8",function(){a.menu(c)},
!1)};this.title=function(c,f){a.breadcrumb(c,f);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){z||b.backdrop(!1);c();pa=!1;a.SETTINGS=!1},!1);Va?(b.style=1,b.sprite(40,72,8,10,"1.0-14","2",8,10),b.sprite(48,72,16,16,"1.0-19","2",16,16),b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-23","2+4p","7","5",function(){var l=document.getElementById("mp3_player");l.currentTime=Math.random()*l.duration;l.play();a.STATE()},!1),b.button("","1.0-14","2+4p",
"7","5",function(){document.getElementById("mp3_player").pause();Va=!1;a.STATE()},!1)):(b.style=2,b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();Va=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=function(c,f){var l=void 0===f?function(){z||b.backdrop(!1);c();pa=!1;a.SETTINGS=!1}:function(){a.menu(c);pa=!0};b.style=Va?1:0;f=Va?" low recordings 0.0.6 feature mix":" menu";b.print(" "+
f,"2","2");b.style=0;b.print("<","2","2");b.button("","2","2+4p","7","8",l,!1)};this.menu=function(c){pa=!0;b.style=0;a.STATE=function(){a.menu(c)};z||b.backdrop();b.clear();a.title(c);b.sprite(0,0,1,1,"2","6","1.0-4",1);Aa?(b.print(" > view spectator controls","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(c)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");
b.button("","2","13+4p","1.0-4","5",function(){a.settings(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var f=8,l;Aa?(l=uas.AUTOPILOT?"disable":"enable",b.button(l+" autopilot","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;a.replay()},!0),f+=8,b.button("deploy vehicle","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);Aa=!1;a.STATE=function(){};x.reset(!1);a.reset();va=!0;x.START=!1;x.disconnect();x.connect(N.start,N.surface,!1);a.play()},!0)):(va||x.REPLAY)&&
(b.button("restart stage","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),f+=8,b.button("next stage","2","1.0-2-"+f,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var c;a.STATE=function(){a.intro()};z=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");b.style=0;Fa?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,c=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),
b.style=0,b.print(c,"9","15"),sa.requestName(a.CHALLENGES.uid,function(f){a.CHALLENGER=f;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ta&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===ma||""!==ja?null!==ja&&""!==ja?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+ja,"2","9"),b.style=2,b.print("[edit]",ja.length+"+5","9"),b.style=0,b.button("","2","9+4p",ja.length+
"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===ja||null===ja)||!1!==ma&&null===ja)&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.6.1","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},
!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();z=!1;b.renderer.style.background="transparent";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");N.connect();a.load()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=
0};this.load=function(){a.STATE=function(){a.target();a.setBattleName()};a.TIMELIST=[];sa.scan(N.name,function(c){for(var f={$jscomp$loop$prop$t$91$159:0};f.$jscomp$loop$prop$t$91$159<c.length;f={$jscomp$loop$prop$t$91$159:f.$jscomp$loop$prop$t$91$159},f.$jscomp$loop$prop$t$91$159++)a.TIMELIST[f.$jscomp$loop$prop$t$91$159]={uid:c[f.$jscomp$loop$prop$t$91$159].uid,utc:c[f.$jscomp$loop$prop$t$91$159].utc,time:c[f.$jscomp$loop$prop$t$91$159].time,name:"..."},sa.requestName(c[f.$jscomp$loop$prop$t$91$159].uid,
function(p){return function(J){a.TIMELIST[p.$jscomp$loop$prop$t$91$159].name=J;a.STATE()}}(f)),sa.checkTime(ma,c[f.$jscomp$loop$prop$t$91$159].uid,c[f.$jscomp$loop$prop$t$91$159].time);f=a.TIMELIST.length<Ca?a.TIMELIST.length:Ca;var l=[];switch(Da){case 0:l=c.slice(0,f);break;case 1:for(c=c.slice();l.length<f;){var e=Math.floor(Math.random()*c.length);l.push(Object.assign({},c[e]));c.splice(e,1)}}a.BATTLE=l.slice();a.STATE()});Ra=!0;a.target();h=0};this.ready=function(){Ra=!1;a.STATE()};this.play=
function(){b.clear();a.nav(a.play);pa=!1;b.style=0};this.complete=function(){pa=!0;b.clear();a.STATE=function(){};a.nav(a.complete);var c="stage complete!";b.style=0;b.print(c,"0.5-"+2*Math.round(c.length/2),"0.3-1",2);b.style=0;N.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=function(){a.results();x.replay()}):(a.STATE=function(){a.results()},x.REPLAY||(a.STATE=function(){},sa["export"](a.results)))},2E3);c=x.param().model+" ("+(x.param().power+1)+"/"+(x.param().drag+
1)+"/"+(x.param().sensitivity+1)+"/"+(x.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:ja,time:x.AT(),penalty:x.PENALTY(),score:x.AT()+x.PENALTY(),seed:N.name,rating:Math.round(N.generate.DISTANCE/(x.AT()+x.PENALTY())),distance:N.generate.DISTANCE,vehicle:c})};this.results=function(){a.STATE=function(){a.results()};b.clear();b.style=0;pa=!0;var c=0,f=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((f<Ma||!1===Ma)&&(Ma=f),0<a.TIMELIST.length){for(var l=0;l<a.TIMELIST.length;l++)if(f<
a.TIMELIST[l].time){c=l+1;break}0==c&&(c=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+N.name,"2","2");b.style=0;f=b.time(f);b.print(f,"2","5",2);l=x.overwrite(x.CHECKPOINT,N.best,!1);0!=c?b.print("rank "+c,2*f.length+"+3".toString(),"5+4p"):l?(l=Fa?"challenge victory!":"new record!",b.style=1,b.print(l,2*f.length+"+3".toString(),"5+4p"),b.style=0):Fa&&b.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");f=9;l=x.CHECKPOINT;if(320<k){for(var e=1;e<l.length-1;e++){b.style=
5;b.print("cp "+e,"2",f+"+"+e.toString());e;var p=l[e],J=a.split(e);b.print(J,"0.5+1",f+"+"+e.toString());"number"==typeof l[e]?(b.style=0,p=b.time(l[e])):(b.style=4,p="penalty",d="");b.print(p,"0.5 -1-"+p.length.toString(),f+"+"+e.toString());b.style=0;f+=1}f+=5}1===c&&(b.style=4,b.print("new record!","2",f.toString(),2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});
b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){pa=!1;uas.replay();a.replay()})};this.checkpoint=function(c){c=void 0===c?!1:c;b.clear();b.style=0;a.nav(function(){a.checkpoint(c)});var f="";c?f+="missed checkpoint X "+Math.abs(x.CHECKPOINT[5]):f=this.split(x.OBJECTIVE);b.text(f,16,32);b.style=0};this.split=function(c){var f="",l=N.best[c]-
x.CHECKPOINT[c],e=2,p="";return Number.isNaN(l)?void 0===x.CHECKPOINT[c]?(e=4,f+="- 100 sec"):void 0===N.best[c]&&0>N.best[5]?(e=1,f+="+ 100 sec"):void 0===N.best[c]&&(e=1,f+="new time!"):(0<l?(p="+ ",e=1):0>l?(p="- ",e=4):p="+ ",l=Math.abs(l),f+="( "+p+b.time(l)+" )"),b.style=e,f};this.battle=function(){var c=new jb(sa.save(sa.tape),x.MODEL,x.PAINT);aa.push(c);a.reset()};this.replay=function(){if(!x.IMPORT&&!va){a.STATE=function(){a.replay()};b.clear();Aa?a.nav(function(){a.replay()}):a.nav(a.results);
uas.AUTOPILOT?a.autopilot():a.drone();var c={};for(c.$jscomp$loop$prop$e$96$161=b.style=0;4>c.$jscomp$loop$prop$e$96$161;c={$jscomp$loop$prop$e$96$161:c.$jscomp$loop$prop$e$96$161},c.$jscomp$loop$prop$e$96$161++){var f="7+"+(4*c.$jscomp$loop$prop$e$96$161).toString(),l=c.$jscomp$loop$prop$e$96$161===uas.CAM-1?48:40;b.button("",f+"-10p","1.0-4+4p","3","4",function(e){return function(){uas.CAM=e.$jscomp$loop$prop$e$96$161+1;a.STATE()}}(c),!1);b.sprite(l,64,8,8,f,"1.0-4",8,8)}b.style=0;c=(uas.AUTOPILOT||
uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:ja;(uas.AUTOPILOT||uas.TARGETING)&&b.print(c,"2","1.0-7");b.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){b.style=0;b.style=0<uas.POV?4:2;b.sprite(72,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);Aa||(b.style=2,b.print("<","2","2"),b.button("",
"2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){b.style=uas.TARGETING?4:2;b.sprite(64,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){b.clear();Ra=!0;Ta=Za=Fa=!1;a.PATH=!1;custom_seed="";N.name="";a.BATTLE=[];Ma=!1;window.history.pushState("","","/");ya.clear();x.REPLAY=!1;x.RESET=!0;x.disconnect();for(var c=0;c<aa.length;c++)aa[c].disconnect();uas.reset(!0);aa=
[];N.SNOW&&fa.remove(N.snow.mesh);N.reset();va=pa=!1;sa.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(c){c=void 0===c?"reset":c;aa.index=0;b.clear();a.nav(a.play);va=!0;pa=!1;x.reset(!1);for(var f=0;f<aa.length;f++)aa[f].reset();
firebase.analytics().logEvent("stage_restart",{status:c})};this.hide=function(c){};this.update=function(){pa||!va||La||(b["delete"](16,16,g-64,16),b["delete"](16,k-32,64,16),b.text(b.time(x.AT()),16,16),b.text(x.SPEED.toString(),16,k-32))};this.loading=function(){for(var c="";c.length<Math.floor(Ua/500)%4;)c+=".";pa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+c,16,16),b.style=0);h++};this.scanning=function(){if(0===U.TIMELIST.length&&sa.SCAN&&!pa){b["delete"](16,72,88,8);for(var c=
"";c.length<Math.floor(Ua/500)%4;)c+=".";b.style=5;b.text("scanning"+c,16,72)}};this.target=function(){b.clear();a.STATE=function(){a.target()};a.nav(a.target);var c,f,l=N.name;if(Ra||(b.style=2,b.print("stage generated.","2","2"),sa.SCAN?b.style=2:(b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){b.clear();N.SNOW&&fa.add(N.snow.mesh);a.STATE=function(){};N.generate.END=!1;a.play();x.SPECTATE=!1;va=!0;x.connect(N.start,N.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")}),
b.style=4,b.style=1,0<a.BATTLE.length&&b.button("spectate!","1.0-14","1.0-18","12","3",function(){va=!1;N.generate.END=!1;N.SNOW&&fa.add(N.snow.mesh);b.style=0;x.connect(N.start,N.surface);Aa=!0;a["import"]();b.clear();fa.add(N.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),b.style=5,b.print(l,"2","5-1p",2),b.style=0,0!==a.TIMELIST.length||!sa.SCAN)if(0!==a.TIMELIST.length){var e=a.TIMELIST.slice();for(l=0;l<e.length;l++)for(var p=0;p<e.length;p++)e[l].time<=e[p].time&&e[l].utc<
e[p].utc&&l>p&&(c={},Object.assign(c,e[l]),f={},Object.assign(f,e[p]),e[l]=f,e[p]=c);b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(e[0].time),"2","12",2);b.style=5;c=(l=e.length<Xa)?e.length:Xa;l=l?0:e.length-Xa;for(f=0;f<c;f++)b.print(f+1+". "+e[f].name,"2","16+"+2*f),b.print(b.time(e[f].time),"18","16+"+2*f);0<l&&b.print("+ "+l+" more entries","2",2*c+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.setBattleName=function(){for(var c=0;c<a.BATTLE.length;c++)a.BATTLE[c].name=
a.TIMELIST[c].name};this["import"]=function(){a.setBattleName();for(var c={$jscomp$loop$prop$i$105$163:0};c.$jscomp$loop$prop$i$105$163<a.BATTLE.length;c={$jscomp$loop$prop$i$105$163:c.$jscomp$loop$prop$i$105$163},c.$jscomp$loop$prop$i$105$163++)x.IMPORT=!0,sa["import"](N.name+"/"+a.BATTLE[c.$jscomp$loop$prop$i$105$163].uid,function(f){return function(l){a.BATTLE[f.$jscomp$loop$prop$i$105$163].IMPORT_BUFFER=[];x.INPUTS=[];a.BATTLE[f.$jscomp$loop$prop$i$105$163].data=[];a.BATTLE[f.$jscomp$loop$prop$i$105$163].param=
{power:l.param.power,drag:l.param.drag,sensitivity:l.param.sensitivity,model:l.param.model,paint:l.param.paint};a.BATTLE[f.$jscomp$loop$prop$i$105$163].cp=l.cp;for(var e=0;e<l.debug.length;e++)l.debug[e].time,l.debug[e].position,l.debug[e].normal,l.debug[e].rotation,l.debug[e].U,l.debug[e].D,l.debug[e].L,l.debug[e].R,a.BATTLE[f.$jscomp$loop$prop$i$105$163].data.push({U:l.debug[e].U,D:l.debug[e].D,L:l.debug[e].L,R:l.debug[e].R,time:l.debug[e].time});f.$jscomp$loop$prop$i$105$163===a.BATTLE.length-
1&&x["import"]()}}(c))};this.uasComputer=function(){b.clear();b.style=0;var c;b.print("autopilot "+(uas.AUTOPILOT?"enabled":"disabled"),"2","2");uas.AUTOPILOT?(c=U.TIMELIST[uas.data().target].name,b.print("targeting: "+c,"2","4")):(c=0<aa.length?U.TIMELIST[uas.data().target].name:"disabled",b.print("targeting: "+c,"2","4"),b.style=2,c=uas.CTRL||D.SHIFT?"roll":"yaw",b.print("ctrl: "+c,"2","1.0-4"),b.button("","0","1.0-4+4p","14","4",function(){a.uas(!0);uas.tutorial=!0},!1),b.style=0)};this.uas=function(c){b.clear();
b.style=0;a.STATE=function(){a.uas()};b.backdrop();b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2","1.0","4",function(){b.backdrop(!1);a.replay()},!1);b.style=0;b.print("spectator controls","2","2");b.print("pilot mode","2","6");b.style=2;b.print("arrow            pitch/yaw/roll","2","10");b.print("shift + arrow    roll/yaw modifier","2","12");b.print("space            power +","2","14");b.print("shift + space    power -","2","16");b.print("ctrl:            roll/yaw toggle","2","18");b.print("r                reset",
"2","20");b.print("t                targeting mode toggle","2","22");b.print("shift + arrow    change target (targeting)","2","24");b.style=0};this.timelist=function(){b.style=0};this.save=function(){var c=ja+"#"+x.MODEL+"#"+x.PAINT+"#"+x.param().power+x.param().drag+ +x.param().sensitivity+"#"+Date.now();c!==u&&(u=c,a.cSave("SAVE",u))};this.vehicle=function(c){a.STATE=function(){a.vehicle(c)};pa=!0;b.clear();a.title(function(){c();a.save()},function(){a.menu();sv()});x.REPLAY&&a.reset();var f=[],
l=x.param();f.push({id:"power",value:l.power,funct:function(M){x.tune.power(M)}});f.push({id:"drag",value:l.drag,funct:function(M){x.tune.drag(M)}});f.push({id:"sensitivity",value:l.sensitivity,funct:function(M){x.tune.sensitivity(M)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(x.models()[x.MODEL].name,"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){x.MODEL+=1;1<x.MODEL&&(x.MODEL=0);x.body();a.vehicle(c)},!1);
b.button("<","1.0-12","8++4p","4","4",function(){--x.MODEL;0>x.MODEL&&(x.MODEL=1);x.body();a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(sb[x.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){x.PAINT+=1;x.PAINT>Ja.length-1&&(x.PAINT=0);x.paint();a.vehicle(c)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--x.PAINT;0>x.PAINT&&(x.PAINT=Ja.length-1);x.paint();a.vehicle(c)},!1);
for(l={$jscomp$loop$prop$t$107$165:0};l.$jscomp$loop$prop$t$107$165<f.length;l={$jscomp$loop$prop$t$107$165:l.$jscomp$loop$prop$t$107$165},l.$jscomp$loop$prop$t$107$165++){var e="8+5+5+"+(5*l.$jscomp$loop$prop$t$107$165).toString();b.print(f[l.$jscomp$loop$prop$t$107$165].id,"2",e);b.sprite(0,0,1,1,"2",e+"+3","1.0-2-2",1);for(var p={$jscomp$loop$prop$e$108$167:0};6>p.$jscomp$loop$prop$e$108$167;p={$jscomp$loop$prop$e$108$167:p.$jscomp$loop$prop$e$108$167},p.$jscomp$loop$prop$e$108$167++){var J="1.0-18+"+
(3*p.$jscomp$loop$prop$e$108$167).toString(),L=p.$jscomp$loop$prop$e$108$167<=f[l.$jscomp$loop$prop$t$107$165].value?48:40;b.button("",J+"-10p",e+"+4p","3","4",function(M,da){return function(){f[M.$jscomp$loop$prop$t$107$165].funct(da.$jscomp$loop$prop$e$108$167);a.vehicle(c)}}(l,p),!1);b.sprite(L,64,8,8,J,e,8,8)}}};this.scan=function(c,f){};this.settings=function(c){a.STATE=function(){a.settings(c)};a.SETTINGS=!0;r=Ca+"#"+Da+"#"+(Na?1:0)+"#"+(bb?1:0)+"#";a.cSave("SETTINGS",r);b.clear();z||b.backdrop();
a.title(c,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(f=Na?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(f,"1.0-2-"+f.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("","2","13+4p","1.0-4","5",function(){Na=!Na;a.settings(c)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15",
"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+Ea,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",function(){2>Ea&&(Ea+=.5);b.style=0;a.settings(c);Ia()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<Ea&&(Ea-=.5);b.style=0;a.settings(c);Ia()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);b.print("camera mode","2","23");var f=x.FPV?"fpv":"tpv";b.print(f,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){x.FPV=
!x.FPV;a.settings(c)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(c,f){a.STATE=function(){a.ghostConfig(c)};var l=bb?1:0;r=Ca+"#"+Da+"#"+(Na?1:0)+"#"+l;a.cSave("SETTINGS",r);b.clear();z||b.backdrop();a.title(c,function(){a.settings(c)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name","2","8");b.print(ja,"1.0-13-"+ja.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(c)},
!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");l=Ca.toString();b.print(l,"1.0-13-"+l.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Ca&&(Ca+=1);a.ghostConfig(c)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Ca&&--Ca;a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority","2","18");l=0===Da?"best":"random";b.print(l,"1.0-13-"+l.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Da+=1;1<Da&&(Da=0);a.STATE()},
!1);b.button("<","1.0-12","18+4p","4","4",function(){--Da;0>Da&&(Da=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2","23");l=Ya?"enabled":"disabled";b.print(l,"1.0-2-"+l.length,"23");b.button("","2","23+4p","1.0-4","4",function(){Ya=!Ya;for(var e=0;e<aa.length;e++)aa[e].toggleEmitter(Ya);a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1)};this.controls=function(c){b.clear();a.title(c,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&
document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(c){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");b.style=0;b.print("> "+ja,"2","9");b.style=2;b.print("[edit]",ja.length+"+9","9");b.button("","2","9+4p",ja.length+"+5","4",function(){a.inputName(a.challenge,
!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(N.name,"2","15");b.style=2;b.print("time","2","19");c=b.time(x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5]);b.style=5;b.print(c,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(c,f,l){f=void 0===f?!1:f;l=void 0===
l?"enter display name:":l;a.STATE=function(){a.inputName(c,f,l)};b.clear();pa=!0;f?a.nav(function(){c()},a.menu):a.title(c);b.print(l,"2","2");b.textinput(ja,"2","4","1.0-2","6","operator_id");var e=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ja=tb(e.value.toLowerCase());!1===ma&&1<ja.length&&null!==ja?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,
c,f);a.STATE=function(){}})["catch"](function(p){p.code;p.message}):!1!==ma&&1<ja.length&&null!==ja?a.submitName(ma,c,f):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(c,f,l){l=void 0===l?!1:l;1<ja.length&&10>ja.length?firebase.database().ref("uid/"+c).set({name:ja},function(e){e?(b.clear(),e="PERMISSION_DENIED"===e.code?"invalid name":"network error",b.print(e,"2","2"),window.setTimeout(function(){a.inputName(f,l)},1E3)):(b.clear(),b.print("name change successful",
"2","2"),window.setTimeout(f,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(f,l)},1E3))};this.encodeURL=function(){for(var c="",f=N.name,l=0;l<f.length;l++){var e=f.charAt(l);e=" "===e?"-":e;c+=e}c=c+"/"+ma;window.history.pushState("","","/");f=window.location.href;var p="./#/"+c;navigator.clipboard.writeText("https://specialstage.io/#/"+c).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",p)},function(){window.history.pushState("",
"",p);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:f+"#/"+c})};this.decodeURL=function(){for(var c=window.location.href,f="",l=[],e=!1,p=0,J=0;J<c.length;J++){var L=c.charAt(J);e?"/"===L?(Fa=!0,p++):(1===p&&(L="-"===L?" ":L,f+=L),1<p&&(l+=L)):"#"===L&&(e=!0,Ta=!0,p=0)}Fa&&0<l.length?(a.custom_seed=f,N.name=f,a.CHALLENGES={seed:f,uid:l}):Ta&&(a.custom_seed=f,N.name=f,Fa=!1);Fa&&firebase.analytics().logEvent("challenge_accepted",{url:c})};this.cSave=
function(c,f){var l=new Date;l.setTime(l.getTime()+2808E7);l="expires="+l.toUTCString();document.cookie=c+"="+f+";"+l+";path=/"};this.cLoad=function(c){c+="=";for(var f=document.cookie.split(";"),l=0;l<f.length;l++){for(var e=f[l];" "==e.charAt(0);)e=e.substring(1);if(0==e.indexOf(c))return e.substring(c.length,e.length)}return""};this.checksave=function(){var c=a.cLoad("SAVE");if(0!==c.length&&null!=c){for(var f=0,l="",e="",p="",J="",L=0,M=0;M<c.length;M++){var da=c.charAt(M);if("#"!==da)switch(L){case 1:f=
parseInt(da);break;case 2:l+=da;break;case 3:e+=c.charAt(M),p+=c.charAt(M+1),J+=c.charAt(M+2),M+=2}else L++}x.MODEL=parseInt(f);x.PAINT=parseInt(l);x.paint();x.tune.power(parseInt(e));x.tune.drag(parseInt(p));x.tune.sensitivity(parseInt(J))}else x.PAINT=0,x.paint();if(c=a.cLoad("SETTINGS"),0!==c.length&&null!=c){f=0;p=e=l="";for(J=0;J<c.length;J++)if(L=c.charAt(J),"#"!==L)switch(f){case 0:l+=L;break;case 1:Da=parseInt(L);break;case 2:e=parseInt(L);break;case 3:p=parseInt(L)}else f++;Ca=parseInt(l);
Na=0!==e;1===p&&(bb=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();b.print("0.0.5.3","2","2");b.sprite(0,88,47,8,"2","6-4p",188,32,4);b.sprite(49,88,40,8,"2","12-4p",160,32,4);b.sprite(1,0,255,16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)",
"4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics",
"4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("https://specialstage.io","2","0.25",1);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.ginko.ltd","4","0.25 + 10");b.print("> discord.specialstage.io","4","0.25 + 12");window.setTimeout(a.music,2E3)};this.music=function(c){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},
500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty","2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance",
"2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(c){if("n"===c.key)switch(t){case 0:b.clear();window.setTimeout(a.promo,1E3);t++;break;case 1:window.setTimeout(a.biome,1E3);t++;x.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);t++;x.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);t++;x.CAMERA=
3;break;case 4:window.setTimeout(a.endtag,1E3);t++;x.CAMERA=1;break;case 5:b.clear(),t=0}}}function ub(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var g=this.renderer.getContext("2d");this.context=g;var k=document.createElement("img");k.src="./img/stage.font.0.0.6.png";k.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var h=document.createElement("canvas"),t=h.getContext("2d");
this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var u=128,r=180,z=128,c=80,f;var l=128;var e=r;var p=128;var J=80;var L=!(f={x:128,y:r+60,w:128,h:40}),M=[],da=[],S=[];this.connect=function(){g.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(w,A){w=void 0===w?0:w;A=void 0===A?"#ffffff":A;void 0===h[w]&&(h[w]=document.createElement("canvas"),t[w]=h[w].getContext("2d"));t[w].drawImage(k,0,0,128,128,0,0,128,128);t[w].globalCompositeOperation="source-atop";t[w].fillStyle=
A;t[w].fillRect(0,0,128,128);t[w].globalCompositeOperation="source-out"};this.resize=function(w,A,G,H){H=void 0===H?1:H;a.scale=G*H;var O=window.devicePixelRatio,ia=300>Math.ceil(O)/O*w?Math.floor(O):Math.ceil(O);0!=ia-O&&(G=ia/O*H);1>=O&&1<a.scale&&(G=a.scale);this.width=w/G;this.height=A/G;this.renderer.width=this.width;this.renderer.height=this.height;ya.setSize(this.width,this.height);a.scale=G;this.renderer.style.transform="scale("+G+","+G+")";ya.domElement.style.transform="scale("+G+","+G+")";
this.renderer.style.transformOrigin="top left";ya.domElement.style.transformOrigin="top left";g.imageSmoothingEnabled=!1;this.redraw();u=128;r=180;z=128;c=80;l=128;e=r;p=128;J=80;f={x:128,y:r+60,w:128,h:40};this.automate(this.width,this.height)};this.update=function(w){var A=0,G;for(G in w)for(var H in S)if(w[G].x>S[H].x*a.scale&&w[G].y>S[H].y*a.scale&&w[G].x<S[H].w*a.scale&&w[G].y<S[H].h*a.scale&&(A++,1==w[G].start)){S[H].funct();w[G].start=!1;break}};this.print=function(w,A,G,H){H=void 0===H?1:
H;for(var O=0,ia=a.compile(A,a.width,a.col),T=a.compile(G,a.height,a.row),R=a.style;O<w.length;)a.encode(w.charAt(O),ia+O*a.col*H,T,H),O++;L||M.push(function(){a.style=R;a.print(w,A,G,H)})};this.text=function(w,A,G,H,O){H=void 0===H?1:H;for(O=0;O<w.length;)a.encode(w.charAt(O),A+O*a.col*H,G,H),O++};this.button=function(w,A,G,H,O,ia,T,R){T=void 0===T?!0:T;R=void 0===R?1:R;var Y=a.compile(A,a.width,a.col),la=a.compile(G,a.height,a.row),ka=a.compile(H,a.width,a.col),oa=a.compile(O,a.height,a.row),ca=
a.style;T&&(g.drawImage(h[a.style],0,0,1,1,Y,la+oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,Y,la-oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,Y,la-oa/2,1,oa),g.drawImage(h[a.style],0,0,1,1,Y+ka-1,la-oa/2,1,oa+1));for(var ea=0;ea<w.length;)a.encode(w.charAt(ea),Y+ea*a.col+ka/2-Math.round(w.length*a.col)/2+2,la-a.row/2,R),ea++;S.push({x:Y,y:la-oa/2,w:Y+ka,h:la+oa/2,funct:function(){ia()}});L||M.push(function(){a.style=ca;a.button(w,A,G,H,O,ia,T,R)})};this.line=function(w,A,G,H){a.sprite(0,0,1,1,w,A,
G,H)};this.sprite=function(w,A,G,H,O,ia,T,R){var Y=a.compile(O,a.width,a.col),la=a.compile(ia,a.height,a.row),ka=a.compile(T,a.width,a.col),oa=a.compile(R,a.height,a.row),ca=a.style;g.drawImage(h[a.style],w,A,G,H,Y,la,ka,oa);L||M.push(function(){a.style=ca;a.sprite(w,A,G,H,O,ia,T,R)})};this.backdrop=function(w,A,G,H,O){w=void 0===w?"#10101099":w;!1===w?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=w)};this.getDrawList=function(){return M};this.redraw=
function(){L=!0;a.clear();for(var w=0;w<M.length;w++)M[w]();w=document.body.getElementsByTagName("input");for(var A=0;A<w.length;A++)a.text(w[A].value,w[A].style.top,w[A].style.left);L=!1};this.automate=function(w,A){w=Math.floor(w/3)-2;A=Math.floor(A/4);z>w&&(z=w,u=w,p=w,l=w,f.w=w,f.x=w);r>A&&(r=A+40,e=r,f.y=r+60)};this.pad=function(w,A,G,H,O,ia,T){var R=0;for(T();R<D.touches.length;)D.touches[R].x>A*a.scale&&D.touches[R].y>G*a.scale&&D.touches[R].x<(A+H)*a.scale&&D.touches[R].y<(G+O)*a.scale&&ia(),
R++;Na&&(g.drawImage(h[a.style],0,0,1,1,A+1,G,H-1,1),g.drawImage(h[a.style],0,0,1,1,A+1,G+O,H-1,1),g.drawImage(h[a.style],0,0,1,1,A+1,G,1,O),g.drawImage(h[a.style],0,0,1,1,A+H-1,G,1,O));a.encode(w,A+H/2-a.col/2,G+O/2-a.row/2)};this.dpad=function(){g.drawImage(h[a.style],88,88,40,40,a.width-l+p/2-20,a.height-e+J/2-20,40,40);a.pad("<",u-z-1,a.height-r,z,c,function(){D.LEFT=!0},function(){D.LEFT=!1});a.pad(">",u+1,a.height-r,z,c,function(){D.RIGHT=!0},function(){D.RIGHT=!1});a.pad("^",a.width-l,a.height-
e,p,J,function(){D.UP=!0},function(){D.UP=!1});a.pad("b",a.width-f.x,a.height-f.y+f.h/2,f.w,f.h,function(){D.DOWN=!0},function(){D.DOWN=!1})};this.clear=function(){if(!L){for(var w=document.body.getElementsByTagName("input"),A=0;A<w.length;A++)document.body.removeChild(w[A]);if(!a.REDRAW){M=[];for(w=0;w<da.length;w++)document.body.removeChild(da[w]);da=[]}M=[]}S=[];g.clearRect(0,0,a.width,a.height)};this["delete"]=function(w,A,G,H){A=void 0===A?0:A;G=void 0===G?ya.width:G;H=void 0===H?ya.height:H;
w=a.compile(void 0===w?0:w,a.width,a.col);A=a.compile(A,a.height,a.row);G=a.compile(G,a.width,a.col);H=a.compile(H,a.height,a.row);g.clearRect(w,A,G,H)};this.encode=function(w,A,G,H){H=void 0===H?1:H;var O=w.charCodeAt(0);w=8*O%128;O=8*Math.floor(O/16);g.clearRect(A,G,8,8);g.drawImage(h[a.style],w,O,8,8,A,G,8*H,8*H)};this["float"]=function(w,A){var G=Math.floor(Math.abs(100*w));G=G.toString();var H=G.slice(0,G.length-2),O=G.slice(G.length-2,G.length);return 0==w?"0.00":(0==H.length&&(H="0"),2>O.length&&
(O+="0"),A&&0<w?H="+"+H:0>w&&(H="-"+H),G=H+"."+O,G)};this.compile=function(w,A,G){var H=0;switch(A=Math.floor(A),typeof w){case "number":H=w;break;case "function":H=w();break;case "string":for(var O=!1,ia=1,T=0,R="";T<w.length;){var Y=w.charAt(T);"."===Y?(R+=Y,O=!0):"+"===Y?(R=O?Number(R)*A:Number(R)*G,R*=ia,ia=1,H+=R,O=!1,R=""):"-"===Y?(R=O?Number(R)*A:Number(R)*G,R*=ia,ia=-1,H+=R,O=!1,R=""):"p"===Y?(R=Number(R),R*=ia,H+=R,R=""):T===w.length-1?(R+=Y,R=O?Number(R)*A:Number(R)*G,R*=ia,H+=R,R=""):R+=
Y;T++}}return H};this.textinput=function(w,A,G,H,O,ia,T){var R=a.compile(A,a.width,a.col),Y=a.compile(G,a.height,a.row),la=a.compile(H,a.width,a.col),ka=a.compile(O,a.height,a.row),oa=a.style;if(L)a.text("> "+T.value,R,Y+ka/2);else{(T=document.createElement("input")).type="text";T.id=ia;T.name=ia;T.value=w;T.style.position="fixed";T.style.top=Y+"px";T.style.left=R+"px";T.style.width=la+"px";T.style.height=ka+"px";T.style.paddingLeft="12px";T.style.fontSize="14px";T.style.zIndex=9999;T.style.opacity=
0;T.maxlength=10;a.text("> "+T.value,R,Y+ka/2);document.body.appendChild(T);window.setTimeout(function(){T.focus();T.select()},200);T.oninput=function(){ca()};T.onfocusout=function(){ca()};T.onfocusin=function(){ca()};T.onclick=function(){ca()};var ca=function(ea){a["delete"](R,Y,la,ka);a.text("> "+T.value,R,Y+ka/2);a.text("_",T.selectionStart*a.col+2*a.col+R,Y+ka/2)};M.push(function(){a.style=oa;a.textinput(T.value,A,G,H,O,ia,T)})}};this.link=function(w,A,G,H,O,ia,T,R){var Y=a.compile(A,a.width,
a.col)*a.scale,la=a.compile(G,a.height,a.row)*a.scale,ka=a.compile(H,a.width,a.col)*a.scale,oa=a.compile(O,a.height,a.row)*a.scale,ca=a.style;L||M.push(function(){return new function(){a.style=ca;ea.style.left=Y+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";a.print(w,Y,la)}});var ea=document.createElement("a");ea.href=ia;ea.style.left=Y+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";ea.style.display="block";ea.style.zIndex=400;ea.style.position=
"fixed";ea.target="_blank";ea.id=ia;document.body.appendChild(ea);da.push(ea);L=!0;a.print(w,Y,la);L=!1};this.time=function(w){return(w/100).toFixed(2)};this.typewrite=function(w){a.clear();for(var A={$jscomp$loop$prop$e$136$169:0};A.$jscomp$loop$prop$e$136$169<w.length;A={$jscomp$loop$prop$e$136$169:A.$jscomp$loop$prop$e$136$169},A.$jscomp$loop$prop$e$136$169++){var G=(A.$jscomp$loop$prop$e$136$169,0);G=Math.floor(A.$jscomp$loop$prop$e$136$169%32);var H=Math.floor(A.$jscomp$loop$prop$e$136$169/32);
G=32+G%32*8;H=32+16*H;window.setTimeout(function(O){return function(){b.text(w.charAt(O.$jscomp$loop$prop$e$136$169),G,H)}}(A),50*A.$jscomp$loop$prop$e$136$169)}}}function vb(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return J};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=
new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=[];this.IMPORT_BUFFER=[];this.FRAME=0;var g=[],k=0;this.TIMESTEP=Ha;var h=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var t=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),
u=!1,r=!1,z=!1,c=!1,f=!0,l=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var e=0,p=0,J=0,L=0,M=!1,da=!1,S=0,w=0;this.DT=function(){return 1};var A={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},G=0,H=0,O=0;G=.004;H=.985-.98;O=.08-.06;var ia,T,R,Y=6,la,ka=0,oa=0,ca=0,ea=new THREE.Vector3(0,1,0),Oa=new THREE.Vector3(0,0,0),Pa=new THREE.Vector3,q=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var n=new THREE.Vector3(0,0,1),m=new THREE.Vector3(0,0,1),C=new THREE.Vector3(0,0,
1),B=new THREE.Vector3(0,0,1),y=new THREE.Vector3(0,0,-.008),Q=new THREE.Vector3,F=new THREE.Vector3,K=new THREE.Vector3,I=new THREE.Vector3;this.position=Q.clone();this.direction=ea.clone();this.lookAt=Q.clone();this.normal=m.clone();this.rotation=0;var P=[],V=new THREE.Vector3(0,0,1),W=new THREE.Raycaster(I,V,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]=
{distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var ta=[{name:"logistics crate",geometry:function(){return Sa.logistics_crate()}},{name:"ag-86",geometry:function(){return Sa.ag_86()}}];this.models=function(){return ta};this.PAINT=0;var Ba=new THREE.MeshBasicMaterial({color:Ja[a.PAINT]}),qa=(new THREE.LineSegments(ta[a.MODEL].geometry(),
Ba)).clone();qa.name="Vehicle";var Wa=new Sa.emitter;this.connect=function(E,X){qa.copy(new THREE.LineSegments(ta[a.MODEL].geometry(),Ba));qa.name="Vehicle";qa.geometry.computeBoundingSphere();K.copy(E);K.z+=2;qa.position.copy(K);fa.add(qa);Wa.connect(Ja[a.PAINT]);a.tune.power();a.tune.drag();a.tune.sensitivity();a.tune.ease();fa.fog=new THREE.FogExp2(Z[0],.005);ba.fov=90;ba.updateProjectionMatrix();fa.add(N.generate.stars);a.START_POSITION.copy(K);a.START_NORMAL.copy(m);a.START_DIRECTION.copy(ea);
a.START_VELOCITY.copy(Pa);uas.TARGETS.length<aa.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);fa.remove(qa);Wa.disconnect();fa.fog=new THREE.FogExp2(Z[0],0);fa.remove(N.generate.stars);this.DISCONNECT=!1};this.ready=function(E){E=void 0===E?window.performance.now():E;var X;!u&&!this.REPLAY||this.RESET||(N.generate.checkpoints[0].display.material.color=Z[4],uas.reset(),w=1,M=!1,da=
!1,f=!0,na.reset(),L=E,e=0,k=0,this.FRAME=0,g[k].time=0,g=[],g.length=0,k=0,g.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],X={time:0,position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),lookAt:B.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(X),
a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,X={},Object.assign(X,g[k]),a.PHYSICSBUFFER.push(X),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(E){E=void 0===E?!1:E;a.REPLAY=E;a.RESET=!0;va=!E;this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;l=La=this.END=this.START=!1;D.UP=!1;D.DOWN=!1;D.LEFT=!1;c=z=r=u=D.RIGHT=!1;w=J=S=0;Q.copy(a.START_POSITION);F.copy(Q);ea.copy(a.START_DIRECTION);Pa.copy(a.START_VELOCITY);m.copy(a.START_NORMAL);I.copy(Q);this.position=Q.clone();
this.direction=ea.clone();this.lookAt=Q.clone();this.normal=m.clone();la=ca=ka=oa=this.rotation=0;a.SPEED=0;V.copy(a.START_NORMAL);V.normalize();W.far=V.length();W.set(a.START_POSITION,V);C.copy(a.START_NORMAL);B.copy(a.START_NORMAL);B.add(a.START_POSITION);ba.updateProjectionMatrix();l=!0;Wa.reset();na.reset();uas.reset();g=[];L=k=0;this.IMPORT||(L=window.performance.now());for(E=0;E<N.generate.checkpoints.length;E++)N.generate.checkpoints[E].display.material.color=Z[5];if(g[0]={time:0,position:this.START_POSITION.clone(),
normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY)for(this.DEBUG_BUFFER=[],e=0,a.best=a.overwrite(a.CHECKPOINT,a.best),N.best=a.overwrite(a.CHECKPOINT,N.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,a.inputs=[],a.inputs.push({key:0,time:0}),a.PHYSICSBUFFER=[],E={},Object.assign(E,g[k]),a.PHYSICSBUFFER.push(E),E=0;E<aa.length;E++)aa[E].reset();this.VALIDATE_CHECKPOINT=[];this.VALIDATE_CHECKPOINT.length=
6;t.position.copy(a.START_POSITION);t.lookAt(B);qa.lookAt(B);t.rotateOnAxis(n,0);da=M=!1;f=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(E){E=void 0===E?window.performance.now():E;La||a.END||!l||a.REPLAY||a.RESET?(u=!1,r=!1,z=!1,c=!1):(u=D.UP,r=D.DOWN,z=D.LEFT,c=D.RIGHT,z&&c&&(z=!1,c=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?E+99999-L:E-L;E=0;if(this.TIMESTAMP>g[k].time){var X={};Object.assign(X,g[k]);var ha=X.time;g=[];k=0;for(g.push({time:ha,position:X.position.clone(),
normal:X.normal.clone(),direction:X.direction.clone(),velocity:X.velocity.clone(),rotation:X.rotation,step:X.step,U:X.U,D:X.D,L:X.L,R:X.R});ha<this.TIMESTAMP;){var ra;ha+=Ha;this.REPLAY&&this.START&&(E=this.tapeReplay(ha));g.push({time:ha,position:g[k].position.clone(),normal:g[k].normal.clone(),direction:g[k].direction.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,step:g[k].step,U:u,D:r,L:z,R:c});k=g.length-1;a.START&&(Ga=wa=void 0,Ga=z&&c?0:z?1:c?-1:0,ca=g[k].step,0!=Ga&&Math.abs(ca)<
Y?ca+=Ga:Math.abs(ca)>Y?(wa=ca/Math.abs(ca),ca=Y*wa):0<Math.abs(ca)&&(wa=ca/Math.abs(ca),ca-=ca/Math.abs(ca),ca/Math.abs(ca)!=wa&&(ca=0)),ka=ca/Y*R,g[k].rotation+=ka,g[k].step=ca,la=g[k].velocity.length(),wa=void 0,u&&f&&(Oa.copy(g[k].direction),Oa.multiplyScalar(ia),g[k].velocity.add(Oa)),r&&f&&g[k].velocity.multiplyScalar(.95),f?(da=!1,wa=M?T-.01:T,g[k].velocity.multiplyScalar(wa)):f||(da?g[k].velocity.add(y):da=!0,g[k].velocity.multiplyScalar(.998)),g[k].position.add(g[k].velocity),t.position.copy(g[k].position),
function(){P=[];I.copy(g[k].position);I.z-=50;V.set(0,0,1);W.far=100;W.set(I,V);N.surface.raycast(W,P);0<P.length?(I.copy(P[0].point),M=g[k].position.z<I.z&&5>Math.abs(g[k].position.z-I.z)?(p=0,f=!0,m.copy(P[0].face.normal),g[k].position.copy(I),1!==P[0].face.color.r):f=!1):0===P.length&&(f=!1,M=!1,u||r||z||c||a.REPLAY||(p+=Ha),1E3<p&&!a.END&&!La&&(La=!0,U.dnf()));var ua=da?.001:.25;C.copy(g[k].normal);C.lerp(m,ua);ua=C.clone();ua.add(g[k].position);g[k].normal=C.clone();t.lookAt(ua);t.rotateOnAxis(n,
g[k].rotation);ea.copy(t.localToWorld(q.clone()));ea.sub(g[k].position);ea.normalize();g[k].direction.copy(ea)}(),function(){P=[];V.copy(g[k].position);V.sub(g[k-1].position);V.normalize();W.far=V.length();W.set(g[k].position,V);for(var ua=0,xa=!1,za=w;5>za;za++)if(N.generate.checkpoints[za].collision.raycast(W,P),0<P.length){ua=za;xa=!0;break}if(xa){za=g[k].position;xa=P[0].point;var Ka=g[k-1].position.distanceTo(xa);xa=za.distanceTo(xa);xa=g[k-1].time+Ka/(Ka+xa)*a.TIMESTEP;N.generate.checkpoints[ua].display.material.color=
Z[4];a.CHECKPOINT[ua]=Math.floor(xa/10);xa=w!==ua;a.CHECKPOINT[5]=0;for(za=1;za<ua;za++)void 0===a.CHECKPOINT[za]&&--a.CHECKPOINT[5];w=ua+1;4<=ua&&!a.REPLAY?(a.END=!0,a.REPLAY||U.complete()):a.REPLAY||a.IMPORT||U.checkpoint(xa)}a.SPEED=Math.round(60*la/1E3*3600);a.START&&!a.END&&(e=Math.floor(g[k].time/10));a.OBJECTIVE=w;F.copy(Q)}());this.FRAME++;this.START&&!this.REPLAY?(ra={},Object.assign(ra,g[k]),this.PHYSICSBUFFER.push(ra)):this.REPLAY&&E<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&
(ra={time:g[k].time,position:g[k].position.clone(),direction:g[k].direction.clone(),normal:g[k].normal.clone(),velocity:g[k].velocity.clone(),rotation:g[k].rotation,U:g[k].U,D:g[k].D,L:g[k].L,R:g[k].R,step:g[k].step,lookAt:B.clone()},a.DEBUG_BUFFER.push(ra))}}var wa,Ga;if(h=(Ha-(g[k].time-this.TIMESTAMP))/Ha,1<g.length)this.position.copy(g[k-1].position),this.position.lerp(g[k].position,h),this.direction.copy(g[k-1].direction),this.direction.lerp(g[k].direction,h),this.rotation=g[k].rotation,this.rotation-=
g[k-1].rotation,this.rotation*=h,this.rotation+=g[k].rotation,this.lookAt.copy(this.position),this.normal.copy(g[k-1].normal),this.normal.lerp(g[k].normal,h),this.lookAt.copy(g[k].position),this.normal.copy(g[k].normal),ra=this.normal.clone(),ra.add(this.position),qa.position.copy(this.position),qa.lookAt(ra),qa.rotateOnAxis(n,this.rotation),Wa.update(u,this.position,this.direction,la);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:S,
yen:0}};this.AT=function(){return e};this.convert=function(E){for(var X=[],ha=0;ha<E.length;ha++){var ra=E[ha].U,wa=E[ha].D,Ga=E[ha].L,ua=E[ha].R,xa=ra&&wa&&Ga,za=ra&&wa&&ua,Ka=0;xa||za?xa?Ka="a":za&&(Ka="b"):(Ka+=ra?3:wa?6:0,Ka+=Ga?1:ua?2:0);X.push(Ka.toString())}return X};this.replay=function(E){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),va=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(E,X){void 0===E||E?(a.SAVE_PARAM.power=
X.power,a.SAVE_PARAM.drag=X.drag,a.SAVE_PARAM.sensitivity=X.sensitivity,a.SAVE_PARAM.model=X.model,a.SAVE_PARAM.paint=X.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var E=aa.length+" / "+U.BATTLE.length;0===aa.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,
a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);aa.length<U.BATTLE.length?(U.scan(E,!1),this.reset(),a.PAINT=U.BATTLE[aa.length].param.paint,a.MODEL=U.BATTLE[aa.length].param.model,a.paint(),a.body(),a.tune.power(U.BATTLE[aa.length].param.power),a.tune.drag(U.BATTLE[aa.length].param.drag),a.tune.sensitivity(U.BATTLE[aa.length].param.sensitivity),a.INPUTS=U.BATTLE[aa.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(g[k].time=0,this.IMPORT=!1,Aa?(this.RESET=
!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),U.replay("import"),this.INPUTS=[]):(this.reset(!1),U.play()),a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(E){E=void 0===E?A.power:E;A.power=0>E?0:5<E?5:E;ia=.016+A.power/5*G},drag:function(E){E=void 0===E?A.drag:E;A.drag=0>E?0:5<E?5:E;T=.985-A.drag/5*H},sensitivity:function(E){E=
void 0===E?A.sensitivity:E;A.sensitivity=0>E?0:5<E?5:E;R=.06+A.sensitivity/5*O},ease:function(E){E=void 0===E?A.ease:E;A.ease=0>E?0:5<E?5:E;Y=6+A.ease}};this.param=function(){return array=Object.assign(A,[]),array.model=a.MODEL,array.paint=a.PAINT,array};this.paint=function(E){E=void 0===E?a.PAINT:E;a.PAINT=E;Wa.paint(Ja[E]);Ba.color.set(Ja[E]);Ba.needsUpdate=!0};this.body=function(){qa.geometry.dispose();qa.geometry=ta[a.MODEL].geometry().clone();qa.geometry.verticesNeedUpdate=!0};this.yen=function(){return U.cSave("YEN",
0),0};this.debug=function(){console.log("position:",Q);console.log("direction:",ea);console.log("rotation:",oa);console.log("dt:",1);console.log("TIME:",Ua);console.log("INTERPOLATION:",h);console.log("PHYSICS MESH:",t.rotation);console.log("EASE",Y);console.log(g);console.log(p);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",g[k]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(E){var X=0;if(0==a.INPUTS.length)X=
0;else if(E<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[X].time<E;)X++;u=this.INPUTS[X].U;r=this.INPUTS[X].D;z=this.INPUTS[X].L;c=this.INPUTS[X].R}else if(this.IMPORT){E=!0;for(var ha="",ra=1;ra<this.CHECKPOINT.length;ra++)this.CHECKPOINT[ra]!==U.BATTLE[aa.length].cp[ra]&&(""===ha&&(ha+="checkpoint_discrepancy"),E=!1);if(a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==U.BATTLE[aa.length].time&&(E=!1,ha+="final_time_discrepancy"),E){E=[];for(ha=0;ha<this.DEBUG_BUFFER.length;ha++)E.push({time:this.DEBUG_BUFFER[ha].time,
position:this.DEBUG_BUFFER[ha].position.clone(),direction:this.DEBUG_BUFFER[ha].direction.clone(),rotation:this.DEBUG_BUFFER[ha].rotation,normal:this.DEBUG_BUFFER[ha].normal.clone(),lookAt:this.DEBUG_BUFFER[ha].lookAt.clone(),U:this.DEBUG_BUFFER[ha].U});aa.push(new jb(E,this.MODEL,this.PAINT,this.CHECKPOINT.slice()))}else firebase.analytics().logEvent("invalid_data",{seed:N.name,uid:U.BATTLE[aa.length].uid,name:U.BATTLE[aa.length].name,report:N.name+"/"+U.BATTLE[aa.length].uid+"("+U.BATTLE[aa.length].name+
")"+ha+" : "+ma+"/("+ja+")",error:ha}),U.BATTLE.splice(aa.length,1);this["import"]()}else a.replay(!1),this.START=this.IMPORT=!1;return X};this.overwrite=function(E,X,ha){ha=void 0===ha?!0:ha;var ra=E[4]+1E3*E[5]<X[4]*X[5]*1E3,wa=E[5]>X[5],Ga=void 0!==E[4];return(0===X.length||ra||wa)&&Ga?!ha||E:!!ha&&X};this.decode=function(E){var X=[function(){D.UP=!1;D.DOWN=!1;D.LEFT=!1;D.RIGHT=!1},function(){D.UP=!1;D.DOWN=!1;D.LEFT=!0;D.RIGHT=!1},function(){D.UP=!1;D.DOWN=!1;D.LEFT=!1;D.RIGHT=!0},function(){D.UP=
!0;D.DOWN=!1;D.LEFT=!1;D.RIGHT=!1},function(){D.UP=!0;D.DOWN=!1;D.LEFT=!0;D.RIGHT=!1},function(){D.UP=!0;D.DOWN=!1;D.LEFT=!1;D.RIGHT=!0},function(){D.UP=!1;D.DOWN=!0;D.LEFT=!1;D.RIGHT=!1},function(){D.UP=!1;D.DOWN=!0;D.LEFT=!0;D.RIGHT=!1},function(){D.UP=!1;D.DOWN=!0;D.LEFT=!1;D.RIGHT=!0},function(){D.UP=!0;D.DOWN=!0;D.LEFT=!1;D.RIGHT=!1}];X.a=function(){D.UP=!0;D.DOWN=!0;D.LEFT=!0;D.RIGHT=!1};X.b=function(){D.UP=!0;D.DOWN=!0;D.LEFT=!1;D.RIGHT=!0};X[E]()};this.audit=function(){}}function wb(a){var g=
this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return g.tape[k].timer};this.DT=ib();var k=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(h){this.keybuffer.push({key:(D.UP?3:D.DOWN?6:0)+(D.LEFT?1:D.RIGHT?2:0),time:h})};this.simulate=function(){};this.capture=function(h){return{position:(new THREE.Vector3).copy(h.position),normal:(new THREE.Vector3).copy(h.normal),lookTarget:h.lookTarget.clone(),rotation:h.rotation,timer:h.getTime(),objective:h.getObjective(),
check:h.check,UP:h.UP}};this.record=function(h){g.tape[k]=h.record();k=24E4<g.tape[k].TS?0:k+1};this.play=function(h){if(this.RECORD){this.RECORD=!1;for(var t=g.frame=0;t<aa.length;t++)aa[t].reset();na.reset()}if(g.frame>g.tape.length-10){g.frame=0;na.reset();for(t=0;t<aa.length;t++)aa[t].reset();N.generate.resetCheckpoints()}if(h.replay(),this.tape[g.frame].check)N.generate.checkpoints[0===this.tape[g.frame].objective?4:this.tape[g.frame].objective-1].display.material.color=Z[4]};this.reset=function(){N.generate.resetCheckpoints();
k=0;g.frame=0;na.reset();g.PLAY=!1;g.RECORD=!0;g.tape=[]};this["export"]=function(h,t){h=void 0===h?function(){U.results()}:h;var u=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((u<Ma||!1===Ma)&&""!==ja&&null!==ja&&!1!==ma&&void 0!==ma&&!g.SCAN){U.STATE=function(){b.clear();b.print("uploading vhs to db","2","2")};U.STATE();ma;for(var r=N.name,z=x.CHECKPOINT.slice(),c=x.CHECKPOINT[0],f=x.param(),l=[];l.length<x.PHYSICSBUFFER.length;){var e=l.length;e={time:x.PHYSICSBUFFER[e].time,U:x.PHYSICSBUFFER[e].U,D:x.PHYSICSBUFFER[e].D,
L:x.PHYSICSBUFFER[e].L,R:x.PHYSICSBUFFER[e].R};l.push(e)}f={version:"006",id:ma,seed:r,time:u,cp:z,utc:c,debug:l,param:f};firebase.database().ref("vhs/006/"+f.seed+"/"+ma).set(f,function(p){p?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2","2"));window.setTimeout(h,1E3);uas.replay();x.replay()})}else void 0===ma||!1===ma||null===ja||""===ja||void 0===ja?U.register():(U.results(),uas.replay(),x.replay())};this.burn=function(h){return Math.round(1E9*h).toString(16)};
this.read=function(h){return parseInt(h,16)/1E9};this.scan=function(h,t){g.SCAN=!0;var u=[];firebase.database().ref("vhs/006/"+h).orderByChild("time").limitToFirst(99).once("value").then(function(r){r.forEach(function(z){var c=z.child("id").val(),f=z.child("time").val();z=z.child("utc").val();u.push({uid:c,time:f,utc:z})});g.SCAN=!1;t(u)})};this.checkTime=function(h,t,u){h===t&&(Ma=u)};this.requestName=function(h,t){firebase.database().ref("uid/"+h).once("value").then(function(u){u=u.child("name").val();
return t(u),u})};this["import"]=function(h,t){t=void 0===t?function(){}:t;firebase.database().ref("vhs/006/"+h).once("value").then(function(u){var r=u.val(),z=r.id,c=r.seed,f=r.cp.slice();u=r.utc;r.model;r.paint;r.param;t({uid:z,seed:c,cp:f,utc:u,debug:r.debug.slice(),param:r.param})})};this.save=function(h,t){t=void 0===t?1E3/30:t;for(var u=0,r=[],z=h[h.length-1].TS,c=0;c<z;)c+=t,c<z&&r.push({TS:c});for(z=0;z<r.length;z++)u=g.convert(h,r[z],u);return r};this.convert=function(h,t,u){for(var r=h[u].time,
z=h[u+1].TS,c=z-r;t.time>z&&u<h.length-2;)r=h[++u].time,z=h[u+1].time,c=z-r;r=u;var f=u+1;z=(c-(z-t.time))/c;return t.position=new THREE.Vector3,t.position.copy(h[r].position),t.position.lerp(h[f].position,z),t.lookTarget=new THREE.Vector3,t.lookTarget.copy(h[r].normal),t.lookTarget.lerp(h[f].normal,z),t.rotation=(h[f].rotation-h[r].rotation)*z,t.rotation+=h[r].rotation,t.rotation=(h[f].rotation-h[r].rotation)*z,t.rotation+=h[r].rotation,t.AT=(h[f].AT-h[r].AT)*z,t.AT+=h[r].AT,t.UP=h[r].UP,t.check=
h[r].check,t.objective=h[r].objective,u}}var jb=function(a,g,k,h){k=void 0===k?0:k;h=void 0===h?[]:h;var t=[];this.inputs=[];t[0]={name:"logistics crate",geometry:function(){return Sa.logistics_crate()}};t[1]={name:"ag-86",geometry:function(){return Sa.ag_86()}};var u=void 0===g?0:g;g=k;var r=a.slice();this.PHYSICS=r;var z=0,c=new THREE.Vector3(0,0,1);r[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;
this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var f=t[u].geometry(),l=new THREE.MeshBasicMaterial({color:Ja[g]}),e=new THREE.LineSegments(f,l);e.name="ghost_"+aa.length;e.position.copy(r[0].position);fa.add(e);var p=new Sa.emitter;p.connect(Ja[k]);a=h.slice();(a[4]<N.best[4]||null==N.best[4])&&(N.best=a.slice());uas.TARGETS.push(this);Aa&&(uas.TARGET=1);this.reset=function(){na.reset();p.reset();z=0};this.update=function(J,
L){this.index(J);var M=(1E3/60-(r[z].time-J))/(1E3/60),da=r[z].U;0!==z&&0!==J||(z=1,M=0,da=!1);var S=this.normal.clone();S.add(this.position);e.position.copy(this.position);e.lookAt(S);e.rotateOnAxis(c,this.rotation);this.interpolate(M);this.lookAt.copy(this.position);this.velocity.copy(r[z].position);this.velocity.sub(r[z-1].position);p.update(da,this.position,this.direction,this.velocity.length())};this.interpolate=function(J){this.direction.copy(r[z-1].direction);this.direction.lerp(r[z].direction,
J);this.position.copy(r[z-1].position);this.position.lerp(r[z].position,J);this.normal.copy(r[z-1].normal);this.normal.lerp(r[z].normal,J);this.rotation=r[z].rotation;this.rotation-=r[z-1].rotation;this.rotation*=J;this.rotation+=r[z].rotation};this.discrete=function(){this.position.copy(r[z].position);this.rotation=r[z].rotation;this.normal.copy(r[z].normal)};this.index=function(J){if(z=0,J<=r[r.length-2].time)for(;r[z].time<=J;)z++;else z=r.length-2};this.toggleEmitter=function(J){void 0===J||J?
p.connect():p.disconnect()};this.disconnect=function(){fa.remove(e);f.dispose();l.dispose();p.disconnect()};this.debug=function(){console.log(r)}};window.onload=function(){window.addEventListener("touchstart",gb);window.addEventListener("contextmenu",function(){event.preventDefault()});fa=new THREE.Scene;fa.background=kb;lb=new THREE.Vector3(0,0,1);ba=new THREE.PerspectiveCamera;ba.up=lb;ba.position.z=2E3;ba.lookAt(0,0,0);ba.fov=70;ba.near=1E-5;ba.far=3E3;ba.name="Camera";fa.add(ba);ya=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,
antialias:!1,precision:"highp"});ya.setClearColor(kb);ya.domElement.id="renderer";ya.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(ya.domElement);D=new nb;D.connect();b=new ub;N=new pb;x=new vb;sa=new wb;U=new rb;U.login();U.checksave();U.decodeURL();uas=new mb;uas.connect();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,"#eeeeee");ba.position.set(0,25,10);ba.lookAt(0,0,0);Ia();hb();U.intro()}};window.onresize=
Ia;window.fullscreenchange=Ia;window.focus=Ia;var fb="development mountain;haunted forest;sheep pass;pine forest;shinigami graveyard;tofu route;ego mountain;lotus mountain;prey first pass;ginko mountain;ghxst pass;ghxstly forest;sleeping forest;do it pass;mew mountain;ultra mountain;vr pass;ratty mountain;coffee forest;r3 mountain;low tunnel pass;ogj route;lyla forest;the lotus order;deadmans wonderland;zynra mountain;nephil pass;r3evaluate pass;coen mountain;hoekage mountain;tora tora pass;tora forest;olive forest;kae mountain;rex mountain;coyote forest;jaywalk pass;wasabi mountain".split(";"),
Z=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],cb;for(cb in Z){var xb=new THREE.Color(Z[cb]);Z[cb]=xb}var Ja=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],sb="snow sakura melon peach bumblebee lavender ice".split(" "),Ma=!1,Ta="",Qa=Math.floor(2147483647*Math.random()),eb="",fa,ba,ya,N,x,D,b,sa,U,aa=[],Ha=1E3/60,Ca=12,Xa=9,Da=0,Ya=!0,bb=!1,ab=!1,ma=null,ja="",lb,va=!1,kb=Z[0],qb=0,La=!1,Ra=!1,pa=!1,$a=!1,Fa=!1,Na=
!0,Ua=0,Va=!1,Za=!1,Aa=!1,Ea=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var Sa={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,
-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=
this;this.maxLife=100;for(var g=0,k=new THREE.Geometry;k.vertices.length<a.maxLife;){var h=new THREE.Vector3(0,0,0);h.life=0;h.maxLife=a.maxLife;h.acc=new THREE.Vector3(0,0,0);k.vertices.push(h);h=new THREE.Color(4294967040);k.colors.push(h)}k.verticesNeedUpdate=!0;var t=new THREE.Points(k,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));t.name="Emitter";var u=new THREE.Color;a.connect=function(r){r=void 0===r?16777215:r;fa.add(t);
a.paint(r)};a.paint=function(r){r=new THREE.Color(void 0===r?16777215:r);u=new THREE.Color;r.getHSL(u);for(r=0;r<t.geometry.vertices.length;r++)t.geometry.colors[r].setHSL(u.h,u.s,0),t.geometry.vertices[r].life=0};a.reset=function(){for(var r=0;r<t.geometry.colors.length;r++)t.geometry.colors[r].setHSL(u.h,u.s,0),t.geometry.vertices[r].life=0};a.disconnect=function(){fa.remove(t);t.geometry.dispose();t.material.dispose()};a.update=function(r,z,c,f){if(r)for(r=0;1>r;){t.geometry.vertices[g].copy(c);
t.geometry.vertices[g].multiplyScalar(-1-Math.random()*f);t.geometry.vertices[g].add(z);t.geometry.vertices[g].life=t.geometry.vertices[g].maxLife;Math.random();Math.random();Math.random();var l=.1*-Math.random();t.geometry.vertices[g].acc.copy(c);t.geometry.vertices[g].acc.multiplyScalar(l);g++;g%=t.geometry.vertices.length;r++}for(var e in t.geometry.vertices){var p;0<t.geometry.vertices[e].life&&(t.geometry.vertices[e].add(t.geometry.vertices[e].acc),--t.geometry.vertices[e].life,p=t.geometry.vertices[e].life/
100,t.geometry.colors[e].setHSL(u.h,u.s,u.l*p));0>=t.geometry.vertices[e].life&&(t.geometry.vertices[e].set(0,0,0),t.geometry.vertices[g].acc.x=0,t.geometry.vertices[g].acc.y=0,t.geometry.vertices[g].acc.z=0)}t.geometry.verticesNeedUpdate=!0;t.geometry.colorsNeedUpdate=!0;t.geometry.computeBoundingSphere()}}},ob=function(){function a(u){return u*u*u*(u*(6*u-15)+10)}function g(u,r,z){return r+u*(z-r)}function k(u,r,z,c){var f=15&u;u=8>f?r:z;c=4>f?z:12==f||14==f?r:c;return(0==(1&f)?u:-u)+(0==(2&f)?
c:-c)}for(var h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,
118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;256>t;t++)h[256+t]=h[t];return{noise:function(u,r,z){var c=Math.floor(u),
f=Math.floor(r),l=Math.floor(z),e=255&c,p=255&f,J=255&l,L=(u-=c)-1,M=(r-=f)-1,da=(z-=l)-1,S=a(u),w=a(r);c=a(z);f=h[e]+p;l=h[f]+J;f=h[f+1]+J;e=h[1+e]+p;p=h[e]+J;J=h[e+1]+J;return g(c,g(w,g(S,k(h[l],u,r,z),k(h[p],L,r,z)),g(S,k(h[f],u,M,z),k(h[J],L,M,z))),g(w,g(S,k(h[l+1],u,r,da),k(h[p+1],L,r,z-1)),g(S,k(h[f+1],u,M,da),k(h[J+1],L,M,da))))}}},tb=function(a,g){for(var k="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61".split(" "),
h="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),t=a.toLowerCase(),u=0;u<t.length;u++){var r=t.charCodeAt(u);if(122<r||57<r&&61>r||33>r||40==r||41==r)return"";r="";for(var z=u;z<t.length;z++){t.charAt(z);var c=t.charCodeAt(z);(48<=c&&57>=c||97<=c&&122>=c)&&(r+=c.toString(16));for(c=0;c<k.length;c++){for(var f="",l="",e=[],p=0,J=0,L=0;L<k[c].length;L+=2){var M=r.charAt(L+p)+r.charAt(L+1+p),da=k[c].charAt(L)+k[c].charAt(L+1);if((M===f||M===l)&&0!==M.length&&(J++,
0<J))for(;M===f||M===l;)p+=2,M=r.charAt(L+p)+r.charAt(L+1+p);if(M===da)e[L/2]=!0,f=M,l=da;else{e[L/2]=!1;for(var S=0;S<h.length;S++){var w=h[S].charCodeAt(1).toString(16),A=h[S].charCodeAt(0).toString(16);M===w&&(A===da?(e[L/2]=!0,f=w,l=da):A!==f&&A!==l||(J++,0<J&&(p+=2,L-=2)))}!1===e[L/2]&&(L=k[c].length)}}for(l=f=0;l<e.length;l++)if(!0===e[l]&&f++,f===e.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();
na.time=0;na.last=0;na.timestep=1E3/60;na.dt=1}},ib=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var g="[\n",k=0;k<a.length;k++){g+="'";for(var h=0;h<a[k].length;h++)g+=a[k].charCodeAt(h).toString(16);g+="',\n"}return g+="]",console.log(g),g}})();