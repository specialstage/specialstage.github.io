(function(){function ob(){var a=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var g="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",
a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;
ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,!1)};this.key=function(l){var h="keydown"==l.type;switch(h||(g+=l.key),3<g.length&&(g=g.slice(1,4)),l.key){case "ArrowUp":a.UP=h;break;case "ArrowDown":a.DOWN=h;break;case "ArrowLeft":a.LEFT=h;break;case "ArrowRight":a.RIGHT=h;break;case "w":a.UP=h;break;case "s":a.DOWN=h;break;case "a":a.LEFT=h;break;case "d":a.RIGHT=h;break;case "r":a.RESET=h;break;case " ":a.SPACE=h;break;case "Shift":a.SHIFT=h;break;case "1":uas.CAM=
1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "Enter":a.ENTER=h;break;case "Control":a.CTRL=h;break;case "Escape":case "Backspace":a.ESC=h;break;case "=":a.ZOOM_IN=h;break;case "-":a.ZOOM_OUT=h;break;case "t":a.TARGET=h;break;case "h":a.HIDE=h;break;case ">":!h&&2>Fa&&(Fa+=.5);Ia();break;case "<":!h&&.5<Fa&&(Fa-=.5),Ia()}!x.REPLAY||qa||ya||"vhs"===g&&(b.print("code detected: ghost data overwrite","2","2"),window.setTimeout(sa["export"],1E3,R.results,!1),g=
"")};this.mousedown=function(l){l.preventDefault();a.touches[0]={x:l.clientX,y:l.clientY,start:!0}};this.mouseup=function(l){l.preventDefault();a.touches[0]={x:l.clientX,y:l.clientY,start:!1}};this.touchSetup=function(l){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",
a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",a.touchend,!1);a.touchstart(l)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(l){l=l.touches;a.touches=[];for(var h=0;h<l.length;h++)a.touches[h]={x:l[h].clientX,y:l[h].clientY,start:!0}};this.touchmove=function(l){a.touches=[];l=l.touches;for(var h=0;h<l.length;h++)a.touches[h]=
{x:l[h].clientX,y:l[h].clientY,start:!1}};this.touchend=function(l){a.touches=[];l=l.touches;for(var h=0;h<l.length;h++)a.touches[h]={x:l[h].clientX,y:l[h].clientY,start:!1}}}function db(){var a=(scope=this).SEED=0;this.length=480;var g=[],l=0;this.BIOMES=g;this.BIOME=0;g[0]={name:"pine",palette:aa[9],tree:function(q,p){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};g[0].map[0]=function(q,p){var n=aa[10],D=!1;return.92<Math.abs(q)&&(n=.92<Math.abs(q)?aa[9]:aa[2],D=
!0),g[0].flags[p]=D,n};g[1]={name:"cherry blossom",palette:aa[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};g[1].map[0]=function(q,p){var n=aa[1],D=!1;return.95<Math.abs(q)&&(n=.92<Math.abs(q)?aa[12]:aa[1],D=!0),g[1].flags[p]=D,n};g[2]={name:"ice",palette:aa[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};g[2].map[0]=function(q,p){var n=aa[7],D=!1;return.95<Math.abs(q)&&(n=.92<Math.abs(q)?aa[2]:aa[7],D=!0),g[2].flags[p]=
D,n};var h=new THREE.Points(new THREE.Geometry);h.name="Generative Extruder";h.visible=!1;var t=new THREE.Line(new THREE.Geometry);t.name="Generative Nodes";t.visible=!1;t.material.color=aa[6];t.material.name="Node Material";t.position.z+=2;var w=new THREE.LineSegments(new THREE.Geometry);w.name="Generative Segments";w.visible=!0;w.material.color=aa[3];w.material.name="Segments Material";var r=new THREE.Mesh(new THREE.Geometry);r.name="Generative Surface";r.visible=!1;r.material.color=aa[0];r.material.name=
"Surface Material";var A=new THREE.LineSegments(new THREE.Geometry);A.name="Generative Perimeter";A.material.color=aa[1];A.material.name="Perimeter Material";var c=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));c.name="Terrain";c.material.name="Terrain Material";c.material.wireframe=!0;c.material.side=THREE.DoubleSide;c.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name=
"Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var e=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));e.name="Trees";var k=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);k.name="Background";k.material.color=aa[0];k.material.name="Background Material";k.material.wireframe=!1;k.material.side=THREE.FrontSide;k.material.opacity=
.75;k.material.blendMode=THREE.MultiplyBlending;k.material.transparent=!0;var f=new THREE.Points(new THREE.Geometry);f.material.color=aa[1];f.material.sizeAttenuation=!1;f.material.size=1.5;f.material.fog=!1;scope.stars=f;var m=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);m.name="Collision Mesh";m.visible=!0;m.material.name="Collision Material";m.material.side=THREE.BackSide;this.checkpoints=[];var I=new THREE.Vector3(0,0,1),C=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,
0,1);var N=new THREE.Vector3(0,3,0),da=new THREE.Vector3(0,0,1),W=t.geometry.clone(),u=r.geometry.clone(),z=w.geometry.clone(),H=A.geometry.clone(),J=[],O=[],ia=new THREE.Vector3;J[0]=new THREE.Vector3(5,3,0);J[1]=new THREE.Vector3(-5,3,0);O[0]=J[0].clone();O.z+=1;O[1]=J[1].clone();O.z+=1;var T=Math.PI/64,S=Math.PI/32,Z=[],la=0,ka=new THREE.Vector3;this.start=new THREE.Vector3;var oa=!1,ca=!1,ea=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Pa=18,Qa=new THREE.Raycaster;Qa.far=800;h.geometry.vertices[0]=
N.clone();h.geometry.vertices[1]=I.clone().add(N);h.geometry.vertices[2]=J[0].clone();h.geometry.vertices[3]=J[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();this.connect=function(){scope.SEED=Ra;this.BIOME=l=scope.randomInt(0,3);M.SNOW=2===l;M.SNOW&&M.snow.init();fa.add(h);fa.add(t);fa.add(w);fa.add(A);fa.add(r);fa.add(wireframe);fa.add(k);la=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var q in Z=[],fa.remove(h),
fa.remove(t),fa.remove(w),fa.remove(A),fa.remove(r),fa.remove(wireframe),fa.remove(k),fa.remove(e),g)g[q].flag=[];for(var p in scope.checkpoints)fa.remove(scope.checkpoints[p].display),scope.checkpoints[p].display.geometry.dispose(),scope.checkpoints[p].collision.geometry.dispose()};this.complete=function(){m.geometry.mergeVertices();m.geometry.verticesNeedUpdate=!0;m.geometry.elementsNeedUpdate=!0;m.geometry.computeFaceNormals();m.geometry.computeVertexNormals();m.geometry.computeBoundingSphere();
k.geometry.copy(m.geometry);--k.position.z;for(var q=[],p=0;p<m.geometry.faces.length;p++)q[m.geometry.faces[p].a]=m.geometry.faces[p].vertexNormals[0].clone(),q[m.geometry.faces[p].b]=m.geometry.faces[p].vertexNormals[1].clone(),q[m.geometry.faces[p].c]=m.geometry.faces[p].vertexNormals[2].clone();for(p=0;p<m.geometry.vertices.length;p++)m.geometry.vertices[p].add(q[p].multiplyScalar(2));m.geometry.verticesNeedUpdate=!0;m.geometry.computeFaceNormals();m.geometry.computeVertexNormals();m.geometry.computeBoundingSphere();
wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();q=new THREE.IcosahedronGeometry(1200,10);for(var n in q.vertices).3>scope.random()&&-400<q.vertices[n].z&&f.geometry.vertices.push(q.vertices[n].clone());q.dispose();f.geometry.computeBoundingSphere();M.surface=m.clone();M.start=scope.start.clone();la=window.performance.now()-la;oa=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",
{time:Math.round(la/1E3)});Za?(b.clear(),x.connect(M.start,M.surface),x.PLAY=!1,sa.PLAY=!0):R.ready()};this.reset=function(){Pa=(36+scope.random()-.5)/2;a=0;t.geometry.dispose();w.geometry.dispose();r.geometry.dispose();h.geometry.dispose();A.geometry.dispose();c.geometry.dispose();wireframe.geometry.dispose();m.geometry.dispose();e.geometry.dispose();f.geometry.dispose();z.dispose();H.dispose();W.dispose();u.dispose();z.copy(new THREE.Geometry);H.copy(new THREE.Geometry);W.copy(new THREE.Geometry);
u.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);h.geometry.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);A.geometry.copy(new THREE.Geometry);r.geometry.copy(new THREE.Geometry);c.geometry.copy(new THREE.Geometry);m.geometry.copy(new THREE.Geometry);N.set(0,3,0);da.set(0,0,1);J[0]=new THREE.Vector3(4,3,0);J[1]=new THREE.Vector3(-4,3,0);oa&&(oa=!1,ca=!1,ea=!1);this.END=!1;h.position.set(0,0,0);h.geometry.vertices[0]=N.clone();h.geometry.vertices[1]=I.clone().add(N);h.geometry.vertices[2]=
J[0].clone();h.geometry.vertices[3]=J[1].clone();h.geometry.vertices[4]=O[0].clone();h.geometry.vertices[5]=O[1].clone();h.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(q,p,n,D,B,y,Q,E,L,K){q=void 0===q?0:q;p=void 0===p?0:p;n=void 0===n?0:n;D=void 0===D?0:D;B=void 0===B?0:B;y=void 0===y?{start:0,end:30,angle:0,slope:0}:y;Q=void 0===Q?[]:Q;E=void 0===E?[]:E;L=void 0===L?!1:L;K=void 0===K?999:K;var P=window.performance.now(),U=0;for(0===D&&(D=.5<scope.random()?
1:-1);32>U&&!ca;){if(q===y.end+1){E=[];for(n=0;1>n;n++)if(q>=scope.length)E.push({angle:0,slope:0,end:30}),K=q+30;else if(0===p){var V=scope.randomInt(2,4)*D;U=Math.floor(Math.abs(36/V));D=.01>scope.random()?+D:-1*D;U=scope.randomInt(1,U);E.push({angle:V,slope:0,end:U})}else V=scope.randomInt(-5,-1),U=scope.random(),V=2!==l&&.05>U?V*=-1:V,U=scope.randomInt(2,20),E.push({angle:0,slope:V,end:U});U=scope.randomInt(0,E.length);p=E[U].angle;n=E[U].slope;y.start=q;y.end=q+E[U].end;E=E.slice(U,1)}if(L||
(scope.extrude(p,n),Z.push({angle:p,slope:n}),W.verticesNeedUpdate=!0,q++),10<=q&&!L){U=new THREE.Vector2(W.vertices[q-1].x,W.vertices[q-1].y);for(V=0;V<W.vertices.length-1-10;V++)if(18>(new THREE.Vector2(W.vertices[V].x,W.vertices[V].y)).distanceTo(U)){L=!0;break}L&&window.setTimeout(M.reset(!0),0)}0;q===K&&(ca=!0,t.geometry.dispose(),t.geometry=W.clone(),t.geometry.computeBoundingSphere(),t.geometry.center(),t.updateMatrixWorld(),0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(W.vertices[0])),
window.setTimeout(function(){R.PATH=!0;R.STATE();scope["import"]()},0));U=window.performance.now()-P}ca||L||window.setTimeout(scope.path,0,q,p,n,D,B,y,Q,E,L,K)};this.skijump=function(q,p,n,D,B,y,Q,E,L,K,P){q=void 0===q?0:q;p=void 0===p?0:p;n=void 0===n?0:n;D=void 0===D?0:D;B=void 0===B?0:B;y=void 0===y?{start:0,end:20,angle:0,slope:0}:y;Q=void 0===Q?[]:Q;E=void 0===E?[]:E;L=void 0===L?!1:L;K=void 0===K?300:K;P=void 0===P?0:P;var U=window.performance.now(),V=0;for(0===D&&(D=.5<scope.random()?1:-1);32>
V&&!ca;){if(q===y.end+1){E=[];for(p=0;1>p;p++)0===n&&20===y.end?(P=-1,E.push({angle:0,slope:-4,end:30})):3===n?E.push({angle:0,slope:4,end:3}):4===n?E.push({angle:0,slope:-32,end:10}):-4===n?(P=1,E.push({angle:0,slope:n+1,end:1})):-32===n?E.push({angle:0,slope:-4,end:40}):1==P?E.push({angle:0,slope:n+1,end:1}):-1==P&&E.push({angle:0,slope:n-1,end:1});V=scope.randomInt(0,E.length);p=E[V].angle;n=E[V].slope;y.start=q;y.end=q+E[V].end;E=E.slice(V,1)}if(L||(scope.extrude(p,n),Z.push({angle:p,slope:n}),
W.verticesNeedUpdate=!0,q++),10<=q&&!L){V=new THREE.Vector2(W.vertices[q-1].x,W.vertices[q-1].y);for(var ta=0;ta<W.vertices.length-1-10;ta++)if(0>(new THREE.Vector2(W.vertices[ta].x,W.vertices[ta].y)).distanceTo(V)){L=!0;break}L&&window.setTimeout(M.reset(!0),0)}0;K<=q&&(ca=!0,t.geometry.dispose(),t.geometry=W.clone(),t.geometry.computeBoundingSphere(),t.geometry.center(),t.updateMatrixWorld(),0<t.geometry.vertices.length&&(ka.copy(t.geometry.vertices[0]),ka.sub(W.vertices[0])),window.setTimeout(function(){scope["import"]()},
0));V=window.performance.now()-U}ca||L||window.setTimeout(scope.skijump,0,q,p,n,D,B,y,Q,E,L,K)};this["import"]=function(q){q=void 0===q?0:q;for(var p=window.performance.now(),n=0;!ea&&32>n;){if(0===q&&(h.position.set(0,0,0),h.rotation.z=0,N.set(0,3,0),h.geometry.vertices[0]=N.clone(),h.geometry.vertices[1]=I.clone().add(N),h.geometry.vertices[2]=J[0].clone(),h.geometry.vertices[3]=J[1].clone(),h.geometry.vertices[4]=O[0].clone(),h.geometry.vertices[5]=O[1].clone(),h.geometry.verticesNeedUpdate=!0,
h.updateMatrixWorld()),q<Z.length)a=q,angle=Z[q].angle,slope=Z[q].slope,scope.extrude(angle,slope),w.geometry.dispose(),w.geometry=z.clone(),w.geometry.computeBoundingSphere(),A.geometry.dispose(),A.geometry=H.clone(),A.geometry.computeBoundingSphere(),r.geometry.dispose(),r.geometry=u.clone(),r.geometry.computeBoundingSphere(),q++;else if(!ea&&q===Z.length){for(var D in scope.checkpoints=scope.checkpoint(),scope.checkpoints)fa.add(scope.checkpoints[D].display);ea=!0;window.setTimeout(function(){scope.terrain(!0)},
0)}n=window.performance.now()-p}ea||window.setTimeout(scope["import"],0,q,angle,slope)};this.extrude=function(q,p){q=void 0===q?0:q;p=void 0===p?0:p;for(var n in h.updateMatrixWorld(),h.rotateZ(q*S),h.geometry.vertices)h.geometry.vertices[n].applyAxisAngle(C,p*T);h.geometry.verticesNeedUpdate=!0;n=h.geometry.vertices[0].clone();var D=h.geometry.vertices[2].clone(),B=h.geometry.vertices[3].clone(),y=h.geometry.vertices[1].clone();if(n.applyMatrix4(h.matrix),D.applyMatrix4(h.matrix),B.applyMatrix4(h.matrix),
y.applyMatrix4(h.matrix),y.sub(n),ca){if(D.add(ka),B.add(ka),0<z.vertices.length){var Q=z.vertices[z.vertices.length-1].clone().sub(ia),E=z.vertices[z.vertices.length-2].clone().sub(ia);u.vertices.push(D.clone().sub(y));u.vertices.push(B.clone().sub(y));u.vertices.push(E);u.vertices.push(B.clone().sub(y));u.vertices.push(Q);u.vertices.push(E);var L=D.clone();q=B.clone();Q=z.vertices[z.vertices.length-1].clone();E=z.vertices[z.vertices.length-2].clone();m.geometry.vertices.push(L);m.geometry.vertices.push(q);
m.geometry.vertices.push(E);m.geometry.vertices.push(q);m.geometry.vertices.push(Q);m.geometry.vertices.push(E);Q=u.vertices.length;var K=new THREE.Face3(Q-3,Q-2,Q-1);L=new THREE.Face3(Q-5,Q-4,Q-6);u.faces.push(K);u.faces.push(L);K=K.clone();L=L.clone();K.color=new THREE.Color(16777215);L.color=new THREE.Color(16777215);m.geometry.faces.push(K);m.geometry.faces.push(L)}0<H.vertices.length?(K=2,L=1,4<H.vertices.length&&(K=4,L=2),K=H.vertices[H.vertices.length-K].clone(),L=H.vertices[H.vertices.length-
L].clone(),H.vertices.push(D.clone().add(y)),H.vertices.push(K.clone()),H.vertices.push(B.clone().add(y)),H.vertices.push(L.clone()),a==Z.length-1&&(E=D.clone().add(y),Q=B.clone().add(y),H.vertices.push(E),H.vertices.push(Q))):(H.vertices.push(D.clone().add(y)),H.vertices.push(B.clone().add(y)));z.vertices.push(D.clone());z.vertices.push(B.clone());ia.copy(y)}else W.vertices.push(n.clone());for(var P in N.copy(n).sub(h.position),h.position.add(N),h.geometry.vertices)h.geometry.vertices[P].applyAxisAngle(C,
-1*p*T)};this.terrain=function(q,p,n,D,B,y,Q){p=void 0===p?[]:p;n=void 0===n?[]:n;D=void 0===D?[]:D;B=void 0===B?0:B;y=void 0===y?0:y;Q=void 0===Q?0:Q;if(void 0===q||q){w.updateMatrixWorld();c.geometry.dispose();c.geometry.copy(new THREE.Geometry);p=[];n=[];D=[];for(q=0;2>q;q++)D[q]=[],p[q]=[],n[q]=[];for(q=0;q<w.geometry.vertices.length;q++)n[q%2].push(w.geometry.vertices[q]);for(q=0;2>q;q++)for(var E=0;E<n[q].length;E++){var L=0===q?1:-1,K=n[q][E].clone();K.sub(n[q+L][E]);K.normalize().multiplyScalar(3);
D[q][E]=K.clone()}}E=0;var P;q=window.performance.now();if(4>B){if(c.geometry.verticesNeedUpdate=!0,c.geometry.elementsNeedUpdate=!0,c.geometry.computeBoundingSphere(),c.geometry.computeFaceNormals(),c.geometry.computeVertexNormals(),c.updateMatrixWorld(),0<B&&0===Q)for(n[y]=[],L=0;L<p[y].length;L++)n[y][L]=c.geometry.vertices[p[y][L]];0===Q&&(p[y]=[]);for(v=Q;v<n[y].length&&32>E;){E=!1;if(void 0!==n[y][v]&&void 0!==n[y][v-1]){if(void 0===D[y][v])D[y][v]=D[s][v-1].clone();else if(c.geometry.computeBoundingSphere(),
L=n[y][v].clone().add(D[y][v]),L.z-=100,Qa.set(L,I),L.z+=100,K=Qa.intersectObjects([c],!0),0<K.length)for(var U in K).01<K[U].point.distanceTo(L)&&(p[y][v]=void 0,E=!0);E||(c.geometry.vertices.push(n[y][v].clone()),c.geometry.vertices.push(n[y][v].clone().add(D[y][v])),p[y][v]=c.geometry.vertices.length-1,0<v&&(c.geometry.vertices.push(n[y][v-1].clone()),P=c.geometry.vertices.length,0===y?c.geometry.faces.push(new THREE.Face3(P-2,P-1,P-3)):1===y&&c.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3))))}E=
window.performance.now()-q;v++;Q=v}if(Q===n[y].length){Q=0;for(P=1;P<p[y].length;P++)if(void 0!==p[y][P]&&void 0!==p[y][P-1]){U=c.geometry.vertices[p[y][P]];var V;q=c.geometry.vertices[p[y][P-1]];2.8>U.distanceTo(q)?(U.copy(q),p[y][P]=p[y][P-1],D[y][P].copy(D[y][P-1])):1<P&&(c.geometry.vertices.push(n[y][P-1]),V=0===y?p[y][P]:p[y][P-1],q=0===y?p[y][P-1]:p[y][P],c.geometry.faces.push(new THREE.Face3(V,q,c.geometry.vertices.length-1)))}y++}1<y&&(y=0,B++)}if(4===B){c.geometry.verticesNeedUpdate=!0;c.geometry.elementsNeedUpdate=
!0;c.geometry.colorsNeedUpdate=!0;c.geometry.computeFaceNormals();c.geometry.computeVertexNormals();c.geometry.mergeVertices();c.geometry.computeBoundingSphere();scope.noise(c.geometry);for(V=0;V<c.geometry.faces.length;V++)U=c.geometry.vertices[c.geometry.faces[V].a].clone(),q=c.geometry.vertices[c.geometry.faces[V].b].clone(),P=c.geometry.vertices[c.geometry.faces[V].c].clone(),c.geometry.colors[c.geometry.faces[V].a],c.geometry.colors[c.geometry.faces[V].b],c.geometry.colors[c.geometry.faces[V].c],
m.geometry.vertices.push(U),m.geometry.vertices.push(q),m.geometry.vertices.push(P),wireframe.geometry.vertices.push(U),wireframe.geometry.vertices.push(q),wireframe.geometry.vertices.push(P),P=m.geometry.vertices.length,U=new THREE.Face3(P-1,P-2,P-3),U.color=new THREE.Color(0),m.geometry.faces.push(U),wireframe.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3));wireframe.geometry.copy(c.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,
p.slice(),n.slice(),D.slice(),B,y,Q)},0)};this.biome=function(){for(var q=l,p=wireframe.geometry.faces,n=[],D=[],B=0;B<p.length;B++)for(var y=0;y<g[l].map.length;y++)p[B].vertexColors[0]=g[l].map[y](p[B].vertexNormals[0].z,p[B].a),p[B].vertexColors[1]=g[l].map[y](p[B].vertexNormals[1].z,p[B].b),p[B].vertexColors[2]=g[l].map[y](p[B].vertexNormals[2].z,p[B].c);for(p=0;p<g[l].flags.length;p++)for(B=0;B<w.geometry.vertices.length;B++).1>wireframe.geometry.vertices[p].distanceTo(w.geometry.vertices[B])&&
(g[l].flags[p]=!1);for(p=0;p<g[l].flags.length;p++)g[l].flags[p]&&n.push(p);for(p=0;p<g[l].limit&&p<n.length;){B=scope.randomInt(0,n.length);y=!0;if(0<D.length&&0<n.length)for(;y;){for(var Q in D){if(wireframe.geometry.vertices[n[B]].distanceTo(wireframe.geometry.vertices[D[Q]])<g[l].range){y=!0;n.slice(B,1);B=scope.randomInt(0,n.length);break}y=!1}0>=n.length&&(y=!1)}if(0<n.length){y=g[q].tree();for(var E in y.vertices)e.geometry.vertices.push(y.vertices[E].clone().add(wireframe.geometry.vertices[n[B]])),
e.geometry.colors[e.geometry.vertices.length-1]=y.colors[E];D.push(n[B]);n.slice(B,1)}p++}e.verticesNeedUpdate=!0;e.elementsNeedUpdate=!0;fa.add(e)};this.sakura=function(){var q=new THREE.Geometry,p=[],n=[],D=1,B,y=new THREE.Vector3(0,0,0),Q=new THREE.Vector3(0,0,3),E=12,L=0,K=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,0,1);q.vertices.push(y);q.vertices.push(Q);q.colors.push(aa[2]);q.colors.push(aa[2]);n.push({v:Q.clone(),n:Q.clone(),pitch:K.clone(),roll:P.clone()});for(y=[];4>L;){Q=[];for(K=
0;K<n.length;K++)for(var U=P=0;3>U;U++){var V=0===L&&2===U&&1>P?1:scope.random();if(.2<V){V=scope.randomInt(-2,2);var ta=n[K].n.clone(),Ca=aa[2];ta.applyAxisAngle(n[K].pitch,2*Math.PI/(E+V));ta.applyAxisAngle(n[K].roll,2*Math.PI/3*U);ta.multiplyScalar(D);V=ta.clone().add(n[K].v);q.vertices.push(n[K].v.clone());q.vertices.push(V);q.colors.push(Ca);q.colors.push(Ca);Ca=n[K].pitch.clone();Ca.applyAxisAngle(n[K].roll,2*Math.PI/3*U);Ca.applyAxisAngle(n[K].pitch,2*Math.PI/E);var pa=n[K].roll.clone();pa.applyAxisAngle(n[K].pitch,
2*Math.PI/E);pa.applyAxisAngle(n[K].roll,2*Math.PI/3*U);0<U&&p.push({a:V.clone(),b:n[K].v.clone(),pitch:Ca,roll:pa});Q.push({v:V.clone(),n:ta.clone(),pitch:Ca,roll:pa});P++}else 0===P&&2===U&&y.push({v:n[K].v.clone(),n:n[K].n.clone(),pitch:n[K].pitch.clone(),roll:n[K].roll.clone()})}n=Q.slice();D*=.9;L++}for(B in E=6,p)D=p[B].a.clone(),Q=p[B].b.clone(),D=D.clone().sub(Q),K=D.clone().multiplyScalar(.5).add(Q),L=scope.randomInt(0,3)-1,D.applyAxisAngle(p[B].pitch,2*Math.PI/E),D.applyAxisAngle(p[B].roll,
2*Math.PI/L),D.multiplyScalar(.5),Q=K,K=D.clone().add(K),q.vertices.push(Q),q.vertices.push(K),q.colors.push(aa[2]),q.colors.push(aa[2]),Q=p[B].pitch.clone(),Q.applyAxisAngle(p[B].roll,2*Math.PI/L),Q.applyAxisAngle(p[B].pitch,2*Math.PI/E),P=p[B].roll.clone(),P.applyAxisAngle(p[B].pitch,2*Math.PI/E),P.applyAxisAngle(p[B].roll,2*Math.PI/L),n.push({v:K.clone(),n:D.clone(),pitch:Q,roll:P});n=n.concat(y);for(p=0;p<n.length;p++)for(B=0;5>B;B++)E=n[p].n.clone(),E.normalize(),E.applyAxisAngle(n[p].pitch,
2*Math.PI/6),E.applyAxisAngle(n[p].roll,2*Math.PI/5*B),E.multiplyScalar(.5),E=E.add(n[p].v),y=n[p].v.clone(),q.vertices.push(E),q.vertices.push(y),q.colors.push(aa[12]),q.colors.push(aa[12]);return q.colorsNeedUpdate=!0,q};this.pine=function(){var q=Math.floor(8*scope.random())+6,p=2*Math.PI/6,n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,0,0));n.vertices.push(new THREE.Vector3(0,0,+q-.5+1));n.colors.push(aa[9]);n.colors.push(aa[9]);n.colors.push(aa[9]);for(var D=1;D<q;D++)for(var B=0;6>
B;B++)off=D%2*p*.5,n.vertices.push(new THREE.Vector3(0,0,+D+1)),n.vertices.push(new THREE.Vector3(.3*(q-D),0,+D-.3+1)),n.vertices[n.vertices.length-1].applyAxisAngle(I,p*B+off),n.colors.push(aa[9]),n.colors.push(aa[9]);return n};this.checkpoint=function(){function q(B,y,Q){var E=new THREE.Geometry,L=(new THREE.Vector3).copy(B).sub(y),K=(new THREE.Vector3).copy(B).add(L.clone().multiplyScalar(1.5));L=(new THREE.Vector3).copy(y).sub(L.clone().multiplyScalar(1.5));E.vertices.push(new THREE.Vector3(K.x,
K.y,K.z-12));E.vertices.push(new THREE.Vector3(K.x,K.y,K.z+12));E.vertices.push(new THREE.Vector3(L.x,L.y,L.z+12));E.vertices.push(new THREE.Vector3(L.x,L.y,L.z+12));E.vertices.push(new THREE.Vector3(L.x,L.y,L.z-12));E.vertices.push(new THREE.Vector3(K.x,K.y,K.z-12));E.faces.push(new THREE.Face3(0,1,2));E.faces.push(new THREE.Face3(3,4,5));K=new THREE.Geometry;K.vertices.push(new THREE.Vector3(B.x,B.y,B.z+6));K.vertices.push(new THREE.Vector3(B.x,B.y,B.z+8));K.vertices.push(new THREE.Vector3(y.x,
y.y,y.z+6));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));K.vertices.push(new THREE.Vector3(B.x,B.y,B.z+6));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+6));K.vertices.push(new THREE.Vector3(B.x,B.y,B.z+8));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+8));K.vertices.push(new THREE.Vector3(B.x,B.y,B.z+1));K.vertices.push(new THREE.Vector3(y.x,y.y,y.z+1));B=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});B.color=aa[5];E=new THREE.Mesh(E,B);E.visible=!0;B=new THREE.LineSegments(K,
B);return E.name="Objective "+Q,B.name="Checkpoint"+Q,{display:B,collision:E}}var p=w.geometry,n=p.vertices.length-80;n=Math.floor(n/4)-Math.floor(n/4)%2;var D=[];D[0]=q(p.vertices[40],p.vertices[41],0);D[1]=q(p.vertices[40+n],p.vertices[1+n+40],1);D[2]=q(p.vertices[2*n+40],p.vertices[2*n+41],2);D[3]=q(p.vertices[3*n+40],p.vertices[3*n+41],3);D[4]=q(p.vertices[4*n+40],p.vertices[4*n+41],4);this.DISTANCE=4*n/2*3;scope.start.copy(p.vertices[36]);scope.start.sub(p.vertices[37]);scope.start.multiplyScalar(-.75);
scope.start.add(p.vertices[36]);for(p=0;5>p;p++)null==M.best&&(M.best[p]=4>p?n*(p+1)/Pa:M.best[p]=M.best[p-1]);return R.STATE(),D};this.resetCheckpoints=function(){for(var q in scope.checkpoints)scope.checkpoints[q].display.material.color=aa[5]};this.random=function(){Ra=(Ra+1)%2147483647;var q=1E4*Math.sin(Ra);return q-Math.floor(q)};this.randomInt=function(q,p){return Math.floor(scope.random()*(p-q))+q};this.noise=function(q){var p=new pb,n=[],D=8,B=0,y=0,Q=1E3*scope.random();l;for(var E=0;E<q.vertices.length;E++)n[E]=
0;for(E=0;2>E;E++){for(var L=0;L<q.vertices.length;L++)n[L]+=Math.floor(p.noise(q.vertices[L].x/D,q.vertices[L].y/D,Q)*D),n[L]>B&&(B=n[L]),n[L]<y&&(y=n[L]);D*=3}for(p=0;p<n.length;p++){D=2===l?2:.5;for(B=0;B<w.geometry.vertices.length;B++)y=q.vertices[p].distanceTo(w.geometry.vertices[B]),y=y*y/100,y<D&&(D=y);q.vertices[p].z+=n[p]*D}};this.name=function(){var q="";if(Ua)q=R.custom_seed;else if(Ga||Za)q=R.CHALLENGES.seed;else{var p=[" forest"," pass"," mountain"],n="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");
TOGGLE=!1;for(var D=Math.ceil(3*Math.random())+1,B=0;B<D;)q+=n[Math.floor(Math.random()*n.length)],B++;n=2===l?1:0;n=p[Math.floor(n+Math.random()*(p.length-n))];q+=n;(.02<Math.random()||q!==eb)&&(q="",n=Math.floor(Math.random()*fb.length),q=fb[n])}return eb=q,this.BIOME=l,q}}function gb(){$a=!0;window.removeEventListener("touchstart",gb)}function Ia(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,g=window.innerWidth,l=window.innerHeight;ba.aspect=g/l;ba.updateProjectionMatrix();
b.resize(g,l,a,Fa);R.resize(g,l,a)}function hb(){if(window.requestAnimationFrame(hb),Va=window.performance.now(),!va||x.IMPORT||ya)if(x.REPLAY&&!va){ib();M.update();x.update();uas.update(x.TIMESTAMP);ya&&0<X.length&&x.TIMESTAMP>10*X[0].cp[4]+9E3&&x.reset(!0);qa||jb||kb||qb||(x.TIMESTAMP,4E3);for(var a=0;a<X.length;a++)X[a].update(x.TIMESTAMP-4E3,x.FRAME)}else if(Sa||sa.SCAN&&!va)ba.up.set(0,0,1),ba.position.applyAxisAngle(ba.up,.01),ba.lookAt(new THREE.Vector3),Sa&&R.loading(),R.scanning();else{if(ya||
x.IMPORT){for(a="";a.length<Math.floor(Va/500)%4;)a+=".";b.clear();b.text("importing ghost data"+a,16,16);M.update()}ba.up.set(0,0,1);ba.position.applyAxisAngle(ba.up,.01);ba.lookAt(new THREE.Vector3,0,0,0)}else{x.update();for(a=0;a<X.length;a++)x.START?X[a].update(x.TIMESTAMP,x.FRAME):X[a].update(0,0);uas.update(x.TIMESTAMP);qa||ab||R.update();!$a||qa||Ma||b.dpad();F.RESET&&!qa&&(R.reset(),F.RESET=!1);M.update()}za.render(fa,ba);b.update(F.touches)}function rb(){var a=this;this.SNOW=this.COMPLETE=
!1;this.start=new THREE.Vector3;this.generate=new db;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var l=new THREE.Vector3;l.copy(ba.position);l.x+=Math.random()*a.snow.distance-a.snow.distance/
2;l.y+=Math.random()*a.snow.distance-a.snow.distance/2;l.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(l)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var l=0;l<a.snow.mesh.geometry.vertices.length;l++){var h=a.snow.mesh.geometry.vertices[l];h.z-=.5*x.DT();(Math.abs(h.z-ba.position.z)>a.snow.height/2||Math.abs(h.x-ba.position.x)>a.snow.distance/2||Math.abs(h.y-ba.position.y)>a.snow.distance/2)&&(h.copy(ba.position),
h.x+=Math.random()*a.snow.distance-a.snow.distance/2,h.y+=Math.random()*a.snow.distance-a.snow.distance/2,h.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var g=0;4>g;g++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(l){l=void 0===l?!1:l;if(ba.position.set(0,400,200),ba.far=2E3,ba.updateProjectionMatrix(),ba.lookAt(new THREE.Vector3),za.render(fa,ba),!l){this.name=
this.generate.name();l="";for(var h in this.name)l+=this.name.charCodeAt(h).toString();Ra=l}a.generate.connect();sb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};this.reset=function(l){l=void 0===l?!1:l;Ra++;a.best=[];a.COMPLETE=!1;a.disconnect();a.generate=new db;a.connect(l)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function tb(){var a=this,g,l,h=0,t=0;this.custom_seed="";var w="#1#ffffff#334#",r=Da+"#1#",
A=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(c){return c?(ma=c.uid,a.STATE(),sa.requestName(ma,function(e){ja=e;a.STATE()})):(ma=!1,a.STATE()),null})};this.register=function(c){b.clear();a.STATE=function(){a.register(c)};ab=!0;a.inputName(function(){ab=!1;sa["export"]()},!0,"input name to save data")};this.resize=function(c,e){g=b.width;l=b.height;
Aa=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var c=x.yen();b.print("$ "+c.toString(),"2","1.0-4")};this.nav=function(c){c=void 0===c?function(){b.clear()}:c;b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.button("","2","2+4p","1.0-4","8",function(){a.menu(c)},!1)};this.title=function(c,e){a.breadcrumb(c,e);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){A||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1},!1);Wa?(b.style=1,b.sprite(40,
72,8,10,"1.0-14","2",8,10),b.sprite(48,72,16,16,"1.0-19","2",16,16),b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-23","2+4p","7","5",function(){var k=document.getElementById("mp3_player");k.currentTime=Math.random()*k.duration;k.play();a.STATE()},!1),b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").pause();Wa=!1;a.STATE()},!1)):(b.style=2,b.sprite(16,72,16,16,"1.0-10","2",16,16),b.style=0,b.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").play();
Wa=!0;a.STATE()},!1));document.fullscreenEnabled;a.wallet()};this.breadcrumb=function(c,e){var k=void 0===e?function(){A||b.backdrop(!1);c();qa=!1;a.SETTINGS=!1}:function(){a.menu(c);qa=!0};b.style=Wa?1:0;e=Wa?" low recordings 0.0.6 feature mix":" menu";b.print(" "+e,"2","2");b.style=0;b.print("<","2","2");b.button("","2","2+4p","7","8",k,!1)};this.menu=function(c){qa=!0;b.style=0;a.STATE=function(){a.menu(c)};A||b.backdrop();b.clear();a.title(c);b.sprite(0,0,1,1,"2","6","1.0-4",1);ya?(b.print(" > view spectator controls",
"2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.uas(!0)},!1)):(b.print(" > modify vehicle","2","8"),b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(c)},!1));b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");b.button("","2","13+4p","1.0-4","5",function(){a.settings(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var e=8,k;ya?(k=uas.AUTOPILOT?"disable":"enable",b.button(k+" autopilot","2","1.0-2-"+e,"1.0-4","6",function(){b.backdrop(!1);uas.AUTOPILOT=!uas.AUTOPILOT;
a.replay()},!0),e+=8,b.button("deploy vehicle","2","1.0-2-"+e,"1.0-4","6",function(){b.backdrop(!1);ya=!1;a.STATE=function(){};x.reset(!1);a.reset();va=!0;x.START=!1;x.disconnect();x.connect(M.start,M.surface,!1);a.play()},!0)):(va||x.REPLAY)&&(b.button("restart stage","2","1.0-2-"+e,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),e+=8,b.button("next stage","2","1.0-2-"+e,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0));a.discord()};this.intro=function(){var c;a.STATE=function(){a.intro()};
A=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");b.link("","0","1.0-24","26","6","http://icecast.klbp.org:8000/stream");b.print("new mixtape now live on","2","1.0-23");b.style=1;b.print("Cosmic Spot 99.1 KLBP FM","2","1.0-21");b.style=0;Ga?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,c=null!==a.CHALLENGER&&0<a.CHALLENGER.length?a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),b.style=0,b.print(c,"9","15"),sa.requestName(a.CHALLENGES.uid,function(e){a.CHALLENGER=
e;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Ua&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==ma&&!1===ma||""!==ja?null!==ja&&""!==ja?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+ja,"2","9"),b.style=2,b.print("[edit]",ja.length+"+5","9"),b.style=0,b.button("","2","9+4p",ja.length+"+9","4",function(){a.inputName(a.intro)},!1)):(!1===ma&&(""===ja||null===ja)||!1!==ma&&
null===ja)&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.6.2","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},!1);a.discord();a.startButton()};this.startButton=function(){b.button("start",
"2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();A=!1;b.renderer.style.background="transparent";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");M.connect();a.load()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=0};this.load=function(){a.STATE=function(){a.target();a.setBattleName()};
a.TIMELIST=[];sa.scan(M.name,function(c){for(var e={$jscomp$loop$prop$t$89$171:0};e.$jscomp$loop$prop$t$89$171<c.length;e={$jscomp$loop$prop$t$89$171:e.$jscomp$loop$prop$t$89$171},e.$jscomp$loop$prop$t$89$171++)a.TIMELIST[e.$jscomp$loop$prop$t$89$171]={uid:c[e.$jscomp$loop$prop$t$89$171].uid,utc:c[e.$jscomp$loop$prop$t$89$171].utc,time:c[e.$jscomp$loop$prop$t$89$171].time,name:"..."},sa.requestName(c[e.$jscomp$loop$prop$t$89$171].uid,function(m){return function(I){a.TIMELIST[m.$jscomp$loop$prop$t$89$171].name=
I;a.STATE()}}(e)),sa.checkTime(ma,c[e.$jscomp$loop$prop$t$89$171].uid,c[e.$jscomp$loop$prop$t$89$171].time);e=a.TIMELIST.length<Da?a.TIMELIST.length:Da;var k=[];switch(Ea){case 0:k=c.slice(0,e);break;case 1:for(c=c.slice();k.length<e;){var f=Math.floor(Math.random()*c.length);k.push(Object.assign({},c[f]));c.splice(f,1)}}a.BATTLE=k.slice();a.STATE()});Sa=!0;a.target();h=0};this.ready=function(){Sa=!1;a.STATE()};this.play=function(){b.clear();a.nav(a.play);qa=!1;b.style=0};this.complete=function(){qa=
!0;b.clear();a.STATE=function(){};a.nav(a.complete);var c="stage complete!";b.style=0;b.print(c,"0.5-"+2*Math.round(c.length/2),"0.3-1",2);b.style=0;M.COMPLETE=!0;window.setTimeout(function(){!1===ma||null===ma?(a.register(),a.STATE=function(){a.results();x.replay()}):(a.STATE=function(){a.results()},x.REPLAY||(a.STATE=function(){},sa["export"](a.results)))},2E3);c=x.param().model+" ("+(x.param().power+1)+"/"+(x.param().drag+1)+"/"+(x.param().sensitivity+1)+"/"+(x.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",
{operator_id:ja,time:x.AT(),penalty:x.PENALTY(),score:x.AT()+x.PENALTY(),seed:M.name,rating:Math.round(M.generate.DISTANCE/(x.AT()+x.PENALTY())),distance:M.generate.DISTANCE,vehicle:c})};this.results=function(){a.STATE=function(){a.results()};b.clear();b.style=0;qa=!0;var c=0,e=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((e<Na||!1===Na)&&(Na=e),0<a.TIMELIST.length){for(var k=0;k<a.TIMELIST.length;k++)if(e<a.TIMELIST[k].time){c=k+1;break}0==c&&(c=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+
M.name,"2","2");b.style=0;e=b.time(e);b.print(e,"2","5",2);k=x.overwrite(x.CHECKPOINT,M.best,!1);0!=c?b.print("rank "+c,2*e.length+"+3".toString(),"5+4p"):k?(k=Ga?"challenge victory!":"new record!",b.style=1,b.print(k,2*e.length+"+3".toString(),"5+4p"),b.style=0):Ga&&b.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");e=9;k=x.CHECKPOINT;if(320<l){for(var f=1;f<k.length-1;f++){b.style=5;b.print("cp "+f,"2",e+"+"+f.toString());f;var m=k[f],I=a.split(f);b.print(I,"0.5+1",e+"+"+f.toString());
"number"==typeof k[f]?(b.style=0,m=b.time(k[f])):(b.style=4,m="penalty",d="");b.print(m,"0.5 -1-"+m.length.toString(),e+"+"+f.toString());b.style=0;e+=1}e+=5}1===c&&(b.style=4,b.print("new record!","2",e.toString(),2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4",
"0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){qa=!1;uas.replay();a.replay()})};this.checkpoint=function(c){c=void 0===c?!1:c;b.clear();b.style=0;a.nav(function(){a.checkpoint(c)});var e="";c?e+="missed checkpoint X "+Math.abs(x.CHECKPOINT[5]):e=this.split(x.OBJECTIVE);b.text(e,16,32);b.style=0};this.split=function(c){var e="",k=M.best[c]-x.CHECKPOINT[c],f=2,m="";return Number.isNaN(k)?void 0===x.CHECKPOINT[c]?(f=4,e+="- 100 sec"):void 0===
M.best[c]&&0>M.best[5]?(f=1,e+="+ 100 sec"):void 0===M.best[c]&&(f=1,e+="new time!"):(0<k?(m="+ ",f=1):0>k?(m="- ",f=4):m="+ ",k=Math.abs(k),e+="( "+m+b.time(k)+" )"),b.style=f,e};this.battle=function(){var c=new lb(sa.save(sa.tape),x.MODEL,x.PAINT);X.push(c);a.reset()};this.replay=function(){if(!x.IMPORT&&!va&&(a.STATE=function(){a.replay()},b.clear(),ya?a.nav(function(){a.replay()}):a.nav(a.results),!0)){uas.AUTOPILOT?a.autopilot():a.drone();var c={};for(c.$jscomp$loop$prop$e$94$173=b.style=0;4>
c.$jscomp$loop$prop$e$94$173;c={$jscomp$loop$prop$e$94$173:c.$jscomp$loop$prop$e$94$173},c.$jscomp$loop$prop$e$94$173++){var e="7+"+(4*c.$jscomp$loop$prop$e$94$173).toString(),k=c.$jscomp$loop$prop$e$94$173===uas.CAM-1?48:40;b.button("",e+"-10p","1.0-4+4p","3","4",function(f){return function(){uas.CAM=f.$jscomp$loop$prop$e$94$173+1;a.STATE()}}(c),!1);b.sprite(k,64,8,8,e,"1.0-4",8,8)}b.style=0;c=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?a.TIMELIST[uas.TARGET-1].name:ja;(uas.AUTOPILOT||
uas.TARGETING)&&b.print(c,"2","1.0-7");b.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,a.STATE())},!1)}};this.autopilot=function(){b.style=0;b.style=0<uas.POV?4:2;b.sprite(72,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;a.STATE()},!1);ya||(b.style=2,b.print("<","2","2"),b.button("","2","2+4p","7","8",function(){a.results(function(){a.replay()})},!1))};this.drone=function(){b.style=
uas.TARGETING?4:2;b.sprite(64,64,8,8,"3","1.0-4",8,8);b.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;a.STATE()},!1)};this.next=function(){b.clear();Sa=!0;Ua=Za=Ga=!1;a.PATH=!1;custom_seed="";M.name="";a.BATTLE=[];Na=!1;window.history.pushState("","","/");za.clear();x.REPLAY=!1;x.RESET=!0;x.disconnect();for(var c=0;c<X.length;c++)X[c].disconnect();uas.reset(!0);X=[];M.SNOW&&fa.remove(M.snow.mesh);M.reset();va=qa=!1;sa.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};
this.dnf=function(){a.STATE=function(){a.dnf()};b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(c){c=void 0===c?"reset":c;X.index=0;b.clear();a.nav(a.play);va=!0;qa=!1;x.reset(!1);for(var e=0;e<X.length;e++)X[e].reset();firebase.analytics().logEvent("stage_restart",{status:c})};this.hide=function(){var c=this;this.STATE=function(){c.hide()};
style=1;b.clear();a.nav(R)};this.update=function(c){c=void 0===c?!1:c;qa||!va||Ma?!1!==c&&(b["delete"](16,16,g-64,16),b.text(b.time(c),16,16)):(b["delete"](16,16,g-64,16),b["delete"](16,l-32,64,16),b.text(b.time(x.AT()),16,16),b.text(x.SPEED.toString(),16,l-32))};this.loading=function(){for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";qa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+c,16,16),b.style=0);h++};this.scanning=function(){if(0===R.TIMELIST.length&&sa.SCAN&&!qa){b["delete"](16,
72,88,8);for(var c="";c.length<Math.floor(Va/500)%4;)c+=".";b.style=5;b.text("scanning"+c,16,72)}};this.target=function(){b.clear();a.STATE=function(){a.target()};a.nav(a.target);var c,e,k=M.name;if(Sa||(b.style=2,b.print("stage generated.","2","2"),sa.SCAN?b.style=2:(b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){b.clear();M.SNOW&&fa.add(M.snow.mesh);a.STATE=function(){};M.generate.END=!1;a.play();x.SPECTATE=!1;va=!0;x.connect(M.start,M.surface,!1);a["import"]();firebase.analytics().logEvent("stage_start")}),
b.style=4,b.style=1,0<a.BATTLE.length&&b.button("spectate!","1.0-14","1.0-18","12","3",function(){va=!1;M.generate.END=!1;M.SNOW&&fa.add(M.snow.mesh);b.style=0;x.connect(M.start,M.surface);ya=!0;a["import"]();b.clear();fa.add(M.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),b.style=5,b.print(k,"2","5-1p",2),b.style=0,0!==a.TIMELIST.length||!sa.SCAN)if(0!==a.TIMELIST.length){var f=a.TIMELIST.slice();for(k=0;k<f.length;k++)for(var m=0;m<f.length;m++)f[k].time<=f[m].time&&f[k].utc<
f[m].utc&&k>m&&(c={},Object.assign(c,f[k]),e={},Object.assign(e,f[m]),f[k]=e,f[m]=c);b.style=2;b.print("best time:","2","9");b.style=0;b.print(b.time(f[0].time),"2","12",2);b.style=5;c=(k=f.length<Aa)?f.length:Aa;k=k?0:f.length-Aa;for(e=0;e<c;e++)b.print(e+1+". "+f[e].name,"2","16+"+2*e),b.print(b.time(f[e].time),"18","16+"+2*e);0<k&&b.print("+ "+k+" more entries","2",2*c+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.displayResults=function(c){c=a.TIMELIST;b.style=2;b.print("best time:",
"2","9");b.style=0;b.print(b.time(c[0].time),"2","12",2);b.style=5;var e=c.length<Aa+4,k=e?c.length:Aa+4;e=e?0:c.length-Aa+4;for(var f=0;f<k;f++)b.print(f+1+". "+c[f].name,"2","16+"+2*f),b.print(b.time(c[f].time),"18","16+"+2*f);0<e&&b.print("+ "+e+" more entries","2",2*k+"+17")};this.setBattleName=function(){for(var c=0;c<a.BATTLE.length;c++)a.BATTLE[c].name=a.TIMELIST[c].name};this["import"]=function(){a.setBattleName();for(var c={$jscomp$loop$prop$i$104$175:0};c.$jscomp$loop$prop$i$104$175<a.BATTLE.length;c=
{$jscomp$loop$prop$i$104$175:c.$jscomp$loop$prop$i$104$175},c.$jscomp$loop$prop$i$104$175++)x.IMPORT=!0,sa["import"](M.name+"/"+a.BATTLE[c.$jscomp$loop$prop$i$104$175].uid,function(e){return function(k){a.BATTLE[e.$jscomp$loop$prop$i$104$175].IMPORT_BUFFER=[];x.INPUTS=[];a.BATTLE[e.$jscomp$loop$prop$i$104$175].data=[];a.BATTLE[e.$jscomp$loop$prop$i$104$175].param={power:k.param.power,drag:k.param.drag,sensitivity:k.param.sensitivity,model:k.param.model,paint:k.param.paint};a.BATTLE[e.$jscomp$loop$prop$i$104$175].cp=
k.cp;for(var f=0;f<k.debug.length;f++)k.debug[f].time,k.debug[f].position,k.debug[f].normal,k.debug[f].rotation,k.debug[f].U,k.debug[f].D,k.debug[f].L,k.debug[f].R,a.BATTLE[e.$jscomp$loop$prop$i$104$175].data.push({U:k.debug[f].U,D:k.debug[f].D,L:k.debug[f].L,R:k.debug[f].R,time:k.debug[f].time});e.$jscomp$loop$prop$i$104$175===a.BATTLE.length-1&&x["import"]()}}(c))};this.uas=function(c){b.clear();b.style=0;a.STATE=function(){a.uas()};b.backdrop();b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("",
"2","2","1.0","4",function(){b.backdrop(!1);a.replay()},!1);b.style=0;b.print("spectator controls","2","2");b.print("pilot mode","2","6");b.style=2;b.print("arrow            pitch/yaw/roll","2","10");b.print("shift + arrow    roll/yaw modifier","2","12");b.print("space            power +","2","14");b.print("shift + space    power -","2","16");b.print("ctrl:            roll/yaw toggle","2","18");b.print("r                reset","2","20");b.print("t                targeting mode toggle","2","22");b.print("shift + arrow    change target (targeting)",
"2","24");b.style=0};this.timelist=function(){b.style=0};this.save=function(){var c=ja+"#"+x.MODEL+"#"+x.PAINT+"#"+x.param().power+x.param().drag+ +x.param().sensitivity+"#"+Date.now();c!==w&&(w=c,a.cSave("SAVE",w))};this.vehicle=function(c){a.STATE=function(){a.vehicle(c)};qa=!0;b.clear();a.title(function(){c();a.save()},function(){a.menu();sv()});x.REPLAY&&a.reset();var e=[],k=x.param();e.push({id:"power",value:k.power,funct:function(N){x.tune.power(N)}});e.push({id:"drag",value:k.drag,funct:function(N){x.tune.drag(N)}});
e.push({id:"sensitivity",value:k.sensitivity,funct:function(N){x.tune.sensitivity(N)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(x.models()[x.MODEL].name,"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){x.MODEL+=1;1<x.MODEL&&(x.MODEL=0);x.body();a.vehicle(c)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--x.MODEL;0>x.MODEL&&(x.MODEL=1);x.body();a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",
1);b.print("paint","2","8+5+");b.print(ub[x.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){x.PAINT+=1;x.PAINT>Ja.length-1&&(x.PAINT=0);x.paint();a.vehicle(c)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--x.PAINT;0>x.PAINT&&(x.PAINT=Ja.length-1);x.paint();a.vehicle(c)},!1);for(k={$jscomp$loop$prop$t$106$177:0};k.$jscomp$loop$prop$t$106$177<e.length;k={$jscomp$loop$prop$t$106$177:k.$jscomp$loop$prop$t$106$177},k.$jscomp$loop$prop$t$106$177++){var f=
"8+5+5+"+(5*k.$jscomp$loop$prop$t$106$177).toString();b.print(e[k.$jscomp$loop$prop$t$106$177].id,"2",f);b.sprite(0,0,1,1,"2",f+"+3","1.0-2-2",1);for(var m={$jscomp$loop$prop$e$107$179:0};6>m.$jscomp$loop$prop$e$107$179;m={$jscomp$loop$prop$e$107$179:m.$jscomp$loop$prop$e$107$179},m.$jscomp$loop$prop$e$107$179++){var I="1.0-18+"+(3*m.$jscomp$loop$prop$e$107$179).toString(),C=m.$jscomp$loop$prop$e$107$179<=e[k.$jscomp$loop$prop$t$106$177].value?48:40;b.button("",I+"-10p",f+"+4p","3","4",function(N,
da){return function(){e[N.$jscomp$loop$prop$t$106$177].funct(da.$jscomp$loop$prop$e$107$179);a.vehicle(c)}}(k,m),!1);b.sprite(C,64,8,8,I,f,8,8)}}};this.scan=function(c,e){};this.settings=function(c){a.STATE=function(){a.settings(c)};a.SETTINGS=!0;r=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+(bb?1:0)+"#";a.cSave("SETTINGS",r);b.clear();A||b.backdrop();a.title(c,a.menu);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(c)},
!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);$a?(e=Oa?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(e,"1.0-2-"+e.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("","2","13+4p","1.0-4","5",function(){Oa=!Oa;a.settings(c)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("pixel scale","2","18");b.print(""+Fa,"1.0-18","18");b.button("+","1.0-6","18+4p","4","4",
function(){2>Fa&&(Fa+=.5);b.style=0;a.settings(c);Ia()},!1);b.button("-","1.0-12","18+4p","4","4",function(){1<Fa&&(Fa-=.5);b.style=0;a.settings(c);Ia()},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1);b.print("camera mode","2","23");var e=x.FPV?"fpv":"tpv";b.print(e,"1.0-6","23");b.button("","2","23+4p","1.0-4","5",function(){x.FPV=!x.FPV;a.settings(c)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord();b.style=0};this.ghostConfig=function(c,e){a.STATE=function(){a.ghostConfig(c)};
var k=bb?1:0;r=Da+"#"+Ea+"#"+(Oa?1:0)+"#"+k;a.cSave("SETTINGS",r);b.clear();A||b.backdrop();a.title(c,function(){a.settings(c)});b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name","2","8");b.print(ja,"1.0-13-"+ja.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(c)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");k=Da.toString();b.print(k,"1.0-13-"+k.length,"13");b.button(">","1.0-6","13+4p",
"4","4",function(){20>Da&&(Da+=1);a.ghostConfig(c)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Da&&--Da;a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority","2","18");k=0===Ea?"best":"random";b.print(k,"1.0-13-"+k.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Ea+=1;1<Ea&&(Ea=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Ea;0>Ea&&(Ea=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);b.print("ghost particles","2",
"23");k=Ya?"enabled":"disabled";b.print(k,"1.0-2-"+k.length,"23");b.button("","2","23+4p","1.0-4","4",function(){Ya=!Ya;for(var f=0;f<X.length;f++)X[f].toggleEmitter(Ya);a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","26","1.0-4",1)};this.controls=function(c){b.clear();a.title(c,a.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",
2);b.print("-","4","8",2)};this.challenge=function(c){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");b.style=0;b.print("> "+ja,"2","9");b.style=2;b.print("[edit]",ja.length+"+9","9");b.button("","2","9+4p",ja.length+"+5","4",function(){a.inputName(a.challenge,!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(M.name,"2","15");b.style=2;b.print("time","2","19");c=b.time(x.CHECKPOINT[4]-
1E4*x.CHECKPOINT[5]);b.style=5;b.print(c,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(c,e,k){e=void 0===e?!1:e;k=void 0===k?"enter display name:":k;a.STATE=function(){a.inputName(c,e,k)};b.clear();qa=!0;e?a.nav(function(){c()},a.menu):a.title(c);b.print(k,"2",
"2");b.textinput(ja,"2","4","1.0-2","6","operator_id");var f=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ja=vb(f.value.toLowerCase());!1===ma&&1<ja.length&&null!==ja?firebase.auth().signInAnonymously().then(function(){ma=firebase.auth().currentUser.uid;a.submitName(ma,c,e);a.STATE=function(){}})["catch"](function(m){m.code;m.message}):!1!==ma&&1<ja.length&&null!==ja?a.submitName(ma,c,e):(b.clear(),b.print("invalid name",
"2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(c,e,k){k=void 0===k?!1:k;1<ja.length&&10>ja.length?firebase.database().ref("uid/"+c).set({name:ja},function(f){f?(b.clear(),f="PERMISSION_DENIED"===f.code?"invalid name":"network error",b.print(f,"2","2"),window.setTimeout(function(){a.inputName(e,k)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(e,1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(e,k)},
1E3))};this.encodeURL=function(){for(var c="",e=M.name,k=0;k<e.length;k++){var f=e.charAt(k);f=" "===f?"-":f;c+=f}c=c+"/"+ma;window.history.pushState("","","/");e=window.location.href;var m="./#/"+c;navigator.clipboard.writeText("https://specialstage.io/#/"+c).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",m)},function(){window.history.pushState("","",m);b.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:e+
"#/"+c})};this.decodeURL=function(){for(var c=window.location.href,e="",k=[],f=!1,m=0,I=0;I<c.length;I++){var C=c.charAt(I);f?"/"===C?(Ga=!0,m++):(1===m&&(C="-"===C?" ":C,e+=C),1<m&&(k+=C)):"#"===C&&(f=!0,Ua=!0,m=0)}Ga&&0<k.length?(a.custom_seed=e,M.name=e,a.CHALLENGES={seed:e,uid:k}):Ua&&(a.custom_seed=e,M.name=e,Ga=!1);Ga&&firebase.analytics().logEvent("challenge_accepted",{url:c})};this.cSave=function(c,e){var k=new Date;k.setTime(k.getTime()+2808E7);k="expires="+k.toUTCString();document.cookie=
c+"="+e+";"+k+";path=/"};this.cLoad=function(c){c+="=";for(var e=document.cookie.split(";"),k=0;k<e.length;k++){for(var f=e[k];" "==f.charAt(0);)f=f.substring(1);if(0==f.indexOf(c))return f.substring(c.length,f.length)}return""};this.checksave=function(){var c=a.cLoad("SAVE");if(0!==c.length&&null!=c){for(var e=0,k="",f="",m="",I="",C=0,N=0;N<c.length;N++){var da=c.charAt(N);if("#"!==da)switch(C){case 1:e=parseInt(da);break;case 2:k+=da;break;case 3:f+=c.charAt(N),m+=c.charAt(N+1),I+=c.charAt(N+2),
N+=2}else C++}x.MODEL=parseInt(e);x.PAINT=parseInt(k);x.paint();x.tune.power(parseInt(f));x.tune.drag(parseInt(m));x.tune.sensitivity(parseInt(I))}else x.PAINT=0,x.paint();if(c=a.cLoad("SETTINGS"),0!==c.length&&null!=c){e=0;m=f=k="";for(I=0;I<c.length;I++)if(C=c.charAt(I),"#"!==C)switch(e){case 0:k+=C;break;case 1:Ea=parseInt(C);break;case 2:f=parseInt(C);break;case 3:m=parseInt(C)}else e++;Da=parseInt(k);Oa=0!==f;1===m&&(bb=!0)}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");
b.print("ginko.ltd","2","1.0-4")};this.promo=function(){b.clear();R.nav();b.style=0;b.print("0.0.6.2","2","2");b.sprite(0,88,47,8,"2","6-4p",188,32,2);b.sprite(49,88,40,8,"2","12-4p",160,32,2);b.sprite(1,0,255,16,"2","1.0-6",255,16);b.print("www.specialstage.io  ","2","1.0-8")};this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4",
"2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4",
"2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("www.specialstage.io","2","0.25",2);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.specialstage.io","4","0.25 + 9");window.setTimeout(a.music,2E3)};this.music=function(c){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4",
"2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty","2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps","2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling",
"2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(c){if("n"===c.key)switch(t){case 0:b.clear();window.setTimeout(a.promo,1E3);t++;break;case 1:window.setTimeout(a.biome,1E3);t++;x.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);t++;x.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);t++;x.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);t++;x.CAMERA=1;break;case 5:b.clear(),t=0}};this.url=function(){for(var c="";c.length<M.name.length;){var e=M.name.charAt(c.length);
c+=" "===e?"-":e}return"specialstage.io/#/"+c};this.utc=function(c){c=(new Date(c)).toLocaleString("en-GB",{timeZone:"UTC"});for(var e="",k=0;k<c.length;k++)","!==c.charAt(k)&&(e+=c.charAt(k));return e};this.stageIntro=function(){var c=this;this.STATE=function(){c.stageIntro()};b.clear();R.nav(this.STATE);var e=this.url();b.timeouts.push(window.setTimeout(function(){b.style=5;b.print(e,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event seed","2","7")},250));b.timeouts.push(window.setTimeout(function(){b.style=
0;b.print(M.name,"2","10",2)},500));b.timeouts.push(window.setTimeout(function(){R.BATTLE.length;b.style="2";b.print(M.generate.BIOMES[M.generate.BIOME].name+" biome","2","14");b.style="0"},1E3))};this.stageReplay=function(){var c=this;this.STATE=function(){c.stageReplay()};b.clear();R.nav(this.STATE);b.print(X[uas.TARGET-1].name,"2","1.0-4")};this.stageResults=function(){jb=!0;this.STATE=function(){a.stageResults()};b.clear();R.nav(this.STATE);var c=a.url();b.timeouts.push(window.setTimeout(function(){b.style=
"5";b.print(c,"2","2")},250));b.timeouts.push(window.setTimeout(function(){b.style=2;b.print("event result","2","6")},500));b.timeouts.push(window.setTimeout(function(){b.style=0;b.print(R.BATTLE[0].name,"2","9",2)},750));b.timeouts.push(window.setTimeout(function(){b.style=1;b.print("stage rank 1","2+"+2*R.BATTLE[0].name.length+"+1","9+4p")},1E3));b.timeouts.push(window.setTimeout(function(){b.style=0;b.sprite(0,0,1,1,"2","13","1.0-4",1)},1250));var e=a.TIMELIST;b.style=5;var k=e.length<Aa+4,f=k?
e.length:Aa+4;k||(e.length,Aa);for(k={$jscomp$loop$prop$i$129$181:0};k.$jscomp$loop$prop$i$129$181<f;k={$jscomp$loop$prop$i$129$181:k.$jscomp$loop$prop$i$129$181},k.$jscomp$loop$prop$i$129$181++)b.timeouts.push(window.setTimeout(function(m){return function(){var I="16+"+3*m.$jscomp$loop$prop$i$129$181;b.print(m.$jscomp$loop$prop$i$129$181+1+". "+e[m.$jscomp$loop$prop$i$129$181].name,"2",I);var C=b.time(e[m.$jscomp$loop$prop$i$129$181].time);b.print(C,"1.0-2-"+C.length,I)}}(k),1500+250*k.$jscomp$loop$prop$i$129$181))};
this.stageEntries=function(){var c=this;kb=!0;this.STATE=function(){a.stageEntries()};b.clear();a.nav(this.STATE);b.style="5";b.print(this.url(),"2","2");b.style="5";for(var e=[],k=0;k<X.length;k++)X[k].hide();for(k=0;k<a.BATTLE.length;k++){var f;!(0<e.length)||a.BATTLE[k].utc>e[k-1].utc?e.push({name:a.BATTLE[k].name,utc:a.BATTLE[k].utc}):(f={name:e[k-1].name,utc:e[k-1].utc},e[k-1]={name:a.BATTLE[k].name,utc:a.BATTLE[k].utc},e.push(f))}var m=1<R.BATTLE.length?" entries":" entry";m=R.BATTLE.length+
m;b.timeouts.push(window.setTimeout(function(){b.style="0";b.print(M.name,"2","6");b.print(m,"1.0-2-"+m.length,"6")},1E3));b.timeouts.push(window.setTimeout(function(){b.sprite(0,0,1,1,"2","10","1.0-4",1)},1500));b.style=5;f=e.length<Aa+4;f?e.length:Aa;f||(e.length,Aa);x.reset(!0);for(f={$jscomp$loop$prop$e$132$184:0};f.$jscomp$loop$prop$e$132$184<e.length;f={$jscomp$loop$prop$e$132$184:f.$jscomp$loop$prop$e$132$184},f.$jscomp$loop$prop$e$132$184++)b.timeouts.push(window.setTimeout(function(I){return function(){b.style=
"5";b.print(e[I.$jscomp$loop$prop$e$132$184].name,"2","12+"+3*I.$jscomp$loop$prop$e$132$184);X[I.$jscomp$loop$prop$e$132$184].show();0<I.$jscomp$loop$prop$e$132$184&&X[I.$jscomp$loop$prop$e$132$184-1].hide();b.style="2";b.print(R.utc(e[I.$jscomp$loop$prop$e$132$184].utc),"1.0-21","12+"+3*I.$jscomp$loop$prop$e$132$184)}}(f),2E3+500*f.$jscomp$loop$prop$e$132$184)),f.$jscomp$loop$prop$e$132$184===R.BATTLE.length-1&&(b.timeouts.push(window.setTimeout(function(I){return function(){X[I.$jscomp$loop$prop$e$132$184].hide()}}(f),
500*f.$jscomp$loop$prop$e$132$184+2500)),b.timeouts.push(window.setTimeout(function(){for(var I=0;I<X.length;I++)X[I].show();c.stageReplay();uas.CAM=1},500*f.$jscomp$loop$prop$e$132$184+3E3)))};this.mixplug=function(){b.clear();b.format(6,"#555");b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#7b1df5");ba.updateProjectionMatrix();b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,8);b.style=7;b.style=6;window.setTimeout(function(){b.style=6;b.print("mix","2","1.0-6")},2E3);for(var c={$jscomp$loop$prop$e$134$186:0};15>
c.$jscomp$loop$prop$e$134$186;c={$jscomp$loop$prop$e$134$186:c.$jscomp$loop$prop$e$134$186},c.$jscomp$loop$prop$e$134$186++)window.setTimeout(function(e){return function(){b.style=0;b.print("specialstage.io".charAt(e.$jscomp$loop$prop$e$134$186),"2+"+e.$jscomp$loop$prop$e$134$186,"2")}}(c),100*c.$jscomp$loop$prop$e$134$186);window.setTimeout(function(){b.sprite(0,88,88,8,"2","4",88,8)},1800);b.style=7;b.style=7;window.setTimeout(function(){b.style=7;b.print("low recordings","2","1.0-4")},2E3);b.style=
6;window.setTimeout(function(){b.style=6;b.print("(lo-fi house)","1.0-15","1.0-4")},2200);b.style=7;c=document.createElement("img");c.style.zIndex=98;c.style.position="fixed";c.style.top=0;c.style.left=0;c.src="./img/low_promo_4x.gif";c.style.setProperty("mix-blend-mode","lighten");document.body.appendChild(c)};this.tracklist=function(){b.clear();b.format(6,"#555");b.format(7,"#50ffae");b.format(8,"#80f7d2");b.format(9,"#DA4DFA");b.format(10,"#101010");b.style=0;b.sprite(8,64,8,8,"1.0-4+2p","2",8,
8);b.style=3;b.style=4;b.style=1;b.style=0;b.print("specialstage.io","2","2");b.style=9;b.print("X low recordings feature mix","2","4");b.style=5;window.setTimeout(function(){b.style=6;b.print("featuring music by:","2","8")},600);var c=[];b.style=0;c.push(function(){b.print("> evade robots","2","12")});c.push(function(){b.print("> eli cash","2","14")});c.push(function(){b.print("> shaman","2","16")});c.push(function(){b.print("> heartwerk","2","18")});c.push(function(){b.print("> blo","2","20")});
c.push(function(){b.print("> urbanite","2","22")});c.push(function(){b.print("> rick wade","2","24")});c.push(function(){b.print("> orthographic figure","2","26")});c.push(function(){b.print("> hyas","2","28")});c.push(function(){b.print("> albin & noris","2","30")});b.style=7;for(var e={$jscomp$loop$prop$e$135$188:0};e.$jscomp$loop$prop$e$135$188<c.length;e={$jscomp$loop$prop$e$135$188:e.$jscomp$loop$prop$e$135$188},e.$jscomp$loop$prop$e$135$188++)window.setTimeout(function(k){return function(){b.style=
0;c[k.$jscomp$loop$prop$e$135$188]()}}(e),250*e.$jscomp$loop$prop$e$135$188+1E3)}}function wb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var a=[],g=0,l=!1,h=this.up.clone(),t=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,
1,0),value:0},yaw:{axis:new THREE.Vector3(0,0,1),value:0},pov:0,target:0,targeting:!1,autopilot:!0}},w=[],r=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},A=this.AUTOPILOT=!0,c=this.TARGET=0;this.TARGETS=[];this.TARGETING=!1;var e=this.CAM=1,k=this.POV=0;this.camera=[];this.camera[0]=t();this.camera[0].distance=
22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=t();this.camera[1].distance=24.5;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=.5708;this.camera[1].pitch.value=.485;this.camera[1].lerp=.1;this.camera[2]=t();this.camera[2].distance=34;this.camera[2].position.set(0,1,0);this.camera[2].yaw.value=3.512;this.camera[2].pitch.value=.79;this.camera[2].lerp=.1;this.camera[3]=t();this.camera[3].distance=34;this.camera[3].position.set(0,
1,0);this.camera[3].yaw.value=5.7916;this.camera[3].pitch.value=.5236;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=t();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].yaw.value=Math.PI;this.camera[4].pitch.value=1.32;this.camera[4].lerp=.075;w[0]=r();w[1]=r();w[2]=r();w[3]=r();w[4]=r();this.reset=function(f){if(void 0===f?0:f)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],ba.up.copy(h),f=0;f<this.camera.length;f++)this.camera[f].target=0;1<a.length?a[g].time=
0:(g=0,a=[],a[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var f=0;f<this.camera.length;f++)this.camera[f].target=
0,this.camera[f].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var f=0;f<this.camera.length;f++)this.camera[f].target=1,this.camera[f].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(f,m,I){f=void 0===f?new THREE.Vector3:f;m=void 0===m?new THREE.Vector3:m;I=void 0===I?new THREE.Vector3:I;var C=Ma||x.END?1E-5:.1;this.up.set(0,0,1);m=m.clone();m.multiplyScalar(-this.camera[0].distance+4*(b.scale-1));m.add(f);
m.z+=this.camera[0].position.z;a[g].position.lerp(m,C);a[g].lookAt.copy(I);a[g].up.set(0,0,1)};this.fpv=function(f,m,I,C){f=void 0===f?new THREE.Vector3:f;m=void 0===m?new THREE.Vector3:m;void 0===I&&new THREE.Vector3;C=void 0===C?new THREE.Vector3:C;a[g].position.copy(f);m=m.clone();m.add(f);a[g].lookAt.copy(m);C=C.clone();a[g].up.copy(C)};this.orbit=function(f,m,I){f=void 0===f?new THREE.Vector3:f;void 0===m&&new THREE.Vector3;I=void 0===I?new THREE.Vector3:I;F.SPACE;F.SHIFT;m=F.UP;var C=F.DOWN,
N=F.LEFT,da=F.RIGHT,W=F.ZOOM_IN,u=F.ZOOM_OUT;f=f.clone();a[g].yaw=a[g-1].yaw;var z=this.camera[e].position.clone();this.camera[e].distance+=W&&0<this.camera[e].distance?-.5:u&&100>this.camera[e].distance?.5:0;z.multiplyScalar(this.camera[e].distance);this.camera[e].yaw.value+=N?-.05:da?.05:0;this.camera[e].pitch.value+=m?.05:C?-.05:0;this.camera[e].pitch.value=0>this.camera[e].pitch.value?0:this.camera[e].pitch.value>Math.PI/2-.1?Math.PI/2-.1:this.camera[e].pitch.value;W=this.camera[e].pitch.axis.clone();
W.applyAxisAngle(h,this.camera[e].yaw.value);z.applyAxisAngle(h,this.camera[e].yaw.value);z.applyAxisAngle(W,this.camera[e].pitch.value);f.add(z);C=l?1:N||da||m||C?.1:this.camera[e].lerp;a[g].position.lerp(f,C);a[g].lookAt.copy(I);a[g].up.set(0,0,1)};this.physics=function(f,m,I){if((void 0===f?0:f)>a[g].time){var C=m.position.clone(),N=m.direction.clone();f=m.lookAt.clone();m=m.normal.clone();I=((void 0!==I?I:C).clone(),{});Object.assign(I,a[g]);a=[];g=0;a.push(I);I={};Object.assign(I,a[g]);a.push(I);
g++;x.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(C,N,f):2===this.POV?this.fpv(C,N,f,m):this.orbit(C,N,f):this.pilot():x.FPV?this.fpv(C,N,f,m):this.pov(C,N,C);a[g].time+=Ka}};this.target=function(f){this.lookAt.copy(this.TARGETS[f].position)};this.update=function(f,m){f=void 0===f?0:f;m=void 0===m?this.TARGETS:m;this.CAM!==e?(l=!0,e=this.CAM,this.TARGET=this.camera[e].target,this.TARGETING=this.camera[e].targeting,this.AUTOPILOT=this.camera[e].autopilot,this.POV=this.camera[e].pov,A=this.AUTOPILOT,
A?(a[g].position.copy(this.camera[e].position),a[g].position.add(m[this.TARGET].position),a[g].up.copy(this.camera[e].up),l=!0):(a[g].position.copy(w[e].position),a[g].lookAt.copy(w[e].lookAt),a[g].up.copy(w[e].up),a[g].velocity.copy(w[e].velocity),a[g].pitch.axis.copy(w[e].pitch.axis),a[g].roll.axis.copy(w[e].roll.axis),a[g].yaw.axis.copy(w[e].yaw.axis),a[g].pitch.value=w[e].pitch.value,a[g].roll.value=w[e].roll.value,a[g].yaw.value=w[e].yaw.value,a[g].speed=w[e].speed),R.STATE()):(this.camera[e].target=
this.TARGET,this.camera[e].pov=this.POV,this.camera[e].targeting=this.TARGETING,this.camera[e].autopilot=this.AUTOPILOT);this.AUTOPILOT!==A&&(A=this.AUTOPILOT,this.AUTOPILOT?(a[g].position.copy(this.camera[e].position),a[g].up.copy(this.camera[e].up)):a[g].speed=0);this.POV!==k&&(R.STATE(),k=this.POV,uas.camera[uas.CAM].pov=k);this.TARGET!==c&&(c=this.TARGET,uas.camera[uas.CAM].target=c);this.physics(f,m[va?0:this.camera[e].target]);Ka;a[g].time;Ka;1<a.length&&(this.position.copy(a[g].position),this.direction.copy(a[g].direction),
this.up.copy(a[g].up),this.lookAt.copy(a[g].lookAt),ba.position.copy(this.position),ba.up.set(this.up.x,this.up.y,this.up.z),ba.lookAt(this.lookAt));l=!1};this.pilot=function(){var f=a[g],m=F.SPACE,I=F.SHIFT,C=F.UP,N=F.DOWN,da=F.LEFT,W=F.RIGHT;F.TARGET&&(this.TARGETING=!this.TARGETING,F.TARGET=!1,R.replay());f.pitch.value+=C?-f.pitch.power:N?+f.pitch.power:0;I&&!this.TARGETING?f.roll.value+=da?-f.roll.power:W?f.roll.power:0:(f.yaw.value+=da?f.yaw.power:W?-f.yaw.power:0,f.yaw.value*=f.yaw.drag);f.pitch.value*=
f.pitch.drag;f.roll.value*=f.roll.drag;f.yaw.value*=f.yaw.drag;f.pitch.axis.applyAxisAngle(f.roll.axis,f.roll.value);f.pitch.axis.applyAxisAngle(f.yaw.axis,f.yaw.value);f.roll.axis.applyAxisAngle(f.pitch.axis,f.pitch.value);f.roll.axis.applyAxisAngle(f.yaw.axis,f.yaw.value);f.yaw.axis.applyAxisAngle(f.pitch.axis,f.pitch.value);f.yaw.axis.applyAxisAngle(f.roll.axis,f.roll.value);I&&m&&-1<f.speed?f.speed-=.0025:m&&1>f.speed&&(f.speed+=.0025);f.velocity.copy(f.roll.axis);f.velocity.multiplyScalar(f.speed);
f.position.add(f.velocity);this.TARGETING?(da&&I&&0<this.TARGET&&(--this.TARGET,R.replay(),F.LEFT=!1),W&&I&&this.TARGET<this.TARGETS.length-1&&(this.TARGET+=1,R.replay(),F.RIGHT=!1),this.up.set(0,0,1),l?f.lookAt.copy(this.TARGETS[this.TARGET].position):f.lookAt.lerp(this.TARGETS[this.TARGET].position,.05)):(f.up.copy(f.yaw.axis),f.lookAt.copy(f.roll.axis),f.lookAt.add(f.position));w[e].position.copy(f.position);w[e].lookAt.copy(f.lookAt);w[e].velocity.copy(f.velocity);w[e].up.copy(f.up);w[e].pitch.axis.copy(f.pitch.axis);
w[e].roll.axis.copy(f.roll.axis);w[e].yaw.axis.copy(f.yaw.axis);w[e].pitch.value=f.pitch.value;w[e].roll.value=f.roll.value;w[e].yaw.value=f.yaw.value;w[e].speed=f.speed};this.autocam=function(){};this.debug=function(){console.log("Vehicle Timestamp:",x.TIMESTAMP);console.log("Physics:",a);console.log("lookAt:",this.lookAt)}}function xb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var g=this.renderer.getContext("2d");this.context=
g;var l=document.createElement("img");l.src="./img/stage.font.0.0.6.png";l.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var h=document.createElement("canvas"),t=h.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var w=128,r=180,A=128,c=80,e;var k=128;var f=r;var m=128;var I=80;var C=!(e={x:128,y:r+60,w:128,h:40}),N=[],da=[],W=[];this.timeouts=[];this.connect=function(){g.imageSmoothingEnabled=!1;a.format(0,
"#ffffff")};this.format=function(u,z){u=void 0===u?0:u;z=void 0===z?"#ffffff":z;void 0===h[u]&&(h[u]=document.createElement("canvas"),t[u]=h[u].getContext("2d"));t[u].drawImage(l,0,0,128,128,0,0,128,128);t[u].globalCompositeOperation="source-atop";t[u].fillStyle=z;t[u].fillRect(0,0,128,128);t[u].globalCompositeOperation="source-out"};this.resize=function(u,z,H,J){J=void 0===J?1:J;a.scale=H*J;var O=window.devicePixelRatio,ia=300>Math.ceil(O)/O*u?Math.floor(O):Math.ceil(O);0!=ia-O&&(H=ia/O*J);1>=O&&
1<a.scale&&(H=a.scale);this.width=u/H;this.height=z/H;this.renderer.width=this.width;this.renderer.height=this.height;za.setSize(this.width,this.height);a.scale=H;this.renderer.style.transform="scale("+H+","+H+")";za.domElement.style.transform="scale("+H+","+H+")";this.renderer.style.transformOrigin="top left";za.domElement.style.transformOrigin="top left";g.imageSmoothingEnabled=!1;this.redraw();w=128;r=180;A=128;c=80;k=128;f=r;m=128;I=80;e={x:128,y:r+60,w:128,h:40};this.automate(this.width,this.height)};
this.update=function(u){var z=0,H;for(H in u)for(var J in W)if(u[H].x>W[J].x*a.scale&&u[H].y>W[J].y*a.scale&&u[H].x<W[J].w*a.scale&&u[H].y<W[J].h*a.scale&&(z++,1==u[H].start)){W[J].funct();u[H].start=!1;break}};this.print=function(u,z,H,J){J=void 0===J?1:J;for(var O=0,ia=a.compile(z,a.width,a.col),T=a.compile(H,a.height,a.row),S=a.style;O<u.length;)a.encode(u.charAt(O),ia+O*a.col*J,T,J),O++;C||N.push(function(){a.style=S;a.print(u,z,H,J)})};this.text=function(u,z,H,J,O){J=void 0===J?1:J;for(O=0;O<
u.length;)a.encode(u.charAt(O),z+O*a.col*J,H,J),O++};this.button=function(u,z,H,J,O,ia,T,S){T=void 0===T?!0:T;S=void 0===S?1:S;var Z=a.compile(z,a.width,a.col),la=a.compile(H,a.height,a.row),ka=a.compile(J,a.width,a.col),oa=a.compile(O,a.height,a.row),ca=a.style;T&&(g.drawImage(h[a.style],0,0,1,1,Z,la+oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,Z,la-oa/2,ka+1,1),g.drawImage(h[a.style],0,0,1,1,Z,la-oa/2,1,oa),g.drawImage(h[a.style],0,0,1,1,Z+ka-1,la-oa/2,1,oa+1));for(var ea=0;ea<u.length;)a.encode(u.charAt(ea),
Z+ea*a.col+ka/2-Math.round(u.length*a.col)/2+2,la-a.row/2,S),ea++;W.push({x:Z,y:la-oa/2,w:Z+ka,h:la+oa/2,funct:function(){ia()}});C||N.push(function(){a.style=ca;a.button(u,z,H,J,O,ia,T,S)})};this.line=function(u,z,H,J){a.sprite(0,0,1,1,u,z,H,J)};this.sprite=function(u,z,H,J,O,ia,T,S){var Z=a.compile(O,a.width,a.col),la=a.compile(ia,a.height,a.row),ka=a.compile(T,a.width,a.col),oa=a.compile(S,a.height,a.row),ca=a.style;g.drawImage(h[a.style],u,z,H,J,Z,la,ka,oa);C||N.push(function(){a.style=ca;a.sprite(u,
z,H,J,O,ia,T,S)})};this.backdrop=function(u,z,H,J,O){u=void 0===u?"#10101099":u;!1===u?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=u)};this.getDrawList=function(){return N};this.redraw=function(){C=!0;a.clear();for(var u=0;u<N.length;u++)N[u]();u=document.body.getElementsByTagName("input");for(var z=0;z<u.length;z++)a.text(u[z].value,u[z].style.top,u[z].style.left);C=!1};this.automate=function(u,z){u=Math.floor(u/3)-2;z=Math.floor(z/4);A>u&&(A=u,w=
u,m=u,k=u,e.w=u,e.x=u);r>z&&(r=z+40,f=r,e.y=r+60)};this.pad=function(u,z,H,J,O,ia,T){var S=0;for(T();S<F.touches.length;)F.touches[S].x>z*a.scale&&F.touches[S].y>H*a.scale&&F.touches[S].x<(z+J)*a.scale&&F.touches[S].y<(H+O)*a.scale&&ia(),S++;Oa&&(g.drawImage(h[a.style],0,0,1,1,z+1,H,J-1,1),g.drawImage(h[a.style],0,0,1,1,z+1,H+O,J-1,1),g.drawImage(h[a.style],0,0,1,1,z+1,H,1,O),g.drawImage(h[a.style],0,0,1,1,z+J-1,H,1,O));a.encode(u,z+J/2-a.col/2,H+O/2-a.row/2)};this.dpad=function(){g.drawImage(h[a.style],
88,88,40,40,a.width-k+m/2-20,a.height-f+I/2-20,40,40);a.pad("<",w-A-1,a.height-r,A,c,function(){F.LEFT=!0},function(){F.LEFT=!1});a.pad(">",w+1,a.height-r,A,c,function(){F.RIGHT=!0},function(){F.RIGHT=!1});a.pad("^",a.width-k,a.height-f,m,I,function(){F.UP=!0},function(){F.UP=!1});a.pad("b",a.width-e.x,a.height-e.y+e.h/2,e.w,e.h,function(){F.DOWN=!0},function(){F.DOWN=!1})};this.clear=function(){if(!C){for(var u=document.body.getElementsByTagName("input"),z=0;z<u.length;z++)document.body.removeChild(u[z]);
if(!a.REDRAW){N=[];for(u=0;u<da.length;u++)document.body.removeChild(da[u]);da=[]}N=[]}for(u=0;u<this.timeouts.length;u++)window.clearTimeout(this.timeouts[u]);W=[];g.clearRect(0,0,a.width,a.height)};this["delete"]=function(u,z,H,J){z=void 0===z?0:z;H=void 0===H?za.width:H;J=void 0===J?za.height:J;u=a.compile(void 0===u?0:u,a.width,a.col);z=a.compile(z,a.height,a.row);H=a.compile(H,a.width,a.col);J=a.compile(J,a.height,a.row);g.clearRect(u,z,H,J)};this.encode=function(u,z,H,J){J=void 0===J?1:J;var O=
u.charCodeAt(0);u=8*O%128;O=8*Math.floor(O/16);g.clearRect(z,H,8,8);g.drawImage(h[a.style],u,O,8,8,z,H,8*J,8*J)};this["float"]=function(u,z){var H=Math.floor(Math.abs(100*u));H=H.toString();var J=H.slice(0,H.length-2),O=H.slice(H.length-2,H.length);return 0==u?"0.00":(0==J.length&&(J="0"),2>O.length&&(O+="0"),z&&0<u?J="+"+J:0>u&&(J="-"+J),H=J+"."+O,H)};this.compile=function(u,z,H){var J=0;switch(z=Math.floor(z),typeof u){case "number":J=u;break;case "function":J=u();break;case "string":for(var O=
!1,ia=1,T=0,S="";T<u.length;){var Z=u.charAt(T);"."===Z?(S+=Z,O=!0):"+"===Z?(S=O?Number(S)*z:Number(S)*H,S*=ia,ia=1,J+=S,O=!1,S=""):"-"===Z?(S=O?Number(S)*z:Number(S)*H,S*=ia,ia=-1,J+=S,O=!1,S=""):"p"===Z?(S=Number(S),S*=ia,J+=S,S=""):T===u.length-1?(S+=Z,S=O?Number(S)*z:Number(S)*H,S*=ia,J+=S,S=""):S+=Z;T++}}return J};this.textinput=function(u,z,H,J,O,ia,T){var S=a.compile(z,a.width,a.col),Z=a.compile(H,a.height,a.row),la=a.compile(J,a.width,a.col),ka=a.compile(O,a.height,a.row),oa=a.style;if(C)a.text("> "+
T.value,S,Z+ka/2);else{(T=document.createElement("input")).type="text";T.id=ia;T.name=ia;T.value=u;T.style.position="fixed";T.style.top=Z+"px";T.style.left=S+"px";T.style.width=la+"px";T.style.height=ka+"px";T.style.paddingLeft="12px";T.style.fontSize="14px";T.style.zIndex=9999;T.style.opacity=0;T.maxlength=10;a.text("> "+T.value,S,Z+ka/2);document.body.appendChild(T);window.setTimeout(function(){T.focus();T.select()},200);T.oninput=function(){ca()};T.onfocusout=function(){ca()};T.onfocusin=function(){ca()};
T.onclick=function(){ca()};var ca=function(ea){a["delete"](S,Z,la,ka);a.text("> "+T.value,S,Z+ka/2);a.text("_",T.selectionStart*a.col+2*a.col+S,Z+ka/2)};N.push(function(){a.style=oa;a.textinput(T.value,z,H,J,O,ia,T)})}};this.link=function(u,z,H,J,O,ia,T,S){var Z=a.compile(z,a.width,a.col)*a.scale,la=a.compile(H,a.height,a.row)*a.scale,ka=a.compile(J,a.width,a.col)*a.scale,oa=a.compile(O,a.height,a.row)*a.scale,ca=a.style;C||N.push(function(){return new function(){a.style=ca;ea.style.left=Z+"px";ea.style.top=
la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";a.print(u,Z,la)}});var ea=document.createElement("a");ea.href=ia;ea.style.left=Z+"px";ea.style.top=la+"px";ea.style.width=ka+"px";ea.style.height=oa+"px";ea.style.display="block";ea.style.zIndex=400;ea.style.position="fixed";ea.target="_blank";ea.id=ia;document.body.appendChild(ea);da.push(ea);C=!0;a.print(u,Z,la);C=!1};this.time=function(u){return(u/100).toFixed(2)};this.typewrite=function(u){a.clear();for(var z={$jscomp$loop$prop$e$148$190:0};z.$jscomp$loop$prop$e$148$190<
u.length;z={$jscomp$loop$prop$e$148$190:z.$jscomp$loop$prop$e$148$190},z.$jscomp$loop$prop$e$148$190++){var H=(z.$jscomp$loop$prop$e$148$190,0);H=Math.floor(z.$jscomp$loop$prop$e$148$190%32);var J=Math.floor(z.$jscomp$loop$prop$e$148$190/32);H=32+H%32*8;J=32+16*J;window.setTimeout(function(O){return function(){b.text(u.charAt(O.$jscomp$loop$prop$e$148$190),H,J)}}(z),50*z.$jscomp$loop$prop$e$148$190)}}}function yb(){var a=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=
0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return I};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=
[];this.IMPORT_BUFFER=[];this.FRAME=0;var g=[],l=0;this.TIMESTEP=Ka;var h=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var t=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),w=!1,r=!1,A=!1,c=!1,e=!0,k=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var f=0,m=0,I=0,C=0,N=!1,da=!1,W=0,u=0;this.DT=function(){return 1};var z={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},H=0,J=0,O=0;H=.004;J=.985-.98;O=.08-.06;var ia,
T,S,Z=6,la,ka=0,oa=0,ca=0,ea=new THREE.Vector3(0,1,0),Pa=new THREE.Vector3(0,0,0),Qa=new THREE.Vector3,q=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var p=new THREE.Vector3(0,0,1),n=new THREE.Vector3(0,0,1),D=new THREE.Vector3(0,0,1),B=new THREE.Vector3(0,0,1),y=new THREE.Vector3(0,0,-.008),Q=new THREE.Vector3,E=new THREE.Vector3,L=new THREE.Vector3,K=new THREE.Vector3;this.position=Q.clone();this.direction=ea.clone();this.lookAt=Q.clone();this.normal=n.clone();this.rotation=0;var P=[],U=new THREE.Vector3(0,
0,1),V=new THREE.Raycaster(K,U,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var ta=[{name:"logistics crate",geometry:function(){return Ta.logistics_crate()}},
{name:"ag-86",geometry:function(){return Ta.ag_86()}}];this.models=function(){return ta};this.PAINT=0;var Ca=new THREE.MeshBasicMaterial({color:Ja[a.PAINT]}),pa=(new THREE.LineSegments(ta[a.MODEL].geometry(),Ca)).clone();pa.name="Vehicle";var Xa=new Ta.emitter;this.connect=function(G,Y){pa.copy(new THREE.LineSegments(ta[a.MODEL].geometry(),Ca));pa.name="Vehicle";pa.geometry.computeBoundingSphere();L.copy(G);L.z+=2;pa.position.copy(L);fa.add(pa);Xa.connect(Ja[a.PAINT]);a.tune.power();a.tune.drag();
a.tune.sensitivity();a.tune.ease();fa.fog=new THREE.FogExp2(aa[0],.005);ba.fov=90;ba.updateProjectionMatrix();fa.add(M.generate.stars);a.START_POSITION.copy(L);a.START_NORMAL.copy(n);a.START_DIRECTION.copy(ea);a.START_VELOCITY.copy(Qa);uas.TARGETS.length<X.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;a.reset(!1);fa.remove(pa);Xa.disconnect();fa.fog=new THREE.FogExp2(aa[0],0);fa.remove(M.generate.stars);
this.DISCONNECT=!1};this.ready=function(G){G=void 0===G?window.performance.now():G;var Y;!w&&!this.REPLAY||this.RESET||(M.generate.checkpoints[0].display.material.color=aa[4],uas.reset(),u=1,N=!1,da=!1,e=!0,na.reset(),C=G,f=0,l=0,this.FRAME=0,g[l].time=0,g=[],g.length=0,l=0,g.push({time:0,position:a.START_POSITION.clone(),normal:a.START_NORMAL.clone(),direction:a.START_DIRECTION.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),a.REPLAY?(a.DEBUG_BUFFER=[],Y={time:0,
position:a.START_POSITION.clone(),direction:a.START_DIRECTION.clone(),normal:a.START_NORMAL.clone(),lookAt:B.clone(),velocity:a.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},a.DEBUG_BUFFER.push(Y),a.DISTANCE_AUDIT=[]):(a.INPUTS=[],a.PHYSICSBUFFER=[],a.PHYSICSBUFFER.length=0,Y={},Object.assign(Y,g[l]),a.PHYSICSBUFFER.push(Y),a.CHECKPOINT[0]=Date.now()),a.START=!0)};this.reset=function(G){G=void 0===G?!1:G;a.REPLAY=G;a.RESET=!0;va=!G;pa.visible=!0;ya&&(pa.visible=!1);this.SYNC=!1;this.FRAME=
this.TIMESTAMP=0;k=Ma=this.END=this.START=!1;F.UP=!1;F.DOWN=!1;F.LEFT=!1;c=A=r=w=F.RIGHT=!1;u=I=W=0;Q.copy(a.START_POSITION);E.copy(Q);ea.copy(a.START_DIRECTION);Qa.copy(a.START_VELOCITY);n.copy(a.START_NORMAL);K.copy(Q);this.position=Q.clone();this.direction=ea.clone();this.lookAt=Q.clone();this.normal=n.clone();la=ca=ka=oa=this.rotation=0;a.SPEED=0;U.copy(a.START_NORMAL);U.normalize();V.far=U.length();V.set(a.START_POSITION,U);D.copy(a.START_NORMAL);B.copy(a.START_NORMAL);B.add(a.START_POSITION);
ba.updateProjectionMatrix();k=!0;Xa.reset();na.reset();uas.reset();g=[];C=l=0;this.IMPORT||(C=window.performance.now());for(G=0;G<M.generate.checkpoints.length;G++)M.generate.checkpoints[G].display.material.color=aa[5];if(g[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!a.REPLAY)for(this.DEBUG_BUFFER=[],f=0,this.IMPORT||(a.best=a.overwrite(a.CHECKPOINT,
a.best)),M.best=a.overwrite(a.CHECKPOINT,M.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,a.inputs=[],a.inputs.push({key:0,time:0}),a.PHYSICSBUFFER=[],G={},Object.assign(G,g[l]),a.PHYSICSBUFFER.push(G),G=0;G<X.length;G++)X[G].reset();this.VALIDATE_CHECKPOINT=[];this.VALIDATE_CHECKPOINT.length=6;t.position.copy(a.START_POSITION);t.lookAt(B);pa.lookAt(B);t.rotateOnAxis(p,0);da=N=!1;e=!0;this.DISTANCE_AUDIT=[];a.RESET=!1};this.update=function(G){G=void 0===G?window.performance.now():G;Ma||a.END||
!k||a.REPLAY||a.RESET?(w=!1,r=!1,A=!1,c=!1):(w=F.UP,r=F.DOWN,A=F.LEFT,c=F.RIGHT,A&&c&&(A=!1,c=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?G+99999-C:G-C;G=0;if(this.TIMESTAMP>g[l].time){var Y={};Object.assign(Y,g[l]);var ha=Y.time;g=[];l=0;for(g.push({time:ha,position:Y.position.clone(),normal:Y.normal.clone(),direction:Y.direction.clone(),velocity:Y.velocity.clone(),rotation:Y.rotation,step:Y.step,U:Y.U,D:Y.D,L:Y.L,R:Y.R});ha<this.TIMESTAMP;){var ra;ha+=Ka;this.REPLAY&&this.START&&(G=
this.tapeReplay(ha));g.push({time:ha,position:g[l].position.clone(),normal:g[l].normal.clone(),direction:g[l].direction.clone(),velocity:g[l].velocity.clone(),rotation:g[l].rotation,step:g[l].step,U:w,D:r,L:A,R:c});l=g.length-1;a.START&&(Ha=wa=void 0,Ha=A&&c?0:A?1:c?-1:0,ca=g[l].step,0!=Ha&&Math.abs(ca)<Z?ca+=Ha:Math.abs(ca)>Z?(wa=ca/Math.abs(ca),ca=Z*wa):0<Math.abs(ca)&&(wa=ca/Math.abs(ca),ca-=ca/Math.abs(ca),ca/Math.abs(ca)!=wa&&(ca=0)),ka=ca/Z*S,g[l].rotation+=ka,g[l].step=ca,la=g[l].velocity.length(),
wa=void 0,w&&e&&(Pa.copy(g[l].direction),Pa.multiplyScalar(ia),g[l].velocity.add(Pa)),r&&e&&g[l].velocity.multiplyScalar(.95),e?(da=!1,wa=N?T-.01:T,g[l].velocity.multiplyScalar(wa)):e||(da?g[l].velocity.add(y):da=!0,g[l].velocity.multiplyScalar(.998)),g[l].position.add(g[l].velocity),t.position.copy(g[l].position),function(){P=[];K.copy(g[l].position);K.z-=50;U.set(0,0,1);V.far=100;V.set(K,U);M.surface.raycast(V,P);0<P.length?(K.copy(P[0].point),N=g[l].position.z<K.z&&5>Math.abs(g[l].position.z-K.z)?
(m=0,e=!0,n.copy(P[0].face.normal),g[l].position.copy(K),1!==P[0].face.color.r):e=!1):0===P.length&&(e=!1,N=!1,w||r||A||c||a.REPLAY||(m+=Ka),1E3<m&&!a.END&&!Ma&&(Ma=!0,R.dnf()));var ua=da?.001:.25;D.copy(g[l].normal);D.lerp(n,ua);ua=D.clone();ua.add(g[l].position);g[l].normal=D.clone();t.lookAt(ua);t.rotateOnAxis(p,g[l].rotation);ea.copy(t.localToWorld(q.clone()));ea.sub(g[l].position);ea.normalize();g[l].direction.copy(ea)}(),function(){P=[];U.copy(g[l].position);U.sub(g[l-1].position);U.normalize();
V.far=U.length();V.set(g[l].position,U);for(var ua=0,xa=!1,Ba=u;5>Ba;Ba++)if(M.generate.checkpoints[Ba].collision.raycast(V,P),0<P.length){ua=Ba;xa=!0;break}if(xa){Ba=g[l].position;xa=P[0].point;var La=g[l-1].position.distanceTo(xa);xa=Ba.distanceTo(xa);xa=g[l-1].time+La/(La+xa)*a.TIMESTEP;M.generate.checkpoints[ua].display.material.color=aa[4];a.CHECKPOINT[ua]=Math.floor(xa/10);xa=u!==ua;a.CHECKPOINT[5]=0;for(Ba=1;Ba<ua;Ba++)void 0===a.CHECKPOINT[Ba]&&--a.CHECKPOINT[5];u=ua+1;4<=ua&&!a.REPLAY?(a.END=
!0,a.REPLAY||R.complete()):a.REPLAY||a.IMPORT||R.checkpoint(xa)}a.SPEED=Math.round(60*la/1E3*3600);a.START&&!a.END&&(f=Math.floor(g[l].time/10));a.OBJECTIVE=u;E.copy(Q)}());this.FRAME++;this.START&&!this.REPLAY?(ra={},Object.assign(ra,g[l]),this.PHYSICSBUFFER.push(ra)):this.REPLAY&&G<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(ra={time:g[l].time,position:g[l].position.clone(),direction:g[l].direction.clone(),normal:g[l].normal.clone(),velocity:g[l].velocity.clone(),rotation:g[l].rotation,
U:g[l].U,D:g[l].D,L:g[l].L,R:g[l].R,step:g[l].step,lookAt:B.clone()},a.DEBUG_BUFFER.push(ra));!this.IMPORT&&5E3<this.TIMESTAMP-ha&&x.reset(this.REPLAY)}}var wa,Ha;if(h=(Ka-(g[l].time-this.TIMESTAMP))/Ka,1<g.length)this.position.copy(g[l-1].position),this.position.lerp(g[l].position,h),this.direction.copy(g[l-1].direction),this.direction.lerp(g[l].direction,h),this.rotation=g[l].rotation,this.rotation-=g[l-1].rotation,this.rotation*=h,this.rotation+=g[l].rotation,this.lookAt.copy(this.position),this.normal.copy(g[l-
1].normal),this.normal.lerp(g[l].normal,h),this.lookAt.copy(g[l].position),this.normal.copy(g[l].normal),ra=this.normal.clone(),ra.add(this.position),pa.position.copy(this.position),pa.lookAt(ra),pa.rotateOnAxis(p,this.rotation),Xa.update(w,this.position,this.direction,la);a.REPLAY_START&&a.replay();this.DISCONNECT?a.disconnect():a.RESET&&a.reset(a.REPLAY)};this.results=function(){return{reward:W,yen:0}};this.AT=function(){return f};this.convert=function(G){for(var Y=[],ha=0;ha<G.length;ha++){var ra=
G[ha].U,wa=G[ha].D,Ha=G[ha].L,ua=G[ha].R,xa=ra&&wa&&Ha,Ba=ra&&wa&&ua,La=0;xa||Ba?xa?La="a":Ba&&(La="b"):(La+=ra?3:wa?6:0,La+=Ha?1:ua?2:0);Y.push(La.toString())}return Y};this.replay=function(G){a.REPLAY_START?(0===a.INPUTS.length&&(a.INPUTS=a.PHYSICSBUFFER.slice()),va=!1,a.REPLAY=!0,a.REPLAY_START=!1,a.RESET=!0):a.REPLAY_START=!0};this.desyncTune=function(G,Y){void 0===G||G?(a.SAVE_PARAM.power=Y.power,a.SAVE_PARAM.drag=Y.drag,a.SAVE_PARAM.sensitivity=Y.sensitivity,a.SAVE_PARAM.model=Y.model,a.SAVE_PARAM.paint=
Y.paint):(a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this["import"]=function(){var G=X.length+" / "+R.BATTLE.length;0===X.length&&(a.SAVE_PARAM.power=a.param().power,a.SAVE_PARAM.drag=a.param().drag,a.SAVE_PARAM.sensitivity=a.param().sensitivity,a.SAVE_PARAM.model=a.MODEL,a.SAVE_PARAM.paint=a.PAINT);X.length<R.BATTLE.length?(R.scan(G,!1),this.reset(),a.PAINT=
R.BATTLE[X.length].param.paint,a.MODEL=R.BATTLE[X.length].param.model,a.paint(),a.body(),a.tune.power(R.BATTLE[X.length].param.power),a.tune.drag(R.BATTLE[X.length].param.drag),a.tune.sensitivity(R.BATTLE[X.length].param.sensitivity),a.INPUTS=R.BATTLE[X.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),a.replay()):(g[l].time=0,this.IMPORT=!1,ya?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,a.replay(),uas.spectate(),R.replay("import"),this.INPUTS=[]):(this.reset(!1),R.play()),
a.PAINT=a.SAVE_PARAM.paint,a.MODEL=a.SAVE_PARAM.model,a.paint(),a.body(),a.tune.power(a.SAVE_PARAM.power),a.tune.drag(a.SAVE_PARAM.drag),a.tune.sensitivity(a.SAVE_PARAM.sensitivity))};this.tune={power:function(G){G=void 0===G?z.power:G;z.power=0>G?0:5<G?5:G;ia=.016+z.power/5*H},drag:function(G){G=void 0===G?z.drag:G;z.drag=0>G?0:5<G?5:G;T=.985-z.drag/5*J},sensitivity:function(G){G=void 0===G?z.sensitivity:G;z.sensitivity=0>G?0:5<G?5:G;S=.06+z.sensitivity/5*O},ease:function(G){G=void 0===G?z.ease:
G;z.ease=0>G?0:5<G?5:G;Z=6+z.ease}};this.param=function(){return array=Object.assign(z,[]),array.model=a.MODEL,array.paint=a.PAINT,array};this.paint=function(G){G=void 0===G?a.PAINT:G;a.PAINT=G;Xa.paint(Ja[G]);Ca.color.set(Ja[G]);Ca.needsUpdate=!0};this.body=function(){pa.geometry.dispose();pa.geometry=ta[a.MODEL].geometry().clone();pa.geometry.verticesNeedUpdate=!0};this.yen=function(){return R.cSave("YEN",0),0};this.debug=function(){console.log("position:",Q);console.log("direction:",ea);console.log("rotation:",
oa);console.log("dt:",1);console.log("TIME:",Va);console.log("INTERPOLATION:",h);console.log("PHYSICS MESH:",t.rotation);console.log("EASE",Z);console.log(g);console.log(m);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",g[l]);console.log("PHYSICSBUFFER",this.PHYSICSBUFFER)};this.tapeReplay=function(G){var Y=0;if(0==a.INPUTS.length)Y=0;else if(G<a.INPUTS[a.INPUTS.length-1].time){for(;a.INPUTS[Y].time<G;)Y++;w=this.INPUTS[Y].U;
r=this.INPUTS[Y].D;A=this.INPUTS[Y].L;c=this.INPUTS[Y].R}else if(this.IMPORT){G=!0;for(var ha="",ra=1;ra<this.CHECKPOINT.length;ra++)this.CHECKPOINT[ra]!==R.BATTLE[X.length].cp[ra]&&(""===ha&&(ha+="checkpoint_discrepancy"),G=!1);if(a.CHECKPOINT[4]-1E4*a.CHECKPOINT[5]!==R.BATTLE[X.length].time&&(G=!1,ha+="final_time_discrepancy"),G){G=[];for(ha=0;ha<this.DEBUG_BUFFER.length;ha++)G.push({time:this.DEBUG_BUFFER[ha].time,position:this.DEBUG_BUFFER[ha].position.clone(),direction:this.DEBUG_BUFFER[ha].direction.clone(),
rotation:this.DEBUG_BUFFER[ha].rotation,normal:this.DEBUG_BUFFER[ha].normal.clone(),lookAt:this.DEBUG_BUFFER[ha].lookAt.clone(),U:this.DEBUG_BUFFER[ha].U});X.push(new lb(G,this.MODEL,this.PAINT,this.CHECKPOINT.slice(),R.BATTLE[X.length].name))}else firebase.analytics().logEvent("invalid_data",{seed:M.name,uid:R.BATTLE[X.length].uid,name:R.BATTLE[X.length].name,report:M.name+"/"+R.BATTLE[X.length].uid+"("+R.BATTLE[X.length].name+")"+ha+" : "+ma+"/("+ja+")",error:ha}),R.BATTLE.splice(X.length,1);this["import"]()}else a.replay(!1),
this.START=this.IMPORT=!1;return Y};this.overwrite=function(G,Y,ha){ha=void 0===ha?!0:ha;var ra=G[4]<Y[4],wa=G[5]>=Y[5],Ha=G[5]>Y[5];return void 0===Y[4]||ra&&wa||Ha?!ha||G:!!ha&&Y};this.decode=function(G){var Y=[function(){F.UP=!1;F.DOWN=!1;F.LEFT=!1;F.RIGHT=!1},function(){F.UP=!1;F.DOWN=!1;F.LEFT=!0;F.RIGHT=!1},function(){F.UP=!1;F.DOWN=!1;F.LEFT=!1;F.RIGHT=!0},function(){F.UP=!0;F.DOWN=!1;F.LEFT=!1;F.RIGHT=!1},function(){F.UP=!0;F.DOWN=!1;F.LEFT=!0;F.RIGHT=!1},function(){F.UP=!0;F.DOWN=!1;F.LEFT=
!1;F.RIGHT=!0},function(){F.UP=!1;F.DOWN=!0;F.LEFT=!1;F.RIGHT=!1},function(){F.UP=!1;F.DOWN=!0;F.LEFT=!0;F.RIGHT=!1},function(){F.UP=!1;F.DOWN=!0;F.LEFT=!1;F.RIGHT=!0},function(){F.UP=!0;F.DOWN=!0;F.LEFT=!1;F.RIGHT=!1}];Y.a=function(){F.UP=!0;F.DOWN=!0;F.LEFT=!0;F.RIGHT=!1};Y.b=function(){F.UP=!0;F.DOWN=!0;F.LEFT=!1;F.RIGHT=!0};Y[G]()};this.audit=function(){}}function zb(a){var g=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return g.tape[l].timer};this.DT=
ib();var l=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(h){this.keybuffer.push({key:(F.UP?3:F.DOWN?6:0)+(F.LEFT?1:F.RIGHT?2:0),time:h})};this.simulate=function(){};this.capture=function(h){return{position:(new THREE.Vector3).copy(h.position),normal:(new THREE.Vector3).copy(h.normal),lookTarget:h.lookTarget.clone(),rotation:h.rotation,timer:h.getTime(),objective:h.getObjective(),check:h.check,UP:h.UP}};this.record=function(h){g.tape[l]=h.record();l=24E4<g.tape[l].TS?0:l+1};this.play=
function(h){if(this.RECORD){this.RECORD=!1;for(var t=g.frame=0;t<X.length;t++)X[t].reset();na.reset()}if(g.frame>g.tape.length-10){g.frame=0;na.reset();for(t=0;t<X.length;t++)X[t].reset();M.generate.resetCheckpoints()}if(h.replay(),this.tape[g.frame].check)M.generate.checkpoints[0===this.tape[g.frame].objective?4:this.tape[g.frame].objective-1].display.material.color=aa[4]};this.reset=function(){M.generate.resetCheckpoints();l=0;g.frame=0;na.reset();g.PLAY=!1;g.RECORD=!0;g.tape=[]};this["export"]=
function(h,t){h=void 0===h?function(){R.results()}:h;var w=x.CHECKPOINT[4]-1E4*x.CHECKPOINT[5];if((w<Na||!1===Na)&&""!==ja&&null!==ja&&!1!==ma&&void 0!==ma&&!g.SCAN){R.STATE=function(){b.clear();b.print("uploading vhs to db","2","2")};R.STATE();ma;for(var r=M.name,A=x.CHECKPOINT.slice(),c=x.CHECKPOINT[0],e=x.param(),k=[];k.length<x.PHYSICSBUFFER.length;){var f=k.length;f={time:x.PHYSICSBUFFER[f].time,U:x.PHYSICSBUFFER[f].U,D:x.PHYSICSBUFFER[f].D,L:x.PHYSICSBUFFER[f].L,R:x.PHYSICSBUFFER[f].R};k.push(f)}e=
{version:"006",id:ma,seed:r,time:w,cp:A,utc:c,debug:k,param:e};firebase.database().ref("vhs/006/"+e.seed+"/"+ma).set(e,function(m){m?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2","2"));window.setTimeout(h,1E3);uas.replay();x.replay()})}else void 0===ma||!1===ma||null===ja||""===ja||void 0===ja?R.register():(R.results(),uas.replay(),x.replay())};this.burn=function(h){return Math.round(1E9*h).toString(16)};this.read=function(h){return parseInt(h,16)/
1E9};this.scan=function(h,t){g.SCAN=!0;var w=[];firebase.database().ref("vhs/006/"+h).orderByChild("time").limitToFirst(99).once("value").then(function(r){r.forEach(function(A){var c=A.child("id").val(),e=A.child("time").val();A=A.child("utc").val();w.push({uid:c,time:e,utc:A})});g.SCAN=!1;t(w)})};this.checkTime=function(h,t,w){h===t&&(Na=w)};this.requestName=function(h,t){firebase.database().ref("uid/"+h).once("value").then(function(w){w=w.child("name").val();return t(w),w})};this["import"]=function(h,
t){t=void 0===t?function(){}:t;firebase.database().ref("vhs/006/"+h).once("value").then(function(w){var r=w.val(),A=r.id,c=r.seed,e=r.cp.slice();w=r.utc;r.model;r.paint;r.param;t({uid:A,seed:c,cp:e,utc:w,debug:r.debug.slice(),param:r.param})})};this.save=function(h,t){t=void 0===t?1E3/30:t;for(var w=0,r=[],A=h[h.length-1].TS,c=0;c<A;)c+=t,c<A&&r.push({TS:c});for(A=0;A<r.length;A++)w=g.convert(h,r[A],w);return r};this.convert=function(h,t,w){for(var r=h[w].time,A=h[w+1].TS,c=A-r;t.time>A&&w<h.length-
2;)r=h[++w].time,A=h[w+1].time,c=A-r;r=w;var e=w+1;A=(c-(A-t.time))/c;return t.position=new THREE.Vector3,t.position.copy(h[r].position),t.position.lerp(h[e].position,A),t.lookTarget=new THREE.Vector3,t.lookTarget.copy(h[r].normal),t.lookTarget.lerp(h[e].normal,A),t.rotation=(h[e].rotation-h[r].rotation)*A,t.rotation+=h[r].rotation,t.rotation=(h[e].rotation-h[r].rotation)*A,t.rotation+=h[r].rotation,t.AT=(h[e].AT-h[r].AT)*A,t.AT+=h[r].AT,t.UP=h[r].UP,t.check=h[r].check,t.objective=h[r].objective,
w}}var lb=function(a,g,l,h,t){l=void 0===l?0:l;h=void 0===h?[]:h;var w=[];this.inputs=[];this.name=void 0===t?"":t;this.cp=h;w[0]={name:"logistics crate",geometry:function(){return Ta.logistics_crate()}};w[1]={name:"ag-86",geometry:function(){return Ta.ag_86()}};t=void 0===g?0:g;g=l;var r=a.slice();this.PHYSICS=r;var A=0,c=new THREE.Vector3(0,0,1);r[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;var e=new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;
this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var k=w[t].geometry(),f=new THREE.MeshBasicMaterial({color:Ja[g]}),m=new THREE.LineSegments(k,f);m.visible=!0;m.name="ghost_"+X.length;m.position.copy(r[0].position);fa.add(m);var I=new Ta.emitter;I.connect(Ja[l]);0===M.best.length||h[4]<M.best[4]&&(h[5],M.best[5]);uas.TARGETS.push(this);ya&&(uas.TARGET=1);this.reset=function(){na.reset();I.reset();A=0};this.update=function(C){this.index(C);
var N=(1E3/60-(r[A].time-C))/(1E3/60),da=r[A].U;0!==A&&0!==C||(A=1,N=0,da=!1);C=this.normal.clone();C.add(this.position);this.direction.copy(m.localToWorld(e.clone()));this.direction.sub(this.position);this.direction.normalize();m.position.copy(this.position);m.lookAt(C);m.rotateOnAxis(c,this.rotation);this.interpolate(N);this.lookAt.copy(this.position);this.velocity.copy(r[A].position);this.velocity.sub(r[A-1].position);I.update(da,this.position,this.direction,this.velocity.length())};this.interpolate=
function(C){this.position.copy(r[A-1].position);this.position.lerp(r[A].position,C);this.normal.copy(r[A-1].normal);this.normal.lerp(r[A].normal,C);this.rotation=r[A].rotation;this.rotation-=r[A-1].rotation;this.rotation*=C;this.rotation+=r[A].rotation};this.discrete=function(){this.position.copy(r[A].position);this.rotation=r[A].rotation;this.normal.copy(r[A].normal)};this.index=function(C){if(A=0,C<=r[r.length-2].time)for(;r[A].time<=C;)A++;else A=r.length-2};this.toggleEmitter=function(C){void 0===
C||C?I.connect():I.disconnect()};this.disconnect=function(){fa.remove(m);k.dispose();f.dispose();I.disconnect()};this.debug=function(){console.log(r)};this.hide=function(){m.visible=!1};this.show=function(){m.visible=!0}};window.onload=function(){window.addEventListener("touchstart",gb);window.addEventListener("contextmenu",function(){event.preventDefault()});fa=new THREE.Scene;fa.background=mb;nb=new THREE.Vector3(0,0,1);ba=new THREE.PerspectiveCamera;ba.up=nb;ba.position.z=2E3;ba.lookAt(0,0,0);
ba.fov=70;ba.near=1E-5;ba.far=3E3;ba.name="Camera";fa.add(ba);za=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});za.setClearColor(mb);za.domElement.id="renderer";za.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(za.domElement);F=new ob;F.connect();b=new xb;M=new rb;x=new yb;sa=new zb;R=new tb;R.login();R.checksave();R.decodeURL();uas=new wb;uas.connect();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");
b.format(4,"#ff7272");b.format(5,"#eeeeee");ba.position.set(0,25,10);ba.lookAt(0,0,0);Ia();hb();R.intro()}};window.onresize=Ia;window.fullscreenchange=Ia;window.focus=Ia;var fb="artology forest;coen mountain;coffee forest;coyote forest;deadmans wonderland;development mountain;do it pass;eenetsu pass;ego mountain;ghxst pass;ghxstly forest;ginko mountain;haunted forest;hoekage mountain;ifuta pass;jaywalk pass;kae mountain;lotus mountain;low tunnel pass;lyla forest;mach mountain;mew mountain;nephil pass;nminke pass;ogj route;olive forest;pine forest;prey first pass;r3 mountain;r3evaluate pass;ratty mountain;rekenase mountain;rex mountain;rutsuyo pass;sheep pass;shinigami graveyard;sleeping forest;the lotus order;tofu route;tora forest;tora tora pass;totoworo forest;ultra mountain;utopia district;vancouver island survey;vr pass;wasabi mountain;zynra mountain".split(";"),
aa=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],cb;for(cb in aa){var Ab=new THREE.Color(aa[cb]);aa[cb]=Ab}var Ja=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],ub="snow sakura melon peach bumblebee lavender ice".split(" "),Na=!1,Ua="",Ra=Math.floor(2147483647*Math.random()),eb="",fa,ba,za,M,x,F,b,sa,R,X=[],Ka=1E3/60,Da=12,Aa=9,Ea=0,Ya=!0,bb=!1,ab=!1,ma=null,ja="",nb,va=!1,mb=aa[0],sb=0,Ma=!1,Sa=!1,qa=!1,$a=!1,Ga=!1,
Oa=!0,Va=0,Wa=!1,Za=!1,ya=!1,qb=!1,kb=!1,jb=!1,Fa=1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics=function(){return{logEvent:function(a){console.log("LOGGING DISABLED",a)}}};var Ta={ag_86:function(){geometry=
new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,
1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,
2,1)));return a.name="Logistics Crate",a},emitter:function(){var a=this;this.maxLife=100;for(var g=0,l=new THREE.Geometry;l.vertices.length<a.maxLife;){var h=new THREE.Vector3(0,0,0);h.life=0;h.maxLife=a.maxLife;h.acc=new THREE.Vector3(0,0,0);l.vertices.push(h);h=new THREE.Color(4294967040);l.colors.push(h)}l.verticesNeedUpdate=!0;var t=new THREE.Points(l,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));t.name="Emitter";var w=new THREE.Color;
a.connect=function(r){r=void 0===r?16777215:r;fa.add(t);a.paint(r)};a.paint=function(r){r=new THREE.Color(void 0===r?16777215:r);w=new THREE.Color;r.getHSL(w);for(r=0;r<t.geometry.vertices.length;r++)t.geometry.colors[r].setHSL(w.h,w.s,0),t.geometry.vertices[r].life=0};a.reset=function(){for(var r=0;r<t.geometry.colors.length;r++)t.geometry.colors[r].setHSL(w.h,w.s,0),t.geometry.vertices[r].life=0};a.disconnect=function(){fa.remove(t);t.geometry.dispose();t.material.dispose()};a.update=function(r,
A,c,e){if(r)for(r=0;1>r;){t.geometry.vertices[g].copy(c);t.geometry.vertices[g].multiplyScalar(-1-Math.random()*e);t.geometry.vertices[g].add(A);t.geometry.vertices[g].life=t.geometry.vertices[g].maxLife;Math.random();Math.random();Math.random();var k=.1*-Math.random();t.geometry.vertices[g].acc.copy(c);t.geometry.vertices[g].acc.multiplyScalar(k);g++;g%=t.geometry.vertices.length;r++}for(var f in t.geometry.vertices){var m;0<t.geometry.vertices[f].life&&(t.geometry.vertices[f].add(t.geometry.vertices[f].acc),
--t.geometry.vertices[f].life,m=t.geometry.vertices[f].life/100,t.geometry.colors[f].setHSL(w.h,w.s,w.l*m));0>=t.geometry.vertices[f].life&&(t.geometry.vertices[f].set(0,0,0),t.geometry.vertices[g].acc.x=0,t.geometry.vertices[g].acc.y=0,t.geometry.vertices[g].acc.z=0)}t.geometry.verticesNeedUpdate=!0;t.geometry.colorsNeedUpdate=!0;t.geometry.computeBoundingSphere()}}},pb=function(){function a(w){return w*w*w*(w*(6*w-15)+10)}function g(w,r,A){return r+w*(A-r)}function l(w,r,A,c){var e=15&w;w=8>e?r:
A;c=4>e?A:12==e||14==e?r:c;return(0==(1&e)?w:-w)+(0==(2&e)?c:-c)}for(var h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,
109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],t=0;256>t;t++)h[256+
t]=h[t];return{noise:function(w,r,A){var c=Math.floor(w),e=Math.floor(r),k=Math.floor(A),f=255&c,m=255&e,I=255&k,C=(w-=c)-1,N=(r-=e)-1,da=(A-=k)-1,W=a(w),u=a(r);c=a(A);e=h[f]+m;k=h[e]+I;e=h[e+1]+I;f=h[1+f]+m;m=h[f]+I;I=h[f+1]+I;return g(c,g(u,g(W,l(h[k],w,r,A),l(h[m],C,r,A)),g(W,l(h[e],w,N,A),l(h[I],C,N,A))),g(u,g(W,l(h[k+1],w,r,da),l(h[m+1],C,r,A-1)),g(W,l(h[e+1],w,N,da),l(h[I+1],C,N,da))))}}},vb=function(a,g){for(var l="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61".split(" "),
h="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),t=a.toLowerCase(),w=0;w<t.length;w++){var r=t.charCodeAt(w);if(122<r||57<r&&61>r||33>r||40==r||41==r)return"";r="";for(var A=w;A<t.length;A++){t.charAt(A);var c=t.charCodeAt(A);(48<=c&&57>=c||97<=c&&122>=c)&&(r+=c.toString(16));for(c=0;c<l.length;c++){for(var e="",k="",f=[],m=0,I=0,C=0;C<l[c].length;C+=2){var N=r.charAt(C+m)+r.charAt(C+1+m),da=l[c].charAt(C)+l[c].charAt(C+1);if((N===e||N===k)&&0!==N.length&&(I++,
0<I))for(;N===e||N===k;)m+=2,N=r.charAt(C+m)+r.charAt(C+1+m);if(N===da)f[C/2]=!0,e=N,k=da;else{f[C/2]=!1;for(var W=0;W<h.length;W++){var u=h[W].charCodeAt(1).toString(16),z=h[W].charCodeAt(0).toString(16);N===u&&(z===da?(f[C/2]=!0,e=u,k=da):z!==e&&z!==k||(I++,0<I&&(m+=2,C-=2)))}!1===f[C/2]&&(C=l[c].length)}}for(k=e=0;k<f.length;k++)if(!0===f[k]&&e++,e===f.length)return""}}}return a},na={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){na.start=window.performance.now();
na.time=0;na.last=0;na.timestep=1E3/60;na.dt=1}},ib=function(){return na.time=window.performance.now()-na.start,na.timestep=na.time-na.last,na.dt=na.timestep/(1E3/60),2<na.dt&&(na.dt=2),na.last=na.time,na.dt};na.convert=function(a){a=void 0===a?[]:a;for(var g="[\n",l=0;l<a.length;l++){g+="'";for(var h=0;h<a[l].length;h++)g+=a[l].charCodeAt(h).toString(16);g+="',\n"}return g+="]",console.log(g),g}})();