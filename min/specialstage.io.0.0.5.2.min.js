(function(){function pb(){var a=this;this.BINDINGS=this.GAMEPAD=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",a.touch,!1),window.addEventListener("touchmove",a.touch,!1),window.addEventListener("touchend",a.touch,!1)):(window.addEventListener("keydown",a.key,!1),window.addEventListener("keyup",a.key,!1),window.addEventListener("mousedown",a.mousedown),window.addEventListener("mouseup",
a.mouseup,!1),window.addEventListener("touchstart",a.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.removeEventListener("touchstart",a.touch,!1);window.removeE;ventListener("touchmove",a.touch,!1);window.removeEventListener("touchend",a.touch,
!1)};this.key=function(e){var g="keydown"==e.type;switch(e.key){case "ArrowUp":a.UP=g;break;case "ArrowDown":a.DOWN=g;break;case "ArrowLeft":a.LEFT=g;break;case "ArrowRight":a.RIGHT=g;break;case "w":a.UP=g;break;case "s":a.DOWN=g;break;case "a":a.LEFT=g;break;case "d":a.RIGHT=g;break;case "r":a.RESET=g;break;case " ":a.SPACE=g;break;case "Enter":a.ENTER=g}};this.mousedown=function(e){e.preventDefault();a.touches[0]={x:e.clientX,y:e.clientY,start:!0}};this.mouseup=function(e){e.preventDefault();a.touches[0]=
{x:e.clientX,y:e.clientY,start:!1}};this.touchSetup=function(e){window.removeEventListener("keydown",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("keyup",a.key,!1);window.removeEventListener("mousedown",a.mousedown,!1);window.removeEventListener("mouseup",a.mouseup,!1);window.removeEventListener("touchstart",a.touchSetup,!1);window.addEventListener("touchstart",a.touchstart,!1);window.addEventListener("touchmove",a.touchmove,!1);window.addEventListener("touchend",
a.touchend,!1);a.touchstart(e)};this.clear=function(){a.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(e){e=e.touches;a.touches=[];for(var g=0;g<e.length;g++)a.touches[g]={x:e[g].clientX,y:e[g].clientY,start:!0}};this.touchmove=function(e){a.touches=[];e=e.touches;for(var g=0;g<e.length;g++)a.touches[g]={x:e[g].clientX,y:e[g].clientY,start:!1}};this.touchend=function(e){a.touches=[];e=e.touches;for(var g=0;g<e.length;g++)a.touches[g]={x:e[g].clientX,y:e[g].clientY,
start:!1}}}function ib(){var a=(scope=this).SEED=0;this.length=480;var e=[],g=0;e[0]={name:"forest",palette:X[9],tree:function(k,h){return scope.pine()},limit:Math.floor(scope.length/2),range:5,map:[],flags:[]};e[0].map[0]=function(k,h){var f=X[10],y=!1;return.92<Math.abs(k)&&(f=.92<Math.abs(k)?X[9]:X[2],y=!0),e[0].flags[h]=y,f};e[1]={name:"sakura",palette:X[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};e[1].map[0]=function(k,h){var f=X[1],
y=!1;return.95<Math.abs(k)&&(f=.92<Math.abs(k)?X[12]:X[1],y=!0),e[1].flags[h]=y,f};e[2]={name:"summit",palette:X[1],tree:function(){return new THREE.Geometry},limit:0,range:10,map:[],flags:[]};e[2].map[0]=function(k,h){var f=X[7],y=!1;return.95<Math.abs(k)&&(f=.92<Math.abs(k)?X[2]:X[7],y=!0),e[2].flags[h]=y,f};var d=new THREE.Points(new THREE.Geometry);d.name="Generative Extruder";d.visible=!1;var w=new THREE.Line(new THREE.Geometry);w.name="Generative Nodes";w.visible=!1;w.material.color=X[6];w.material.name=
"Node Material";w.position.z+=2;var z=new THREE.LineSegments(new THREE.Geometry);z.name="Generative Segments";z.visible=!0;z.material.color=X[3];z.material.name="Segments Material";var x=new THREE.Mesh(new THREE.Geometry);x.name="Generative Surface";x.visible=!1;x.material.color=X[0];x.material.name="Surface Material";var t=new THREE.LineSegments(new THREE.Geometry);t.name="Generative Perimeter";t.material.color=X[1];t.material.name="Perimeter Material";var r=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));
r.name="Terrain";r.material.name="Terrain Material";r.material.wireframe=!0;r.material.side=THREE.DoubleSide;r.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var c=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));
c.name="Trees";var l=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);l.name="Background";l.material.color=X[0];l.material.name="Background Material";l.material.wireframe=!1;l.material.side=THREE.FrontSide;l.material.opacity=.75;l.material.blendMode=THREE.MultiplyBlending;l.material.transparent=!0;var n=new THREE.Points(new THREE.Geometry);n.material.color=X[1];n.material.sizeAttenuation=!1;n.material.size=1.5;n.material.fog=!1;scope.stars=n;var m=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);
m.name="Collision Mesh";m.visible=!0;m.material.name="Collision Material";m.material.side=THREE.BackSide;this.checkpoints=[];var A=new THREE.Vector3(0,0,1),F=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var Q=new THREE.Vector3(0,3,0),T=new THREE.Vector3(0,0,1),U=w.geometry.clone(),p=x.geometry.clone(),C=z.geometry.clone(),E=t.geometry.clone(),D=[],M=[],ba=new THREE.Vector3;D[0]=new THREE.Vector3(5,3,0);D[1]=new THREE.Vector3(-5,3,0);M[0]=D[0].clone();M.z+=1;M[1]=D[1].clone();
M.z+=1;var N=Math.PI/64,K=Math.PI/32,Y=[],ka=0,ha=new THREE.Vector3;this.start=new THREE.Vector3;var na=!1,la=!1,ca=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Ia=18,La=new THREE.Raycaster;La.far=800;d.geometry.vertices[0]=Q.clone();d.geometry.vertices[1]=A.clone().add(Q);d.geometry.vertices[2]=D[0].clone();d.geometry.vertices[3]=D[1].clone();d.geometry.vertices[4]=M[0].clone();d.geometry.vertices[5]=M[1].clone();this.connect=function(){scope.SEED=Oa;g=scope.randomInt(0,3);O.SNOW=2===g;O.SNOW&&
O.snow.init();aa.add(d);aa.add(w);aa.add(z);aa.add(t);aa.add(x);aa.add(wireframe);aa.add(l);ka=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var k in Y=[],aa.remove(d),aa.remove(w),aa.remove(z),aa.remove(t),aa.remove(x),aa.remove(wireframe),aa.remove(l),aa.remove(c),e)e[k].flag=[];for(var h in scope.checkpoints)aa.remove(scope.checkpoints[h].display),scope.checkpoints[h].display.geometry.dispose(),scope.checkpoints[h].collision.geometry.dispose()};this.complete=
function(){m.geometry.mergeVertices();m.geometry.verticesNeedUpdate=!0;m.geometry.elementsNeedUpdate=!0;m.geometry.computeFaceNormals();m.geometry.computeVertexNormals();m.geometry.computeBoundingSphere();l.geometry.copy(m.geometry);--l.position.z;for(var k=[],h=0;h<m.geometry.faces.length;h++)k[m.geometry.faces[h].a]=m.geometry.faces[h].vertexNormals[0].clone(),k[m.geometry.faces[h].b]=m.geometry.faces[h].vertexNormals[1].clone(),k[m.geometry.faces[h].c]=m.geometry.faces[h].vertexNormals[2].clone();
for(h=0;h<m.geometry.vertices.length;h++)m.geometry.vertices[h].add(k[h].multiplyScalar(2));m.geometry.verticesNeedUpdate=!0;wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();k=new THREE.IcosahedronGeometry(1200,4);for(var f in k.vertices).6>scope.random()&&-400<k.vertices[f].z&&n.geometry.vertices.push(k.vertices[f].clone());k.dispose();n.geometry.computeBoundingSphere();
O.surface=m.clone();O.start=scope.start.clone();ka=window.performance.now()-ka;na=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(ka/1E3)});cb?(b.clear(),G.connect(O.start,O.surface),G.PLAY=!1,da.PLAY=!0):oa.ready()};this.reset=function(){Ia=(36+scope.random()-.5)/2;a=0;w.geometry.dispose();z.geometry.dispose();x.geometry.dispose();d.geometry.dispose();t.geometry.dispose();r.geometry.dispose();wireframe.geometry.dispose();m.geometry.dispose();c.geometry.dispose();
n.geometry.dispose();C.dispose();E.dispose();U.dispose();p.dispose();C.copy(new THREE.Geometry);E.copy(new THREE.Geometry);U.copy(new THREE.Geometry);p.copy(new THREE.Geometry);w.geometry.copy(new THREE.Geometry);d.geometry.copy(new THREE.Geometry);z.geometry.copy(new THREE.Geometry);t.geometry.copy(new THREE.Geometry);x.geometry.copy(new THREE.Geometry);r.geometry.copy(new THREE.Geometry);m.geometry.copy(new THREE.Geometry);Q.set(0,3,0);T.set(0,0,1);D[0]=new THREE.Vector3(4,3,0);D[1]=new THREE.Vector3(-4,
3,0);na&&(na=!1,la=!1,ca=!1);this.END=!1;d.position.set(0,0,0);d.geometry.vertices[0]=Q.clone();d.geometry.vertices[1]=A.clone().add(Q);d.geometry.vertices[2]=D[0].clone();d.geometry.vertices[3]=D[1].clone();d.geometry.vertices[4]=M[0].clone();d.geometry.vertices[5]=M[1].clone();d.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(k,h,f,y,u,q,S,B,I,H){k=void 0===k?0:k;h=void 0===h?0:h;f=void 0===f?0:f;y=void 0===y?0:y;u=void 0===u?0:u;q=void 0===q?{start:0,end:30,
angle:0,slope:0}:q;S=void 0===S?[]:S;B=void 0===B?[]:B;I=void 0===I?!1:I;H=void 0===H?999:H;var P=window.performance.now(),Z=0;for(0===y&&(y=.5<scope.random()?1:-1);32>Z&&!la;){if(k===q.end+1){B=[];for(f=0;1>f;f++)if(k>=scope.length)B.push({angle:0,slope:0,end:30}),H=k+30;else if(0===h){var V=scope.randomInt(2,4)*y;Z=Math.floor(Math.abs(36/V));y=.01>scope.random()?+y:-1*y;Z=scope.randomInt(1,Z);B.push({angle:V,slope:0,end:Z})}else V=scope.randomInt(-5,-1),Z=scope.random(),V=2!==g&&.05>Z?V*=-1:V,Z=
scope.randomInt(2,20),B.push({angle:0,slope:V,end:Z});Z=scope.randomInt(0,B.length);h=B[Z].angle;f=B[Z].slope;q.start=k;q.end=k+B[Z].end;B=B.slice(Z,1)}if(I||(scope.extrude(h,f),Y.push({angle:h,slope:f}),U.verticesNeedUpdate=!0,k++),10<=k&&!I){Z=new THREE.Vector2(U.vertices[k-1].x,U.vertices[k-1].y);for(V=0;V<U.vertices.length-1-10;V++)if(18>(new THREE.Vector2(U.vertices[V].x,U.vertices[V].y)).distanceTo(Z)){I=!0;break}I&&window.setTimeout(O.reset(!0),0)}0;k===H&&(la=!0,w.geometry.dispose(),w.geometry=
U.clone(),w.geometry.computeBoundingSphere(),w.geometry.center(),w.updateMatrixWorld(),0<w.geometry.vertices.length&&(ha.copy(w.geometry.vertices[0]),ha.sub(U.vertices[0])),window.setTimeout(function(){oa.PATH=!0;oa.STATE();scope["import"]()},0));Z=window.performance.now()-P}la||I||window.setTimeout(scope.path,0,k,h,f,y,u,q,S,B,I,H)};this.skijump=function(k,h,f,y,u,q,S,B,I,H,P){k=void 0===k?0:k;h=void 0===h?0:h;f=void 0===f?0:f;y=void 0===y?0:y;u=void 0===u?0:u;q=void 0===q?{start:0,end:20,angle:0,
slope:0}:q;S=void 0===S?[]:S;B=void 0===B?[]:B;I=void 0===I?!1:I;H=void 0===H?300:H;P=void 0===P?0:P;var Z=window.performance.now(),V=0;for(0===y&&(y=.5<scope.random()?1:-1);32>V&&!la;){if(k===q.end+1){B=[];for(h=0;1>h;h++)0===f&&20===q.end?(P=-1,B.push({angle:0,slope:-4,end:30})):3===f?B.push({angle:0,slope:4,end:3}):4===f?B.push({angle:0,slope:-32,end:10}):-4===f?(P=1,B.push({angle:0,slope:f+1,end:1})):-32===f?B.push({angle:0,slope:-4,end:40}):1==P?B.push({angle:0,slope:f+1,end:1}):-1==P&&B.push({angle:0,
slope:f-1,end:1});V=scope.randomInt(0,B.length);h=B[V].angle;f=B[V].slope;q.start=k;q.end=k+B[V].end;B=B.slice(V,1)}if(I||(scope.extrude(h,f),Y.push({angle:h,slope:f}),U.verticesNeedUpdate=!0,k++),10<=k&&!I){V=new THREE.Vector2(U.vertices[k-1].x,U.vertices[k-1].y);for(var va=0;va<U.vertices.length-1-10;va++)if(0>(new THREE.Vector2(U.vertices[va].x,U.vertices[va].y)).distanceTo(V)){I=!0;break}I&&window.setTimeout(O.reset(!0),0)}0;H<=k&&(la=!0,w.geometry.dispose(),w.geometry=U.clone(),w.geometry.computeBoundingSphere(),
w.geometry.center(),w.updateMatrixWorld(),0<w.geometry.vertices.length&&(ha.copy(w.geometry.vertices[0]),ha.sub(U.vertices[0])),window.setTimeout(function(){scope["import"]()},0));V=window.performance.now()-Z}la||I||window.setTimeout(scope.skijump,0,k,h,f,y,u,q,S,B,I,H)};this["import"]=function(k){k=void 0===k?0:k;for(var h=window.performance.now(),f=0;!ca&&32>f;){if(0===k&&(d.position.set(0,0,0),d.rotation.z=0,Q.set(0,3,0),d.geometry.vertices[0]=Q.clone(),d.geometry.vertices[1]=A.clone().add(Q),
d.geometry.vertices[2]=D[0].clone(),d.geometry.vertices[3]=D[1].clone(),d.geometry.vertices[4]=M[0].clone(),d.geometry.vertices[5]=M[1].clone(),d.geometry.verticesNeedUpdate=!0,d.updateMatrixWorld()),k<Y.length)a=k,angle=Y[k].angle,slope=Y[k].slope,scope.extrude(angle,slope),z.geometry.dispose(),z.geometry=C.clone(),z.geometry.computeBoundingSphere(),t.geometry.dispose(),t.geometry=E.clone(),t.geometry.computeBoundingSphere(),x.geometry.dispose(),x.geometry=p.clone(),x.geometry.computeBoundingSphere(),
k++;else if(!ca&&k===Y.length){for(var y in scope.checkpoints=scope.checkpoint(),scope.checkpoints)aa.add(scope.checkpoints[y].display);ca=!0;window.setTimeout(function(){scope.terrain(!0)},0)}f=window.performance.now()-h}ca||window.setTimeout(scope["import"],0,k,angle,slope)};this.extrude=function(k,h){k=void 0===k?0:k;h=void 0===h?0:h;for(var f in d.updateMatrixWorld(),d.rotateZ(k*K),d.geometry.vertices)d.geometry.vertices[f].applyAxisAngle(F,h*N);d.geometry.verticesNeedUpdate=!0;f=d.geometry.vertices[0].clone();
var y=d.geometry.vertices[2].clone(),u=d.geometry.vertices[3].clone(),q=d.geometry.vertices[1].clone();if(f.applyMatrix4(d.matrix),y.applyMatrix4(d.matrix),u.applyMatrix4(d.matrix),q.applyMatrix4(d.matrix),q.sub(f),la){if(y.add(ha),u.add(ha),0<C.vertices.length){var S=C.vertices[C.vertices.length-1].clone().sub(ba),B=C.vertices[C.vertices.length-2].clone().sub(ba);p.vertices.push(y.clone().sub(q));p.vertices.push(u.clone().sub(q));p.vertices.push(B);p.vertices.push(u.clone().sub(q));p.vertices.push(S);
p.vertices.push(B);var I=y.clone();k=u.clone();S=C.vertices[C.vertices.length-1].clone();B=C.vertices[C.vertices.length-2].clone();m.geometry.vertices.push(I);m.geometry.vertices.push(k);m.geometry.vertices.push(B);m.geometry.vertices.push(k);m.geometry.vertices.push(S);m.geometry.vertices.push(B);S=p.vertices.length;var H=new THREE.Face3(S-3,S-2,S-1);I=new THREE.Face3(S-5,S-4,S-6);p.faces.push(H);p.faces.push(I);H=H.clone();I=I.clone();H.color=new THREE.Color(16777215);I.color=new THREE.Color(16777215);
m.geometry.faces.push(H);m.geometry.faces.push(I)}0<E.vertices.length?(H=2,I=1,4<E.vertices.length&&(H=4,I=2),H=E.vertices[E.vertices.length-H].clone(),I=E.vertices[E.vertices.length-I].clone(),E.vertices.push(y.clone().add(q)),E.vertices.push(H.clone()),E.vertices.push(u.clone().add(q)),E.vertices.push(I.clone()),a==Y.length-1&&(B=y.clone().add(q),S=u.clone().add(q),E.vertices.push(B),E.vertices.push(S))):(E.vertices.push(y.clone().add(q)),E.vertices.push(u.clone().add(q)));C.vertices.push(y.clone());
C.vertices.push(u.clone());ba.copy(q)}else U.vertices.push(f.clone());for(var P in Q.copy(f).sub(d.position),d.position.add(Q),d.geometry.vertices)d.geometry.vertices[P].applyAxisAngle(F,-1*h*N)};this.terrain=function(k,h,f,y,u,q,S){h=void 0===h?[]:h;f=void 0===f?[]:f;y=void 0===y?[]:y;u=void 0===u?0:u;q=void 0===q?0:q;S=void 0===S?0:S;if(void 0===k||k){z.updateMatrixWorld();r.geometry.dispose();r.geometry.copy(new THREE.Geometry);h=[];f=[];y=[];for(k=0;2>k;k++)y[k]=[],h[k]=[],f[k]=[];for(k=0;k<z.geometry.vertices.length;k++)f[k%
2].push(z.geometry.vertices[k]);for(k=0;2>k;k++)for(var B=0;B<f[k].length;B++){var I=0===k?1:-1,H=f[k][B].clone();H.sub(f[k+I][B]);H.normalize().multiplyScalar(3);y[k][B]=H.clone()}}B=0;var P;k=window.performance.now();if(4>u){if(r.geometry.verticesNeedUpdate=!0,r.geometry.elementsNeedUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeFaceNormals(),r.geometry.computeVertexNormals(),r.updateMatrixWorld(),0<u&&0===S)for(f[q]=[],I=0;I<h[q].length;I++)f[q][I]=r.geometry.vertices[h[q][I]];
0===S&&(h[q]=[]);for(v=S;v<f[q].length&&32>B;){B=!1;if(void 0!==f[q][v]&&void 0!==f[q][v-1]){if(void 0===y[q][v])y[q][v]=y[s][v-1].clone();else if(r.geometry.computeBoundingSphere(),I=f[q][v].clone().add(y[q][v]),I.z-=100,La.set(I,A),I.z+=100,H=La.intersectObjects([r],!0),0<H.length)for(var Z in H).01<H[Z].point.distanceTo(I)&&(h[q][v]=void 0,B=!0);B||(r.geometry.vertices.push(f[q][v].clone()),r.geometry.vertices.push(f[q][v].clone().add(y[q][v])),h[q][v]=r.geometry.vertices.length-1,0<v&&(r.geometry.vertices.push(f[q][v-
1].clone()),P=r.geometry.vertices.length,0===q?r.geometry.faces.push(new THREE.Face3(P-2,P-1,P-3)):1===q&&r.geometry.faces.push(new THREE.Face3(P-1,P-2,P-3))))}B=window.performance.now()-k;v++;S=v}if(S===f[q].length){S=0;for(P=1;P<h[q].length;P++)if(void 0!==h[q][P]&&void 0!==h[q][P-1]){Z=r.geometry.vertices[h[q][P]];var V;k=r.geometry.vertices[h[q][P-1]];2.8>Z.distanceTo(k)?(Z.copy(k),h[q][P]=h[q][P-1],y[q][P].copy(y[q][P-1])):1<P&&(r.geometry.vertices.push(f[q][P-1]),V=0===q?h[q][P]:h[q][P-1],k=
0===q?h[q][P-1]:h[q][P],r.geometry.faces.push(new THREE.Face3(V,k,r.geometry.vertices.length-1)))}q++}1<q&&(q=0,u++)}if(4===u){r.geometry.verticesNeedUpdate=!0;r.geometry.elementsNeedUpdate=!0;r.geometry.colorsNeedUpdate=!0;r.geometry.computeFaceNormals();r.geometry.computeVertexNormals();r.geometry.mergeVertices();r.geometry.computeBoundingSphere();scope.noise(r.geometry);for(V=0;V<r.geometry.faces.length;V++)Z=r.geometry.vertices[r.geometry.faces[V].a].clone(),k=r.geometry.vertices[r.geometry.faces[V].b].clone(),
P=r.geometry.vertices[r.geometry.faces[V].c].clone(),r.geometry.colors[r.geometry.faces[V].a],r.geometry.colors[r.geometry.faces[V].b],r.geometry.colors[r.geometry.faces[V].c],m.geometry.vertices.push(Z),m.geometry.vertices.push(k),m.geometry.vertices.push(P),wireframe.geometry.vertices.push(Z),wireframe.geometry.vertices.push(k),wireframe.geometry.vertices.push(P),P=m.geometry.vertices.length,Z=new THREE.Face3(P-1,P-2,P-3),Z.color=new THREE.Color(0),m.geometry.faces.push(Z),wireframe.geometry.faces.push(new THREE.Face3(P-
1,P-2,P-3));wireframe.geometry.copy(r.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,h.slice(),f.slice(),y.slice(),u,q,S)},0)};this.biome=function(){for(var k=g,h=wireframe.geometry.faces,f=[],y=[],u=0;u<h.length;u++)for(var q=0;q<e[g].map.length;q++)h[u].vertexColors[0]=e[g].map[q](h[u].vertexNormals[0].z,h[u].a),h[u].vertexColors[1]=e[g].map[q](h[u].vertexNormals[1].z,h[u].b),h[u].vertexColors[2]=
e[g].map[q](h[u].vertexNormals[2].z,h[u].c);for(h=0;h<e[g].flags.length;h++)for(u=0;u<z.geometry.vertices.length;u++).1>wireframe.geometry.vertices[h].distanceTo(z.geometry.vertices[u])&&(e[g].flags[h]=!1);for(h=0;h<e[g].flags.length;h++)e[g].flags[h]&&f.push(h);for(h=0;h<e[g].limit&&h<f.length;){u=scope.randomInt(0,f.length);q=!0;if(0<y.length&&0<f.length)for(;q;){for(var S in y){if(wireframe.geometry.vertices[f[u]].distanceTo(wireframe.geometry.vertices[y[S]])<e[g].range){q=!0;f.slice(u,1);u=scope.randomInt(0,
f.length);break}q=!1}0>=f.length&&(q=!1)}if(0<f.length){q=e[k].tree();for(var B in q.vertices)c.geometry.vertices.push(q.vertices[B].clone().add(wireframe.geometry.vertices[f[u]])),c.geometry.colors[c.geometry.vertices.length-1]=q.colors[B];y.push(f[u]);f.slice(u,1)}h++}c.verticesNeedUpdate=!0;c.elementsNeedUpdate=!0;aa.add(c)};this.sakura=function(){var k=new THREE.Geometry,h=[],f=[],y=1,u,q=new THREE.Vector3(0,0,0),S=new THREE.Vector3(0,0,3),B=12,I=0,H=new THREE.Vector3(1,0,0),P=new THREE.Vector3(0,
0,1);k.vertices.push(q);k.vertices.push(S);k.colors.push(X[2]);k.colors.push(X[2]);f.push({v:S.clone(),n:S.clone(),pitch:H.clone(),roll:P.clone()});for(q=[];4>I;){S=[];for(H=0;H<f.length;H++)for(var Z=P=0;3>Z;Z++){var V=0===I&&2===Z&&1>P?1:scope.random();if(.2<V){V=scope.randomInt(-2,2);var va=f[H].n.clone(),Aa=X[2];va.applyAxisAngle(f[H].pitch,2*Math.PI/(B+V));va.applyAxisAngle(f[H].roll,2*Math.PI/3*Z);va.multiplyScalar(y);V=va.clone().add(f[H].v);k.vertices.push(f[H].v.clone());k.vertices.push(V);
k.colors.push(Aa);k.colors.push(Aa);Aa=f[H].pitch.clone();Aa.applyAxisAngle(f[H].roll,2*Math.PI/3*Z);Aa.applyAxisAngle(f[H].pitch,2*Math.PI/B);var wa=f[H].roll.clone();wa.applyAxisAngle(f[H].pitch,2*Math.PI/B);wa.applyAxisAngle(f[H].roll,2*Math.PI/3*Z);0<Z&&h.push({a:V.clone(),b:f[H].v.clone(),pitch:Aa,roll:wa});S.push({v:V.clone(),n:va.clone(),pitch:Aa,roll:wa});P++}else 0===P&&2===Z&&q.push({v:f[H].v.clone(),n:f[H].n.clone(),pitch:f[H].pitch.clone(),roll:f[H].roll.clone()})}f=S.slice();y*=.9;I++}for(u in B=
6,h)y=h[u].a.clone(),S=h[u].b.clone(),y=y.clone().sub(S),H=y.clone().multiplyScalar(.5).add(S),I=scope.randomInt(0,3)-1,y.applyAxisAngle(h[u].pitch,2*Math.PI/B),y.applyAxisAngle(h[u].roll,2*Math.PI/I),y.multiplyScalar(.5),S=H,H=y.clone().add(H),k.vertices.push(S),k.vertices.push(H),k.colors.push(X[2]),k.colors.push(X[2]),S=h[u].pitch.clone(),S.applyAxisAngle(h[u].roll,2*Math.PI/I),S.applyAxisAngle(h[u].pitch,2*Math.PI/B),P=h[u].roll.clone(),P.applyAxisAngle(h[u].pitch,2*Math.PI/B),P.applyAxisAngle(h[u].roll,
2*Math.PI/I),f.push({v:H.clone(),n:y.clone(),pitch:S,roll:P});f=f.concat(q);for(h=0;h<f.length;h++)for(u=0;5>u;u++)B=f[h].n.clone(),B.normalize(),B.applyAxisAngle(f[h].pitch,2*Math.PI/6),B.applyAxisAngle(f[h].roll,2*Math.PI/5*u),B.multiplyScalar(.5),B=B.add(f[h].v),q=f[h].v.clone(),k.vertices.push(B),k.vertices.push(q),k.colors.push(X[12]),k.colors.push(X[12]);return k.colorsNeedUpdate=!0,k};this.pine=function(){var k=Math.floor(8*scope.random())+6,h=2*Math.PI/6,f=new THREE.Geometry;f.vertices.push(new THREE.Vector3(0,
0,0));f.vertices.push(new THREE.Vector3(0,0,+k-.5+1));f.colors.push(X[9]);f.colors.push(X[9]);f.colors.push(X[9]);for(var y=1;y<k;y++)for(var u=0;6>u;u++)off=y%2*h*.5,f.vertices.push(new THREE.Vector3(0,0,+y+1)),f.vertices.push(new THREE.Vector3(.3*(k-y),0,+y-.3+1)),f.vertices[f.vertices.length-1].applyAxisAngle(A,h*u+off),f.colors.push(X[9]),f.colors.push(X[9]);return f};this.checkpoint=function(){function k(u,q,S){var B=new THREE.Geometry,I=(new THREE.Vector3).copy(u).sub(q),H=(new THREE.Vector3).copy(u).add(I.clone().multiplyScalar(1.5));
I=(new THREE.Vector3).copy(q).sub(I.clone().multiplyScalar(1.5));B.vertices.push(new THREE.Vector3(H.x,H.y,H.z-12));B.vertices.push(new THREE.Vector3(H.x,H.y,H.z+12));B.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));B.vertices.push(new THREE.Vector3(I.x,I.y,I.z+12));B.vertices.push(new THREE.Vector3(I.x,I.y,I.z-12));B.vertices.push(new THREE.Vector3(H.x,H.y,H.z-12));B.faces.push(new THREE.Face3(0,1,2));B.faces.push(new THREE.Face3(3,4,5));H=new THREE.Geometry;H.vertices.push(new THREE.Vector3(u.x,
u.y,u.z+6));H.vertices.push(new THREE.Vector3(u.x,u.y,u.z+8));H.vertices.push(new THREE.Vector3(q.x,q.y,q.z+6));H.vertices.push(new THREE.Vector3(q.x,q.y,q.z+8));H.vertices.push(new THREE.Vector3(u.x,u.y,u.z+6));H.vertices.push(new THREE.Vector3(q.x,q.y,q.z+6));H.vertices.push(new THREE.Vector3(u.x,u.y,u.z+8));H.vertices.push(new THREE.Vector3(q.x,q.y,q.z+8));H.vertices.push(new THREE.Vector3(u.x,u.y,u.z+1));H.vertices.push(new THREE.Vector3(q.x,q.y,q.z+1));u=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,
wireframe:!1,fog:!0});u.color=X[5];B=new THREE.Mesh(B,u);B.visible=!0;u=new THREE.LineSegments(H,u);return B.name="Objective "+S,u.name="Checkpoint"+S,{display:u,collision:B}}var h=z.geometry,f=h.vertices.length-80;f=Math.floor(f/4)-Math.floor(f/4)%2;var y=[];y[0]=k(h.vertices[40],h.vertices[41],0);y[1]=k(h.vertices[40+f],h.vertices[1+f+40],1);y[2]=k(h.vertices[2*f+40],h.vertices[2*f+41],2);y[3]=k(h.vertices[3*f+40],h.vertices[3*f+41],3);y[4]=k(h.vertices[4*f+40],h.vertices[4*f+41],4);this.DISTANCE=
4*f/2*3;scope.start.copy(h.vertices[36]);scope.start.sub(h.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(h.vertices[36]);for(h=0;5>h;h++)null==O.best&&(O.best[h]=4>h?f*(h+1)/Ia:O.best[h]=O.best[h-1]);return oa.STATE(),y};this.resetCheckpoints=function(){for(var k in scope.checkpoints)scope.checkpoints[k].display.material.color=X[5]};this.random=function(){Oa=(Oa+1)%2147483647;var k=1E4*Math.sin(Oa);return k-Math.floor(k)};this.randomInt=function(k,h){return Math.floor(scope.random()*
(h-k))+k};this.noise=function(k){var h=new qb,f=[],y=8,u=0,q=0,S=1E3*scope.random();g;for(var B=0;B<k.vertices.length;B++)f[B]=0;for(B=0;2>B;B++){for(var I=0;I<k.vertices.length;I++)f[I]+=Math.floor(h.noise(k.vertices[I].x/y,k.vertices[I].y/y,S)*y),f[I]>u&&(u=f[I]),f[I]<q&&(q=f[I]);y*=3}for(h=0;h<f.length;h++){y=2===g?2:.5;for(u=0;u<z.geometry.vertices.length;u++)q=k.vertices[h].distanceTo(z.geometry.vertices[u]),q=q*q/100,q<y&&(y=q);k.vertices[h].z+=f[h]*y}};this.name=function(){var k="";if(Sa)k=
oa.custom_seed;else if(Ja||cb)k=oa.CHALLENGES.seed;else{var h=[" forest"," pass"," mountain"],f="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var y=Math.ceil(3*Math.random())+1,u=0;u<y;)k+=f[Math.floor(Math.random()*f.length)],u++;f=2===g?1:0;f=h[Math.floor(f+Math.random()*(h.length-f))];if(k+=f,.1<Math.random())for(f=Math.floor(Math.random()*Ya.length),k=Ya[f];k==jb;)k=Ya[Math.floor(Math.random()*
Ya.length)]}return jb="name",k}}function kb(){db=!0;window.removeEventListener("touchstart",kb)}function Za(){var a=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,e=window.innerWidth,g=window.innerHeight;W.aspect=e/g;W.updateProjectionMatrix();b.resize(e,g,a);oa.resize(e,g,a)}function lb(){if(window.requestAnimationFrame(lb),Ea=window.performance.now(),Ha){G.update();for(var a=0;a<qa.length;a++)G.START&&(eb(),qa[a].update());sa||fb||oa.update();!db||sa||Ma||b.dpad();
fa.RESET&&!sa&&(oa.reset(),fa.RESET=!1);O.update()}else if(da.PLAY)for(eb(),da.play(G),O.update(),a=0;a<qa.length;a++)qa[a].update();else Ta?(W.position.applyAxisAngle(W.up,.01),W.lookAt(new THREE.Vector3,0,0,0),oa.loading()):(W.position.applyAxisAngle(W.up,.01),W.lookAt(new THREE.Vector3,0,0,0));xa.render(aa,W);b.update(fa.touches)}function rb(){var a=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new ib;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];
this.dimension=2400;this.partitionDimension=16;this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;a.snow.mesh.geometry.vertices.length<a.snow.limit;){var g=new THREE.Vector3;g.copy(W.position);g.x+=Math.random()*a.snow.distance-a.snow.distance/2;g.y+=Math.random()*a.snow.distance-a.snow.distance/2;g.z+=Math.random()*a.snow.height-a.snow.height/2;a.snow.mesh.geometry.vertices.push(g)}a.snow.mesh.geometry.verticesNeedUpdate=
!0;a.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var g=0;g<a.snow.mesh.geometry.vertices.length;g++){var d=a.snow.mesh.geometry.vertices[g];d.z-=.5*G.DT();(Math.abs(d.z-W.position.z)>a.snow.height/2||Math.abs(d.x-W.position.x)>a.snow.distance/2||Math.abs(d.y-W.position.y)>a.snow.distance/2)&&(d.copy(W.position),d.x+=Math.random()*a.snow.distance-a.snow.distance/2,d.y+=Math.random()*a.snow.distance-a.snow.distance/2,d.z+=Math.random()*a.snow.height-a.snow.height/2)}a.snow.mesh.geometry.verticesNeedUpdate=
!0;a.snow.mesh.geometry.computeBoundingSphere()}};for(var e=0;4>e;e++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(g){g=void 0===g?!1:g;if(W.position.set(0,400,200),W.far=2E3,W.updateProjectionMatrix(),W.lookAt(new THREE.Vector3),xa.render(aa,W),!g){this.name=this.generate.name();g="";for(var d in this.name)g+=this.name.charCodeAt(d).toString();Oa=g}a.generate.connect();sb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};
this.reset=function(g){g=void 0===g?!1:g;Oa++;a.COMPLETE=!1;a.disconnect();a.generate=new ib;a.connect(g)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function tb(){var a=this,e,g,d="",w=0,z=0;this.custom_seed="";var x="#1#ffffff#334#",t=Ca+"#1#",r=!0;this.SETTINGS=!1;this.STATE=function(){a.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(c){return c?
(pa=c.uid,a.STATE(),da.requestName(pa,function(l){ea=l;a.STATE()})):(pa=!1,a.STATE()),null})};this.register=function(c){b.clear();a.STATE=function(){a.register(c)};fb=!0;a.inputName(function(){fb=!1;da["export"]()},!0,"input name to save data")};this.resize=function(c,l){e=b.width;g=b.height;$a=Math.floor((window.innerHeight/b.scale/b.row-34)/2)};this.wallet=function(){var c=G.yen();b.print("$ "+c.toString(),"2","1.0-4")};this.nav=function(c){c=void 0===c?function(){b.clear()}:c;b.sprite(8,64,8,8,
"1.0-4+2p","2",8,8);b.button("","1.0-8","2+4p","8","8",function(){a.menu(c)},!1)};this.title=function(c,l){a.breadcrumb(c,l);b.sprite(16,64,8,8,"1.0-4+2p","2",8,8);b.button("","1.0-7","2+4p","7","5",function(){r||b.backdrop(!1);c();sa=!1;a.SETTINGS=!1},!1);a.wallet()};this.breadcrumb=function(c,l){l=void 0===l?function(){r||b.backdrop(!1);c();sa=!1;a.SETTINGS=!1}:function(){a.menu(c);sa=!0};b.print("< menu","2","2");b.button("","2","2+4p","7","8",l,!1)};this.menu=function(c){sa=!0;a.STATE=function(){a.menu(c)};
r||b.backdrop();b.clear();a.title(c);b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print(" > modify vehicle","2","8");b.button("","2","8+4p","1.0-4","5",function(){a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print(" > settings","2","13");b.button("","2","13+4p","1.0-4","5",function(){a.settings(c)},!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);var l=8;(Ha||da.PLAY)&&(b.button("restart stage","2","1.0-2-"+l,"1.0-4","6",function(){b.backdrop(!1);a.reset()},!0),l+=8);O.COMPLETE&&(Ha||da.PLAY)&&b.button("next stage",
"2","1.0-2-"+l,"1.0-4","6",function(){b.backdrop(!1);a.next()},!0);a.discord()};this.intro=function(){var c;a.STATE=function(){a.intro()};r=!0;b.clear();b.print("specialstage.io","2","2");b.print("-","2","4");b.link("","0","1.0-24","26","6","https://ginko.ltd");b.print("new physical items","2","1.0-23");b.print("available at","2","1.0-21");b.style=1;b.print("ginko.ltd","2+13","1.0-21");b.style=0;Ja?(b.style=4,b.print("challenge detected!","2","12"),b.style=0,c=null!==a.CHALLENGER&&0<a.CHALLENGER.length?
a.CHALLENGER:"...",b.style=2,b.print("rival:","2","15"),b.style=0,b.print(c,"9","15"),da.requestName(a.CHALLENGES.uid,function(l){a.CHALLENGER=l;a.STATE()}),b.style=2,b.print("seed:","2","17"),b.style=0,b.print(a.CHALLENGES.seed,"9","17")):Sa&&(b.style=3,b.print("seed detected","2","13",1),b.style=0,b.print("> "+a.custom_seed,"2","16",1));null!==pa&&!1===pa||""!==ea?""!==ea?(b.style=5,b.print("welcome back!","2","6"),b.style=0,b.print("> "+ea,"2","9"),b.style=2,b.print("[edit]",ea.length+"+5","9"),
b.style=0,b.button("","2","9+4p",ea.length+"+9","4",function(){a.inputName(a.intro)},!1)):!1===pa&&""===ea&&(b.style=2,b.print("user data not detected","2","6"),b.style=0,b.print("> [register/sign in]","2","9"),b.button("","2","9+4p","1.0-4","4",function(){a.inputName(a.intro)},!1)):(b.style=2,b.print("> loading user data...","2","6"),b.style=0);b.style=2;b.print("0.0.5.2 ","2","1.0-4");b.style=0;a.nav(function(){a.intro()});b.print("menu","1.0-9","2");b.button("","1.0-9","2+4p","4","5",function(){a.menu(a.intro)},
!1);a.discord();a.startButton()};this.startButton=function(){b.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){b.clear();r=!1;b.renderer.style.background="transparent";b.renderer.style.animation="none";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");O.connect();a.load()})};this.discord=function(){b.style=3;b.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);b.print("discord","1.0-9","1.0-4");b.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");b.style=
0};this.load=function(){a.STATE=function(){a.target()};a.TIMELIST=[];da.scan(O.name,function(c){for(var l={$jscomp$loop$prop$t$82$146:0};l.$jscomp$loop$prop$t$82$146<c.length;l={$jscomp$loop$prop$t$82$146:l.$jscomp$loop$prop$t$82$146},l.$jscomp$loop$prop$t$82$146++)a.TIMELIST[l.$jscomp$loop$prop$t$82$146]={uid:c[l.$jscomp$loop$prop$t$82$146].uid,time:c[l.$jscomp$loop$prop$t$82$146].time,name:"..."},da.requestName(c[l.$jscomp$loop$prop$t$82$146].uid,function(A){return function(F){a.TIMELIST[A.$jscomp$loop$prop$t$82$146].name=
F;a.STATE()}}(l)),da.checkTime(pa,c[l.$jscomp$loop$prop$t$82$146].uid,c[l.$jscomp$loop$prop$t$82$146].time);var n=a.TIMELIST.length<Ca?a.TIMELIST.length:Ca;l=[];switch(Da){case 0:l=c.slice(0,n);break;case 1:for(c=c.slice();l.length<n;){var m=Math.floor(Math.random()*c.length);l.push(Object.assign({},c[m]));c.splice(m,1)}}if(a.BATTLE=l.slice(),Ha)for(n=0;n<l.length;n++)da["import"](O.name+"/"+l[n].uid,function(A){qa.push(new gb(A.tape,A.model,A.paint,A.cp))});a.STATE()});Ta=!0;a.target();w=0};this.ready=
function(){Ta=!1;a.STATE()};this.play=function(){b.clear();a.nav(a.play);sa=!1};this.complete=function(){sa=!0;b.clear();a.nav(a.complete);var c="stage complete!";b.style=0;b.print(c,"0.5-"+2*Math.round(c.length/2),"0.3-1",2);b.style=0;O.COMPLETE=!0;window.setTimeout(function(){!1===pa||null===pa?(a.register(),a.STATE=function(){a.results()}):(a.STATE=function(){a.results()},da["export"](a.results))},2E3);c=G.param().model+" ("+(G.param().power+1)+"/"+(G.param().drag+1)+"/"+(G.param().sensitivity+
1)+"/"+(G.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:ea,time:G.AT(),penalty:G.PENALTY(),score:G.AT()+G.PENALTY(),seed:O.name,rating:Math.round(O.generate.DISTANCE/(G.AT()+G.PENALTY())),distance:O.generate.DISTANCE,vehicle:c})};this.results=function(){a.STATE=function(){a.results()};b.clear();ea;da.tape.slice();sa=!0;var c,l=b["float"](G.AT()+G.PENALTY()),n=0;if(0<a.TIMELIST.length){for(var m=Math.floor(100*(G.AT()+G.PENALTY()))/100,A=0;A<a.TIMELIST.length;A++)if(m<
a.TIMELIST[A].time){n=A+1;break}0==n&&(n=a.TIMELIST.length+1)}a.nav(a.results);b.style=5;b.print("stage complete! "+O.name,"2","2");b.style=0;b.print(l,"2","5",2);0!=n?b.print("rank "+n,2*l.length+"+3".toString(),"5+4p"):G.AT()+G.PENALTY()<O.best[4]?(c=Ja?"challenge victory!":"new record!",b.style=4,b.print(c,2*l.length+"+3".toString(),"5+4p"),b.style=0):Ja&&b.print("challenge failed",2*l.length+"+3".toString(),"5+4p");c=9;l=G.CP();if(320<g){for(m=0;m<l.length-1;m++){b.style=5;b.print("cp "+(m+1).toString(),
"2",c+"+"+m.toString());m;var F=void 0;A=void 0;A="number"==typeof l[m]?(F=b["float"](l[m]),Number.isNaN(O.best[m])?"+1 cp":l[m]-O.best[m]):(F="penalty",b.style=4,"");b.print(F.toString(),"0.5 -1-"+F.length.toString(),c+"+"+m.toString());b.style=0;F="penalty"===F?"25 sec":"+1 cp"==A?"+1 cp":0<A?"( - "+b["float"](A)+" )":"( + "+b["float"](Math.abs(A))+" )";b.style=0<A?4:0>A?1:0===A?2:4;b.print(F,"0.5+1",c+"+"+m.toString());b.style=0;c+=1}c+=5}1===n&&(b.style=1,b.print("new record!","2",c.toString(),
2),b.style=0);b.button("issue challenge","0.5+1","1.0-20","0.5-3","4",a.challenge);b.button("modify vehicle","2","1.0-20","0.5-3","4",function(){b.backdrop();a.vehicle(a.results)});b.button("next stage","2","1.0-12","1.0-4","8",function(){a.next()});b.button("restart stage","2","1.0-4","0.5-3","4",function(){a.reset("complete")});b.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){a.replay()});window.setTimeout(function(){Ha=!1;da.PLAY=!0},0)};this.battle=function(){var c=new gb(da.save(da.tape),
G.MODEL,G.PAINT);qa.push(c);a.reset()};this.replay=function(){a.STATE=function(){a.results()};b.clear();a.nav(a.results);for(var c={$jscomp$loop$prop$e$89$148:0};4>c.$jscomp$loop$prop$e$89$148;c={$jscomp$loop$prop$e$89$148:c.$jscomp$loop$prop$e$89$148},c.$jscomp$loop$prop$e$89$148++){var l="4+"+(4*c.$jscomp$loop$prop$e$89$148).toString(),n=c.$jscomp$loop$prop$e$89$148===G.CAMERA-1?48:40;b.button("",l+"-10p","1.0-4+4p","3","4",function(m){return function(){G.CAMERA=m.$jscomp$loop$prop$e$89$148+1;a.replay()}}(c),
!1);b.sprite(n,64,8,8,l,"1.0-4",8,8)}b.print("<","2","2");b.button("","2","2+4p","7","8",function(){a.results(a.replay)},!1)};this.next=function(){b.clear();Ta=!0;Sa=cb=Ja=!1;a.PATH=!1;custom_seed="";O.name="";a.BATTLE=[];Ua=!1;window.history.pushState("","","/");xa.clear();G.reset();G.disconnect();for(var c=0;c<qa.length;c++)qa[c].disconnect();qa=[];O.SNOW&&aa.remove(O.snow.mesh);O.reset();Ha=sa=!1;da.PLAY=!1;a.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){a.STATE=function(){a.dnf()};
b.backdrop(!1);b.clear();a.nav(a.dnf);firebase.analytics().logEvent("dnf");b.print("dnf","0.5-3+3p","0.5-8",2);b.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){a.reset("dnf")},!1)};this.reset=function(c){c=void 0===c?"reset":c;qa.index=0;b.clear();a.nav(a.play);Ha=!0;sa=!1;G.reset();for(var l=0;l<qa.length;l++)qa[l].reset();firebase.analytics().logEvent("stage_restart",{status:c})};this.update=function(){sa||!Ha||Ma||(b["delete"](16,16,e-64,16),b["delete"](16,g-32,64,16),b.text(b["float"](G.AT()),
16,16),b.text(G.SPEED.toString(),16,g-32))};this.loading=function(){d=0!=w%16?d:3<=d.length?"":d+".";sa||(b["delete"](16,16,160,8),b.style=2,b.text("stage generating"+d,16,16),b.style=0);w++};this.target=function(){b.clear();a.STATE=function(){a.target()};a.nav(a.target);var c=O.name;if(Ta||(b.style=2,b.print("stage generated.","2","2"),b.style=0,b.button("ready","2","1.0-10","1.0-4","8",function(){for(var m=0;m<a.BATTLE.length;m++)da["import"](O.name+"/"+a.BATTLE[m].uid,function(A){qa.push(new gb(A.tape,
A.model,A.paint,A.cp))});a.STATE=function(){};O.generate.END=!1;b.clear();a.play();Ha=!0;G.connect(O.start,O.surface,!1);firebase.analytics().logEvent("stage_start")})),b.style=5,b.print(c,"2","5-1p",2),(b.style=0)===a.TIMELIST.length&&da.SCAN)b.style=5,b.print("scanning...","2","9");else if(0!==a.TIMELIST.length){b.style=2;b.print("best time:","2","9");b.style=0;b.print(b["float"](a.TIMELIST[0].time),"2","12",2);b.style=5;var l=(c=a.TIMELIST.length<$a)?a.TIMELIST.length:$a;c=c?0:a.TIMELIST.length-
$a;for(var n=0;n<l;n++)b.print(n+1+". "+a.TIMELIST[n].name,"2","16+"+2*n),b.print(b["float"](a.TIMELIST[n].time),"18","16+"+2*n);0<c&&b.print("+ "+c+" more entries","2",2*l+"+17")}else b.style=2,b.print("no entries found.","2","9"),b.style=0};this.save=function(){var c=ea+"#"+G.MODEL+"#"+G.PAINT+"#"+G.param().power+G.param().drag+ +G.param().sensitivity+"#"+Date.now();c!==x&&(x=c,a.cSave("SAVE",x))};this.vehicle=function(c){a.STATE=function(){a.vehicle(c)};sa=!0;b.clear();a.title(function(){c();a.save()},
function(){a.menu();sv()});var l=[],n=G.param();l.push({id:"power",value:n.power,funct:function(T){G.tune.power(T)}});l.push({id:"drag",value:n.drag,funct:function(T){G.tune.drag(T)}});l.push({id:"sensitivity",value:n.sensitivity,funct:function(T){G.tune.sensitivity(T)}});b.sprite(0,0,1,1,"2","8+-5+3","1.0-2-2",1);b.print("model","2","8+");b.print(G.models()[G.MODEL].name,"2+8","8+");b.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);b.button(">","1.0-6","8++4p","4","4",function(){G.MODEL+=1;1<G.MODEL&&(G.MODEL=
0);G.body();a.vehicle(c)},!1);b.button("<","1.0-12","8++4p","4","4",function(){--G.MODEL;0>G.MODEL&&(G.MODEL=1);G.body();a.vehicle(c)},!1);b.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);b.print("paint","2","8+5+");b.print(ub[G.PAINT],"10","8+5+");b.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);b.button(">","1.0-6","8+5++4p","4","4",function(){G.PAINT+=1;G.PAINT>Va.length-1&&(G.PAINT=0);G.paint();a.vehicle(c)},!1);b.button("<","1.0-12","8+5++4p","4","4",function(){--G.PAINT;0>G.PAINT&&(G.PAINT=Va.length-
1);G.paint();a.vehicle(c)},!1);for(n={$jscomp$loop$prop$t$94$150:0};n.$jscomp$loop$prop$t$94$150<l.length;n={$jscomp$loop$prop$t$94$150:n.$jscomp$loop$prop$t$94$150},n.$jscomp$loop$prop$t$94$150++){var m="8+5+5+"+(5*n.$jscomp$loop$prop$t$94$150).toString();b.print(l[n.$jscomp$loop$prop$t$94$150].id,"2",m);b.sprite(0,0,1,1,"2",m+"+3","1.0-2-2",1);for(var A={$jscomp$loop$prop$e$95$152:0};6>A.$jscomp$loop$prop$e$95$152;A={$jscomp$loop$prop$e$95$152:A.$jscomp$loop$prop$e$95$152},A.$jscomp$loop$prop$e$95$152++){var F=
"1.0-18+"+(3*A.$jscomp$loop$prop$e$95$152).toString(),Q=A.$jscomp$loop$prop$e$95$152<=l[n.$jscomp$loop$prop$t$94$150].value?48:40;b.button("",F+"-10p",m+"+4p","3","4",function(T,U){return function(){l[T.$jscomp$loop$prop$t$94$150].funct(U.$jscomp$loop$prop$e$95$152);a.vehicle(c)}}(n,A),!1);b.sprite(Q,64,8,8,F,m,8,8)}}};this.settings=function(c){a.STATE=function(){a.settings(c)};a.SETTINGS=!0;t=Ca+"#"+Da+"#"+(Na?1:0)+"#";a.cSave("SETTINGS",t);b.clear();r||b.backdrop();a.title(c,a.menu);b.sprite(0,
0,1,1,"2","6","1.0-4",1);b.print("ghost config","2","8");b.print("[edit]","1.0-2-6","8");b.button("","2","8+4p","1.0-4","5",function(){a.ghostConfig(c)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);db?(l=Na?"enabled":"disabled",b.print("display touch hitboxes","2","13"),b.print(l,"1.0-2-"+l.length,"13"),b.sprite(0,0,1,1,"2","21","1.0-4",1),b.button("","2","13+4p","1.0-4","5",function(){Na=!Na;a.settings(c)},!1)):(b.print("keybindings","2","13"),b.print("arrow / wasdr","1.0-15","13"),b.sprite(0,0,1,1,
"2","21","1.0-4",1));b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("camera mode","2","18");var l=G.FPV?"fpv":"tpv";b.print(l,"1.0-6","18");b.button("","2","18+4p","1.0-4","5",function(){G.FPV=!G.FPV;a.settings(c)},!1);b.print("www.procedural.ca","2","1.0-10");b.print("www.ginko.ltd","2","1.0-8");a.discord()};this.ghostConfig=function(c,l){l=void 0===l?!1:l;a.STATE=function(){a.ghostConfig(c)};var n=Na?1:0;t=Ca+"#"+Da+"#"+n+"#";a.cSave("SETTINGS",t);b.clear();r||b.backdrop();a.title(c,function(){a.settings(c)});
b.sprite(0,0,1,1,"2","6","1.0-4",1);b.print("ghost name","2","8");b.print(ea,"1.0-13-"+ea.length,"8");b.print("[edit]","1.0-8","8");b.button("","2","9+4p","1.0-4","4",function(){a.inputName(function(){a.ghostConfig(c)},!1)},!1);b.sprite(0,0,1,1,"2","11","1.0-4",1);b.print("ghost limit","2","13");n=Ca.toString();b.print(n,"1.0-13-"+n.length,"13");b.button(">","1.0-6","13+4p","4","4",function(){20>Ca&&(Ca+=1);a.ghostConfig(c)},!1);b.button("<","1.0-12","13+4p","4","4",function(){0<Ca&&--Ca;a.ghostConfig(c)},
!1);b.sprite(0,0,1,1,"2","16","1.0-4",1);b.print("ghost priority","2","18");n=0===Da?"best":"random";b.print(n,"1.0-13-"+n.length,"18");b.button(">","1.0-6","18+4p","4","4",function(){Da+=1;1<Da&&(Da=0);a.STATE()},!1);b.button("<","1.0-12","18+4p","4","4",function(){--Da;0>Da&&(Da=1);a.STATE()},!1);b.sprite(0,0,1,1,"2","21","1.0-4",1);l&&b.print("* changes require stage generation","2","1.0-8")};this.controls=function(c){b.clear();a.title(c,a.menu)};this.fullscreen=function(){document.fullscreenElement?
document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){b.clear();b.print("specialstage.io","4","4",2);b.print("-","4","8",2)};this.challenge=function(c){b.clear();a.nav(function(){a.challenge()},a.menu);b.print("issue challenge url","2","2");b.print("-","2","4");b.style=2;b.print("issued by","2","6");b.style=0;b.print("> "+ea,"2","9");b.style=2;b.print("[edit]",ea.length+"+9","9");b.button("","2","9+4p",ea.length+"+5","4",function(){a.inputName(a.challenge,
!1)},!1);b.style=2;b.print("seed","2","13");b.style=5;b.print(O.name,"2","15");b.style=2;b.print("time","2","19");c=b["float"](G.CP()[3]+G.PENALTY());b.style=5;b.print(c,"2","21");b.style=0;b.button("copy challenge url","1","1.0-8","1.0-2","8",function(){b.clear();a.encodeURL();window.setTimeout(a.results,2E3)})};this.appearance=function(){b.clear();a.breadcrumb(this.vehicle,this.state);a.nav(function(){a.appearance()},a.menu)};this.inputName=function(c,l,n){l=void 0===l?!1:l;n=void 0===n?"enter display name:":
n;a.STATE=function(){a.inputName(c,l,n)};b.clear();sa=!0;l?a.nav(function(){c()},a.menu):a.title(c);b.print(n,"2","2");b.textinput(ea,"2","4","1.0-2","6","operator_id");var m=document.getElementById("operator_id");b.button("accept","2","14","1.0-4","6",function(){b.clear();b.print("submitting name to db","2","2");ea=vb(m.value.toLowerCase());!1===pa&&1<ea.length&&null!==ea?firebase.auth().signInAnonymously().then(function(){pa=firebase.auth().currentUser.uid;a.submitName(pa,c,l);a.STATE=function(){}})["catch"](function(A){A.code;
A.message}):!1!==pa&&1<ea.length&&null!==ea?a.submitName(pa,c,l):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(a.STATE,1E3))},!0)};this.submitName=function(c,l,n){n=void 0===n?!1:n;1<ea.length&&10>ea.length?firebase.database().ref("uid/"+c).set({name:ea},function(m){m?(b.clear(),m="PERMISSION_DENIED"===m.code?"invalid name":"network error",b.print(m,"2","2"),window.setTimeout(function(){a.inputName(l,n)},1E3)):(b.clear(),b.print("name change successful","2","2"),window.setTimeout(l,
1E3))}):(b.clear(),b.print("invalid name","2","2"),window.setTimeout(function(){a.inputName(l,n)},1E3))};this.encodeURL=function(){for(var c="",l=O.name,n=0;n<l.length;n++){var m=l.charAt(n);m=" "===m?"-":m;c+=m}c=c+"/"+pa;window.history.pushState("","","/");l=window.location.href;var A="./#/"+c;navigator.clipboard.writeText(l+"/#/"+c).then(function(){b.print("url copied to clipboard","2","2");window.history.pushState("","",A)},function(){window.history.pushState("","",A);b.print("url copied to address bar",
"2","2")});firebase.analytics().logEvent("challenge_issued",{url:l+"#/"+c})};this.decodeURL=function(){for(var c=window.location.href,l="",n=[],m=!1,A=0,F=0;F<c.length;F++){var Q=c.charAt(F);m?"/"===Q?(Ja=!0,A++):(1===A&&(Q="-"===Q?" ":Q,l+=Q),1<A&&(n+=Q)):"#"===Q&&(m=!0,Sa=!0,A=0)}Ja&&0<n.length?(a.custom_seed=l,O.name=l,a.CHALLENGES={seed:l,uid:n}):Sa&&(a.custom_seed=l,O.name=l,Ja=!1);firebase.analytics().logEvent("challenge_accepted",{url:c})};this.cSave=function(c,l){var n=new Date;n.setTime(n.getTime()+
2808E7);n="expires="+n.toUTCString();document.cookie=c+"="+l+";"+n+";path=/"};this.cLoad=function(c){c+="=";for(var l=document.cookie.split(";"),n=0;n<l.length;n++){for(var m=l[n];" "==m.charAt(0);)m=m.substring(1);if(0==m.indexOf(c))return m.substring(c.length,m.length)}return""};this.checksave=function(){var c=a.cLoad("SAVE");if(0!==c.length&&null!=c){for(var l=0,n="",m="",A="",F="",Q=0,T=0;T<c.length;T++){var U=c.charAt(T);if("#"!==U)switch(Q){case 1:l=parseInt(U);break;case 2:n+=U;break;case 3:m+=
c.charAt(T),A+=c.charAt(T+1),F+=c.charAt(T+2),T+=2}else Q++}G.MODEL=l;G.PAINT=n;G.paint();G.tune.power(parseInt(m));G.tune.drag(parseInt(A));G.tune.sensitivity(parseInt(F))}else G.PAINT=0,G.paint();if(c=a.cLoad("SETTINGS"),0!==c.length&&null!=c){l=0;m=n="";for(A=0;A<c.length;A++)if(F=c.charAt(A),"#"!==F)switch(l){case 0:n+=F;break;case 1:Da=parseInt(F);break;case 2:m=parseInt(F)}else l++;Ca=parseInt(n);Na=0!==m}};this.credit=function(){b.clear();b.print("procedural.ca","2","1.0-6");b.print("ginko.ltd",
"2","1.0-4")};this.promo=function(){b.clear();b.print("0.0.5","2","2");b.sprite(56,68,48,20,"2","6-4p",192,80,4);b.sprite(1,0,255,16,"2","20",255,16);b.print("https://specialstage.io","2","18");b.print("seed: ryuk mountain","2","1.0-10");b.print("best: ghxst90 (16.48)","2","1.0-8");b.print("data: ek9","2","1.0-6")};this.fpv=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){b.clear();
b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("new feature","4","0.5");b.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("update","4","0.5");b.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){b.clear();
b.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){b.clear();b.print("play at","2","0.25-4");b.print("https://specialstage.io","2","0.25",1);b.print("challenges posted on discord","4","0.25+ 6");b.print("> discord.ginko.ltd","4","0.25 + 10");b.print("> discord.specialstage.io","4","0.25 + 12");window.setTimeout(a.music,2E3)};this.music=function(c){window.setTimeout(function(){b.print("procedural.ca","2","1.0-12")},500);window.setTimeout(function(){b.print("ginko.ltd",
"2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){b.clear();b.print("https://specialstage.io - 0.0.4","2","2");b.print("updates","2","6");b.print("> added ice biome","2","10");b.print("> added fpv camera","2","12");b.print("> added snow particle effects","2","14");b.print("> added terrain drag penalty","2","16");b.print("> improved vehicle physics","2","18");b.print("> increased gravity","2","20");b.print("> decreased air resistance","2","22");b.print("> disabled DNF timeout during button input for big jumps",
"2","24");b.print("> removed framerate dependecies","2","26");b.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){b.clear()},1E4)};this.plug=function(c){if("n"===c.key)switch(z){case 0:b.clear();window.setTimeout(a.promo,1E3);z++;break;case 1:window.setTimeout(a.biome,1E3);z++;G.CAMERA=4;break;case 2:window.setTimeout(a.physics,1E3);z++;G.CAMERA=2;break;case 3:window.setTimeout(a.fpv,1E3);z++;G.CAMERA=3;break;case 4:window.setTimeout(a.endtag,1E3);z++;G.CAMERA=1;break;case 5:b.clear(),
z=0}}}function wb(){var a=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var e=this.renderer.getContext("2d");this.context=e;var g=document.createElement("img");g.src="./img/stage.font.0.0.4.png";g.onload=function(){a.connect();a.onload()};document.createElement("canvas");this.onload=function(){};var d=document.createElement("canvas"),w=d.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var z=
128,x=180,t=128,r=80,c;var l=128;var n=x;var m=128;var A=80;var F=!(c={x:128,y:x+60,w:128,h:40}),Q=[],T=[],U=[];this.connect=function(){e.imageSmoothingEnabled=!1;a.format(0,"#ffffff")};this.format=function(p,C){p=void 0===p?0:p;C=void 0===C?"#ffffff":C;void 0===d[p]&&(d[p]=document.createElement("canvas"),w[p]=d[p].getContext("2d"));w[p].drawImage(g,0,0,128,128,0,0,128,128);w[p].globalCompositeOperation="source-atop";w[p].fillStyle=C;w[p].fillRect(0,0,128,128);w[p].globalCompositeOperation="source-out"};
this.resize=function(p,C,E){a.scale=E;var D=window.devicePixelRatio,M=300>Math.ceil(D)/D*p?Math.floor(D):Math.ceil(D);0!=M-D&&(E=M/D);1>=D&&1<a.scale&&(E=a.scale);this.width=p/E;this.height=C/E;this.renderer.width=this.width;this.renderer.height=this.height;xa.setSize(this.width,this.height);a.scale=E;this.renderer.style.transform="scale("+E+","+E+")";xa.domElement.style.transform="scale("+E+","+E+")";this.renderer.style.transformOrigin="top left";xa.domElement.style.transformOrigin="top left";e.imageSmoothingEnabled=
!1;this.redraw();z=128;x=180;t=128;r=80;l=128;n=x;m=128;A=80;c={x:128,y:x+60,w:128,h:40};this.automate(this.width,this.height)};this.update=function(p){var C=0,E;for(E in p)for(var D in U)if(p[E].x>U[D].x*a.scale&&p[E].y>U[D].y*a.scale&&p[E].x<U[D].w*a.scale&&p[E].y<U[D].h*a.scale&&(C++,1==p[E].start)){U[D].funct();p[E].start=!1;break}};this.print=function(p,C,E,D){D=void 0===D?1:D;for(var M=0,ba=a.compile(C,a.width,a.col),N=a.compile(E,a.height,a.row),K=a.style;M<p.length;)a.encode(p.charAt(M),ba+
M*a.col*D,N,D),M++;F||Q.push(function(){a.style=K;a.print(p,C,E,D)})};this.text=function(p,C,E,D,M){D=void 0===D?1:D;for(M=0;M<p.length;)a.encode(p.charAt(M),C+M*a.col*D,E,D),M++};this.button=function(p,C,E,D,M,ba,N,K){N=void 0===N?!0:N;K=void 0===K?1:K;var Y=a.compile(C,a.width,a.col),ka=a.compile(E,a.height,a.row),ha=a.compile(D,a.width,a.col),na=a.compile(M,a.height,a.row),la=a.style;N&&(e.drawImage(d[a.style],0,0,1,1,Y,ka+na/2,ha+1,1),e.drawImage(d[a.style],0,0,1,1,Y,ka-na/2,ha+1,1),e.drawImage(d[a.style],
0,0,1,1,Y,ka-na/2,1,na),e.drawImage(d[a.style],0,0,1,1,Y+ha-1,ka-na/2,1,na));for(var ca=0;ca<p.length;)a.encode(p.charAt(ca),Y+ca*a.col+ha/2-Math.round(p.length*a.col)/2+2,ka-a.row/2,K),ca++;U.push({x:Y,y:ka-na/2,w:Y+ha,h:ka+na/2,funct:function(){ba()}});F||Q.push(function(){a.style=la;a.button(p,C,E,D,M,ba,N,K)})};this.line=function(p,C,E,D){a.sprite(0,0,1,1,p,C,E,D)};this.sprite=function(p,C,E,D,M,ba,N,K){var Y=a.compile(M,a.width,a.col),ka=a.compile(ba,a.height,a.row),ha=a.compile(N,a.width,a.col),
na=a.compile(K,a.height,a.row),la=a.style;e.drawImage(d[a.style],p,C,E,D,Y,ka,ha,na);F||Q.push(function(){a.style=la;a.sprite(p,C,E,D,M,ba,N,K)})};this.backdrop=function(p,C,E,D,M){p=void 0===p?"#10101099":p;!1===p?(a.clear(),a.renderer.style.background="transparent"):(a.clear(),a.renderer.style.background=p)};this.getDrawList=function(){return Q};this.redraw=function(){F=!0;a.clear();for(var p=0;p<Q.length;p++)Q[p]();p=document.body.getElementsByTagName("input");for(var C=0;C<p.length;C++)a.text(p[C].value,
p[C].style.top,p[C].style.left);F=!1};this.automate=function(p,C){p=Math.floor(p/3)-2;C=Math.floor(C/4);t>p&&(t=p,z=p,m=p,l=p,c.w=p,c.x=p);x>C&&(x=C+40,n=x,c.y=x+60)};this.pad=function(p,C,E,D,M,ba,N){var K=0;for(N();K<fa.touches.length;)fa.touches[K].x>C*a.scale&&fa.touches[K].y>E*a.scale&&fa.touches[K].x<(C+D)*a.scale&&fa.touches[K].y<(E+M)*a.scale&&ba(),K++;Na&&(e.drawImage(d[a.style],0,0,1,1,C+1,E,D-1,1),e.drawImage(d[a.style],0,0,1,1,C+1,E+M,D-1,1),e.drawImage(d[a.style],0,0,1,1,C+1,E,1,M),e.drawImage(d[a.style],
0,0,1,1,C+D-1,E,1,M));a.encode(p,C+D/2-a.col/2,E+M/2-a.row/2)};this.dpad=function(){e.drawImage(d[a.style],88,88,40,40,a.width-l+m/2-20,a.height-n+A/2-20,40,40);a.pad("<",z-t-1,a.height-x,t,r,function(){fa.LEFT=!0},function(){fa.LEFT=!1});a.pad(">",z+1,a.height-x,t,r,function(){fa.RIGHT=!0},function(){fa.RIGHT=!1});a.pad("^",a.width-l,a.height-n,m,A,function(){fa.UP=!0},function(){fa.UP=!1});a.pad("b",a.width-c.x,a.height-c.y+c.h/2,c.w,c.h,function(){fa.DOWN=!0},function(){fa.DOWN=!1})};this.clear=
function(){if(!F){for(var p=document.body.getElementsByTagName("input"),C=0;C<p.length;C++)document.body.removeChild(p[C]);if(!a.REDRAW){Q=[];for(p=0;p<T.length;p++)document.body.removeChild(T[p]);T=[]}Q=[]}U=[];e.clearRect(0,0,a.width,a.height)};this["delete"]=function(p,C,E,D){C=void 0===C?0:C;E=void 0===E?xa.width:E;D=void 0===D?xa.height:D;p=a.compile(void 0===p?0:p,a.width,a.col);C=a.compile(C,a.height,a.row);E=a.compile(E,a.width,a.col);D=a.compile(D,a.height,a.row);e.clearRect(p,C,E,D)};this.encode=
function(p,C,E,D){D=void 0===D?1:D;var M=p.charCodeAt(0);p=8*M%128;M=8*Math.floor(M/16);e.clearRect(C,E,8,8);e.drawImage(d[a.style],p,M,8,8,C,E,8*D,8*D)};this["float"]=function(p,C){var E=Math.floor(Math.abs(100*p));E=E.toString();var D=E.slice(0,E.length-2),M=E.slice(E.length-2,E.length);return 0==p?"0.00":(0==D.length&&(D="0"),2>M.length&&(M+="0"),C&&0<p?D="+"+D:0>p&&(D="-"+D),E=D+"."+M,E)};this.compile=function(p,C,E){var D=0;switch(C=Math.floor(C),typeof p){case "number":D=p;break;case "function":D=
p();break;case "string":for(var M=!1,ba=1,N=0,K="";N<p.length;){var Y=p.charAt(N);"."===Y?(K+=Y,M=!0):"+"===Y?(K=M?Number(K)*C:Number(K)*E,K*=ba,ba=1,D+=K,M=!1,K=""):"-"===Y?(K=M?Number(K)*C:Number(K)*E,K*=ba,ba=-1,D+=K,M=!1,K=""):"p"===Y?(K=Number(K),K*=ba,D+=K,K=""):N===p.length-1?(K+=Y,K=M?Number(K)*C:Number(K)*E,K*=ba,D+=K,K=""):K+=Y;N++}}return D};this.textinput=function(p,C,E,D,M,ba,N){var K=a.compile(C,a.width,a.col),Y=a.compile(E,a.height,a.row),ka=a.compile(D,a.width,a.col),ha=a.compile(M,
a.height,a.row),na=a.style;if(F)a.text("> "+N.value,K,Y+ha/2);else{(N=document.createElement("input")).type="text";N.id=ba;N.name=ba;N.value=p;N.style.position="fixed";N.style.top=Y+"px";N.style.left=K+"px";N.style.width=ka+"px";N.style.height=ha+"px";N.style.paddingLeft="12px";N.style.fontSize="14px";N.style.zIndex=9999;N.style.opacity=0;N.maxlength=10;a.text("> "+N.value,K,Y+ha/2);document.body.appendChild(N);window.setTimeout(function(){N.focus();N.select()},200);N.oninput=function(){la()};N.onfocusout=
function(){la()};N.onfocusin=function(){la()};N.onclick=function(){la()};var la=function(ca){a["delete"](K,Y,ka,ha);a.text("> "+N.value,K,Y+ha/2);a.text("_",N.selectionStart*a.col+2*a.col+K,Y+ha/2)};Q.push(function(){a.style=na;a.textinput(N.value,C,E,D,M,ba,N)})}};this.link=function(p,C,E,D,M,ba,N,K){var Y=a.compile(C,a.width,a.col)*a.scale,ka=a.compile(E,a.height,a.row)*a.scale,ha=a.compile(D,a.width,a.col)*a.scale,na=a.compile(M,a.height,a.row)*a.scale,la=a.style;F||Q.push(function(){return new function(){a.style=
la;ca.style.left=Y+"px";ca.style.top=ka+"px";ca.style.width=ha+"px";ca.style.height=na+"px";a.print(p,Y,ka)}});var ca=document.createElement("a");ca.href=ba;ca.style.left=Y+"px";ca.style.top=ka+"px";ca.style.width=ha+"px";ca.style.height=na+"px";ca.style.display="block";ca.style.zIndex=400;ca.style.position="fixed";ca.target="_blank";ca.id=ba;document.body.appendChild(ca);T.push(ca);F=!0;a.print(p,Y,ka);F=!1}}function xb(){function a(){if(r)for(var J=0;1>J;){ja.geometry.vertices[Ba].copy(t.direction);
ja.geometry.vertices[Ba].multiplyScalar(-1-Math.random()*La);ja.geometry.vertices[Ba].add(t.position);ja.geometry.vertices[Ba].life=ja.geometry.vertices[Ba].maxLife;Math.random();Math.random();Math.random();var ua=.1*-Math.random();ja.geometry.vertices[Ba].acc.copy(t.direction);ja.geometry.vertices[Ba].acc.multiplyScalar(ua);Ba++;Ba%=ja.geometry.vertices.length;J++}for(var ta in ja.geometry.vertices)0<ja.geometry.vertices[ta].life&&(ja.geometry.vertices[ta].add(ja.geometry.vertices[ta].acc),--ja.geometry.vertices[ta].life,
ja.geometry.colors[ta].setHSL(0,0,ja.geometry.vertices[ta].life/100)),0>=ja.geometry.vertices[ta].life&&(ja.geometry.vertices[ta].set(0,0,0),ja.geometry.vertices[Ba].acc.x=0,ja.geometry.vertices[Ba].acc.y=0,ja.geometry.vertices[Ba].acc.z=0);ja.geometry.verticesNeedUpdate=!0;ja.geometry.colorsNeedUpdate=!0;ja.geometry.computeBoundingSphere()}var e=this;this.TEXTTIME=this.SPEED="";this.END=this.START=!1;this.OBJECTIVE=0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return T};this.CAMERA=
1;this.FPV=!1;var g=[],d=0,w=1/60*1E3,z=1,x=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),t={position:new THREE.Vector3,normal:new THREE.Vector3,direction:new THREE.Vector3,rotation:0},r=!1,c=!1,l=!0,n=!1,m=1,A=0,F=[],Q=0,T=0,U=0,p=0,C=!1,E=!1,D=!1,M=0,ba=0,N=0;this.DT=function(){return 1};var K={power:3,drag:1,mass:1,brake:3,sensitivity:2,ease:0},Y=0,ka=0,ha=0;Y=.004;ka=.985-.98;ha=.015;var na,la,ca,Ia=6,La,k=0,h=0,f=0,y=new THREE.Vector3(0,1,0),u=
new THREE.Vector3(0,0,0),q=new THREE.Vector3,S=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var B=new THREE.Vector3(0,0,1),I=new THREE.Vector3(0,0,1),H=new THREE.Vector3(0,0,1),P=new THREE.Vector3(0,0,1),Z=new THREE.Vector3(0,0,-.008),V=new THREE.Vector3,va=new THREE.Vector3,Aa=new THREE.Vector3,wa=new THREE.Vector3,Fa=[],Ka=new THREE.Vector3(0,0,1),Pa=new THREE.Raycaster(wa,Ka,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,
x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var Qa=[{name:"logistics crate",geometry:function(){return ab.logistics_crate()}},{name:"ag-86",geometry:function(){return ab.ag_86()}}];this.models=function(){return Qa};this.PAINT=0;var Wa=new THREE.MeshBasicMaterial({color:Va[e.PAINT]}),
ma=(new THREE.LineSegments(Qa[e.MODEL].geometry(),Wa)).clone();ma.name="Vehicle";for(var Ba=0,Xa=new THREE.Geometry;100>Xa.vertices.length;){var Ra=new THREE.Vector3(0,0,0);Ra.life=0;Ra.maxLife=100;Ra.acc=new THREE.Vector3(0,0,0);Xa.vertices.push(Ra);Ra=new THREE.Color(4294967040);Xa.colors.push(Ra)}Xa.verticesNeedUpdate=!0;var ja=new THREE.Points(Xa,new THREE.PointsMaterial({size:.1,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));ja.name="Emitter";this.init=function(){};
this.connect=function(J,ua){ma.copy(new THREE.LineSegments(Qa[e.MODEL].geometry(),Wa));ma.name="Vehicle";ma.geometry.computeBoundingSphere();Aa.copy(J);V.copy(Aa);ma.position.copy(Aa);va.copy(V);aa.add(ma);aa.add(ja);e.tune.power();e.tune.drag();e.tune.sensitivity();e.tune.ease();aa.fog=new THREE.FogExp2(X[0],.005);W.fov=90;W.updateProjectionMatrix();aa.add(O.generate.stars);n=!1;window.setTimeout(function(){n=!0},1E3);O.SNOW&&aa.add(O.snow.mesh);g=[];d=0;p=Ea;g[0]={position:V.clone(),normal:new THREE.Vector3(0,
0,1),direction:new THREE.Vector3(0,1,0),camera:new THREE.Vector3,rotation:0,velocity:new THREE.Vector3,time:Ea};ia.reset()};this.disconnect=function(){e.reset();aa.remove(ma);aa.remove(ja);aa.fog=new THREE.FogExp2(X[0],0);aa.remove(O.generate.stars)};this.ready=function(){r&&(ia.reset(),p=window.performance.now(),A=0,e.START=!0)};this.reset=function(){if(e.END&&F[3]+T<O.best[3])for(var J in O.best)O.best[J]=3===J?A+T:F[J];n=Ma=this.END=this.START=!1;fa.UP=!1;fa.DOWN=!1;fa.LEFT=!1;R=L=c=r=fa.RIGHT=
!1;A=0;F=[];N=U=T=M=0;V.copy(Aa);va.copy(V);y.set(0,1,0);q.set(0,0,0);P.set(0,0,1);ma.copy(new THREE.LineSegments(Qa[e.MODEL].geometry(),Wa));ma.lookAt(P);k=h=0;W.position.copy(V);W.position.add(y.clone().multiplyScalar(-60));W.position.z+=40;W.up.set(0,0,1);W.lookAt(ma.position);W.updateProjectionMatrix();xa.render(aa,W);da.reset();window.setTimeout(function(){n=!0},1E3);for(J=0;J<qa.length;J++)qa[J].reset();ia.reset();g=[];d=0;p=Ea;g[0]={time:Ea,position:V.clone(),normal:P.clone(),direction:new THREE.Vector3(0,
1,0),camera:W.position.clone(),velocity:new THREE.Vector3,rotation:0}};this.update=function(){R=Ma||e.END||!n?(r=!1,c=!1,L=!1):(r=fa.UP,c=fa.DOWN,L=fa.LEFT,fa.RIGHT);var J=0;if(Ea>g[d].time){var ua={};Object.assign(ua,g[d]);var ta=ua.time;g=[];d=0;g.push({time:ta,position:ua.position.clone(),normal:ua.normal.clone(),direction:ua.direction.clone(),velocity:ua.velocity.clone(),rotation:ua.rotation,camera:ua.camera.clone()});for(var Ga=window.performance.now();ta<Ga;){ta+=w;g.push({time:ta,position:g[d].position.clone(),
normal:g[d].normal.clone(),direction:g[d].direction.clone(),velocity:g[d].velocity.clone(),camera:ua.camera.clone(),rotation:g[d].rotation});d=g.length-1;var mb=Ga=void 0;0!=(mb=L&&R?0:L?1:R?-1:0)&&Math.abs(f)<Ia?f+=mb:Math.abs(f)>Ia?(Ga=f/Math.abs(f),f=Ia*Ga):0<Math.abs(f)&&(Ga=f/Math.abs(f),f-=f/Math.abs(f),f/Math.abs(f)!=Ga&&(f=0));k=f/Ia*ca;g[d].rotation+=k;La=g[d].velocity.length();Ga=void 0;r&&l&&(u.copy(g[d].direction),u.multiplyScalar(na),g[d].velocity.add(u));c&&l&&g[d].velocity.multiplyScalar(.95);
l?(D=!1,Ga=E?la-.01:la,g[d].velocity.multiplyScalar(Ga)):l||(D?g[d].velocity.add(Z):D=!0,g[d].velocity.multiplyScalar(.998));g[d].position.add(g[d].velocity);x.position.copy(g[d].position);wa.copy(g[d].position);wa.z-=50;Fa=[];Ka.set(0,0,1);Pa.far=100;Pa.set(wa,Ka);O.surface.raycast(Pa,Fa);0<Fa.length?(wa.copy(Fa[0].point),E=g[d].position.z<wa.z&&5>Math.abs(g[d].position.z-wa.z)?(Q=0,l=!0,I.copy(Fa[0].face.normal),g[d].position.copy(wa),1!==Fa[0].face.color.r):l=!1):0===Fa.length&&(l=!1,E=!1,r||c||
L||R||(Q+=w),1E3<Q&&!e.END&&!Ma&&(Ma=!0,oa.dnf()));I.clone().multiplyScalar(1);H.lerp(I,D?.001:.25);P.copy(H);P.add(g[d].position);g[d].normal=H.clone();x.lookAt(P);x.rotateOnAxis(B,g[d].rotation);y.copy(x.localToWorld(S.clone()));y.sub(g[d].position);y.normalize();g[d].direction.copy(y);(function(){Fa=[];Ka.copy(g[d].position);Ka.sub(g[d-1].position);Ka.normalize();Pa.far=Ka.length();Pa.set(g[d].position,Ka);for(var za=0,ra=!1,bb=N;5>bb;bb++)if(O.generate.checkpoints[bb].collision.raycast(Pa,Fa),
0<Fa.length){za=bb;ra=!0;break}if(C=!1,ra){var ya;ra=Math.floor(100*A)/100;if(za===N)O.generate.checkpoints[N].display.material.color=X[4],0<N&&(F[N-1]=ra,b["delete"](16,32,b.width-16,16),ya=Number.isNaN(O.best[N-1])?"+1 cp":ra-O.best[N-1],b.style=0<ya?4:0>ya?1:2,ya=0<ya?"(-"+b["float"](ya)+")":"+1 cp"===ya?"+1 cp":"(+"+b["float"](Math.abs(ya))+")",b.text(ya,16,32),b.style=0),4===N&&(C=!0,F[za-1]=ra,F[za]=ra+T,M=A+T<O.best[3]?100-T+Math.floor(10*(O.best[3]-(ra+T))):100-T,ba+=M,e.END=!0,fa.RESET=!1,
oa.complete()),C=!0,N++;else{C=!0;for(ya=N-1;ya<za-1;ya++)0<=ya&&(F[ya]="-",U++);T=25*U;4===za?(F[za-1]=ra,F[za]=ra+T,M=A+T<O.best[3]?100-T+Math.floor(10*(O.best[3]-(A+T))):100-T,ba+=M,N=0,e.END=!0,fa.RESET=!1,oa.complete()):(F[za-1]=ra,N=za+1,b["delete"]("2","4","30","1"),b.style=2,b.text("missed checkpoint x "+U.toString()+" ( -"+T.toString()+".00 )",16,32),b.style=0);C=!0;O.generate.checkpoints[za].display.material.color=X[4]}}e.SPEED=Math.round(60*La/1E3*3600);e.START&&!e.END&&(A=(Ea-p)/1E3);
e.OBJECTIVE=N;va.copy(V)})();J++;e.START&&da.record(e);x.updateMatrix();Ga=window.performance.now()}}if(z=(w-(g[d].time-Ea))/w,1<z&&(z=1),1<g.length)t.position.copy(g[d-1].position),t.position.lerp(g[d].position,z),t.normal.copy(g[d-1].normal),t.normal.lerp(g[d].normal,z),t.normal.multiplyScalar(5),J=t.normal.clone(),J.add(t.position),t.rotation=g[d].rotation,t.rotation-=g[d-1].rotation,t.rotation=g[d-1].rotation+t.rotation*z,t.direction.copy(g[d-1].direction),t.direction.lerp(g[d].direction,z),t.direction.multiplyScalar(5),
t.direction.normalize(),ma.position.copy(t.position),ma.lookAt(J),ma.rotateOnAxis(B,t.rotation),function(){if(e.FPV)e.fpv();else{var za=Ma||e.END?1E-5:.1,ra=t.direction.clone();ra.multiplyScalar(-e.cameras[0].distance+4*(b.scale-1));ra.add(t.position);ra.z+=e.cameras[0].z;W.position.lerp(ra,za);W.lookAt(ma.position)}}(),a();this.START||this.ready()};this.results=function(){return{reward:M,yen:ba}};this.AT=function(){return A};this.CP=function(){return F.slice()};this.replay=function(J){J={TS:ia.time};
da.frame=da.convert(da.tape,J,da.frame);t.position.copy(J.position);H.copy(J.lookTarget);t.rotation=J.rotation;t.normal.copy(H);t.normal.add(t.position);ma.position.copy(t.position);ma.lookAt(t.normal);ma.rotateOnAxis(B,t.rotation);t.direction.copy(ma.localToWorld(S.clone()));t.direction.sub(t.position);t.direction.normalize();r=J.UP;C=J.CHECK;t.rotation=J.rotation;N=J.objective;J=t.position.clone();if(C&&(O.generate.checkpoints[N].display.material.color=X[4]),3===e.CAMERA)e.fpv();else{var ua=1,ta=
1;e.CAMERA===m&&(ua=e.cameras[1].lerp,ta=1);m=e.CAMERA;J.x+=e.cameras[e.CAMERA].x;J.y+=e.cameras[e.CAMERA].y;J.z+=e.cameras[e.CAMERA].z;W.up.set(0,0,1);W.position.lerp(J,ua);e.cameras[m].lookAt.lerp(t.position,ta);W.lookAt(e.cameras[m].lookAt)}a()};this.record=function(){return{position:g[d].position.clone(),lookTarget:g[d].normal.clone(),UP:r,AT:A,TS:da.tape.length*w,rotation:g[d].rotation,objective:N,check:C}};this.fpv=function(){W.position.copy(t.position);var J=ma.localToWorld(new THREE.Vector3(0,
0,5));J.sub(t.position);J.normalize();W.up.copy(J);J=t.direction.clone();J.add(t.position);W.lookAt(J)};this.tune={power:function(J){J=void 0===J?K.power:J;K.power=0>J?0:5<J?5:J;na=.016+K.power/5*Y},drag:function(J){J=void 0===J?K.drag:J;K.drag=0>J?0:5<J?5:J;la=.985-K.drag/5*ka},sensitivity:function(J){J=void 0===J?K.sensitivity:J;K.sensitivity=0>J?0:5<J?5:J;ca=.06+K.sensitivity/5*ha},ease:function(J){J=void 0===J?K.ease:J;K.ease=0>J?0:5<J?5:J;Ia=6+K.ease}};this.param=function(){return array=Object.assign(K,
[]),array.model=Qa[e.MODEL].name,array};this.paint=function(J){J=void 0===J?e.PAINT:J;e.PAINT=J;Wa.color.set(Va[J]);Wa.needsUpdate=!0};this.body=function(){ma.geometry.dispose();ma.geometry=Qa[e.MODEL].geometry().clone();ma.geometry.verticesNeedUpdate=!0};this.yen=function(){return oa.cSave("YEN",ba),ba};this.debug=function(){console.log("position:",ma.position,V);console.log("direction:",y);console.log("rotation:",h);console.log("dt:",1);console.log("TIME:",Ea);console.log("TAPES:",Math.ceil(Ea-
p)/w);console.log("INTERPOLATION:",z);console.log("PHYSICS MESH:",x.rotation);console.log("TAPE VELOCITY",g[d].velocity);console.log(g);console.log(Q)}}function yb(a){var e=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return e.tape[g].timer};this.DT=eb();var g=0;this.SCAN=!1;this.capture=function(d){return{position:(new THREE.Vector3).copy(d.position),normal:(new THREE.Vector3).copy(d.normal),lookTarget:d.lookTarget.clone(),rotation:d.rotation,timer:d.getTime(),
objective:d.getObjective(),check:d.check,UP:d.UP}};this.record=function(d){e.tape[g]=d.record();g=24E4<e.tape[g].TS?0:g+1};this.play=function(d){if(this.RECORD){this.RECORD=!1;for(var w=e.frame=0;w<qa.length;w++)qa[w].reset();ia.reset()}if(e.frame>e.tape.length-10){e.frame=0;ia.reset();for(w=0;w<qa.length;w++)qa[w].reset();O.generate.resetCheckpoints()}if(d.replay(),this.tape[e.frame].check)O.generate.checkpoints[0===this.tape[e.frame].objective?4:this.tape[e.frame].objective-1].display.material.color=
X[4]};this.reset=function(){O.generate.resetCheckpoints();g=0;e.frame=0;ia.reset();e.PLAY=!1;e.RECORD=!0;e.tape=[]};this["export"]=function(d){d=void 0===d?function(){oa.results()}:d;if((!1===Ua||G.CP()[4]<Ua&&!e.SCAN)&&""!==ea&&null!==ea&&!1!==pa&&void 0!==pa){b.print("uploading vhs to db","2","2");Ua=G.CP()[4];pa;for(var w=O.name,z=G.CP()[4],x=G.CP().slice(),t=G.MODEL,r=G.PAINT,c=e.save(e.tape),l=[],n=0;n<c.length;n++){var m="";m+=e.burn(c[n].TS);m+="#";m+=e.burn(Math.round(100*c[n].AT)/100);m+=
"#";m+=e.burn(c[n].position.x);m+="#";m+=e.burn(c[n].position.y);m+="#";m+=e.burn(c[n].position.z);m+="#";m+=e.burn(c[n].lookTarget.x);m+="#";m+=e.burn(c[n].lookTarget.y);m+="#";m+=e.burn(c[n].lookTarget.z);m+="#";m+=e.burn(c[n].rotation);l.push(m)}r={version:"005",id:pa,seed:w,time:Math.round(100*z)/100,cp:x,data:l,model:t,paint:r};firebase.database().ref("vhs/005/"+r.seed+"/"+pa).set(r,function(A){A?(b.clear(),b.print("network error","2","2")):(b.clear(),b.print("vhs succesfully submitted","2",
"2"));window.setTimeout(d,1E3)})}else void 0===pa||!1===pa||null===ea||""===ea||void 0===ea?oa.register():oa.results()};this.burn=function(d){return Math.round(1E9*d).toString(16)};this.read=function(d){return parseInt(d,16)/1E9};this.scan=function(d,w){e.SCAN=!0;var z=[];firebase.database().ref("vhs/005/"+d).orderByChild("time").limitToFirst(99).once("value").then(function(x){x.forEach(function(t){var r=t.child("id").val();t=t.child("time").val();z.push({uid:r,time:t})});e.SCAN=!1;w(z)})};this.checkTime=
function(d,w,z){d===w&&(Ua=z)};this.requestName=function(d,w){firebase.database().ref("uid/"+d).once("value").then(function(z){z=z.child("name").val();return w(z),z})};this["import"]=function(d,w){w=void 0===w?function(){}:w;firebase.database().ref("vhs/005/"+d).once("value").then(function(z){var x=z.val(),t=x.id,r=x.seed,c=x.cp.slice(),l=[],n=x.model;z=x.paint;for(var m=0;m<x.data.length;m++){for(var A=0,F=[""],Q=0;Q<x.data[m].length;Q++)"#"===x.data[m].charAt(Q)?(F[A]=e.read(F[A]),A++,F[A]=""):
F[A]+=x.data[m].charAt(Q);F[8]=e.read(F[8]);l[m]={TS:F[0],AT:F[1],position:new THREE.Vector3(F[2],F[3],F[4]),lookTarget:new THREE.Vector3(F[5],F[6],F[7]),rotation:F[8]}}e.save(l,1E3/60);w({uid:t,seed:r,cp:c,model:n,paint:z,tape:l.slice()})})};this.save=function(d,w){w=void 0===w?1E3/30:w;for(var z=0,x=[],t=d[d.length-1].TS,r=0;r<t;)r+=w,r<t&&x.push({TS:r});for(t=0;t<x.length;t++)z=e.convert(d,x[t],z);return x};this.convert=function(d,w,z){for(var x=d[z].TS,t=d[z+1].TS,r=t-x;w.TS>t&&z<d.length-2;)x=
d[++z].TS,t=d[z+1].TS,r=t-x;x=z;var c=z+1;t=(r-(t-w.TS))/r;return w.position=new THREE.Vector3,w.position.copy(d[x].position),w.position.lerp(d[c].position,t),w.lookTarget=new THREE.Vector3,w.lookTarget.copy(d[x].lookTarget),w.lookTarget.lerp(d[c].lookTarget,t),w.rotation=(d[c].rotation-d[x].rotation)*t,w.rotation+=d[x].rotation,w.rotation=(d[c].rotation-d[x].rotation)*t,w.rotation+=d[x].rotation,w.AT=(d[c].AT-d[x].AT)*t,w.AT+=d[x].AT,w.UP=d[x].UP,w.check=d[x].check,w.objective=d[x].objective,z}}
var gb=function(a,e,g,d){e=void 0===e?0:e;g=void 0===g?0:g;d=void 0===d?[]:d;var w=this,z=a.slice();this.tape=z;var x=this.frame=0,t=new THREE.Vector3(0,0,1),r=new THREE.Vector3,c=new THREE.Vector3,l=new THREE.Vector3(0,0,1),n=new THREE.Vector3,m=new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;this.direction=new THREE.Vector3;var A,F=[{name:"logistics crate",geometry:function(){return ab.logistics_crate()}},{name:"ag-86",geometry:function(){return ab.ag_86()}}][e].geometry(),Q=new THREE.MeshBasicMaterial({color:Va[g]}),
T=new THREE.LineSegments(F,Q);T.name="ghost_"+qa.length;T.position.copy(z[0].position);aa.add(T);x=0;cp=d.slice();(cp[4]<O.best[4]||null==O.best[4])&&(O.best=cp.slice());this.reset=function(){ia.reset();x=0;w.update()};this.update=function(){var U={TS:ia.time};x=da.convert(z,U,x);r.copy(U.position);l.copy(U.lookTarget);A=U.rotation;n.copy(l);n.add(r);T.position.copy(r);T.lookAt(n);T.rotateOnAxis(t,A);c.copy(T.localToWorld(m.clone()));c.sub(r);c.normalize();w.position.copy(r);w.direction.copy(c);w.frame=
x};this.disconnect=function(){aa.remove(T);F.dispose();Q.dispose()}};window.onload=function(){window.addEventListener("touchstart",kb);window.addEventListener("contextmenu",function(){event.preventDefault()});aa=new THREE.Scene;aa.background=nb;ob=new THREE.Vector3(0,0,1);W=new THREE.PerspectiveCamera;W.up=ob;W.position.z=2E3;W.lookAt(0,0,0);W.fov=70;W.near=1E-4;W.far=3E3;W.name="Camera";aa.add(W);xa=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});xa.setClearColor(nb);
xa.domElement.id="renderer";xa.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(xa.domElement);fa=new pb;fa.connect();b=new wb;O=new rb;G=new xb;da=new yb;oa=new tb;oa.login();oa.checksave();oa.decodeURL();G.init();b.onload=function(){b.format(1,"#50ffae");b.format(2,"#999999");b.format(3,"#75e8ff");b.format(4,"#ff7272");b.format(5,"#eeeeee");W.position.set(0,25,10);W.lookAt(0,0,0);Za();lb();oa.intro()}};window.onresize=Za;window.fullscreenchange=Za;window.focus=Za;var Ya=
"ato mountain;eha pass;eva tribute;funano mountain;ginko mountain;hefuhi mountain;hewae forest;hollow touge;ima pass;inutsuwa pass;irohazaka;kamomi pass;kikeori mountain;kodama forest;koehako mountain;kokiri forest;kuu forest;machi pass;machiuso mountain;mamushi mountain;mea pass;meikiru mountain;meina pass;mise pass;miuchin pass;moko mountain;momo mountain;morioto pass;morua pass;mumetsu pass;nake forest;nani mountain;nawowako mountain;nechika forest;neiwika mountain;nekona forest;neni pass;netata pass;niawi pass;nkake pass;nme forest;nosuyowo forest;ntsuna forest;oyuni pass;procedural;rafu forest;ran forest;raranike mountain;reoyana pass;rihama pass;rihayoya pass;rononi mountain;ruchitesu pass;ryuk mountain;senuteme pass;sesh mountain;shiomawa pass;shiwa forest;sowe forest;tamuro mountain;tase mountain;tena forest;teyawochi mountain;titan forest;tokoheru forest;tsukeoshi mountain;tsuraku mountain;tsuruchihi mountain;tsurutsu pass;ui pass;umoai mountain;wanano forest;wawako pass;woihime pass;woka mountain;worenaku mountain;yaa pass;yakayu pass;yasoha mountain;yosurora mountain;yoyatsushi pass;yume pass;yuyuke pass".split(";"),
X=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],hb;for(hb in X){var zb=new THREE.Color(X[hb]);X[hb]=zb}var Va=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],ub="snow sakura melon peach bumblebee lavender ice".split(" "),Ua=!1,Sa="",Oa=Math.floor(2147483647*Math.random()),jb="",aa,W,xa,O,G,fa,b,da,oa,qa=[],Ca=12,$a=9,Da=0,fb=!1,pa=null,ea="",ob,Ha=!1,nb=X[0],sb=0,Ma=!1,Ta=!1,sa=!1,db=!1,Ja=!1,Na=!0,Ea=0,cb=!1;firebase.initializeApp({apiKey:"AIzaSyB8RCC02kiLKX3Vm5bUCKDdYgKKVyMRh_0",
authDomain:"ssio-live.firebaseapp.com",databaseURL:"https://ssio-live-default-rtdb.firebaseio.com",projectId:"ssio-live",storageBucket:"ssio-live.appspot.com",messagingSenderId:"205970490845",appId:"1:205970490845:web:fa37aac1e169e6feade234",measurementId:"G-54D3B95XY3"});firebase.analytics();var ab={ag_86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,
1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),
geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logistics_crate:function(){var a=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return a.name="Logistics Crate",a}},qb=function(){function a(z){return z*z*z*(z*(6*z-15)+10)}function e(z,
x,t){return x+z*(t-x)}function g(z,x,t,r){var c=15&z;z=8>c?x:t;r=4>c?t:12==c||14==c?x:r;return(0==(1&c)?z:-z)+(0==(2&c)?r:-r)}for(var d=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,
132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,
29,24,72,243,141,128,195,78,66,215,61,156,180],w=0;256>w;w++)d[256+w]=d[w];return{noise:function(z,x,t){var r=Math.floor(z),c=Math.floor(x),l=Math.floor(t),n=255&r,m=255&c,A=255&l,F=(z-=r)-1,Q=(x-=c)-1,T=(t-=l)-1,U=a(z),p=a(x);r=a(t);c=d[n]+m;l=d[c]+A;c=d[c+1]+A;n=d[1+n]+m;m=d[n]+A;A=d[n+1]+A;return e(r,e(p,e(U,g(d[l],z,x,t),g(d[m],F,x,t)),e(U,g(d[c],z,Q,t),g(d[A],F,Q,t))),e(p,e(U,g(d[l+1],z,x,T),g(d[m+1],F,x,t-1)),e(U,g(d[c+1],z,Q,T),g(d[A+1],F,Q,T))))}}},vb=function(a,e){for(var g="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e".split(" "),
d="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),w=a.toLowerCase(),z=0;z<w.length;z++){var x=w.charCodeAt(z);if(122<x||57<x&&61>x||33>x||40==x||41==x)return"";x="";for(var t=z;t<w.length;t++){w.charAt(t);var r=w.charCodeAt(t);(48<=r&&57>=r||97<=r&&122>=r)&&(x+=r.toString(16));for(r=0;r<g.length;r++){for(var c="",l="",n=[],m=0,A=0,F=0;F<g[r].length;F+=2){var Q=x.charAt(F+m)+x.charAt(F+1+m),T=g[r].charAt(F)+g[r].charAt(F+1);if((Q===c||Q===l)&&0!==Q.length&&(A++,0<
A))for(;Q===c||Q===l;)m+=2,Q=x.charAt(F+m)+x.charAt(F+1+m);if(Q===T)n[F/2]=!0,c=Q,l=T;else{n[F/2]=!1;for(var U=0;U<d.length;U++){var p=d[U].charCodeAt(1).toString(16),C=d[U].charCodeAt(0).toString(16);Q===p&&(C===T?(n[F/2]=!0,c=p,l=T):C!==c&&C!==l||(A++,0<A&&(m+=2,F-=2)))}!1===n[F/2]&&(F=g[r].length)}}for(l=c=0;l<n.length;l++)if(!0===n[l]&&c++,c===n.length)return""}}}return a},ia={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){ia.start=window.performance.now();ia.time=
0;ia.last=0;ia.timestep=16.6667;ia.dt=1}},eb=function(){return ia.time=window.performance.now()-ia.start,ia.timestep=ia.time-ia.last,ia.dt=ia.timestep/(1E3/60),2<ia.dt&&(ia.dt=2),ia.last=ia.time,ia.dt};ia.convert=function(a){a=void 0===a?[]:a;for(var e="[\n",g=0;g<a.length;g++){e+="'";for(var d=0;d<a[g].length;d++)e+=a[g].charCodeAt(d).toString(16);e+="',\n"}return e+="]",console.log(e),e}})();